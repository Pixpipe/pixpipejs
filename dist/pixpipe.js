!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.pixpipe={})}(this,function(exports){"use strict";var ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array;function setMatrixArrayType(e){ARRAY_TYPE=e}var degree=Math.PI/180;function create$2(){var e=new ARRAY_TYPE(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function create$3(){var e=new ARRAY_TYPE(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function fromValues$3(e,t,r,n,i,a,s,o,l,u,c,h,f,d,p,g){var _=new ARRAY_TYPE(16);return _[0]=e,_[1]=t,_[2]=r,_[3]=n,_[4]=i,_[5]=a,_[6]=s,_[7]=o,_[8]=l,_[9]=u,_[10]=c,_[11]=h,_[12]=f,_[13]=d,_[14]=p,_[15]=g,_}function invert$3(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],s=t[4],o=t[5],l=t[6],u=t[7],c=t[8],h=t[9],f=t[10],d=t[11],p=t[12],g=t[13],_=t[14],y=t[15],m=r*o-n*s,v=r*l-i*s,b=r*u-a*s,w=n*l-i*o,E=n*u-a*o,T=i*u-a*l,k=c*g-h*p,x=c*_-f*p,S=c*y-d*p,I=h*_-f*g,A=h*y-d*g,M=f*y-d*_,N=m*M-v*A+b*I+w*S-E*x+T*k;return N?(N=1/N,e[0]=(o*M-l*A+u*I)*N,e[1]=(i*A-n*M-a*I)*N,e[2]=(g*T-_*E+y*w)*N,e[3]=(f*E-h*T-d*w)*N,e[4]=(l*S-s*M-u*x)*N,e[5]=(r*M-i*S+a*x)*N,e[6]=(_*b-p*T-y*v)*N,e[7]=(c*T-f*b+d*v)*N,e[8]=(s*A-o*S+u*k)*N,e[9]=(n*S-r*A-a*k)*N,e[10]=(p*E-g*b+y*m)*N,e[11]=(h*b-c*E-d*m)*N,e[12]=(o*x-s*I-l*k)*N,e[13]=(r*I-n*x+i*k)*N,e[14]=(g*v-p*w-_*m)*N,e[15]=(c*w-h*v+f*m)*N,e):null}function create$4(){var e=new ARRAY_TYPE(3);return e[0]=0,e[1]=0,e[2]=0,e}function length(e){var t=e[0],r=e[1],n=e[2];return Math.sqrt(t*t+r*r+n*n)}function fromValues$4(e,t,r){var n=new ARRAY_TYPE(3);return n[0]=e,n[1]=t,n[2]=r,n}function normalize(e,t){var r=t[0],n=t[1],i=t[2],a=r*r+n*n+i*i;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a),e}function dot(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function cross(e,t,r){var n=t[0],i=t[1],a=t[2],s=r[0],o=r[1],l=r[2];return e[0]=i*l-a*o,e[1]=a*s-n*l,e[2]=n*o-i*s,e}var len=length,forEach=(vec=create$4(),function(e,t,r,n,i,a){var s=void 0,o=void 0;for(t||(t=3),r||(r=0),o=n?Math.min(n*t+r,e.length):e.length,s=r;s<o;s+=t)vec[0]=e[s],vec[1]=e[s+1],vec[2]=e[s+2],i(vec,vec,a),e[s]=vec[0],e[s+1]=vec[1],e[s+2]=vec[2];return e}),vec;function create$5(){var e=new ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function fromValues$5(e,t,r,n){var i=new ARRAY_TYPE(4);return i[0]=e,i[1]=t,i[2]=r,i[3]=n,i}function normalize$1(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],s=r*r+n*n+i*i+a*a;return s>0&&(s=1/Math.sqrt(s),e[0]=r*s,e[1]=n*s,e[2]=i*s,e[3]=a*s),e}function transformMat4$1(e,t,r){var n=t[0],i=t[1],a=t[2],s=t[3];return e[0]=r[0]*n+r[4]*i+r[8]*a+r[12]*s,e[1]=r[1]*n+r[5]*i+r[9]*a+r[13]*s,e[2]=r[2]*n+r[6]*i+r[10]*a+r[14]*s,e[3]=r[3]*n+r[7]*i+r[11]*a+r[15]*s,e}var forEach$1=function(){var e=create$5();return function(t,r,n,i,a,s){var o=void 0,l=void 0;for(r||(r=4),n||(n=0),l=i?Math.min(i*r+n,t.length):t.length,o=n;o<l;o+=r)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],e[3]=t[o+3],a(e,e,s),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2],t[o+3]=e[3];return t}}();function create$6(){var e=new ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function setAxisAngle(e,t,r){r*=.5;var n=Math.sin(r);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r),e}function slerp(e,t,r,n){var i=t[0],a=t[1],s=t[2],o=t[3],l=r[0],u=r[1],c=r[2],h=r[3],f=void 0,d=void 0,p=void 0,g=void 0,_=void 0;return(d=i*l+a*u+s*c+o*h)<0&&(d=-d,l=-l,u=-u,c=-c,h=-h),1-d>1e-6?(f=Math.acos(d),p=Math.sin(f),g=Math.sin((1-n)*f)/p,_=Math.sin(n*f)/p):(g=1-n,_=n),e[0]=g*i+_*l,e[1]=g*a+_*u,e[2]=g*s+_*c,e[3]=g*o+_*h,e}function fromMat3(e,t){var r=t[0]+t[4]+t[8],n=void 0;if(r>0)n=Math.sqrt(r+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);var a=(i+1)%3,s=(i+2)%3;n=Math.sqrt(t[3*i+i]-t[3*a+a]-t[3*s+s]+1),e[i]=.5*n,n=.5/n,e[3]=(t[3*a+s]-t[3*s+a])*n,e[a]=(t[3*a+i]+t[3*i+a])*n,e[s]=(t[3*s+i]+t[3*i+s])*n}return e}var normalize$2=normalize$1,rotationTo=(tmpvec3=create$4(),xUnitVec3=fromValues$4(1,0,0),yUnitVec3=fromValues$4(0,1,0),function(e,t,r){var n=dot(t,r);return n<-.999999?(cross(tmpvec3,xUnitVec3,t),len(tmpvec3)<1e-6&&cross(tmpvec3,yUnitVec3,t),normalize(tmpvec3,tmpvec3),setAxisAngle(e,tmpvec3,Math.PI),e):n>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(cross(tmpvec3,t,r),e[0]=tmpvec3[0],e[1]=tmpvec3[1],e[2]=tmpvec3[2],e[3]=1+n,normalize$2(e,e))}),tmpvec3,xUnitVec3,yUnitVec3,sqlerp=(temp1=create$6(),temp2=create$6(),function(e,t,r,n,i,a){return slerp(temp1,t,i,a),slerp(temp2,r,n,a),slerp(e,temp1,temp2,2*a*(1-a)),e}),temp1,temp2,setAxes=(matr=create$2(),function(e,t,r,n){return matr[0]=r[0],matr[3]=r[1],matr[6]=r[2],matr[1]=n[0],matr[4]=n[1],matr[7]=n[2],matr[2]=-t[0],matr[5]=-t[1],matr[8]=-t[2],normalize$2(e,fromMat3(e,matr))}),matr;function create$7(){var e=new ARRAY_TYPE(2);return e[0]=0,e[1]=0,e}var forEach$2=function(){var e=create$7();return function(t,r,n,i,a,s){var o=void 0,l=void 0;for(r||(r=2),n||(n=0),l=i?Math.min(i*r+n,t.length):t.length,o=n;o<l;o+=r)e[0]=t[o],e[1]=t[o+1],a(e,e,s),t[o]=e[0],t[o+1]=e[1];return t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),get=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,n)}if("value"in i)return i.value;var s=i.get;return void 0!==s?s.call(n):void 0},inherits=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},possibleConstructorReturn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},coreTypes={},CoreTypes=function(){function e(){classCallCheck(this,e)}return createClass(e,null,[{key:"addCoreType",value:function(e){"function"==typeof e&&(coreTypes[e.name]=e)}},{key:"getCoreType",value:function(e){return e in coreTypes?coreTypes[e]:null}}]),e}(),commonjsGlobal="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function commonjsRequire(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function unwrapExports(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}var joiBrowser=createCommonjsModule(function(e,t){var r;r=function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,r),i.loaded=!0,i.exports}return r.m=e,r.c=t,r.p="",r(0)}([function(e,t,r){var n=r(1);e.exports=n},function(e,t,r){var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var i=r[n],a=Object.getOwnPropertyDescriptor(t,i);a&&a.configurable&&void 0===e[i]&&Object.defineProperty(e,i,a)}}(e,t))}var a=r(2),s=r(11),o=r(16),l=r(13),u=r(29),c=r(12),h={alternatives:r(25),array:r(30),boolean:r(24),binary:r(31),date:r(17),number:r(23),object:r(26),string:r(18)};h.root=function(){var e=new s,t=e.clone();return t.any=function(){return a.assert(0===arguments.length,"Joi.any() does not allow arguments."),e},t.alternatives=t.alt=function(){return arguments.length?h.alternatives.try.apply(h.alternatives,arguments):h.alternatives},t.array=function(){return a.assert(0===arguments.length,"Joi.array() does not allow arguments."),h.array},t.boolean=t.bool=function(){return a.assert(0===arguments.length,"Joi.boolean() does not allow arguments."),h.boolean},t.binary=function(){return a.assert(0===arguments.length,"Joi.binary() does not allow arguments."),h.binary},t.date=function(){return a.assert(0===arguments.length,"Joi.date() does not allow arguments."),h.date},t.func=function(){return a.assert(0===arguments.length,"Joi.func() does not allow arguments."),h.object._func()},t.number=function(){return a.assert(0===arguments.length,"Joi.number() does not allow arguments."),h.number},t.object=function(){return arguments.length?h.object.keys.apply(h.object,arguments):h.object},t.string=function(){return a.assert(0===arguments.length,"Joi.string() does not allow arguments."),h.string},t.ref=function(){return c.create.apply(null,arguments)},t.isRef=function(e){return c.isRef(e)},t.validate=function(r){var n=arguments[arguments.length-1],i="function"==typeof n?n:null,a=arguments.length-(i?1:0);if(1===a)return e.validate(r,i);var s=3===a?arguments[2]:{};return t.compile(arguments[1])._validateWithOptions(r,s,i)},t.describe=function(){return(arguments.length?t.compile(arguments[0]):e).describe()},t.compile=function(e){try{return o.schema(e)}catch(e){throw e.hasOwnProperty("path")&&(e.message=e.message+"("+e.path+")"),e}},t.assert=function(e,r,n){t.attempt(e,r,n)},t.attempt=function(e,r,n){var i=t.validate(e,r),a=i.error;if(a){if(!n)throw"function"==typeof a.annotate&&(a.message=a.annotate()),a;if(!(n instanceof Error))throw"function"==typeof a.annotate&&(a.message=n+" "+a.annotate()),a;throw n}return i.value},t.reach=function(e,t){if(a.assert(e&&e instanceof s,"you must provide a joi schema"),a.assert("string"==typeof t,"path must be a string"),""===t)return e;var r=t.split("."),n=e._inner.children;if(n)for(var i=r[0],o=0;o<n.length;++o){var l=n[o];if(l.key===i)return this.reach(l.schema,t.substr(i.length+1))}},t.lazy=function(e){return u.set(e)},t.extend=function(){var e=this,r=a.flatten(Array.prototype.slice.call(arguments));a.assert(r.length>0,"You need to provide at least one extension"),this.assert(r,t.extensionsSchema);var u=Object.create(this.any());n(u,this);for(var h=function(h){var f=r[h];"function"==typeof f&&(f=f(u)),e.assert(f,t.extensionSchema);var d=(f.base||e.any()).clone(),p=d.constructor,g=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r,i,s,o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}(this,e.call(this));return f.base&&n(o,d),o._type=f.name,f.language&&(o._settings=o._settings||{language:{}},o._settings.language=a.applyToDefaults(o._settings.language,(r={},i=f.name,s=f.language,i in r?Object.defineProperty(r,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[i]=s,r))),o}return i(t,e),t}(p);if(f.coerce&&(g.prototype._coerce=function(e,t,r){if(p.prototype._coerce){var n=p.prototype._coerce.call(this,e,t,r);if(n.errors)return n;e=n.value}var i=f.coerce.call(this,e,t,r);return i instanceof l.Err?{value:e,errors:i}:{value:i}}),f.pre&&(g.prototype._base=function(e,t,r){if(p.prototype._base){var n=p.prototype._base.call(this,e,t,r);if(n.errors)return n;e=n.value}var i=f.pre.call(this,e,t,r);return i instanceof l.Err?{value:e,errors:i}:{value:i}}),f.rules)for(var _=function(e){var t=f.rules[e],r=t.params?t.params instanceof s?t.params._inner.children.map(function(e){return e.key}):Object.keys(t.params):[],n=t.params?o.schema(t.params):null;g.prototype[t.name]=function(){if(arguments.length>r.length)throw new Error("Unexpected number of arguments");for(var e=Array.prototype.slice.call(arguments),i=!1,o={},l=0;l<r.length;++l)o[r[l]]=e[l],!i&&c.isRef(e[l])&&(i=!0);n&&(o=u.attempt(o,n));var h=void 0;if(t.validate){h=this._test(t.name,o,function(e,r,n){return t.validate.call(this,o,e,r,n)},{description:t.description,hasRef:i})}else h=this.clone();if(t.setup){var f=t.setup.call(h,o);void 0!==f&&(a.assert(f instanceof s,"Setup of extension Joi."+this._type+"()."+t.name+"() must return undefined or a Joi object"),h=f)}return h}},y=0;y<f.rules.length;++y)_(y);f.describe&&(g.prototype.describe=function(){var e=p.prototype.describe.call(this);return f.describe.call(this,e)});var m=new g;u[f.name]=function(){return m}},f=0;f<r.length;++f)h(f);return u},t.extensionSchema=h.object.keys({base:h.object.type(s,"Joi object"),name:h.string.required(),coerce:h.object._func().arity(3),pre:h.object._func().arity(3),language:h.object,describe:h.object._func().arity(1),rules:h.array.items(h.object.keys({name:h.string.required(),setup:h.object._func().arity(1),validate:h.object._func().arity(4),params:[h.object.pattern(/.*/,h.object.type(s,"Joi object")),h.object.type(h.object.constructor,"Joi object")],description:[h.string,h.object._func().arity(1)]}).or("setup","validate"))}).strict(),t.extensionsSchema=h.array.items([h.object,h.object._func().arity(1)]).strict(),t.version=r(32).version,t},e.exports=h.root()},function(e,t,r){(function(e,n){var i="function"==typeof Symbol&&"symbol"===_typeof(Symbol.iterator)?function(e){return void 0===e?"undefined":_typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":_typeof(e)},a=r(5),s=r(6),o=r(7),l=r(10),u={};t.clone=function(r,n){if("object"!==(void 0===r?"undefined":i(r))||null===r)return r;var a=(n=n||new Map).get(r);if(a)return a;var s=void 0,o=!1;if(Array.isArray(r))s=[],o=!0;else if(e.isBuffer(r))s=new e(r);else if(r instanceof Date)s=new Date(r.getTime());else if(r instanceof RegExp)s=new RegExp(r);else{var l=Object.getPrototypeOf(r);l&&l.isImmutable?s=r:(s=Object.create(l),o=!0)}if(n.set(r,s),o)for(var u=Object.getOwnPropertyNames(r),c=0;c<u.length;++c){var h=u[c],f=Object.getOwnPropertyDescriptor(r,h);f&&(f.get||f.set)?Object.defineProperty(s,h,f):s[h]=t.clone(r[h],n)}return s},t.merge=function(r,n,a,s){if(t.assert(r&&"object"===(void 0===r?"undefined":i(r)),"Invalid target value: must be an object"),t.assert(null===n||void 0===n||"object"===(void 0===n?"undefined":i(n)),"Invalid source value: must be null, undefined, or an object"),!n)return r;if(Array.isArray(n)){t.assert(Array.isArray(r),"Cannot merge array onto an object"),!1===s&&(r.length=0);for(var o=0;o<n.length;++o)r.push(t.clone(n[o]));return r}for(var l=Object.keys(n),u=0;u<l.length;++u){var c=l[u],h=n[c];h&&"object"===(void 0===h?"undefined":i(h))?!r[c]||"object"!==i(r[c])||Array.isArray(r[c])!==Array.isArray(h)||h instanceof Date||e.isBuffer(h)||h instanceof RegExp?r[c]=t.clone(h):t.merge(r[c],h,a,s):null!==h&&void 0!==h?r[c]=h:!1!==a&&(r[c]=h)}return r},t.applyToDefaults=function(e,r,n){if(t.assert(e&&"object"===(void 0===e?"undefined":i(e)),"Invalid defaults value: must be an object"),t.assert(!r||!0===r||"object"===(void 0===r?"undefined":i(r)),"Invalid options value: must be true, falsy or an object"),!r)return null;var a=t.clone(e);return!0===r?a:t.merge(a,r,!0===n,!1)},t.cloneWithShallow=function(e,r){if(!e||"object"!==(void 0===e?"undefined":i(e)))return e;var n=u.store(e,r),a=t.clone(e);return u.restore(a,e,n),a},u.store=function(e,r){for(var n={},i=0;i<r.length;++i){var a=r[i],s=t.reach(e,a);void 0!==s&&(n[a]=s,u.reachSet(e,a,void 0))}return n},u.restore=function(e,t,r){for(var n=Object.keys(r),i=0;i<n.length;++i){var a=n[i];u.reachSet(e,a,r[a]),u.reachSet(t,a,r[a])}},u.reachSet=function(e,t,r){for(var n=t.split("."),i=e,a=0;a<n.length;++a){var s=n[a];a+1===n.length&&(i[s]=r),i=i[s]}},t.applyToDefaultsWithShallow=function(e,r,n){if(t.assert(e&&"object"===(void 0===e?"undefined":i(e)),"Invalid defaults value: must be an object"),t.assert(!r||!0===r||"object"===(void 0===r?"undefined":i(r)),"Invalid options value: must be true, falsy or an object"),t.assert(n&&Array.isArray(n),"Invalid keys"),!r)return null;var a=t.cloneWithShallow(e,n);if(!0===r)return a;var s=u.store(r,n);return t.merge(a,r,!1,!1),u.restore(a,r,s),a},t.deepEqual=function(r,n,a,s){a=a||{prototype:!0};var o=void 0===r?"undefined":i(r);if(o!==(void 0===n?"undefined":i(n)))return!1;if("object"!==o||null===r||null===n)return r===n?0!==r||1/r==1/n:r!=r&&n!=n;if(-1!==(s=s||[]).indexOf(r))return!0;if(s.push(r),Array.isArray(r)){if(!Array.isArray(n))return!1;if(!a.part&&r.length!==n.length)return!1;for(var l=0;l<r.length;++l){if(a.part){for(var u=!1,c=0;c<n.length;++c)if(t.deepEqual(r[l],n[c],a)){u=!0;break}return u}if(!t.deepEqual(r[l],n[l],a))return!1}return!0}if(e.isBuffer(r)){if(!e.isBuffer(n))return!1;if(r.length!==n.length)return!1;for(var h=0;h<r.length;++h)if(r[h]!==n[h])return!1;return!0}if(r instanceof Date)return n instanceof Date&&r.getTime()===n.getTime();if(r instanceof RegExp)return n instanceof RegExp&&r.toString()===n.toString();if(a.prototype&&Object.getPrototypeOf(r)!==Object.getPrototypeOf(n))return!1;var f=Object.getOwnPropertyNames(r);if(!a.part&&f.length!==Object.getOwnPropertyNames(n).length)return!1;for(var d=0;d<f.length;++d){var p=f[d],g=Object.getOwnPropertyDescriptor(r,p);if(g.get){if(!t.deepEqual(g,Object.getOwnPropertyDescriptor(n,p),a,s))return!1}else if(!t.deepEqual(r[p],n[p],a,s))return!1}return!0},t.unique=function(e,t){var r=void 0;return t?function(){r=[];var n=new Set;e.forEach(function(e){var i=e[t];n.has(i)||(n.add(i),r.push(e))})}():r=Array.from(new Set(e)),r},t.mapToObject=function(e,t){if(!e)return null;for(var r={},n=0;n<e.length;++n)t?e[n][t]&&(r[e[n][t]]=!0):r[e[n]]=!0;return r},t.intersect=function(e,r,n){if(!e||!r)return[];for(var i=[],a=Array.isArray(e)?t.mapToObject(e):e,s={},o=0;o<r.length;++o)if(a[r[o]]&&!s[r[o]]){if(n)return r[o];i.push(r[o]),s[r[o]]=!0}return n?null:i},t.contain=function(e,r,n){var a=null;"object"!==(void 0===e?"undefined":i(e))||"object"!==(void 0===r?"undefined":i(r))||Array.isArray(e)||Array.isArray(r)?r=[].concat(r):(a=r,r=Object.keys(r)),n=n||{},t.assert(arguments.length>=2,"Insufficient arguments"),t.assert("string"==typeof e||"object"===(void 0===e?"undefined":i(e)),"Reference must be string or an object"),t.assert(r.length,"Values array cannot be empty");var s=void 0,o=void 0;if(n.deep){s=t.deepEqual;var l=n.hasOwnProperty("only"),u=n.hasOwnProperty("part");o={prototype:l?n.only:!!u&&!n.part,part:l?!n.only:!u||n.part}}else s=function(e,t){return e===t};for(var c=!1,h=new Array(r.length),f=0;f<h.length;++f)h[f]=0;if("string"==typeof e){for(var d="(",p=0;p<r.length;++p){var g=r[p];t.assert("string"==typeof g,"Cannot compare string reference to non-string value"),d+=(p?"|":"")+t.escapeRegex(g)}var _=new RegExp(d+")","g");c=!!e.replace(_,function(e,t){var n=r.indexOf(t);return++h[n],""})}else if(Array.isArray(e))for(var y=0;y<e.length;++y){for(var m=!1,v=0;v<r.length&&!1===m;++v)m=s(r[v],e[y],o)&&v;!1!==m?++h[m]:c=!0}else for(var b=Object.getOwnPropertyNames(e),w=0;w<b.length;++w){var E=b[w],T=r.indexOf(E);if(-1!==T){if(a&&!s(a[E],e[E],o))return!1;++h[T]}else c=!0}for(var k=!1,x=0;x<h.length;++x)if(k=k||!!h[x],n.once&&h[x]>1||!n.part&&!h[x])return!1;return(!n.only||!c)&&k},t.flatten=function(e,r){for(var n=r||[],i=0;i<e.length;++i)Array.isArray(e[i])?t.flatten(e[i],n):n.push(e[i]);return n},t.reach=function(e,r,n){if(!1===r||null===r||void 0===r)return e;"string"==typeof(n=n||{})&&(n={separator:n});for(var a=r.split(n.separator||"."),s=e,o=0;o<a.length;++o){var l=a[o];if("-"===l[0]&&Array.isArray(s)&&(l=l.slice(1,l.length),l=s.length-l),!s||"object"!==(void 0===s?"undefined":i(s))&&"function"!=typeof s||!(l in s)||"object"!==(void 0===s?"undefined":i(s))&&!1===n.functions){t.assert(!n.strict||o+1===a.length,"Missing segment",l,"in reach path ",r),t.assert("object"===(void 0===s?"undefined":i(s))||!0===n.functions||"function"!=typeof s,"Invalid segment",l,"in reach path ",r),s=n.default;break}s=s[l]}return s},t.reachTemplate=function(e,r,n){return r.replace(/{([^}]+)}/g,function(r,i){var a=t.reach(e,i,n);return void 0===a||null===a?"":a})},t.formatStack=function(e){for(var t=[],r=0;r<e.length;++r){var n=e[r];t.push([n.getFileName(),n.getLineNumber(),n.getColumnNumber(),n.getFunctionName(),n.isConstructor()])}return t},t.formatTrace=function(e){for(var t=[],r=0;r<e.length;++r){var n=e[r];t.push((n[4]?"new ":"")+n[3]+" ("+n[0]+":"+n[1]+":"+n[2]+")")}return t},t.callStack=function(e){var r=Error.prepareStackTrace;Error.prepareStackTrace=function(e,t){return t};var n={};Error.captureStackTrace(n,this);var i=n.stack;return Error.prepareStackTrace=r,t.formatStack(i).slice(1+e)},t.displayStack=function(e){var r=t.callStack(void 0===e?1:e+1);return t.formatTrace(r)},t.abortThrow=!1,t.abort=function(e,r){if("test"===n.env.NODE_ENV||!0===t.abortThrow)throw new Error(e||"Unknown error");var i="";r||(i=t.displayStack(1).join("\n\t")),console.log("ABORT: "+e+"\n\t"+i),n.exit(1)},t.assert=function(e){if(!e){if(2===arguments.length&&arguments[1]instanceof Error)throw arguments[1];for(var r=[],n=1;n<arguments.length;++n)""!==arguments[n]&&r.push(arguments[n]);throw r=r.map(function(e){return"string"==typeof e?e:e instanceof Error?e.message:t.stringify(e)}),new Error(r.join(" ")||"Unknown error")}},t.Timer=function(){this.ts=0,this.reset()},t.Timer.prototype.reset=function(){this.ts=Date.now()},t.Timer.prototype.elapsed=function(){return Date.now()-this.ts},t.Bench=function(){this.ts=0,this.reset()},t.Bench.prototype.reset=function(){this.ts=t.Bench.now()},t.Bench.prototype.elapsed=function(){return t.Bench.now()-this.ts},t.Bench.now=function(){var e=n.hrtime();return 1e3*e[0]+e[1]/1e6},t.escapeRegex=function(e){return e.replace(/[\^\$\.\*\+\-\?\=\!\:\|\\\/\(\)\[\]\{\}\,]/g,"\\$&")},t.base64urlEncode=function(r,n){return t.assert("string"==typeof r||e.isBuffer(r),"value must be string or buffer"),(e.isBuffer(r)?r:new e(r,n||"binary")).toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")},t.base64urlDecode=function(t,r){if("string"!=typeof t)return new Error("Value not a string");if(!/^[\w\-]*$/.test(t))return new Error("Invalid character");var n=new e(t,"base64");return"buffer"===r?n:n.toString(r||"binary")},t.escapeHeaderAttribute=function(e){return t.assert(/^[ \w\!#\$%&'\(\)\*\+,\-\.\/\:;<\=>\?@\[\]\^`\{\|\}~\"\\]*$/.test(e),"Bad attribute value ("+e+")"),e.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')},t.escapeHtml=function(e){return l.escapeHtml(e)},t.escapeJavaScript=function(e){return l.escapeJavaScript(e)},t.nextTick=function(e){return function(){var t=arguments;n.nextTick(function(){e.apply(null,t)})}},t.once=function(e){if(e._hoekOnce)return e;var t=!1,r=function(){t||(t=!0,e.apply(null,arguments))};return r._hoekOnce=!0,r},t.isInteger=Number.isSafeInteger,t.ignore=function(){},t.inherits=o.inherits,t.format=o.format,t.transform=function(e,r,n){t.assert(null===e||void 0===e||"object"===(void 0===e?"undefined":i(e))||Array.isArray(e),"Invalid source object: must be null, undefined, an object, or an array");var a="object"===(void 0===n?"undefined":i(n))&&null!==n&&n.separator||".";if(Array.isArray(e)){for(var s=[],o=0;o<e.length;++o)s.push(t.transform(e[o],r,n));return s}for(var l={},u=Object.keys(r),c=0;c<u.length;++c){var h=u[c],f=h.split(a),d=r[h];t.assert("string"==typeof d,'All mappings must be "." delineated strings');for(var p=void 0,g=l;f.length>1;)g[p=f.shift()]||(g[p]={}),g=g[p];g[p=f.shift()]=t.reach(e,d,n)}return l},t.uniqueFilename=function(e,t){t=t?"."!==t[0]?"."+t:t:"",e=s.resolve(e);var r=[Date.now(),n.pid,a.randomBytes(8).toString("hex")].join("-")+t;return s.join(e,r)},t.stringify=function(){try{return JSON.stringify.apply(null,arguments)}catch(e){return"[Cannot display object: "+e.message+"]"}},t.shallow=function(e){for(var t={},r=Object.keys(e),n=0;n<r.length;++n){var i=r[n];t[i]=e[i]}return t}}).call(t,r(3).Buffer,r(4))},function(e,t){function r(){throw new Error("Buffer is not included.")}r.isBuffer=function(){return!1},t.INSPECT_MAX_BYTES=50,t.SlowBuffer=r,t.Buffer=r},function(e,t){var r,n,i=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function o(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var l,u=[],c=!1,h=-1;function f(){c&&l&&(c=!1,l.length?u=l.concat(u):h=-1,u.length&&d())}function d(){if(!c){var e=o(f);c=!0;for(var t=u.length;t;){for(l=u,u=[];++h<t;)l&&l[h].run();h=-1,t=u.length}l=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new p(e,t)),1!==u.length||c||o(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t){},function(e,t,r){(function(e){function r(e,t){for(var r=0,n=e.length-1;n>=0;n--){var i=e[n];"."===i?e.splice(n,1):".."===i?(e.splice(n,1),r++):r&&(e.splice(n,1),r--)}if(t)for(;r--;r)e.unshift("..");return e}var n=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,i=function(e){return n.exec(e).slice(1)};function a(e,t){if(e.filter)return e.filter(t);for(var r=[],n=0;n<e.length;n++)t(e[n],n,e)&&r.push(e[n]);return r}t.resolve=function(){for(var t="",n=!1,i=arguments.length-1;i>=-1&&!n;i--){var s=i>=0?arguments[i]:e.cwd();if("string"!=typeof s)throw new TypeError("Arguments to path.resolve must be strings");s&&(t=s+"/"+t,n="/"===s.charAt(0))}return t=r(a(t.split("/"),function(e){return!!e}),!n).join("/"),(n?"/":"")+t||"."},t.normalize=function(e){var n=t.isAbsolute(e),i="/"===s(e,-1);return(e=r(a(e.split("/"),function(e){return!!e}),!n).join("/"))||n||(e="."),e&&i&&(e+="/"),(n?"/":"")+e},t.isAbsolute=function(e){return"/"===e.charAt(0)},t.join=function(){var e=Array.prototype.slice.call(arguments,0);return t.normalize(a(e,function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e}).join("/"))},t.relative=function(e,r){function n(e){for(var t=0;t<e.length&&""===e[t];t++);for(var r=e.length-1;r>=0&&""===e[r];r--);return t>r?[]:e.slice(t,r-t+1)}e=t.resolve(e).substr(1),r=t.resolve(r).substr(1);for(var i=n(e.split("/")),a=n(r.split("/")),s=Math.min(i.length,a.length),o=s,l=0;l<s;l++)if(i[l]!==a[l]){o=l;break}var u=[];for(l=o;l<i.length;l++)u.push("..");return(u=u.concat(a.slice(o))).join("/")},t.sep="/",t.delimiter=":",t.dirname=function(e){var t=i(e),r=t[0],n=t[1];return r||n?(n&&(n=n.substr(0,n.length-1)),r+n):"."},t.basename=function(e,t){var r=i(e)[2];return t&&r.substr(-1*t.length)===t&&(r=r.substr(0,r.length-t.length)),r},t.extname=function(e){return i(e)[3]};var s="b"==="ab".substr(-1)?function(e,t,r){return e.substr(t,r)}:function(e,t,r){return t<0&&(t=e.length+t),e.substr(t,r)}}).call(t,r(4))},function(e,t,r){(function(e,n){var i=/%[sdj%]/g;t.format=function(e){if(!y(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(o(arguments[r]));return t.join(" ")}r=1;for(var n=arguments,a=n.length,s=String(e).replace(i,function(e){if("%%"===e)return"%";if(r>=a)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}}),l=n[r];r<a;l=n[++r])g(l)||!b(l)?s+=" "+l:s+=" "+o(l);return s},t.deprecate=function(r,i){if(m(e.process))return function(){return t.deprecate(r,i).apply(this,arguments)};if(!0===n.noDeprecation)return r;var a=!1;return function(){if(!a){if(n.throwDeprecation)throw new Error(i);n.traceDeprecation?console.trace(i):console.error(i),a=!0}return r.apply(this,arguments)}};var a,s={};function o(e,r){var n={seen:[],stylize:u};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),p(r)?n.showHidden=r:r&&t._extend(n,r),m(n.showHidden)&&(n.showHidden=!1),m(n.depth)&&(n.depth=2),m(n.colors)&&(n.colors=!1),m(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=l),c(n,e,n.depth)}function l(e,t){var r=o.styles[t];return r?"["+o.colors[r][0]+"m"+e+"["+o.colors[r][1]+"m":e}function u(e,t){return e}function c(e,r,n){if(e.customInspect&&r&&T(r.inspect)&&r.inspect!==t.inspect&&(!r.constructor||r.constructor.prototype!==r)){var i=r.inspect(n,e);return y(i)||(i=c(e,i,n)),i}var a=function(e,t){if(m(t))return e.stylize("undefined","undefined");if(y(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}if(_(t))return e.stylize(""+t,"number");if(p(t))return e.stylize(""+t,"boolean");if(g(t))return e.stylize("null","null")}(e,r);if(a)return a;var s=Object.keys(r),o=function(e){var t={};return e.forEach(function(e,r){t[e]=!0}),t}(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(r)),E(r)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return h(r);if(0===s.length){if(T(r)){var l=r.name?": "+r.name:"";return e.stylize("[Function"+l+"]","special")}if(v(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(w(r))return e.stylize(Date.prototype.toString.call(r),"date");if(E(r))return h(r)}var u,b="",k=!1,x=["{","}"];(d(r)&&(k=!0,x=["[","]"]),T(r))&&(b=" [Function"+(r.name?": "+r.name:"")+"]");return v(r)&&(b=" "+RegExp.prototype.toString.call(r)),w(r)&&(b=" "+Date.prototype.toUTCString.call(r)),E(r)&&(b=" "+h(r)),0!==s.length||k&&0!=r.length?n<0?v(r)?e.stylize(RegExp.prototype.toString.call(r),"regexp"):e.stylize("[Object]","special"):(e.seen.push(r),u=k?function(e,t,r,n,i){for(var a=[],s=0,o=t.length;s<o;++s)I(t,String(s))?a.push(f(e,t,r,n,String(s),!0)):a.push("");return i.forEach(function(i){i.match(/^\d+$/)||a.push(f(e,t,r,n,i,!0))}),a}(e,r,n,o,s):s.map(function(t){return f(e,r,n,o,t,k)}),e.seen.pop(),function(e,t,r){if(e.reduce(function(e,t){return 0,t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1];return r[0]+t+" "+e.join(", ")+" "+r[1]}(u,b,x)):x[0]+b+x[1]}function h(e){return"["+Error.prototype.toString.call(e)+"]"}function f(e,t,r,n,i,a){var s,o,l;if((l=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?o=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(o=e.stylize("[Setter]","special")),I(n,i)||(s="["+i+"]"),o||(e.seen.indexOf(l.value)<0?(o=g(r)?c(e,l.value,null):c(e,l.value,r-1)).indexOf("\n")>-1&&(o=a?o.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+o.split("\n").map(function(e){return"   "+e}).join("\n")):o=e.stylize("[Circular]","special")),m(s)){if(a&&i.match(/^\d+$/))return o;(s=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+o}function d(e){return Array.isArray(e)}function p(e){return"boolean"==typeof e}function g(e){return null===e}function _(e){return"number"==typeof e}function y(e){return"string"==typeof e}function m(e){return void 0===e}function v(e){return b(e)&&"[object RegExp]"===k(e)}function b(e){return"object"===(void 0===e?"undefined":_typeof(e))&&null!==e}function w(e){return b(e)&&"[object Date]"===k(e)}function E(e){return b(e)&&("[object Error]"===k(e)||e instanceof Error)}function T(e){return"function"==typeof e}function k(e){return Object.prototype.toString.call(e)}function x(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(e){if(m(a)&&(a=n.env.NODE_DEBUG||""),e=e.toUpperCase(),!s[e])if(new RegExp("\\b"+e+"\\b","i").test(a)){var r=n.pid;s[e]=function(){var n=t.format.apply(t,arguments);console.error("%s %d: %s",e,r,n)}}else s[e]=function(){};return s[e]},t.inspect=o,o.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},o.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=d,t.isBoolean=p,t.isNull=g,t.isNullOrUndefined=function(e){return null==e},t.isNumber=_,t.isString=y,t.isSymbol=function(e){return"symbol"===(void 0===e?"undefined":_typeof(e))},t.isUndefined=m,t.isRegExp=v,t.isObject=b,t.isDate=w,t.isError=E,t.isFunction=T,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"===(void 0===e?"undefined":_typeof(e))||void 0===e},t.isBuffer=r(8);var S=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function I(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){var e,r;console.log("%s - %s",(e=new Date,r=[x(e.getHours()),x(e.getMinutes()),x(e.getSeconds())].join(":"),[e.getDate(),S[e.getMonth()],r].join(" ")),t.format.apply(t,arguments))},t.inherits=r(9),t._extend=function(e,t){if(!t||!b(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}}).call(t,function(){return this}(),r(4))},function(e,t){e.exports=function(e){return e&&"object"===(void 0===e?"undefined":_typeof(e))&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},function(e,t,r){(function(e){var r={};t.escapeJavaScript=function(e){if(!e)return"";for(var t="",n=0;n<e.length;++n){var i=e.charCodeAt(n);r.isSafe(i)?t+=e[n]:t+=r.escapeJavaScriptChar(i)}return t},t.escapeHtml=function(e){if(!e)return"";for(var t="",n=0;n<e.length;++n){var i=e.charCodeAt(n);r.isSafe(i)?t+=e[n]:t+=r.escapeHtmlChar(i)}return t},r.escapeJavaScriptChar=function(t){if(t>=256)return"\\u"+r.padLeft(""+t,4);var n=new e(String.fromCharCode(t),"ascii").toString("hex");return"\\x"+r.padLeft(n,2)},r.escapeHtmlChar=function(t){var n=r.namedHtml[t];if(void 0!==n)return n;if(t>=256)return"&#"+t+";";var i=new e(String.fromCharCode(t),"ascii").toString("hex");return"&#x"+r.padLeft(i,2)+";"},r.padLeft=function(e,t){for(;e.length<t;)e="0"+e;return e},r.isSafe=function(e){return void 0!==r.safeCharCodes[e]},r.namedHtml={38:"&amp;",60:"&lt;",62:"&gt;",34:"&quot;",160:"&nbsp;",162:"&cent;",163:"&pound;",164:"&curren;",169:"&copy;",174:"&reg;"},r.safeCharCodes=function(){for(var e={},t=32;t<123;++t)(t>=97||t>=65&&t<=90||t>=48&&t<=57||32===t||46===t||44===t||45===t||58===t||95===t)&&(e[t]=null);return e}()}).call(t,r(3).Buffer)},function(e,t,r){var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i="function"==typeof Symbol&&"symbol"===_typeof(Symbol.iterator)?function(e){return void 0===e?"undefined":_typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":_typeof(e)};var a=r(2),s=r(12),o=r(13),l=null,u=null,c={Set:r(15),defaults:{abortEarly:!0,convert:!0,allowUnknown:!1,skipFunctions:!1,stripUnknown:!1,language:{},presence:"optional",strip:!1,noDefaults:!1}};e.exports=c.Any=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),u=u||r(16),this.isJoi=!0,this._type="any",this._settings=null,this._valids=new c.Set,this._invalids=new c.Set,this._tests=[],this._refs=[],this._flags={},this._description=null,this._unit=null,this._notes=[],this._tags=[],this._examples=[],this._meta=[],this._inner={}}return e.prototype.createError=function(e,t,r,n){return o.create(e,t,r,n,this._flags)},e.prototype.createOverrideError=function(e,t,r,n,i,a){return o.create(e,t,r,n,this._flags,i,a)},e.prototype.checkOptions=function(e){var t=r(28).options.validate(e);if(t.error)throw new Error(t.error.details[0].message)},e.prototype.clone=function(){var e=Object.create(Object.getPrototypeOf(this));e.isJoi=!0,e._type=this._type,e._settings=c.concatSettings(this._settings),e._baseType=this._baseType,e._valids=a.clone(this._valids),e._invalids=a.clone(this._invalids),e._tests=this._tests.slice(),e._refs=this._refs.slice(),e._flags=a.clone(this._flags),e._description=this._description,e._unit=this._unit,e._notes=this._notes.slice(),e._tags=this._tags.slice(),e._examples=this._examples.slice(),e._meta=this._meta.slice(),e._inner={};for(var t=Object.keys(this._inner),r=0;r<t.length;++r){var n=t[r];e._inner[n]=this._inner[n]?this._inner[n].slice():null}return e},e.prototype.concat=function(e){a.assert(e instanceof c.Any,"Invalid schema object"),a.assert("any"===this._type||"any"===e._type||e._type===this._type,"Cannot merge type",this._type,"with another type:",e._type);var t=this.clone();if("any"===this._type&&"any"!==e._type){for(var r=e.clone(),n=["_settings","_valids","_invalids","_tests","_refs","_flags","_description","_unit","_notes","_tags","_examples","_meta","_inner"],i=0;i<n.length;++i)r[n[i]]=t[n[i]];t=r}t._settings=t._settings?c.concatSettings(t._settings,e._settings):e._settings,t._valids.merge(e._valids,e._invalids),t._invalids.merge(e._invalids,e._valids),t._tests=t._tests.concat(e._tests),t._refs=t._refs.concat(e._refs),a.merge(t._flags,e._flags),t._description=e._description||t._description,t._unit=e._unit||t._unit,t._notes=t._notes.concat(e._notes),t._tags=t._tags.concat(e._tags),t._examples=t._examples.concat(e._examples),t._meta=t._meta.concat(e._meta);for(var s=Object.keys(e._inner),o="object"===t._type,l=0;l<s.length;++l){var u=s[l],h=e._inner[u];if(h){var f=t._inner[u];if(f)if(o&&"children"===u){for(var d={},p=0;p<f.length;++p)d[f[p].key]=p;for(var g=0;g<h.length;++g){var _=h[g].key;d[_]>=0?f[d[_]]={key:_,schema:f[d[_]].schema.concat(h[g].schema)}:f.push(h[g])}}else t._inner[u]=t._inner[u].concat(h);else t._inner[u]=h.slice()}}return t},e.prototype._test=function(e,t,r,n){var i=this.clone();return i._tests.push({func:r,name:e,arg:t,options:n}),i},e.prototype.options=function(e){a.assert(!e.context,"Cannot override context"),this.checkOptions(e);var t=this.clone();return t._settings=c.concatSettings(t._settings,e),t},e.prototype.strict=function(e){var t=this.clone();return t._settings=t._settings||{},t._settings.convert=void 0!==e&&!e,t},e.prototype.raw=function(e){var t=void 0===e||e;if(this._flags.raw===t)return this;var r=this.clone();return r._flags.raw=t,r},e.prototype.error=function(e){a.assert(e&&(e instanceof Error||"function"==typeof e),"Must provide a valid Error object or a function");var t=this.clone();return t._flags.error=e,t},e.prototype.allow=function(){for(var e=this.clone(),t=a.flatten(Array.prototype.slice.call(arguments)),r=0;r<t.length;++r){var n=t[r];a.assert(void 0!==n,"Cannot call allow/valid/invalid with undefined"),e._invalids.remove(n),e._valids.add(n,e._refs)}return e},e.prototype.valid=function(){var e=this.allow.apply(this,arguments);return e._flags.allowOnly=!0,e},e.prototype.invalid=function(e){for(var t=this.clone(),r=a.flatten(Array.prototype.slice.call(arguments)),n=0;n<r.length;++n)e=r[n],a.assert(void 0!==e,"Cannot call allow/valid/invalid with undefined"),t._valids.remove(e),t._invalids.add(e,this._refs);return t},e.prototype.required=function(){if("required"===this._flags.presence)return this;var e=this.clone();return e._flags.presence="required",e},e.prototype.optional=function(){if("optional"===this._flags.presence)return this;var e=this.clone();return e._flags.presence="optional",e},e.prototype.forbidden=function(){if("forbidden"===this._flags.presence)return this;var e=this.clone();return e._flags.presence="forbidden",e},e.prototype.strip=function(){if(this._flags.strip)return this;var e=this.clone();return e._flags.strip=!0,e},e.prototype.applyFunctionToChildren=function(e,t,r,n){if(1!==(e=[].concat(e)).length||""!==e[0]){n=n?n+".":"";var i=(""===e[0]?e.slice(1):e).map(function(e){return n+e});throw new Error("unknown key(s) "+i.join(", "))}return this[t].apply(this,r)},e.prototype.default=function(e,t){"function"!=typeof e||s.isRef(e)||(!e.description&&t&&(e.description=t),this._flags.func||a.assert("string"==typeof e.description&&e.description.length>0,"description must be provided when default value is a function"));var r=this.clone();return r._flags.default=e,s.push(r._refs,e),r},e.prototype.empty=function(e){var t=this.clone();return t._flags.empty=void 0===e?void 0:u.schema(e),t},e.prototype.when=function(e,t){a.assert(t&&"object"===(void 0===t?"undefined":i(t)),"Invalid options"),a.assert(void 0!==t.then||void 0!==t.otherwise,'options must have at least one of "then" or "otherwise"');var n=t.hasOwnProperty("then")?this.concat(u.schema(t.then)):void 0,s=t.hasOwnProperty("otherwise")?this.concat(u.schema(t.otherwise)):void 0,o=(l=l||r(25)).when(e,{is:t.is,then:n,otherwise:s});return o._flags.presence="ignore",o._baseType=this,o},e.prototype.description=function(e){a.assert(e&&"string"==typeof e,"Description must be a non-empty string");var t=this.clone();return t._description=e,t},e.prototype.notes=function(e){a.assert(e&&("string"==typeof e||Array.isArray(e)),"Notes must be a non-empty string or array");var t=this.clone();return t._notes=t._notes.concat(e),t},e.prototype.tags=function(e){a.assert(e&&("string"==typeof e||Array.isArray(e)),"Tags must be a non-empty string or array");var t=this.clone();return t._tags=t._tags.concat(e),t},e.prototype.meta=function(e){a.assert(void 0!==e,"Meta cannot be undefined");var t=this.clone();return t._meta=t._meta.concat(e),t},e.prototype.example=function(e){a.assert(arguments.length,"Missing example");var t=this._validate(e,null,c.defaults);a.assert(!t.errors,"Bad example:",t.errors&&o.process(t.errors,e));var r=this.clone();return r._examples.push(e),r},e.prototype.unit=function(e){a.assert(e&&"string"==typeof e,"Unit name must be a non-empty string");var t=this.clone();return t._unit=e,t},e.prototype._prepareEmptyValue=function(e){return"string"==typeof e&&this._flags.trim?e.trim():e},e.prototype._validate=function(e,t,r,n){var i=this,l=e;t=t||{key:"",path:"",parent:null,reference:n},this._settings&&(r=c.concatSettings(r,this._settings));var u=[],h=function(){var n=void 0;if(void 0!==e)n=i._flags.raw?l:e;else if(r.noDefaults)n=e;else if(s.isRef(i._flags.default))n=i._flags.default(t.parent,r);else if("function"!=typeof i._flags.default||i._flags.func&&!i._flags.default.description)n=a.clone(i._flags.default);else{var o=void 0;null!==t.parent&&i._flags.default.length>0&&(o=[a.clone(t.parent),r]);var h=c._try(i._flags.default,o);n=h.value,h.error&&u.push(i.createError("any.default",h.error,t,r))}if(u.length&&"function"==typeof i._flags.error){var f=i._flags.error.call(i,u);u="string"==typeof f?[i.createOverrideError("override",{reason:u},t,r,f)]:[].concat(f).map(function(e){return e instanceof Error?e:i.createOverrideError(e.type||"override",e.context,t,r,e.message,e.template)})}return{value:i._flags.strip?void 0:n,finalValue:n,errors:u.length?u:null}};if(this._coerce){var f=this._coerce.call(this,e,t,r);if(f.errors)return e=f.value,u=u.concat(f.errors),h();e=f.value}this._flags.empty&&!this._flags.empty._validate(this._prepareEmptyValue(e),null,c.defaults).errors&&(e=void 0);var d=this._flags.presence||r.presence;if("optional"===d){if(void 0===e){if(!(this._flags.hasOwnProperty("default")&&void 0===this._flags.default)||"object"!==this._type)return h();e={}}}else{if("required"===d&&void 0===e)return u.push(this.createError("any.required",null,t,r)),h();if("forbidden"===d)return void 0===e?h():(u.push(this.createError("any.unknown",null,t,r)),h())}if(this._valids.has(e,t,r,this._flags.insensitive))return h();if(this._invalids.has(e,t,r,this._flags.insensitive)&&(u.push(this.createError(""===e?"any.empty":"any.invalid",null,t,r)),r.abortEarly||void 0===e))return h();if(this._base){var p=this._base.call(this,e,t,r);if(p.errors)return e=p.value,u=u.concat(p.errors),h();if(p.value!==e){if(e=p.value,this._valids.has(e,t,r,this._flags.insensitive))return h();if(this._invalids.has(e,t,r,this._flags.insensitive)&&(u.push(this.createError(""===e?"any.empty":"any.invalid",null,t,r)),r.abortEarly))return h()}}if(this._flags.allowOnly&&(u.push(this.createError("any.allowOnly",{valids:this._valids.values({stripUndefined:!0})},t,r)),r.abortEarly))return h();for(var g=0;g<this._tests.length;++g){var _=this._tests[g].func.call(this,e,t,r);if(_ instanceof o.Err){if(u.push(_),r.abortEarly)return h()}else e=_}return h()},e.prototype._validateWithOptions=function(e,t,r){t&&this.checkOptions(t);var n=c.concatSettings(c.defaults,t),i=this._validate(e,null,n),a=o.process(i.errors,e);return r?r(a,i.value):{error:a,value:i.value}},e.prototype.validate=function(e,t,r){return"function"==typeof t?this._validateWithOptions(e,null,t):this._validateWithOptions(e,t,r)},e.prototype.describe=function(){var e=this,t={type:this._type},r=Object.keys(this._flags);if(r.length)if(["empty","default","lazy","label"].some(function(t){return e._flags.hasOwnProperty(t)})){t.flags={};for(var n=0;n<r.length;++n){var i=r[n];"empty"===i?t.flags[i]=this._flags[i].describe():"default"===i?s.isRef(this._flags[i])?t.flags[i]=this._flags[i].toString():"function"==typeof this._flags[i]?t.flags[i]=this._flags[i].description:t.flags[i]=this._flags[i]:"lazy"===i||"label"===i||(t.flags[i]=this._flags[i])}}else t.flags=this._flags;this._settings&&(t.options=a.clone(this._settings)),this._baseType&&(t.base=this._baseType.describe()),this._description&&(t.description=this._description),this._notes.length&&(t.notes=this._notes),this._tags.length&&(t.tags=this._tags),this._meta.length&&(t.meta=this._meta),this._examples.length&&(t.examples=this._examples),this._unit&&(t.unit=this._unit);var o=this._valids.values();o.length&&(t.valids=o.map(function(e){return s.isRef(e)?e.toString():e}));var l=this._invalids.values();l.length&&(t.invalids=l.map(function(e){return s.isRef(e)?e.toString():e})),t.rules=[];for(var u=0;u<this._tests.length;++u){var c=this._tests[u],h={name:c.name};void 0!==c.arg&&(h.arg=s.isRef(c.arg)?c.arg.toString():c.arg);var f=c.options;if(f){if(f.hasRef){h.arg={};for(var d=Object.keys(c.arg),p=0;p<d.length;++p){var g=d[p],_=c.arg[g];h.arg[g]=s.isRef(_)?_.toString():_}}"string"==typeof f.description?h.description=f.description:"function"==typeof f.description&&(h.description=f.description(h.arg))}t.rules.push(h)}t.rules.length||delete t.rules;var y=this._getLabel();return y&&(t.label=y),t},e.prototype.label=function(e){a.assert(e&&"string"==typeof e,"Label name must be a non-empty string");var t=this.clone();return t._flags.label=e,t},e.prototype._getLabel=function(e){return this._flags.label||e},e}(),c.Any.prototype.isImmutable=!0,c.Any.prototype.only=c.Any.prototype.equal=c.Any.prototype.valid,c.Any.prototype.disallow=c.Any.prototype.not=c.Any.prototype.invalid,c.Any.prototype.exist=c.Any.prototype.required,c._try=function(e,t){var r=void 0,n=void 0;try{n=e.apply(null,t)}catch(e){r=e}return{value:n,error:r}},c.concatSettings=function(e,t){if(!e&&!t)return null;var r={};if(e&&n(r,e),t)for(var i=Object.keys(t),s=0;s<i.length;++s){var o=i[s];"language"===o&&r.hasOwnProperty(o)?r[o]=a.applyToDefaults(r[o],t[o]):r[o]=t[o]}return r}},function(e,t,r){var n=r(2);t.create=function(e,t){n.assert("string"==typeof e,"Invalid reference key:",e);var r=n.clone(t),i=function e(t,i){return n.reach(e.isContext?i.context:t,e.key,r)};return i.isContext=e[0]===(r&&r.contextPrefix||"$"),i.key=i.isContext?e.slice(1):e,i.path=i.key.split(r&&r.separator||"."),i.depth=i.path.length,i.root=i.path[0],i.isJoi=!0,i.toString=function(){return(i.isContext?"context:":"ref:")+i.key},i},t.isRef=function(e){return"function"==typeof e&&e.isJoi},t.push=function(e,r){t.isRef(r)&&!r.isContext&&e.push(r.root)}},function(e,t,r){var n="function"==typeof Symbol&&"symbol"===_typeof(Symbol.iterator)?function(e){return void 0===e?"undefined":_typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":_typeof(e)};var i=r(2),a=r(14),s={annotations:Symbol("joi-annotations"),stringify:function(e,r){var i=void 0===e?"undefined":n(e);if(null===e)return"null";if("string"===i)return e;if(e instanceof t.Err||"function"===i)return e.toString();if("object"===i){if(Array.isArray(e)){for(var a="",o=0;o<e.length;++o)a=a+(a.length?", ":"")+s.stringify(e[o],r);return r?"["+a+"]":a}return e.toString()}return JSON.stringify(e)}};t.Err=function(){function e(t,r,n,i,a,s,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.isJoi=!0,this.type=t,this.context=r||{},this.context.key=n.key,this.path=n.path,this.options=i,this.flags=a,this.message=s,this.template=o}return e.prototype.toString=function(){var e=this;if(this.message)return this.message;var t=void 0;this.template&&(t=this.template);var r=this.options.language;this.flags.label?this.context.key=this.flags.label:""!==this.context.key&&null!==this.context.key||(this.context.key=r.root||a.errors.root),t=t||i.reach(r,this.type)||i.reach(a.errors,this.type);var n=i.reach(r,"messages.wrapArrays");if("boolean"!=typeof n&&(n=a.errors.messages.wrapArrays),null===t){var o=s.stringify(this.context.reason,n);return n?o.slice(1,-1):o}var l=/\{\{\!?key\}\}/.test(t),u=t.length>2&&"!"===t[0]&&"!"===t[1];return u&&(t=t.slice(2)),l||u||(t=(i.reach(r,"key")||i.reach(a.errors,"key"))+t),t.replace(/\{\{(\!?)([^}]+)\}\}/g,function(t,r,a){var o=i.reach(e.context,a),l=s.stringify(o,n);return r?i.escapeHtml(l):l})},e}(),t.create=function(e,r,n,i,a,s,o){return new t.Err(e,r,n,i,a,s,o)},t.process=function(e,t){if(!e||!e.length)return null;var r="",n=[],i=function e(t,i){for(var a=0;a<t.length;++a){var o=t[a];if(o instanceof Error)return o;if(o.flags.error&&"function"!=typeof o.flags.error)return o.flags.error;var l=void 0;if(void 0===i&&(l=o.toString(),r=r+(r?". ":"")+l),o.context.reason&&o.context.reason.length){var u=e(o.context.reason,o.path);if(u)return u}else n.push({message:l||o.toString(),path:s.getPath(o),type:o.type,context:o.context})}}(e);if(i)return i;var a=new Error(r);return a.isJoi=!0,a.name="ValidationError",a.details=n,a._object=t,a.annotate=s.annotate,a},s.getPath=function(e){return e.path||e.context.key},s.safeStringify=function(e,t){return JSON.stringify(e,s.serializer(),t)},s.serializer=function(){var e=[],t=[];return function(r,i){if(t.length>0){var a=t.indexOf(this);~a?(t.length=a+1,e.length=a+1,e[a]=r):(t.push(this),e.push(r)),~t.indexOf(i)&&(i=function(r,n){return t[0]===n?"[Circular ~]":"[Circular ~."+e.slice(0,t.indexOf(n)).join(".")+"]"}.call(this,r,i))}else t.push(i);if(i){var o=i[s.annotations];if(o){if(Array.isArray(i)){for(var l=[],u=0;u<i.length;++u)o.errors[u]&&l.push("_$idx$_"+o.errors[u].sort().join(", ")+"_$end$_"),l.push(i[u]);i=l}else{for(var c=Object.keys(o.errors),h=0;h<c.length;++h){var f=c[h];i[f+"_$key$_"+o.errors[f].sort().join(", ")+"_$end$_"]=i[f],i[f]=void 0}for(var d=Object.keys(o.missing),p=0;p<d.length;++p){var g=d[p];i["_$miss$_"+g+"|"+o.missing[g]+"_$end$_"]="__missing__"}}return i}}return i===1/0||i===-1/0||Number.isNaN(i)||"function"==typeof i||"symbol"===(void 0===i?"undefined":n(i))?"["+i.toString()+"]":i}},s.annotate=function(e){var t=e?"":"[31m",r=e?"":"[41m",a=e?"":"[0m";if("object"!==n(this._object))return this.details[0].message;for(var o=i.clone(this._object||{}),l=this.details.length-1;l>=0;--l)for(var u=l+1,c=this.details[l].path.split("."),h=o,f=0;;++f){var d=c[f];if(h.isImmutable&&(h=h.clone()),!(f+1<c.length&&h[d]&&"string"!=typeof h[d])){var p=h[s.annotations]=h[s.annotations]||{errors:{},missing:{}};void 0!==h[d]?(p.errors[d]=p.errors[d]||[],p.errors[d].push(u)):p.missing[d]=u;break}h=h[d]}var g=/_\$key\$_([, \d]+)_\$end\$_\"/g,_=/\"_\$miss\$_([^\|]+)\|(\d+)_\$end\$_\"\: \"__missing__\"/g,y=/\s*\"_\$idx\$_([, \d]+)_\$end\$_\",?\n(.*)/g,m=/"\[(NaN|Symbol.*|-?Infinity|function.*|\(.*)\]"/g,v=s.safeStringify(o,2).replace(g,function(e,r){return'" '+t+"["+r+"]"+a}).replace(_,function(e,n,i){return r+'"'+n+'"'+a+t+" ["+i+"]: -- missing --"+a}).replace(y,function(e,r,n){return"\n"+n+" "+t+"["+r+"]"+a}).replace(m,function(e,t){return t});v=v+"\n"+t;for(var b=0;b<this.details.length;++b){v=v+"\n["+(b+1)+"] "+this.details[b].message}return v+=a}},function(e,t){t.errors={root:"value",key:'"{{!key}}" ',messages:{wrapArrays:!0},any:{unknown:"is not allowed",invalid:"contains an invalid value",empty:"is not allowed to be empty",required:"is required",allowOnly:"must be one of {{valids}}",default:"threw an error when running default method"},alternatives:{base:"not matching any of the allowed alternatives",child:null},array:{base:"must be an array",includes:"at position {{pos}} does not match any of the allowed types",includesSingle:'single value of "{{!key}}" does not match any of the allowed types',includesOne:"at position {{pos}} fails because {{reason}}",includesOneSingle:'single value of "{{!key}}" fails because {{reason}}',includesRequiredUnknowns:"does not contain {{unknownMisses}} required value(s)",includesRequiredKnowns:"does not contain {{knownMisses}}",includesRequiredBoth:"does not contain {{knownMisses}} and {{unknownMisses}} other required value(s)",excludes:"at position {{pos}} contains an excluded value",excludesSingle:'single value of "{{!key}}" contains an excluded value',min:"must contain at least {{limit}} items",max:"must contain less than or equal to {{limit}} items",length:"must contain {{limit}} items",ordered:"at position {{pos}} fails because {{reason}}",orderedLength:"at position {{pos}} fails because array must contain at most {{limit}} items",ref:'references "{{ref}}" which is not a positive integer',sparse:"must not be a sparse array",unique:"position {{pos}} contains a duplicate value"},boolean:{base:"must be a boolean"},binary:{base:"must be a buffer or a string",min:"must be at least {{limit}} bytes",max:"must be less than or equal to {{limit}} bytes",length:"must be {{limit}} bytes"},date:{base:"must be a number of milliseconds or valid date string",format:"must be a string with one of the following formats {{format}}",strict:"must be a valid date",min:'must be larger than or equal to "{{limit}}"',max:'must be less than or equal to "{{limit}}"',isoDate:"must be a valid ISO 8601 date",timestamp:{javascript:"must be a valid timestamp or number of milliseconds",unix:"must be a valid timestamp or number of seconds"},ref:'references "{{ref}}" which is not a date'},function:{base:"must be a Function",arity:"must have an arity of {{n}}",minArity:"must have an arity greater or equal to {{n}}",maxArity:"must have an arity lesser or equal to {{n}}",ref:"must be a Joi reference"},lazy:{base:"!!schema error: lazy schema must be set",schema:"!!schema error: lazy schema function must return a schema"},object:{base:"must be an object",child:'!!child "{{!child}}" fails because {{reason}}',min:"must have at least {{limit}} children",max:"must have less than or equal to {{limit}} children",length:"must have {{limit}} children",allowUnknown:'!!"{{!child}}" is not allowed',with:'!!"{{mainWithLabel}}" missing required peer "{{peerWithLabel}}"',without:'!!"{{mainWithLabel}}" conflict with forbidden peer "{{peerWithLabel}}"',missing:"must contain at least one of {{peersWithLabels}}",xor:"contains a conflict between exclusive peers {{peersWithLabels}}",or:"must contain at least one of {{peersWithLabels}}",and:"contains {{presentWithLabels}} without its required peers {{missingWithLabels}}",nand:'!!"{{mainWithLabel}}" must not exist simultaneously with {{peersWithLabels}}',assert:'!!"{{ref}}" validation failed because "{{ref}}" failed to {{message}}',rename:{multiple:'cannot rename child "{{from}}" because multiple renames are disabled and another key was already renamed to "{{to}}"',override:'cannot rename child "{{from}}" because override is disabled and target "{{to}}" exists'},type:'must be an instance of "{{type}}"',schema:"must be a Joi instance"},number:{base:"must be a number",min:"must be larger than or equal to {{limit}}",max:"must be less than or equal to {{limit}}",less:"must be less than {{limit}}",greater:"must be greater than {{limit}}",float:"must be a float or double",integer:"must be an integer",negative:"must be a negative number",positive:"must be a positive number",precision:"must have no more than {{limit}} decimal places",ref:'references "{{ref}}" which is not a number',multiple:"must be a multiple of {{multiple}}"},string:{base:"must be a string",min:"length must be at least {{limit}} characters long",max:"length must be less than or equal to {{limit}} characters long",length:"length must be {{limit}} characters long",alphanum:"must only contain alpha-numeric characters",token:"must only contain alpha-numeric and underscore characters",regex:{base:'with value "{{!value}}" fails to match the required pattern: {{pattern}}',name:'with value "{{!value}}" fails to match the {{name}} pattern',invert:{base:'with value "{{!value}}" matches the inverted pattern: {{pattern}}',name:'with value "{{!value}}" matches the inverted {{name}} pattern'}},email:"must be a valid email",uri:"must be a valid uri",uriRelativeOnly:"must be a valid relative uri",uriCustomScheme:"must be a valid uri with a scheme matching the {{scheme}} pattern",isoDate:"must be a valid ISO 8601 date",guid:"must be a valid GUID",hex:"must only contain hexadecimal characters",base64:"must be a valid base64 string",hostname:"must be a valid hostname",lowercase:"must only contain lowercase characters",uppercase:"must only contain uppercase characters",trim:"must not have leading or trailing whitespace",creditCard:"must be a credit card",ref:'references "{{ref}}" which is not a number',ip:"must be a valid ip address with a {{cidr}} CIDR",ipVersion:"must be a valid ip address of one of the following versions {{version}} with a {{cidr}} CIDR"}}},function(e,t,r){(function(t){var n="function"==typeof Symbol&&"symbol"===_typeof(Symbol.iterator)?function(e){return void 0===e?"undefined":_typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":_typeof(e)};var i=r(12);e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._set=[]}return e.prototype.add=function(e,t){if(i.isRef(e)||!this.has(e,null,null,!1))return void 0!==t&&i.push(t,e),this._set.push(e),this},e.prototype.merge=function(e,t){for(var r=0;r<e._set.length;++r)this.add(e._set[r]);for(var n=0;n<t._set.length;++n)this.remove(t._set[n]);return this},e.prototype.remove=function(e){return this._set=this._set.filter(function(t){return e!==t}),this},e.prototype.has=function(e,r,a,s){for(var o=0;o<this._set.length;++o){var l=this._set[o];r&&i.isRef(l)&&(l=l(r.reference||r.parent,a)),Array.isArray(l)||(l=[l]);for(var u=0;u<l.length;++u){var c=l[u];if((void 0===e?"undefined":n(e))===(void 0===c?"undefined":n(c))&&(e===c||e instanceof Date&&c instanceof Date&&e.getTime()===c.getTime()||s&&"string"==typeof e&&e.toLowerCase()===c.toLowerCase()||t.isBuffer(e)&&t.isBuffer(c)&&e.length===c.length&&e.toString("binary")===c.toString("binary")))return!0}}return!1},e.prototype.values=function(e){if(e&&e.stripUndefined){for(var t=[],r=0;r<this._set.length;++r){var n=this._set[r];void 0!==n&&t.push(n)}return t}return this._set.slice()},e.prototype.slice=function(){var t=new e;return t._set=this._set.slice(),t},e.prototype.concat=function(t){var r=new e;return r._set=this._set.concat(t._set),r},e}()}).call(t,r(3).Buffer)},function(e,t,r){var n="function"==typeof Symbol&&"symbol"===_typeof(Symbol.iterator)?function(e){return void 0===e?"undefined":_typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":_typeof(e)},i=r(2),a=r(12),s={any:null,date:r(17),string:r(18),number:r(23),boolean:r(24),alt:null,object:null};t.schema=function(e){return s.any=s.any||new(r(11)),s.alt=s.alt||r(25),s.object=s.object||r(26),void 0!==e&&null!==e&&"object"===(void 0===e?"undefined":n(e))?e.isJoi?e:Array.isArray(e)?s.alt.try(e):e instanceof RegExp?s.string.regex(e):e instanceof Date?s.date.valid(e):s.object.keys(e):"string"==typeof e?s.string.valid(e):"number"==typeof e?s.number.valid(e):"boolean"==typeof e?s.boolean.valid(e):a.isRef(e)?s.any.valid(e):(i.assert(null===e,"Invalid schema content:",e),s.any.valid(null))},t.ref=function(e){return a.isRef(e)?e:a.create(e)}},function(e,t,r){function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var i=r[n],a=Object.getOwnPropertyDescriptor(t,i);a&&a.configurable&&void 0===e[i]&&Object.defineProperty(e,i,a)}}(e,t))}var i,a=r(11),s=r(12),o=r(2),l={};l.isoDate=/^(?:[-+]\d{2})?(?:\d{4}(?!\d{2}\b))(?:(-?)(?:(?:0[1-9]|1[0-2])(?:\1(?:[12]\d|0[1-9]|3[01]))?|W(?:[0-4]\d|5[0-2])(?:-?[1-7])?|(?:00[1-9]|0[1-9]\d|[12]\d{2}|3(?:[0-5]\d|6[1-6])))(?![T]$|[T][\d]+Z$)(?:[T\s](?:(?:(?:[01]\d|2[0-3])(?:(:?)[0-5]\d)?|24\:?00)(?:[.,]\d+(?!:))?)(?:\2[0-5]\d(?:[.,]\d+)?)?(?:[Z]|(?:[+-])(?:[01]\d|2[0-3])(?::?[0-5]\d)?)?)?)?$/,l.invalidDate=new Date(""),l.isIsoDate=(i=l.isoDate.toString(),function(e){return e&&e.toString()===i}),l.Date=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}(this,e.call(this));return r._type="date",r}return n(t,e),t.prototype._base=function(e,t,r){var n={value:r.convert&&l.Date.toDate(e,this._flags.format,this._flags.timestamp,this._flags.multiplier)||e};if(n.value instanceof Date&&!isNaN(n.value.getTime()))n.errors=null;else if(r.convert){var i=void 0;i=l.isIsoDate(this._flags.format)?"isoDate":this._flags.timestamp?"timestamp."+this._flags.timestamp:"base",n.errors=this.createError("date."+i,null,t,r)}else n.errors=this.createError("date.strict",null,t,r);return n},t.toDate=function(e,t,r,n){if(e instanceof Date)return e;if("string"==typeof e||"number"==typeof e&&!isNaN(e)&&isFinite(e)){"string"==typeof e&&/^[+-]?\d+(\.\d+)?$/.test(e)&&(e=parseFloat(e));var i=void 0;if(i=t&&l.isIsoDate(t)?t.test(e)?new Date(e):l.invalidDate:r&&n?new Date(e*n):new Date(e),!isNaN(i.getTime()))return i}return null},t.prototype.iso=function(){if(this._flags.format===l.isoDate)return this;var e=this.clone();return e._flags.format=l.isoDate,e},t.prototype.timestamp=function(e){e=e||"javascript";var t=["javascript","unix"];if(o.assert(-1!==t.indexOf(e),'"type" must be one of "'+t.join('", "')+'"'),this._flags.timestamp===e)return this;var r=this.clone();return r._flags.timestamp=e,r._flags.multiplier="unix"===e?1e3:1,r},t.prototype._isIsoDate=function(e){return l.isoDate.test(e)},t}(a),l.compare=function(e,t){return function(r){var n="now"===r,i=s.isRef(r);return n||i||(r=l.Date.toDate(r)),o.assert(r,"Invalid date format"),this._test(e,r,function(a,s,o){var u=void 0;if(n)u=Date.now();else if(i){if(!(u=l.Date.toDate(r(s.reference||s.parent,o))))return this.createError("date.ref",{ref:r.key},s,o);u=u.getTime()}else u=r.getTime();return t(a.getTime(),u)?a:this.createError("date."+e,{limit:new Date(u)},s,o)})}},l.Date.prototype.min=l.compare("min",function(e,t){return e>=t}),l.Date.prototype.max=l.compare("max",function(e,t){return e<=t}),e.exports=new l.Date},function(e,t,r){(function(t){var n="function"==typeof Symbol&&"symbol"===_typeof(Symbol.iterator)?function(e){return void 0===e?"undefined":_typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":_typeof(e)};function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var i=r[n],a=Object.getOwnPropertyDescriptor(t,i);a&&a.configurable&&void 0===e[i]&&Object.defineProperty(e,i,a)}}(e,t))}var a=r(5),s=r(2),o=void 0,l=r(11),u=r(12),c=r(17),h=r(19),f=r(21),d={uriRegex:h.createUriRegex(),ipRegex:f.createIpRegex(["ipv4","ipv6","ipvfuture"],"optional"),guidBrackets:{"{":"}","[":"]","(":")","":""},guidVersions:{uuidv1:"1",uuidv2:"2",uuidv3:"3",uuidv4:"4",uuidv5:"5"}};d.String=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}(this,e.call(this));return r._type="string",r._invalids.add(""),r}return i(t,e),t.prototype._base=function(e,t,r){if("string"==typeof e&&r.convert){if(this._flags.case&&(e="upper"===this._flags.case?e.toLocaleUpperCase():e.toLocaleLowerCase()),this._flags.trim&&(e=e.trim()),this._inner.replacements)for(var n=0;n<this._inner.replacements.length;++n){var i=this._inner.replacements[n];e=e.replace(i.pattern,i.replacement)}if(this._flags.truncate)for(var a=0;a<this._tests.length;++a){var s=this._tests[a];if("max"===s.name){e=e.slice(0,s.arg);break}}}return{value:e,errors:"string"==typeof e?null:this.createError("string.base",{value:e},t,r)}},t.prototype.insensitive=function(){if(this._flags.insensitive)return this;var e=this.clone();return e._flags.insensitive=!0,e},t.prototype.creditCard=function(){return this._test("creditCard",void 0,function(e,t,r){for(var n=e.length,i=0,a=1;n--;){var s=e.charAt(n)*a;i+=s-9*(s>9),a^=3}return i%10==0&&i>0?e:this.createError("string.creditCard",{value:e},t,r)})},t.prototype.regex=function(e,t){s.assert(e instanceof RegExp,"pattern must be a RegExp");var r={pattern:new RegExp(e.source,e.ignoreCase?"i":void 0)};"string"==typeof t?r.name=t:"object"===(void 0===t?"undefined":n(t))&&(r.invert=!!t.invert,t.name&&(r.name=t.name));var i=["string.regex",r.invert?".invert":"",r.name?".name":".base"].join("");return this._test("regex",r,function(e,t,n){return r.pattern.test(e)^r.invert?e:this.createError(i,{name:r.name,pattern:r.pattern,value:e},t,n)})},t.prototype.alphanum=function(){return this._test("alphanum",void 0,function(e,t,r){return/^[a-zA-Z0-9]+$/.test(e)?e:this.createError("string.alphanum",{value:e},t,r)})},t.prototype.token=function(){return this._test("token",void 0,function(e,t,r){return/^\w+$/.test(e)?e:this.createError("string.token",{value:e},t,r)})},t.prototype.email=function(e){return e&&(s.assert("object"===(void 0===e?"undefined":n(e)),"email options must be an object"),s.assert(void 0===e.checkDNS,"checkDNS option is not supported"),s.assert(void 0===e.tldWhitelist||"object"===n(e.tldWhitelist),"tldWhitelist must be an array or object"),s.assert(void 0===e.minDomainAtoms||Number.isSafeInteger(e.minDomainAtoms)&&e.minDomainAtoms>0,"minDomainAtoms must be a positive integer"),s.assert(void 0===e.errorLevel||"boolean"==typeof e.errorLevel||Number.isSafeInteger(e.errorLevel)&&e.errorLevel>=0,"errorLevel must be a non-negative integer or boolean")),this._test("email",e,function(t,n,i){o=o||r(22);try{var a=o.validate(t,e);if(!0===a||0===a)return t}catch(e){}return this.createError("string.email",{value:t},n,i)})},t.prototype.ip=function(e){var t=d.ipRegex;e=e||{},s.assert("object"===(void 0===e?"undefined":n(e)),"options must be an object"),e.cidr?(s.assert("string"==typeof e.cidr,"cidr must be a string"),e.cidr=e.cidr.toLowerCase(),s.assert(e.cidr in f.cidrs,"cidr must be one of "+Object.keys(f.cidrs).join(", ")),e.version||"optional"===e.cidr||(t=f.createIpRegex(["ipv4","ipv6","ipvfuture"],e.cidr))):e.cidr="optional";var r=void 0;if(e.version){Array.isArray(e.version)||(e.version=[e.version]),s.assert(e.version.length>=1,"version must have at least 1 version specified"),r=[];for(var i=0;i<e.version.length;++i){var a=e.version[i];s.assert("string"==typeof a,"version at position "+i+" must be a string"),a=a.toLowerCase(),s.assert(f.versions[a],"version at position "+i+" must be one of "+Object.keys(f.versions).join(", ")),r.push(a)}r=s.unique(r),t=f.createIpRegex(r,e.cidr)}return this._test("ip",e,function(n,i,a){return t.test(n)?n:r?this.createError("string.ipVersion",{value:n,cidr:e.cidr,version:r},i,a):this.createError("string.ip",{value:n,cidr:e.cidr},i,a)})},t.prototype.uri=function(e){var t="",r=!1,i=!1,a=d.uriRegex;if(e){if(s.assert("object"===(void 0===e?"undefined":n(e)),"options must be an object"),e.scheme){s.assert(e.scheme instanceof RegExp||"string"==typeof e.scheme||Array.isArray(e.scheme),"scheme must be a RegExp, String, or Array"),Array.isArray(e.scheme)||(e.scheme=[e.scheme]),s.assert(e.scheme.length>=1,"scheme must have at least 1 scheme specified");for(var o=0;o<e.scheme.length;++o){var l=e.scheme[o];s.assert(l instanceof RegExp||"string"==typeof l,"scheme at position "+o+" must be a RegExp or String"),t+=t?"|":"",l instanceof RegExp?t+=l.source:(s.assert(/[a-zA-Z][a-zA-Z0-9+-\.]*/.test(l),"scheme at position "+o+" must be a valid scheme"),t+=s.escapeRegex(l))}}e.allowRelative&&(r=!0),e.relativeOnly&&(i=!0)}return(t||r||i)&&(a=h.createUriRegex(t,r,i)),this._test("uri",e,function(e,r,n){return a.test(e)?e:i?this.createError("string.uriRelativeOnly",{value:e},r,n):t?this.createError("string.uriCustomScheme",{scheme:t,value:e},r,n):this.createError("string.uri",{value:e},r,n)})},t.prototype.isoDate=function(){return this._test("isoDate",void 0,function(e,t,r){return c._isIsoDate(e)?e:this.createError("string.isoDate",{value:e},t,r)})},t.prototype.guid=function(e){var t="";if(e&&e.version){Array.isArray(e.version)||(e.version=[e.version]),s.assert(e.version.length>=1,"version must have at least 1 valid version specified");for(var r=new Set,n=0;n<e.version.length;++n){var i=e.version[n];s.assert("string"==typeof i,"version at position "+n+" must be a string"),i=i.toLowerCase();var a=d.guidVersions[i];s.assert(a,"version at position "+n+" must be one of "+Object.keys(d.guidVersions).join(", ")),s.assert(!r.has(a),"version at position "+n+" must not be a duplicate."),t+=a,r.add(a)}}var o=new RegExp("^([\\[{\\(]?)[0-9A-F]{8}([:-]?)[0-9A-F]{4}\\2?["+(t||"0-9A-F")+"][0-9A-F]{3}\\2?["+(t?"89AB":"0-9A-F")+"][0-9A-F]{3}\\2?[0-9A-F]{12}([\\]}\\)]?)$","i");return this._test("guid",e,function(e,t,r){var n=o.exec(e);return n?d.guidBrackets[n[1]]!==n[n.length-1]?this.createError("string.guid",{value:e},t,r):e:this.createError("string.guid",{value:e},t,r)})},t.prototype.hex=function(){var e=/^[a-f0-9]+$/i;return this._test("hex",e,function(t,r,n){return e.test(t)?t:this.createError("string.hex",{value:t},r,n)})},t.prototype.base64=function(e){e=e||{},s.assert("object"===(void 0===e?"undefined":n(e)),"base64 options must be an object"),s.assert(void 0===e.paddingRequired||"boolean"==typeof e.paddingRequired,"paddingRequired must be boolean");var t=(!1===e.paddingRequired?e.paddingRequired:e.paddingRequired||!0)?/^(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/:/^(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}(==)?|[A-Za-z0-9+\/]{3}=?)?$/;return this._test("base64",t,function(e,r,n){return t.test(e)?e:this.createError("string.base64",{value:e},r,n)})},t.prototype.hostname=function(){var e=/^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9])$/;return this._test("hostname",void 0,function(t,r,n){return t.length<=255&&e.test(t)||a.isIPv6(t)?t:this.createError("string.hostname",{value:t},r,n)})},t.prototype.lowercase=function(){var e=this._test("lowercase",void 0,function(e,t,r){return r.convert||e===e.toLocaleLowerCase()?e:this.createError("string.lowercase",{value:e},t,r)});return e._flags.case="lower",e},t.prototype.uppercase=function(){var e=this._test("uppercase",void 0,function(e,t,r){return r.convert||e===e.toLocaleUpperCase()?e:this.createError("string.uppercase",{value:e},t,r)});return e._flags.case="upper",e},t.prototype.trim=function(){var e=this._test("trim",void 0,function(e,t,r){return r.convert||e===e.trim()?e:this.createError("string.trim",{value:e},t,r)});return e._flags.trim=!0,e},t.prototype.replace=function(e,t){"string"==typeof e&&(e=new RegExp(s.escapeRegex(e),"g")),s.assert(e instanceof RegExp,"pattern must be a RegExp"),s.assert("string"==typeof t,"replacement must be a String");var r=this.clone();return r._inner.replacements||(r._inner.replacements=[]),r._inner.replacements.push({pattern:e,replacement:t}),r},t.prototype.truncate=function(e){var t=void 0===e||!!e;if(this._flags.truncate===t)return this;var r=this.clone();return r._flags.truncate=t,r},t}(l),d.compare=function(e,r){return function(n,i){var a=u.isRef(n);return s.assert(Number.isSafeInteger(n)&&n>=0||a,"limit must be a positive integer or reference"),s.assert(!i||t.isEncoding(i),"Invalid encoding:",i),this._test(e,n,function(t,s,o){var l=void 0;if(a){if(l=n(s.reference||s.parent,o),!Number.isSafeInteger(l))return this.createError("string.ref",{ref:n.key},s,o)}else l=n;return r(t,l,i)?t:this.createError("string."+e,{limit:l,value:t,encoding:i},s,o)})}},d.String.prototype.min=d.compare("min",function(e,r,n){return(n?t.byteLength(e,n):e.length)>=r}),d.String.prototype.max=d.compare("max",function(e,r,n){return(n?t.byteLength(e,n):e.length)<=r}),d.String.prototype.length=d.compare("length",function(e,r,n){return(n?t.byteLength(e,n):e.length)===r}),d.String.prototype.uuid=d.String.prototype.guid,e.exports=new d.String}).call(t,r(3).Buffer)},function(e,t,r){var n=r(20),i={Uri:{createUriRegex:function(e,t,r){var i=n.scheme,a=void 0;if(r)a="(?:"+n.relativeRef+")";else{e&&(i="(?:"+e+")");var s="(?:"+i+":"+n.hierPart+")";a=t?"(?:"+s+"|"+n.relativeRef+")":s}return new RegExp("^"+a+"(?:\\?"+n.query+")?(?:#"+n.fragment+")?$")}}};e.exports=i.Uri},function(e,t){var r={rfc3986:{},generate:function(){var e="|";r.rfc3986.cidr="[0-9]|[1-2][0-9]|3[0-2]";var t="a-zA-Z0-9-\\._~",n="!\\$&'\\(\\)\\*\\+,;=",i=t+"%0-9A-Fa-f"+n+":@",a="["+i+"]",s="(?:0?0?[0-9]|0?[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])";r.rfc3986.IPv4address="(?:"+s+"\\.){3}"+s;var o="[0-9A-Fa-f]{1,4}",l="(?:"+o+":"+o+"|"+r.rfc3986.IPv4address+")",u="(?:"+o+":){6}"+l,c="::(?:"+o+":){5}"+l,h="(?:"+o+")?::(?:"+o+":){4}"+l,f="(?:(?:"+o+":){0,1}"+o+")?::(?:"+o+":){3}"+l,d="(?:(?:"+o+":){0,2}"+o+")?::(?:"+o+":){2}"+l,p="(?:(?:"+o+":){0,3}"+o+")?::"+o+":"+l,g="(?:(?:"+o+":){0,4}"+o+")?::"+l;r.rfc3986.IPv6address="(?:"+u+e+c+e+h+e+f+e+d+e+p+e+g+e+"(?:(?:[0-9A-Fa-f]{1,4}:){0,5}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}"+e+"(?:(?:[0-9A-Fa-f]{1,4}:){0,6}[0-9A-Fa-f]{1,4})?::)",r.rfc3986.IPvFuture="v[0-9A-Fa-f]+\\.["+t+n+":]+",r.rfc3986.scheme="[a-zA-Z][a-zA-Z0-9+-\\.]*";var _="(?:[a-zA-Z0-9-\\._~%0-9A-Fa-f!\\$&'\\(\\)\\*\\+,;=:]*@)?"+("(?:"+("\\[(?:"+r.rfc3986.IPv6address+e+r.rfc3986.IPvFuture+")\\]")+e+r.rfc3986.IPv4address+e+"[a-zA-Z0-9-\\._~%0-9A-Fa-f!\\$&'\\(\\)\\*\\+,;=]{0,255})")+"(?::[0-9]*)?",y=a+"+",m="(?:\\/[a-zA-Z0-9-\\._~%0-9A-Fa-f!\\$&'\\(\\)\\*\\+,;=:@]*)*",v="\\/(?:"+y+m+")?";r.rfc3986.hierPart="(?:(?:\\/\\/"+_+m+")"+e+v+e+"[a-zA-Z0-9-\\._~%0-9A-Fa-f!\\$&'\\(\\)\\*\\+,;=:@]+(?:\\/[a-zA-Z0-9-\\._~%0-9A-Fa-f!\\$&'\\(\\)\\*\\+,;=:@]*)*)",r.rfc3986.relativeRef="(?:(?:\\/\\/"+_+m+")"+e+v+e+"[a-zA-Z0-9-\\._~%0-9A-Fa-f!\\$&'\\(\\)\\*\\+,;=@]+(?:\\/[a-zA-Z0-9-\\._~%0-9A-Fa-f!\\$&'\\(\\)\\*\\+,;=:@]*)*"+e+")",r.rfc3986.query="["+i+"\\/\\?]*(?=#|$)",r.rfc3986.fragment="["+i+"\\/\\?]*"}};r.generate(),e.exports=r.rfc3986},function(e,t,r){var n=r(20),i={Ip:{cidrs:{required:"\\/(?:"+n.cidr+")",optional:"(?:\\/(?:"+n.cidr+"))?",forbidden:""},versions:{ipv4:n.IPv4address,ipv6:n.IPv6address,ipvfuture:n.IPvFuture}}};i.Ip.createIpRegex=function(e,t){for(var r=void 0,n=0;n<e.length;++n){var a=e[n];r||(r="^(?:"+i.Ip.versions[a]),r=r+"|"+i.Ip.versions[a]}return new RegExp(r+")"+i.Ip.cidrs[t]+"$")},e.exports=i.Ip},function(e,t,r){(function(e){var n="function"==typeof Symbol&&"symbol"===_typeof(Symbol.iterator)?function(e){return void 0===e?"undefined":_typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":_typeof(e)},i=r(5),a={hasOwn:Object.prototype.hasOwnProperty,indexOf:Array.prototype.indexOf,defaultThreshold:16,maxIPv6Groups:8,categories:{valid:1,dnsWarn:7,rfc5321:15,cfws:31,deprecated:63,rfc5322:127,error:255},diagnoses:{valid:0,dnsWarnNoMXRecord:5,dnsWarnNoRecord:6,rfc5321TLD:9,rfc5321TLDNumeric:10,rfc5321QuotedString:11,rfc5321AddressLiteral:12,cfwsComment:17,cfwsFWS:18,deprecatedLocalPart:33,deprecatedFWS:34,deprecatedQTEXT:35,deprecatedQP:36,deprecatedComment:37,deprecatedCTEXT:38,deprecatedIPv6:39,deprecatedCFWSNearAt:49,rfc5322Domain:65,rfc5322TooLong:66,rfc5322LocalTooLong:67,rfc5322DomainTooLong:68,rfc5322LabelTooLong:69,rfc5322DomainLiteral:70,rfc5322DomainLiteralOBSDText:71,rfc5322IPv6GroupCount:72,rfc5322IPv62x2xColon:73,rfc5322IPv6BadCharacter:74,rfc5322IPv6MaxGroups:75,rfc5322IPv6ColonStart:76,rfc5322IPv6ColonEnd:77,errExpectingDTEXT:129,errNoLocalPart:130,errNoDomain:131,errConsecutiveDots:132,errATEXTAfterCFWS:133,errATEXTAfterQS:134,errATEXTAfterDomainLiteral:135,errExpectingQPair:136,errExpectingATEXT:137,errExpectingQTEXT:138,errExpectingCTEXT:139,errBackslashEnd:140,errDotStart:141,errDotEnd:142,errDomainHyphenStart:143,errDomainHyphenEnd:144,errUnclosedQuotedString:145,errUnclosedComment:146,errUnclosedDomainLiteral:147,errFWSCRLFx2:148,errFWSCRLFEnd:149,errCRNoLF:150,errUnknownTLD:160,errDomainTooShort:161},components:{localpart:0,domain:1,literal:2,contextComment:3,contextFWS:4,contextQuotedString:5,contextQuotedPair:6}};a.defer=void 0!==e&&e&&"function"==typeof e.nextTick?e.nextTick.bind(e):function(e){return setTimeout(e,0)},a.specials=function(){for(var e=new Array(256),t=255;t>=0;--t)e[t]=!1;for(var r=0;r<'()<>[]:;@\\,."'.length;++r)e['()<>[]:;@\\,."'.charCodeAt(r)]=!0;return function(t){return e[t]}}(),a.regex={ipV4:/\b(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipV6:/^[a-fA-F\d]{0,4}$/},a.checkIpV6=function(e){return e.every(function(e){return a.regex.ipV6.test(e)})},a.validDomain=function(e,t){return t.tldBlacklist?Array.isArray(t.tldBlacklist)?-1===a.indexOf.call(t.tldBlacklist,e):!a.hasOwn.call(t.tldBlacklist,e):Array.isArray(t.tldWhitelist)?-1!==a.indexOf.call(t.tldWhitelist,e):a.hasOwn.call(t.tldWhitelist,e)},t.validate=a.validate=function(e,t,r){if("function"==typeof(t=t||{})&&(r=t,t={}),"function"!=typeof r){if(t.checkDNS)throw new TypeError("expected callback function for checkDNS option");r=null}var s=void 0,o=void 0;if("number"==typeof t.errorLevel?(s=!0,o=t.errorLevel):(s=!!t.errorLevel,o=a.diagnoses.valid),t.tldWhitelist)if("string"==typeof t.tldWhitelist)t.tldWhitelist=[t.tldWhitelist];else if("object"!==n(t.tldWhitelist))throw new TypeError("expected array or object tldWhitelist");if(t.tldBlacklist)if("string"==typeof t.tldBlacklist)t.tldBlacklist=[t.tldBlacklist];else if("object"!==n(t.tldBlacklist))throw new TypeError("expected array or object tldBlacklist");if(t.minDomainAtoms&&(t.minDomainAtoms!==(0|+t.minDomainAtoms)||t.minDomainAtoms<0))throw new TypeError("expected positive integer minDomainAtoms");for(var l=a.diagnoses.valid,u=function(e){e>l&&(l=e)},c={now:a.components.localpart,prev:a.components.localpart,stack:[a.components.localpart]},h="",f={local:"",domain:""},d={locals:[""],domains:[""]},p=0,g=0,_=0,y=void 0,m=!1,v=!1,b=e.length,w=void 0,E=0;E<b;++E){switch(w=e[E],c.now){case a.components.localpart:switch(w){case"(":0===g?u(0===p?a.diagnoses.cfwsComment:a.diagnoses.deprecatedComment):(u(a.diagnoses.cfwsComment),v=!0),c.stack.push(c.now),c.now=a.components.contextComment;break;case".":0===g?u(0===p?a.diagnoses.errDotStart:a.diagnoses.errConsecutiveDots):(v&&u(a.diagnoses.deprecatedLocalPart),v=!1,g=0,++p,f.local+=w,d.locals[p]="");break;case'"':0===g?(u(0===p?a.diagnoses.rfc5321QuotedString:a.diagnoses.deprecatedLocalPart),f.local+=w,d.locals[p]+=w,++g,v=!0,c.stack.push(c.now),c.now=a.components.contextQuotedString):u(a.diagnoses.errExpectingATEXT);break;case"\r":if(b===++E||"\n"!==e[E]){u(a.diagnoses.errCRNoLF);break}case" ":case"\t":0===g?u(0===p?a.diagnoses.cfwsFWS:a.diagnoses.deprecatedFWS):v=!0,c.stack.push(c.now),c.now=a.components.contextFWS,h=w;break;case"@":if(1!==c.stack.length)throw new Error("unexpected item on context stack");0===f.local.length?u(a.diagnoses.errNoLocalPart):0===g?u(a.diagnoses.errDotEnd):f.local.length>64?u(a.diagnoses.rfc5322LocalTooLong):c.prev!==a.components.contextComment&&c.prev!==a.components.contextFWS||u(a.diagnoses.deprecatedCFWSNearAt),c.now=a.components.domain,c.stack[0]=a.components.domain,p=0,g=0,v=!1;break;default:if(v)switch(c.prev){case a.components.contextComment:case a.components.contextFWS:u(a.diagnoses.errATEXTAfterCFWS);break;case a.components.contextQuotedString:u(a.diagnoses.errATEXTAfterQS);break;default:throw new Error("more atext found where none is allowed, but unrecognized prev context: "+c.prev)}else c.prev=c.now,((y=w.charCodeAt(0))<33||y>126||a.specials(y))&&u(a.diagnoses.errExpectingATEXT),f.local+=w,d.locals[p]+=w,++g}break;case a.components.domain:switch(w){case"(":0===g?u(0===p?a.diagnoses.deprecatedCFWSNearAt:a.diagnoses.deprecatedComment):(v=!0,u(a.diagnoses.cfwsComment)),c.stack.push(c.now),c.now=a.components.contextComment;break;case".":0===g?u(0===p?a.diagnoses.errDotStart:a.diagnoses.errConsecutiveDots):m?u(a.diagnoses.errDomainHyphenEnd):g>63&&u(a.diagnoses.rfc5322LabelTooLong),v=!1,g=0,++p,d.domains[p]="",f.domain+=w;break;case"[":0===f.domain.length?(v=!0,++g,c.stack.push(c.now),c.now=a.components.literal,f.domain+=w,d.domains[p]+=w,f.literal=""):u(a.diagnoses.errExpectingATEXT);break;case"\r":if(b===++E||"\n"!==e[E]){u(a.diagnoses.errCRNoLF);break}case" ":case"\t":0===g?u(0===p?a.diagnoses.deprecatedCFWSNearAt:a.diagnoses.deprecatedFWS):(u(a.diagnoses.cfwsFWS),v=!0),c.stack.push(c.now),c.now=a.components.contextFWS,h=w;break;default:if(v)switch(c.prev){case a.components.contextComment:case a.components.contextFWS:u(a.diagnoses.errATEXTAfterCFWS);break;case a.components.literal:u(a.diagnoses.errATEXTAfterDomainLiteral);break;default:throw new Error("more atext found where none is allowed, but unrecognized prev context: "+c.prev)}m=!1,(y=w.charCodeAt(0))<33||y>126||a.specials(y)?u(a.diagnoses.errExpectingATEXT):"-"===w?(0===g&&u(a.diagnoses.errDomainHyphenStart),m=!0):(y<48||y>122||y>57&&y<65||y>90&&y<97)&&u(a.diagnoses.rfc5322Domain),f.domain+=w,d.domains[p]+=w,++g}break;case a.components.literal:switch(w){case"]":if(l<a.categories.deprecated){var T=-1,k=f.literal,x=a.regex.ipV4.exec(k);if(x&&0!==(T=x.index)&&(k=k.slice(0,T)+"0:0"),0===T)u(a.diagnoses.rfc5321AddressLiteral);else if("ipv6:"!==k.slice(0,5).toLowerCase())u(a.diagnoses.rfc5322DomainLiteral);else{var S=k.slice(5),I=a.maxIPv6Groups,A=S.split(":");~(T=S.indexOf("::"))?T!==S.lastIndexOf("::")?u(a.diagnoses.rfc5322IPv62x2xColon):(0!==T&&T!==S.length-2||++I,A.length>I?u(a.diagnoses.rfc5322IPv6MaxGroups):A.length===I&&u(a.diagnoses.deprecatedIPv6)):A.length!==I&&u(a.diagnoses.rfc5322IPv6GroupCount),":"===S[0]&&":"!==S[1]?u(a.diagnoses.rfc5322IPv6ColonStart):":"===S[S.length-1]&&":"!==S[S.length-2]?u(a.diagnoses.rfc5322IPv6ColonEnd):a.checkIpV6(A)?u(a.diagnoses.rfc5321AddressLiteral):u(a.diagnoses.rfc5322IPv6BadCharacter)}}else u(a.diagnoses.rfc5322DomainLiteral);f.domain+=w,d.domains[p]+=w,++g,c.prev=c.now,c.now=c.stack.pop();break;case"\\":u(a.diagnoses.rfc5322DomainLiteralOBSDText),c.stack.push(c.now),c.now=a.components.contextQuotedPair;break;case"\r":if(b===++E||"\n"!==e[E]){u(a.diagnoses.errCRNoLF);break}case" ":case"\t":u(a.diagnoses.cfwsFWS),c.stack.push(c.now),c.now=a.components.contextFWS,h=w;break;default:if((y=w.charCodeAt(0))>127||0===y||"["===w){u(a.diagnoses.errExpectingDTEXT);break}(y<33||127===y)&&u(a.diagnoses.rfc5322DomainLiteralOBSDText),f.literal+=w,f.domain+=w,d.domains[p]+=w,++g}break;case a.components.contextQuotedString:switch(w){case"\\":c.stack.push(c.now),c.now=a.components.contextQuotedPair;break;case"\r":if(b===++E||"\n"!==e[E]){u(a.diagnoses.errCRNoLF);break}case"\t":f.local+=" ",d.locals[p]+=" ",++g,u(a.diagnoses.cfwsFWS),c.stack.push(c.now),c.now=a.components.contextFWS,h=w;break;case'"':f.local+=w,d.locals[p]+=w,++g,c.prev=c.now,c.now=c.stack.pop();break;default:(y=w.charCodeAt(0))>127||0===y||10===y?u(a.diagnoses.errExpectingQTEXT):(y<32||127===y)&&u(a.diagnoses.deprecatedQTEXT),f.local+=w,d.locals[p]+=w,++g}break;case a.components.contextQuotedPair:switch((y=w.charCodeAt(0))>127?u(a.diagnoses.errExpectingQPair):(y<31&&9!==y||127===y)&&u(a.diagnoses.deprecatedQP),c.prev=c.now,c.now=c.stack.pop(),w="\\"+w,c.now){case a.components.contextComment:break;case a.components.contextQuotedString:f.local+=w,d.locals[p]+=w,g+=2;break;case a.components.literal:f.domain+=w,d.domains[p]+=w,g+=2;break;default:throw new Error("quoted pair logic invoked in an invalid context: "+c.now)}break;case a.components.contextComment:switch(w){case"(":c.stack.push(c.now),c.now=a.components.contextComment;break;case")":c.prev=c.now,c.now=c.stack.pop();break;case"\\":c.stack.push(c.now),c.now=a.components.contextQuotedPair;break;case"\r":if(b===++E||"\n"!==e[E]){u(a.diagnoses.errCRNoLF);break}case" ":case"\t":u(a.diagnoses.cfwsFWS),c.stack.push(c.now),c.now=a.components.contextFWS,h=w;break;default:if((y=w.charCodeAt(0))>127||0===y||10===y){u(a.diagnoses.errExpectingCTEXT);break}(y<32||127===y)&&u(a.diagnoses.deprecatedCTEXT)}break;case a.components.contextFWS:if("\r"===h){if("\r"===w){u(a.diagnoses.errFWSCRLFx2);break}++_>1?u(a.diagnoses.deprecatedFWS):_=1}switch(w){case"\r":b!==++E&&"\n"===e[E]||u(a.diagnoses.errCRNoLF);break;case" ":case"\t":break;default:"\r"===h&&u(a.diagnoses.errFWSCRLFEnd),_=0,c.prev=c.now,c.now=c.stack.pop(),--E}h=w;break;default:throw new Error("unknown context: "+c.now)}if(l>a.categories.rfc5322)break}if(l<a.categories.rfc5322)if(c.now===a.components.contextQuotedString)u(a.diagnoses.errUnclosedQuotedString);else if(c.now===a.components.contextQuotedPair)u(a.diagnoses.errBackslashEnd);else if(c.now===a.components.contextComment)u(a.diagnoses.errUnclosedComment);else if(c.now===a.components.literal)u(a.diagnoses.errUnclosedDomainLiteral);else if("\r"===w)u(a.diagnoses.errFWSCRLFEnd);else if(0===f.domain.length)u(a.diagnoses.errNoDomain);else if(0===g)u(a.diagnoses.errDotEnd);else if(m)u(a.diagnoses.errDomainHyphenEnd);else if(f.domain.length>255)u(a.diagnoses.rfc5322DomainTooLong);else if(f.local.length+f.domain.length+1>254)u(a.diagnoses.rfc5322TooLong);else if(g>63)u(a.diagnoses.rfc5322LabelTooLong);else if(t.minDomainAtoms&&d.domains.length<t.minDomainAtoms)u(a.diagnoses.errDomainTooShort);else if(t.tldWhitelist||t.tldBlacklist){var M=d.domains[p];a.validDomain(M,t)||u(a.diagnoses.errUnknownTLD)}var N=!1,C=!1,O=function(){!N&&l<a.categories.dnsWarn&&(d.domains[p].charCodeAt(0)<=57?u(a.diagnoses.rfc5321TLDNumeric):0===p&&u(a.diagnoses.rfc5321TLD));l<o&&(l=a.diagnoses.valid);var e=s?l:l<a.defaultThreshold;return r&&(C?r(e):a.defer(r.bind(null,e))),e};if(!(t.checkDNS&&l<a.categories.dnsWarn)){var D=O();return C=!0,D}!function(){0===p&&(f.domain+=".");var e=f.domain;i.resolveMx(e,function(t,r){if(t&&t.code!==i.NODATA)return u(a.diagnoses.dnsWarnNoRecord),O();if(r&&r.length)return N=!0,O();var n=3,s=!1;u(a.diagnoses.dnsWarnNoMXRecord);var o=function(e,t){if(!s){if(--n,t&&t.length)return s=!0,O();0===n&&(u(a.diagnoses.dnsWarnNoRecord),s=!0,O())}};i.resolveCname(e,o),i.resolve4(e,o),i.resolve6(e,o)}),C=!0}()},t.diagnoses=a.validate.diagnoses=function(){for(var e={},t=Object.keys(a.diagnoses),r=0;r<t.length;++r){var n=t[r];e[n]=a.diagnoses[n]}return e}()}).call(t,r(4))},function(e,t,r){function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var i=r[n],a=Object.getOwnPropertyDescriptor(t,i);a&&a.configurable&&void 0===e[i]&&Object.defineProperty(e,i,a)}}(e,t))}var i=r(11),a=r(12),s=r(2),o={precisionRx:/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/};o.Number=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}(this,e.call(this));return r._type="number",r._invalids.add(1/0),r._invalids.add(-1/0),r}return n(t,e),t.prototype._base=function(e,t,r){var n={errors:null,value:e};if("string"==typeof e&&r.convert){var i=parseFloat(e);n.value=isNaN(i)||!isFinite(e)?NaN:i}var a="number"==typeof n.value&&!isNaN(n.value);if(r.convert&&"precision"in this._flags&&a){var s=Math.pow(10,this._flags.precision);n.value=Math.round(n.value*s)/s}return n.errors=a?null:this.createError("number.base",null,t,r),n},t.prototype.multiple=function(e){var t=a.isRef(e);return t||(s.assert("number"==typeof e&&isFinite(e),"multiple must be a number"),s.assert(e>0,"multiple must be greater than 0")),this._test("multiple",e,function(r,n,i){var a=t?e(n.reference||n.parent,i):e;return!t||"number"==typeof a&&isFinite(a)?r%a==0?r:this.createError("number.multiple",{multiple:e,value:r},n,i):this.createError("number.ref",{ref:e.key},n,i)})},t.prototype.integer=function(){return this._test("integer",void 0,function(e,t,r){return Number.isSafeInteger(e)?e:this.createError("number.integer",{value:e},t,r)})},t.prototype.negative=function(){return this._test("negative",void 0,function(e,t,r){return e<0?e:this.createError("number.negative",{value:e},t,r)})},t.prototype.positive=function(){return this._test("positive",void 0,function(e,t,r){return e>0?e:this.createError("number.positive",{value:e},t,r)})},t.prototype.precision=function(e){s.assert(Number.isSafeInteger(e),"limit must be an integer"),s.assert(!("precision"in this._flags),"precision already set");var t=this._test("precision",e,function(t,r,n){var i=t.toString().match(o.precisionRx);return Math.max((i[1]?i[1].length:0)-(i[2]?parseInt(i[2],10):0),0)<=e?t:this.createError("number.precision",{limit:e,value:t},r,n)});return t._flags.precision=e,t},t}(i),o.compare=function(e,t){return function(r){var n=a.isRef(r),i="number"==typeof r&&!isNaN(r);return s.assert(i||n,"limit must be a number or reference"),this._test(e,r,function(i,a,s){var o=void 0;if(n){if("number"!=typeof(o=r(a.reference||a.parent,s))||isNaN(o))return this.createError("number.ref",{ref:r.key},a,s)}else o=r;return t(i,o)?i:this.createError("number."+e,{limit:o,value:i},a,s)})}},o.Number.prototype.min=o.compare("min",function(e,t){return e>=t}),o.Number.prototype.max=o.compare("max",function(e,t){return e<=t}),o.Number.prototype.greater=o.compare("greater",function(e,t){return e>t}),o.Number.prototype.less=o.compare("less",function(e,t){return e<t}),e.exports=new o.Number},function(e,t,r){function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var i=r[n],a=Object.getOwnPropertyDescriptor(t,i);a&&a.configurable&&void 0===e[i]&&Object.defineProperty(e,i,a)}}(e,t))}var i=r(11),a=r(2),s={Set:r(15)};s.Boolean=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}(this,e.call(this));return r._type="boolean",r._flags.insensitive=!0,r._inner.truthySet=new s.Set,r._inner.falsySet=new s.Set,r}return n(t,e),t.prototype._base=function(e,t,r){var n={value:e};if("string"==typeof e&&r.convert){var i=this._flags.insensitive?e.toLowerCase():e;n.value="true"===i||"false"!==i&&e}return"boolean"!=typeof n.value&&(n.value=!!this._inner.truthySet.has(e,null,null,this._flags.insensitive)||!this._inner.falsySet.has(e,null,null,this._flags.insensitive)&&e),n.errors="boolean"==typeof n.value?null:this.createError("boolean.base",null,t,r),n},t.prototype.truthy=function(){for(var e=this.clone(),t=a.flatten(Array.prototype.slice.call(arguments)),r=0;r<t.length;++r){var n=t[r];a.assert(void 0!==n,"Cannot call truthy with undefined"),e._inner.truthySet.add(n)}return e},t.prototype.falsy=function(){for(var e=this.clone(),t=a.flatten(Array.prototype.slice.call(arguments)),r=0;r<t.length;++r){var n=t[r];a.assert(void 0!==n,"Cannot call falsy with undefined"),e._inner.falsySet.add(n)}return e},t.prototype.insensitive=function(e){var t=void 0===e||!!e;if(this._flags.insensitive===t)return this;var r=this.clone();return r._flags.insensitive=t,r},t.prototype.describe=function(){var e=i.prototype.describe.call(this);return e.truthy=[!0].concat(this._inner.truthySet.values()),e.falsy=[!1].concat(this._inner.falsySet.values()),e},t}(i),e.exports=new s.Boolean},function(e,t,r){var n="function"==typeof Symbol&&"symbol"===_typeof(Symbol.iterator)?function(e){return void 0===e?"undefined":_typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":_typeof(e)};function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var i=r[n],a=Object.getOwnPropertyDescriptor(t,i);a&&a.configurable&&void 0===e[i]&&Object.defineProperty(e,i,a)}}(e,t))}var a=r(2),s=r(11),o=r(16),l=r(12),u={};u.Alternatives=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}(this,e.call(this));return r._type="alternatives",r._invalids.remove(null),r._inner.matches=[],r}return i(t,e),t.prototype._base=function(e,t,r){for(var n=[],i=this._inner.matches.length,a=this._baseType,s=0;s<i;++s){var o=this._inner.matches[s],l=o.schema;if(l){var u=l._validate(e,t,r);if(!u.errors)return u;n=n.concat(u.errors)}else{if(o.is._validate(o.ref(t.reference||t.parent,r),null,r,t.parent).errors){if(o.otherwise)return o.otherwise._validate(e,t,r)}else if(o.then)return o.then._validate(e,t,r);if(s===i-1&&a)return a._validate(e,t,r)}}return n.length?{errors:this.createError("alternatives.child",{reason:n},t,r)}:{errors:this.createError("alternatives.base",null,t,r)}},t.prototype.try=function(){var e=a.flatten(Array.prototype.slice.call(arguments));a.assert(e.length,"Cannot add other alternatives without at least one schema");for(var t=this.clone(),r=0;r<e.length;++r){var n=o.schema(e[r]);n._refs.length&&(t._refs=t._refs.concat(n._refs)),t._inner.matches.push({schema:n})}return t},t.prototype.when=function(e,t){a.assert(l.isRef(e)||"string"==typeof e,"Invalid reference:",e),a.assert(t,"Missing options"),a.assert("object"===(void 0===t?"undefined":n(t)),"Invalid options"),a.assert(t.hasOwnProperty("is"),'Missing "is" directive'),a.assert(void 0!==t.then||void 0!==t.otherwise,'options must have at least one of "then" or "otherwise"');var r=this.clone(),i=o.schema(t.is);null!==t.is&&(l.isRef(t.is)||t.is instanceof s)||(i=i.required());var u={ref:o.ref(e),is:i,then:void 0!==t.then?o.schema(t.then):void 0,otherwise:void 0!==t.otherwise?o.schema(t.otherwise):void 0};return r._baseType&&(u.then=u.then&&r._baseType.concat(u.then),u.otherwise=u.otherwise&&r._baseType.concat(u.otherwise)),l.push(r._refs,u.ref),r._refs=r._refs.concat(u.is._refs),u.then&&u.then._refs&&(r._refs=r._refs.concat(u.then._refs)),u.otherwise&&u.otherwise._refs&&(r._refs=r._refs.concat(u.otherwise._refs)),r._inner.matches.push(u),r},t.prototype.describe=function(){for(var e=s.prototype.describe.call(this),t=[],r=0;r<this._inner.matches.length;++r){var n=this._inner.matches[r];if(n.schema)t.push(n.schema.describe());else{var i={ref:n.ref.toString(),is:n.is.describe()};n.then&&(i.then=n.then.describe()),n.otherwise&&(i.otherwise=n.otherwise.describe()),t.push(i)}}return e.alternatives=t,e},t}(s),e.exports=new u.Alternatives},function(e,t,r){var n="function"==typeof Symbol&&"symbol"===_typeof(Symbol.iterator)?function(e){return void 0===e?"undefined":_typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":_typeof(e)};function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var i=r[n],a=Object.getOwnPropertyDescriptor(t,i);a&&a.configurable&&void 0===e[i]&&Object.defineProperty(e,i,a)}}(e,t))}var a=r(2),s=r(27),o=r(11),l=r(13),u=r(16),c=r(12),h={};h.Object=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}(this,e.call(this));return r._type="object",r._inner.children=null,r._inner.renames=[],r._inner.dependencies=[],r._inner.patterns=[],r}return i(t,e),t.prototype._base=function(e,t,r){var i=e,s=[],o=function(){return{value:i,errors:s.length?s:null}};"string"==typeof e&&r.convert&&(e=h.safeParse(e));var u=this._flags.func?"function":"object";if(!e||(void 0===e?"undefined":n(e))!==u||Array.isArray(e))return s.push(this.createError(u+".base",null,t,r)),o();if(!(this._inner.renames.length||this._inner.dependencies.length||this._inner.children||this._inner.patterns.length))return i=e,o();if(i===e){"object"===u?i=Object.create(Object.getPrototypeOf(e)):(i=function(){return e.apply(this,arguments)}).prototype=a.clone(e.prototype);for(var c=Object.keys(e),f=0;f<c.length;++f)i[c[f]]=e[c[f]]}else i=e;for(var d={},p=0;p<this._inner.renames.length;++p){var g=this._inner.renames[p];if(!g.options.ignoreUndefined||void 0!==i[g.from]){if(!g.options.multiple&&d[g.to]&&(s.push(this.createError("object.rename.multiple",{from:g.from,to:g.to},t,r)),r.abortEarly))return o();if(Object.prototype.hasOwnProperty.call(i,g.to)&&!g.options.override&&!d[g.to]&&(s.push(this.createError("object.rename.override",{from:g.from,to:g.to},t,r)),r.abortEarly))return o();void 0===i[g.from]?delete i[g.to]:i[g.to]=i[g.from],d[g.to]=!0,g.options.alias||delete i[g.from]}}if(!this._inner.children&&!this._inner.patterns.length&&!this._inner.dependencies.length)return o();var _=a.mapToObject(Object.keys(i));if(this._inner.children){for(var y=[],m=0;m<this._inner.children.length;++m){var v=this._inner.children[m],b=v.key,w=i[b];delete _[b];var E={key:b,path:(t.path||"")+(t.path&&b?".":"")+b,parent:i,reference:t.reference},T=v.schema._validate(w,E,r);if(T.errors){if(s.push(this.createError("object.child",{key:b,child:v.schema._getLabel(b),reason:T.errors},E,r)),r.abortEarly)return o()}else v.schema._flags.strip||void 0===T.value&&T.value!==w?(y.push(b),i[b]=T.finalValue):void 0!==T.value&&(i[b]=T.value)}for(var k=0;k<y.length;++k)delete i[y[k]]}var x=Object.keys(_);if(x.length&&this._inner.patterns.length){for(var S=0;S<x.length;++S)for(var I=x[S],A={key:I,path:(t.path?t.path+".":"")+I,parent:i,reference:t.reference},M=i[I],N=0;N<this._inner.patterns.length;++N){var C=this._inner.patterns[N];if(C.regex.test(I)){delete _[I];var O=C.rule._validate(M,A,r);if(O.errors&&(s.push(this.createError("object.child",{key:I,child:C.rule._getLabel(I),reason:O.errors},A,r)),r.abortEarly))return o();void 0!==O.value&&(i[I]=O.value)}}x=Object.keys(_)}if((this._inner.children||this._inner.patterns.length)&&x.length){if(r.stripUnknown&&!0!==this._flags.allowUnknown||r.skipFunctions){for(var D=!!r.stripUnknown&&(!0===r.stripUnknown||!!r.stripUnknown.objects),R=0;R<x.length;++R){var B=x[R];D?(delete i[B],delete _[B]):"function"==typeof i[B]&&delete _[B]}x=Object.keys(_)}if(x.length&&(void 0!==this._flags.allowUnknown?!this._flags.allowUnknown:!r.allowUnknown))for(var F=0;F<x.length;++F){var U=x[F];s.push(this.createError("object.allowUnknown",{child:U},{key:U,path:t.path+(t.path?".":"")+U},r))}}for(var L=0;L<this._inner.dependencies.length;++L){var P=this._inner.dependencies[L],j=h[P.type].call(this,null!==P.key&&i[P.key],P.peers,i,{key:P.key,path:(t.path||"")+(P.key?"."+P.key:"")},r);if(j instanceof l.Err&&(s.push(j),r.abortEarly))return o()}return o()},t.prototype._func=function(){var e=this.clone();return e._flags.func=!0,e},t.prototype.keys=function(e){a.assert(null===e||void 0===e||"object"===(void 0===e?"undefined":n(e)),"Object schema must be a valid object"),a.assert(!(e&&e instanceof o),"Object schema cannot be a joi schema");var t=this.clone();if(!e)return t._inner.children=null,t;var r=Object.keys(e);if(!r.length)return t._inner.children=[],t;var i=new s;if(t._inner.children)for(var l=0;l<t._inner.children.length;++l){var c=t._inner.children[l];-1===r.indexOf(c.key)&&i.add(c,{after:c._refs,group:c.key})}for(var h=0;h<r.length;++h){var f=r[h],d=e[f];try{var p=u.schema(d);i.add({key:f,schema:p},{after:p._refs,group:f})}catch(e){throw e.hasOwnProperty("path")?e.path=f+"."+e.path:e.path=f,e}}return t._inner.children=i.nodes,t},t.prototype.unknown=function(e){var t=!1!==e;if(this._flags.allowUnknown===t)return this;var r=this.clone();return r._flags.allowUnknown=t,r},t.prototype.length=function(e){return a.assert(Number.isSafeInteger(e)&&e>=0,"limit must be a positive integer"),this._test("length",e,function(t,r,n){return Object.keys(t).length===e?t:this.createError("object.length",{limit:e},r,n)})},t.prototype.arity=function(e){return a.assert(Number.isSafeInteger(e)&&e>=0,"n must be a positive integer"),this._test("arity",e,function(t,r,n){return t.length===e?t:this.createError("function.arity",{n:e},r,n)})},t.prototype.minArity=function(e){return a.assert(Number.isSafeInteger(e)&&e>0,"n must be a strict positive integer"),this._test("minArity",e,function(t,r,n){return t.length>=e?t:this.createError("function.minArity",{n:e},r,n)})},t.prototype.maxArity=function(e){return a.assert(Number.isSafeInteger(e)&&e>=0,"n must be a positive integer"),this._test("maxArity",e,function(t,r,n){return t.length<=e?t:this.createError("function.maxArity",{n:e},r,n)})},t.prototype.min=function(e){return a.assert(Number.isSafeInteger(e)&&e>=0,"limit must be a positive integer"),this._test("min",e,function(t,r,n){return Object.keys(t).length>=e?t:this.createError("object.min",{limit:e},r,n)})},t.prototype.max=function(e){return a.assert(Number.isSafeInteger(e)&&e>=0,"limit must be a positive integer"),this._test("max",e,function(t,r,n){return Object.keys(t).length<=e?t:this.createError("object.max",{limit:e},r,n)})},t.prototype.pattern=function(e,t){a.assert(e instanceof RegExp,"Invalid regular expression"),a.assert(void 0!==t,"Invalid rule"),e=new RegExp(e.source,e.ignoreCase?"i":void 0);try{t=u.schema(t)}catch(e){throw e.hasOwnProperty("path")&&(e.message=e.message+"("+e.path+")"),e}var r=this.clone();return r._inner.patterns.push({regex:e,rule:t}),r},t.prototype.schema=function(){return this._test("schema",null,function(e,t,r){return e instanceof o?e:this.createError("object.schema",null,t,r)})},t.prototype.with=function(e,t){return this._dependency("with",e,t)},t.prototype.without=function(e,t){return this._dependency("without",e,t)},t.prototype.xor=function(){var e=a.flatten(Array.prototype.slice.call(arguments));return this._dependency("xor",null,e)},t.prototype.or=function(){var e=a.flatten(Array.prototype.slice.call(arguments));return this._dependency("or",null,e)},t.prototype.and=function(){var e=a.flatten(Array.prototype.slice.call(arguments));return this._dependency("and",null,e)},t.prototype.nand=function(){var e=a.flatten(Array.prototype.slice.call(arguments));return this._dependency("nand",null,e)},t.prototype.requiredKeys=function(e){return e=a.flatten(Array.prototype.slice.call(arguments)),this.applyFunctionToChildren(e,"required")},t.prototype.optionalKeys=function(e){return e=a.flatten(Array.prototype.slice.call(arguments)),this.applyFunctionToChildren(e,"optional")},t.prototype.forbiddenKeys=function(e){return e=a.flatten(Array.prototype.slice.call(arguments)),this.applyFunctionToChildren(e,"forbidden")},t.prototype.rename=function(e,t,r){a.assert("string"==typeof e,"Rename missing the from argument"),a.assert("string"==typeof t,"Rename missing the to argument"),a.assert(t!==e,"Cannot rename key to same name:",e);for(var n=0;n<this._inner.renames.length;++n)a.assert(this._inner.renames[n].from!==e,"Cannot rename the same key multiple times");var i=this.clone();return i._inner.renames.push({from:e,to:t,options:a.applyToDefaults(h.renameDefaults,r||{})}),i},t.prototype.applyFunctionToChildren=function(e,t,r,n){e=[].concat(e),a.assert(e.length>0,"expected at least one children");var i=h.groupChildren(e),s=void 0;if(""in i?(s=this[t].apply(this,r),delete i[""]):s=this.clone(),s._inner.children){n=n?n+".":"";for(var o=0;o<s._inner.children.length;++o){var l=s._inner.children[o],u=i[l.key];u&&(s._inner.children[o]={key:l.key,_refs:l._refs,schema:l.schema.applyFunctionToChildren(u,t,r,n+l.key)},delete i[l.key])}}var c=Object.keys(i);return a.assert(0===c.length,"unknown key(s)",c.join(", ")),s},t.prototype._dependency=function(e,t,r){r=[].concat(r);for(var n=0;n<r.length;++n)a.assert("string"==typeof r[n],e,"peers must be a string or array of strings");var i=this.clone();return i._inner.dependencies.push({type:e,key:t,peers:r}),i},t.prototype.describe=function(e){var t=o.prototype.describe.call(this);if(t.rules)for(var r=0;r<t.rules.length;++r){var i=t.rules[r];i.arg&&"object"===n(i.arg)&&i.arg.schema&&i.arg.ref&&(i.arg={schema:i.arg.schema.describe(),ref:i.arg.ref.toString()})}if(this._inner.children&&!e){t.children={};for(var s=0;s<this._inner.children.length;++s){var l=this._inner.children[s];t.children[l.key]=l.schema.describe()}}if(this._inner.dependencies.length&&(t.dependencies=a.clone(this._inner.dependencies)),this._inner.patterns.length){t.patterns=[];for(var u=0;u<this._inner.patterns.length;++u){var c=this._inner.patterns[u];t.patterns.push({regex:c.regex.toString(),rule:c.rule.describe()})}}return this._inner.renames.length>0&&(t.renames=a.clone(this._inner.renames)),t},t.prototype.assert=function(e,t,r){e=u.ref(e),a.assert(e.isContext||e.depth>1,"Cannot use assertions for root level references - use direct key rules instead"),r=r||"pass the assertion test";try{t=u.schema(t)}catch(e){throw e.hasOwnProperty("path")&&(e.message=e.message+"("+e.path+")"),e}var n=e.path[e.path.length-1],i=e.path.join(".");return this._test("assert",{schema:t,ref:e},function(s,o,l){if(!t._validate(e(s),null,l,s).errors)return s;var u=a.merge({},o);return u.key=n,u.path=i,this.createError("object.assert",{ref:u.path,message:r},u,l)})},t.prototype.type=function(e,t){a.assert("function"==typeof e,"type must be a constructor function");var r={name:t||e.name,ctor:e};return this._test("type",r,function(t,n,i){return t instanceof e?t:this.createError("object.type",{type:r.name},n,i)})},t.prototype.ref=function(){return this._test("ref",null,function(e,t,r){return c.isRef(e)?e:this.createError("function.ref",null,t,r)})},t}(o),h.safeParse=function(e){try{return JSON.parse(e)}catch(e){}return e},h.renameDefaults={alias:!1,multiple:!1,override:!1},h.groupChildren=function(e){e.sort();for(var t={},r=0;r<e.length;++r){var n=e[r];a.assert("string"==typeof n,"children must be strings");var i=n.split(".")[0];(t[i]=t[i]||[]).push(n.substring(i.length+1))}return t},h.keysToLabels=function(e,t){var r=e._inner.children;if(!r)return t;var n=function(e){var t=r.find(function(t){return t.key===e});return t?t.schema._getLabel(e):e};return Array.isArray(t)?t.map(n):n(t)},h.with=function(e,t,r,n,i){if(void 0===e)return e;for(var a=0;a<t.length;++a){var s=t[a];if(!Object.prototype.hasOwnProperty.call(r,s)||void 0===r[s])return this.createError("object.with",{main:n.key,mainWithLabel:h.keysToLabels(this,n.key),peer:s,peerWithLabel:h.keysToLabels(this,s)},n,i)}return e},h.without=function(e,t,r,n,i){if(void 0===e)return e;for(var a=0;a<t.length;++a){var s=t[a];if(Object.prototype.hasOwnProperty.call(r,s)&&void 0!==r[s])return this.createError("object.without",{main:n.key,mainWithLabel:h.keysToLabels(this,n.key),peer:s,peerWithLabel:h.keysToLabels(this,s)},n,i)}return e},h.xor=function(e,t,r,n,i){for(var a=[],s=0;s<t.length;++s){var o=t[s];Object.prototype.hasOwnProperty.call(r,o)&&void 0!==r[o]&&a.push(o)}if(1===a.length)return e;var l={peers:t,peersWithLabels:h.keysToLabels(this,t)};return 0===a.length?this.createError("object.missing",l,n,i):this.createError("object.xor",l,n,i)},h.or=function(e,t,r,n,i){for(var a=0;a<t.length;++a){var s=t[a];if(Object.prototype.hasOwnProperty.call(r,s)&&void 0!==r[s])return e}return this.createError("object.missing",{peers:t,peersWithLabels:h.keysToLabels(this,t)},n,i)},h.and=function(e,t,r,n,i){for(var a=[],s=[],o=t.length,l=0;l<o;++l){var u=t[l];Object.prototype.hasOwnProperty.call(r,u)&&void 0!==r[u]?s.push(u):a.push(u)}if(!(a.length===o||s.length===o))return this.createError("object.and",{present:s,presentWithLabels:h.keysToLabels(this,s),missing:a,missingWithLabels:h.keysToLabels(this,a)},n,i)},h.nand=function(e,t,r,n,i){for(var s=[],o=0;o<t.length;++o){var l=t[o];Object.prototype.hasOwnProperty.call(r,l)&&void 0!==r[l]&&s.push(l)}var u=a.clone(t),c=u.splice(0,1)[0];return s.length===t.length?this.createError("object.nand",{main:c,mainWithLabel:h.keysToLabels(this,c),peers:u,peersWithLabels:h.keysToLabels(this,u)},n,i):null},e.exports=new h.Object},function(e,t,r){var n=r(2),i={};e.exports=i.Topo=function(){this._items=[],this.nodes=[]},i.Topo.prototype.add=function(e,t){var r=this,i=[].concat((t=t||{}).before||[]),a=[].concat(t.after||[]),s=t.group||"?",o=t.sort||0;n.assert(-1===i.indexOf(s),"Item cannot come before itself:",s),n.assert(-1===i.indexOf("?"),"Item cannot come before unassociated items"),n.assert(-1===a.indexOf(s),"Item cannot come after itself:",s),n.assert(-1===a.indexOf("?"),"Item cannot come after unassociated items"),[].concat(e).forEach(function(e,t){var n={seq:r._items.length,sort:o,before:i,after:a,group:s,node:e};r._items.push(n)});var l=this._sort();return n.assert(!l,"item","?"!==s?"added into group "+s:"","created a dependencies error"),this.nodes},i.Topo.prototype.merge=function(e){e=[].concat(e);for(var t=0;t<e.length;++t){var r=e[t];if(r)for(var a=0;a<r._items.length;++a){var s=n.shallow(r._items[a]);this._items.push(s)}}this._items.sort(i.mergeSort);for(var o=0;o<this._items.length;++o)this._items[o].seq=o;var l=this._sort();return n.assert(!l,"merge created a dependencies error"),this.nodes},i.mergeSort=function(e,t){return e.sort===t.sort?0:e.sort<t.sort?-1:1},i.Topo.prototype._sort=function(){for(var e={},t=Object.create(null),r=Object.create(null),n=0;n<this._items.length;++n){var i=this._items[n],a=i.seq,s=i.group;r[s]=r[s]||[],r[s].push(a),e[a]=i.before;for(var o=i.after,l=0;l<o.length;++l)t[o[l]]=(t[o[l]]||[]).concat(a)}for(var u=Object.keys(e),c=0;c<u.length;++c){for(var h=u[c],f=[],d=Object.keys(e[h]),p=0;p<d.length;++p){var g=e[h][d[p]];r[g]=r[g]||[];for(var _=0;_<r[g].length;++_)f.push(r[g][_])}e[h]=f}for(var y=Object.keys(t),m=0;m<y.length;++m){var v=y[m];if(r[v])for(var b=0;b<r[v].length;++b){var w=r[v][b];e[w]=e[w].concat(t[v])}}var E=void 0,T={};u=Object.keys(e);for(var k=0;k<u.length;++k){var x=u[k];E=e[x];for(var S=0;S<E.length;++S)T[E[S]]=(T[E[S]]||[]).concat(x)}for(var I={},A=[],M=0;M<this._items.length;++M){var N=M;if(T[M]){N=null;for(var C=0;C<this._items.length;++C)if(!0!==I[C]){T[C]||(T[C]=[]);for(var O=T[C].length,D=0,R=0;R<O;++R)A.indexOf(T[C][R])>=0&&++D;if(D===O){N=C;break}}}null!==N&&(I[N=N.toString()]=!0,A.push(N))}if(A.length!==this._items.length)return new Error("Invalid dependencies");for(var B={},F=0;F<this._items.length;++F){var U=this._items[F];B[U.seq]=U}var L=[];this._items=A.map(function(e){var t=B[e];return L.push(t.node),t}),this.nodes=L}},function(e,t,r){var n=r(1);t.options=n.object({abortEarly:n.boolean(),convert:n.boolean(),allowUnknown:n.boolean(),skipFunctions:n.boolean(),stripUnknown:[n.boolean(),n.object({arrays:n.boolean(),objects:n.boolean()}).or("arrays","objects")],language:n.object(),presence:n.string().only("required","optional","forbidden","ignore"),raw:n.boolean(),context:n.object(),strip:n.boolean(),noDefaults:n.boolean()}).strict()},function(e,t,r){function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var i=r[n],a=Object.getOwnPropertyDescriptor(t,i);a&&a.configurable&&void 0===e[i]&&Object.defineProperty(e,i,a)}}(e,t))}var i=r(11),a=r(2),s={};s.Lazy=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}(this,e.call(this));return r._type="lazy",r}return n(t,e),t.prototype._base=function(e,t,r){var n={value:e},a=this._flags.lazy;if(!a)return n.errors=this.createError("lazy.base",null,t,r),n;var s=a();return s instanceof i?s._validate(e,t,r):(n.errors=this.createError("lazy.schema",null,t,r),n)},t.prototype.set=function(e){a.assert("function"==typeof e,"You must provide a function as first argument");var t=this.clone();return t._flags.lazy=e,t},t}(i),e.exports=new s.Lazy},function(e,t,r){var n="function"==typeof Symbol&&"symbol"===_typeof(Symbol.iterator)?function(e){return void 0===e?"undefined":_typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":_typeof(e)};function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var i=r[n],a=Object.getOwnPropertyDescriptor(t,i);a&&a.configurable&&void 0===e[i]&&Object.defineProperty(e,i,a)}}(e,t))}var a=r(11),s=r(16),o=r(12),l=r(2),u={fastSplice:function(e,t){for(var r=t;r<e.length;)e[r++]=e[r];--e.length}};u.Array=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}(this,e.call(this));return r._type="array",r._inner.items=[],r._inner.ordereds=[],r._inner.inclusions=[],r._inner.exclusions=[],r._inner.requireds=[],r._flags.sparse=!1,r}return i(t,e),t.prototype._base=function(e,t,r){var n={value:e};"string"==typeof e&&r.convert&&u.safeParse(e,n);var i=Array.isArray(n.value),a=i;if(r.convert&&this._flags.single&&!i&&(n.value=[n.value],i=!0),!i)return n.errors=this.createError("array.base",null,t,r),n;if((this._inner.inclusions.length||this._inner.exclusions.length||this._inner.requireds.length||this._inner.ordereds.length||!this._flags.sparse)&&(a&&(n.value=n.value.slice(0)),n.errors=this._checkItems.call(this,n.value,a,t,r),n.errors&&a&&r.convert&&this._flags.single)){var s=n.errors;n.value=[n.value],n.errors=this._checkItems.call(this,n.value,a,t,r),n.errors&&(n.errors=s,n.value=n.value[0])}return n},t.prototype._checkItems=function(e,t,r,n){for(var i=[],a=void 0,s=this._inner.requireds.slice(),o=this._inner.ordereds.slice(),l=this._inner.inclusions.concat(s),c=e.length,h=0;h<c;++h){a=!1;var f=e[h],d=!1,p={key:t?h:r.key,path:t?(r.path?r.path+".":"")+h:r.path,parent:r.parent,reference:r.reference},g=void 0;if(this._flags.sparse||void 0!==f){for(var _=0;_<this._inner.exclusions.length;++_)if(!(g=this._inner.exclusions[_]._validate(f,p,{})).errors){if(i.push(this.createError(t?"array.excludes":"array.excludesSingle",{pos:h,value:f},{key:r.key,path:p.path},n)),a=!0,n.abortEarly)return i;break}if(!a){if(this._inner.ordereds.length){if(o.length>0){var y=o.shift();if((g=y._validate(f,p,n)).errors){if(i.push(this.createError("array.ordered",{pos:h,reason:g.errors,value:f},{key:r.key,path:p.path},n)),n.abortEarly)return i}else if(y._flags.strip)u.fastSplice(e,h),--h,--c;else{if(!this._flags.sparse&&void 0===g.value){if(i.push(this.createError("array.sparse",null,{key:r.key,path:p.path,pos:h},n)),n.abortEarly)return i;continue}e[h]=g.value}continue}if(!this._inner.items.length){if(i.push(this.createError("array.orderedLength",{pos:h,limit:this._inner.ordereds.length},{key:r.key,path:p.path},n)),n.abortEarly)return i;continue}}for(var m=[],v=s.length,b=0;b<v;++b)if(!(g=m[b]=s[b]._validate(f,p,n)).errors){if(e[h]=g.value,d=!0,u.fastSplice(s,b),--b,--v,!this._flags.sparse&&void 0===g.value&&(i.push(this.createError("array.sparse",null,{key:r.key,path:p.path,pos:h},n)),n.abortEarly))return i;break}if(!d){var w=!!n.stripUnknown&&(!0===n.stripUnknown||!!n.stripUnknown.arrays);v=l.length;for(var E=0;E<v;++E){var T=l[E],k=s.indexOf(T);if(-1!==k)g=m[k];else if(!(g=T._validate(f,p,n)).errors){T._flags.strip?(u.fastSplice(e,h),--h,--c):this._flags.sparse||void 0!==g.value?e[h]=g.value:(i.push(this.createError("array.sparse",null,{key:r.key,path:p.path,pos:h},n)),a=!0),d=!0;break}if(1===v){if(w){u.fastSplice(e,h),--h,--c,d=!0;break}if(i.push(this.createError(t?"array.includesOne":"array.includesOneSingle",{pos:h,reason:g.errors,value:f},{key:r.key,path:p.path},n)),a=!0,n.abortEarly)return i;break}}if(!a&&this._inner.inclusions.length&&!d){if(w){u.fastSplice(e,h),--h,--c;continue}if(i.push(this.createError(t?"array.includes":"array.includesSingle",{pos:h,value:f},{key:r.key,path:p.path},n)),n.abortEarly)return i}}}}else if(i.push(this.createError("array.sparse",null,{key:r.key,path:p.path,pos:h},n)),n.abortEarly)return i}return s.length&&this._fillMissedErrors.call(this,i,s,r,n),o.length&&this._fillOrderedErrors.call(this,i,o,r,n),i.length?i:null},t.prototype.describe=function(){var e=a.prototype.describe.call(this);if(this._inner.ordereds.length){e.orderedItems=[];for(var t=0;t<this._inner.ordereds.length;++t)e.orderedItems.push(this._inner.ordereds[t].describe())}if(this._inner.items.length){e.items=[];for(var r=0;r<this._inner.items.length;++r)e.items.push(this._inner.items[r].describe())}return e},t.prototype.items=function(){var e=this.clone();return l.flatten(Array.prototype.slice.call(arguments)).forEach(function(t,r){try{t=s.schema(t)}catch(e){throw e.hasOwnProperty("path")?e.path=r+"."+e.path:e.path=r,e.message=e.message+"("+e.path+")",e}e._inner.items.push(t),"required"===t._flags.presence?e._inner.requireds.push(t):"forbidden"===t._flags.presence?e._inner.exclusions.push(t.optional()):e._inner.inclusions.push(t)}),e},t.prototype.ordered=function(){var e=this.clone();return l.flatten(Array.prototype.slice.call(arguments)).forEach(function(t,r){try{t=s.schema(t)}catch(e){throw e.hasOwnProperty("path")?e.path=r+"."+e.path:e.path=r,e.message=e.message+"("+e.path+")",e}e._inner.ordereds.push(t)}),e},t.prototype.min=function(e){var t=o.isRef(e);return l.assert(Number.isSafeInteger(e)&&e>=0||t,"limit must be a positive integer or reference"),this._test("min",e,function(r,n,i){var a=void 0;if(t){if(a=e(n.reference||n.parent,i),!(Number.isSafeInteger(a)&&a>=0))return this.createError("array.ref",{ref:e.key},n,i)}else a=e;return r.length>=a?r:this.createError("array.min",{limit:e,value:r},n,i)})},t.prototype.max=function(e){var t=o.isRef(e);return l.assert(Number.isSafeInteger(e)&&e>=0||t,"limit must be a positive integer or reference"),this._test("max",e,function(r,n,i){var a=void 0;if(t){if(a=e(n.reference||n.parent,i),!(Number.isSafeInteger(a)&&a>=0))return this.createError("array.ref",{ref:e.key},n,i)}else a=e;return r.length<=a?r:this.createError("array.max",{limit:e,value:r},n,i)})},t.prototype.length=function(e){var t=o.isRef(e);return l.assert(Number.isSafeInteger(e)&&e>=0||t,"limit must be a positive integer or reference"),this._test("length",e,function(r,n,i){var a=void 0;if(t){if(a=e(n.reference||n.parent,i),!(Number.isSafeInteger(a)&&a>=0))return this.createError("array.ref",{ref:e.key},n,i)}else a=e;return r.length===a?r:this.createError("array.length",{limit:e,value:r},n,i)})},t.prototype.unique=function(e){l.assert(void 0===e||"function"==typeof e||"string"==typeof e,"comparator must be a function or a string");var t={};return"string"==typeof e?t.path=e:"function"==typeof e&&(t.comparator=e),this._test("unique",t,function(e,r,i){for(var a={string:{},number:{},undefined:{},boolean:{},object:new Map,function:new Map,custom:new Map},s=t.comparator||l.deepEqual,o=0;o<e.length;++o){var u=t.path?l.reach(e[o],t.path):e[o],c=t.comparator?a.custom:a[void 0===u?"undefined":n(u)];if(c)if(c instanceof Map){for(var h=c.entries(),f=void 0;!(f=h.next()).done;)if(s(f.value[0],u)){var d={key:r.key,path:(r.path?r.path+".":"")+o,parent:r.parent,reference:r.reference},p={pos:o,value:e[o],dupePos:f.value[1],dupeValue:e[f.value[1]]};return t.path&&(p.path=t.path),this.createError("array.unique",p,d,i)}c.set(u,o)}else{if(void 0!==c[u]){var g={key:r.key,path:(r.path?r.path+".":"")+o,parent:r.parent,reference:r.reference},_={pos:o,value:e[o],dupePos:c[u],dupeValue:e[c[u]]};return t.path&&(_.path=t.path),this.createError("array.unique",_,g,i)}c[u]=o}}return e})},t.prototype.sparse=function(e){var t=void 0===e||!!e;if(this._flags.sparse===t)return this;var r=this.clone();return r._flags.sparse=t,r},t.prototype.single=function(e){var t=void 0===e||!!e;if(this._flags.single===t)return this;var r=this.clone();return r._flags.single=t,r},t.prototype._fillMissedErrors=function(e,t,r,n){for(var i=[],a=0,s=0;s<t.length;++s){var o=t[s]._getLabel();o?i.push(o):++a}i.length?a?e.push(this.createError("array.includesRequiredBoth",{knownMisses:i,unknownMisses:a},{key:r.key,path:r.path},n)):e.push(this.createError("array.includesRequiredKnowns",{knownMisses:i},{key:r.key,path:r.path},n)):e.push(this.createError("array.includesRequiredUnknowns",{unknownMisses:a},{key:r.key,path:r.path},n))},t.prototype._fillOrderedErrors=function(e,t,r,n){for(var i=[],a=0;a<t.length;++a){"required"===l.reach(t[a],"_flags.presence")&&i.push(t[a])}i.length&&this._fillMissedErrors.call(this,e,i,r,n)},t}(a),u.safeParse=function(e,t){try{var r=JSON.parse(e);Array.isArray(r)&&(t.value=r)}catch(e){}},e.exports=new u.Array},function(e,t,r){(function(t){function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var i=r[n],a=Object.getOwnPropertyDescriptor(t,i);a&&a.configurable&&void 0===e[i]&&Object.defineProperty(e,i,a)}}(e,t))}var i=r(11),a=r(2),s={};s.Binary=function(e){function r(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}(this,e.call(this));return t._type="binary",t}return n(r,e),r.prototype._base=function(e,r,n){var i={value:e};if("string"==typeof e&&n.convert)try{i.value=new t(e,this._flags.encoding)}catch(e){}return i.errors=t.isBuffer(i.value)?null:this.createError("binary.base",null,r,n),i},r.prototype.encoding=function(e){if(a.assert(t.isEncoding(e),"Invalid encoding:",e),this._flags.encoding===e)return this;var r=this.clone();return r._flags.encoding=e,r},r.prototype.min=function(e){return a.assert(Number.isSafeInteger(e)&&e>=0,"limit must be a positive integer"),this._test("min",e,function(t,r,n){return t.length>=e?t:this.createError("binary.min",{limit:e,value:t},r,n)})},r.prototype.max=function(e){return a.assert(Number.isSafeInteger(e)&&e>=0,"limit must be a positive integer"),this._test("max",e,function(t,r,n){return t.length<=e?t:this.createError("binary.max",{limit:e,value:t},r,n)})},r.prototype.length=function(e){return a.assert(Number.isSafeInteger(e)&&e>=0,"limit must be a positive integer"),this._test("length",e,function(t,r,n){return t.length===e?t:this.createError("binary.length",{limit:e,value:t},r,n)})},r}(i),e.exports=new s.Binary}).call(t,r(3).Buffer)},function(e,t){e.exports={_args:[[{raw:"joi@10.6.0",scope:null,escapedName:"joi",name:"joi",rawSpec:"10.6.0",spec:"10.6.0",type:"version"},"/Users/jeff/projects/joi-browser"]],_from:"joi@10.6.0",_id:"joi@10.6.0",_inCache:!0,_location:"/joi",_nodeVersion:"6.11.0",_npmOperationalInternal:{host:"s3://npm-registry-packages",tmp:"tmp/joi-10.6.0.tgz_1497548465053_0.7665833418723196"},_npmUser:{name:"marsup",email:"nicolas@morel.io"},_npmVersion:"5.0.3",_phantomChildren:{},_requested:{raw:"joi@10.6.0",scope:null,escapedName:"joi",name:"joi",rawSpec:"10.6.0",spec:"10.6.0",type:"version"},_requiredBy:["#DEV:/"],_resolved:"https://registry.npmjs.org/joi/-/joi-10.6.0.tgz",_shasum:"52587f02d52b8b75cdb0c74f0b164a191a0e1fc2",_shrinkwrap:null,_spec:"joi@10.6.0",_where:"/Users/jeff/projects/joi-browser",bugs:{url:"https://github.com/hapijs/joi/issues"},dependencies:{hoek:"4.x.x",isemail:"2.x.x",items:"2.x.x",topo:"2.x.x"},description:"Object schema validation",devDependencies:{code:"4.x.x",hapitoc:"1.x.x",lab:"13.x.x"},directories:{},dist:{integrity:"sha512-hBF3LcqyAid+9X/pwg+eXjD2QBZI5eXnBFJYaAkH4SK3mp9QSRiiQnDYlmlz5pccMvnLcJRS4whhDOTCkmsAdQ==",shasum:"52587f02d52b8b75cdb0c74f0b164a191a0e1fc2",tarball:"https://registry.npmjs.org/joi/-/joi-10.6.0.tgz"},engines:{node:">=4.0.0"},gitHead:"069bb6c04063cba202544dacf9da3bbe21fa3074",homepage:"https://github.com/hapijs/joi",keywords:["hapi","schema","validation"],license:"BSD-3-Clause",main:"lib/index.js",maintainers:[{name:"hueniverse",email:"eran@hammer.io"},{name:"marsup",email:"nicolas@morel.io"},{name:"nlf",email:"quitlahok@gmail.com"},{name:"wyatt",email:"wpreul@gmail.com"}],name:"joi",optionalDependencies:{},readme:"ERROR: No README data found!",repository:{type:"git",url:"git://github.com/hapijs/joi.git"},scripts:{test:"lab -t 100 -a code -L","test-cov-html":"lab -r html -o coverage.html -a code","test-debug":"lab -a code",toc:"hapitoc",version:"npm run toc && git add API.md README.md"},version:"10.6.0"}}])},e.exports=r()}),PixpipeObject=function(){function e(){classCallCheck(this,e),this._uuid="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),this._metadata={},this._metadataSchema=this._buildMetadataSchema(),this._type=e.TYPE(),this._timer={}}return createClass(e,[{key:"isOfType",value:function(e){return!this._type.localeCompare(e)}},{key:"getType",value:function(){this._type}},{key:"getUuid",value:function(){return this._uuid.slice()}},{key:"setMetadata",value:function(e,t){"string"==typeof e||e instanceof String?this._metadata[e]=t:console.warn("The given key must be a String Object.")}},{key:"getMetadata",value:function(e){return e in this._metadata?this._metadata[e]:(console.warn("The metadata with key: "+e+" doe not exist."),null)}},{key:"hasMetadata",value:function(e){return e in this._metadata}},{key:"getMetadataKeys",value:function(){return Object.keys(this._metadata)}},{key:"copyMetadataFrom",value:function(e){var t=this;e.getMetadataKeys().forEach(function(r){try{var n=JSON.parse(JSON.stringify(e.getMetadata(r)));t.setMetadata(r,n)}catch(e){console.error(e)}})}},{key:"getMetadataCopy",value:function(){return JSON.parse(JSON.stringify(this._metadata))}},{key:"setRawMetadata",value:function(e){this._metadata=e,this._metadataRawCopied()}},{key:"_metadataRawCopied",value:function(){}},{key:"_getOption",value:function(e,t,r){return e&&e[t]||r}},{key:"isMetadataCyclic",value:function(){try{JSON.stringify(this._metadata)}catch(e){return!0}return!1}},{key:"addTimeRecord",value:function(e){this._timer[e]=performance.now()}},{key:"getTime",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e in this._timer&&t in this._timer){var n=Math.abs(this._timer[t]-this._timer[e]);return r&&console.log("> Time: ["+e+" , "+t+"] is "+n+" millisec."),n}return console.warn("The two given record name must exist in the time record table."),-1}},{key:"_buildMetadataSchema",value:function(){return null}},{key:"metadataIntegrityCheck",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null==e&&(e=this._metadata),e){var t=joiBrowser.validate(e,this._metadataSchema);return!t.error||(console.warn("SCHEMA VALIDATION: "+t.error),!1)}return console.warn("Validation schema not available. Metadata considered to be valid."),!0}},{key:"getMetadataClone",value:function(){return this.metadataIntegrityCheck()?JSON.parse(JSON.stringify(this._metadata)):null}},{key:"metadataToString",value:function(){var e="__metadata__\n";for(var t in this._metadata)e+="\t["+t+"]\n\t"+JSON.stringify(this._metadata[t])+"\n\n";return e}}],[{key:"TYPE",value:function(){return"GENERIC"}}]),e}(),Filter=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._type=t.TYPE(),e._events={},e._inputValidator={},e._allValidator=null,e._input={},e._output={},e._isOutputReady=!1,e.setMetadata("time",!0),e}return inherits(t,PixpipeObject),createClass(t,[{key:"addInput",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e?(t in this._input||(this._input[t]=null),this._input[t]=e,this._isOutputReady=!1):console.warn("A null input cannot be added.")}},{key:"getOutput",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e in this._output?this._output[e]:null}},{key:"forEachOutput",value:function(e){if(e)for(var t=this.getOutputCategories(),r=0;r<t.length;r++)e.call(this,t[r],this.getOutput(t[r]));else console.warn("forEachOutput requires a callback.")}},{key:"_forEachInput",value:function(e){if(e)for(var t=this.getInputCategories(),r=0;r<t.length;r++)e.call(this,t[r],this._getInput(t[r]));else console.warn("forEachOutput requires a callback.")}},{key:"_addOutput",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=null;if(t in this._output)console.warn("An output of category "+t+" was already defined. Nothing to be done.");else{r=new e;this._output[t]=r,console.log("filter "+this.constructor.name+" creates a new output.")}return r}},{key:"_getInput",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e in this._input?this._input[e]:null}},{key:"hasInputOfCategory",value:function(e){return e in this._input}},{key:"getInputCategories",value:function(){return Object.keys(this._input)}},{key:"getOutputCategories",value:function(){return Object.keys(this._output)}},{key:"setMetadata",value:function(e,r){get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setMetadata",this).call(this,e,r),this._isOutputReady=!1}},{key:"hasOutputReady",value:function(){return this._isOutputReady}},{key:"setOutputAsReady",value:function(){this._isOutputReady=!0}},{key:"addInputValidator",value:function(e,t){if("TYPE"in t){if("ALL"===e)return void(this._allValidator=t.TYPE());this._inputValidator[e]=t.TYPE()}else{if("ALL"===e)return void(this._allValidator=t);this._inputValidator[e]=t}}},{key:"hasValidInput",value:function(){var e=this,t=this.getInputCategories(),r=!0;return 0===t.length&&(r=!1,console.warn("No input validator was added. Filter cannot run. Use addInputValidator(...) to specify input types.")),t.forEach(function(t){var n=e._getInput(t);if(n)if("isOfType"in n)e._inputValidator[t]&&(r=r&&n.isOfType(e._inputValidator[t])),e._allValidator&&(r=r&&n.isOfType(e._allValidator));else try{e._inputValidator[t]&&(r=r&&n instanceof e._inputValidator[t]),e._allValidator&&(r=r&&n instanceof e._allValidator)}catch(e){r=!1}else r=!1}),r||console.warn("The input is not valid."),r}},{key:"update",value:function(){this._output={},this._metadata.time?(this.addTimeRecord("begin"),this._run(),this.addTimeRecord("end"),console.log("Running time for filter "+this.constructor.name+": "+this.getTime("begin","end")+"ms.")):this._run(),this.getNumberOfOutputs()&&this.setOutputAsReady()}},{key:"_run",value:function(){console.error("The update() method has not been written, this filter is not valid.")}},{key:"on",value:function(e,t){this._events[e]=t}},{key:"triggerEvent",value:function(e){var t=null;if(this.hasEvent(e))if(arguments.length>1){for(var r=[],n=1;n<arguments.length;n++)r.push(arguments[n]);t=this._events[e].apply(this,r)}else t=this._events[e].call(this);else console.warn("The event "+e+" does not exist.");return t}},{key:"hasEvent",value:function(e){return e in this._events}},{key:"getNumberOfInputs",value:function(){return Object.keys(this._input).length}},{key:"getNumberOfOutputs",value:function(){return Object.keys(this._output).length}},{key:"clearAllInputs",value:function(){this._input={}}}],[{key:"TYPE",value:function(){return"FILTER"}}]),t}(),PixpipeContainer=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._data=null,e}return inherits(t,PixpipeObject),createClass(t,[{key:"setRawData",value:function(e){this._data=e}}]),t}(),Signal1D=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._type=t.TYPE(),e.setMetadata("length",0),e.setMetadata("min",1/0),e.setMetadata("max",-1/0),e.setMetadata("samplingFrequency",100),e}return inherits(t,PixpipeContainer),createClass(t,[{key:"getData",value:function(){return this._data}},{key:"setData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._data=t?new e.constructor(e):e,this.setMetadata("length",e.length),this._computeStatistics()}},{key:"clone",value:function(){var e=new t;return e.copyMetadataFrom(this),this._data&&e.setData(this._data,!0),e}},{key:"hollowClone",value:function(){var e=new t;e.copyMetadataFrom(this);var r=this.getMetadata("length");return e.setData(new this._data.constructor(r).fill(0)),e}},{key:"dataToString",value:function(){var e=Math.min(10,this._data.length),t=this._data.slice(0,e),r="__data__\n";return r+="\t"+this._data.constructor.name+"["+this._data.length+"] ",r+=t.toString()+" "+(this._data.length>10?" ...":"")}},{key:"toString",value:function(){var e=this.constructor.name+"\n";return e+=this.metadataToString(),e+=this.dataToString()}},{key:"_computeStatistics",value:function(){for(var e=1/0,t=-1/0,r=0;r<this._data.length;r++)e=Math.min(e,this._data[r]),t=Math.max(t,this._data[r]);this.setMetadata("min",e),this.setMetadata("max",t)}}],[{key:"TYPE",value:function(){return"SIGNAL1D"}}]),t}();CoreTypes.addCoreType(Signal1D);var Image2D=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;classCallCheck(this,t);var r=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(r._type=t.TYPE(),r.setMetadata("ncpp",4),e&&"width"in e&&"height"in e&&e.width>0&&e.height>0){r.setMetadata("width",e.width),r.setMetadata("height",e.height),"color"in e&&r.setMetadata("ncpp",e.color.length),r._data=new Float32Array(e.width*e.height*r.getMetadata("ncpp"));var n=r.getMetadata("ncpp");if("color"in e)for(var i=e.color,a=0;a<r._data.length;a++)r._data[a]=i[a%n];else r._data.fill(0)}return r}return inherits(t,PixpipeContainer),createClass(t,[{key:"clone",value:function(){var e=new t;return e.setData(this._data,this.getMetadata("width"),this.getMetadata("height"),this.getMetadata("ncpp"),!0),e.copyMetadataFrom(this),e}},{key:"hollowClone",value:function(){var e=new t,r=this.getMetadata("ncpp"),n=this.getMetadata("width"),i=this.getMetadata("height");return e.setData(new Float32Array(n*i*r).fill(0),n,i,r),e}},{key:"float32Clone",value:function(){var e=new t,r=this.getMetadata("ncpp"),n=this.getMetadata("width"),i=this.getMetadata("height");return e.copyMetadataFrom(this),e.setData(new Float32Array(this._data),n,i,r),e}},{key:"setData",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.setMetadata("ncpp",n),e.length==t*r*n?(this._data=i?new e.constructor(e):e,this.setMetadata("width",t),this.setMetadata("height",r),this.computeSimpleStat()):console.warn("The array size does not match the width and height. Cannot init the Image2D.")}},{key:"setPixel",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._data){var n=this._metadata.ncpp;if("x"in e&&e.x>=0&&e.x<this._metadata.width&&"y"in e&&e.y>=0&&e.y<this._metadata.height){if(t.length==n){var i=this.get1dIndexFrom2dPosition(e);if(1==n)this._data[i]=t[0];else{i*=n;for(var a=0;a<n;a++)this._data[i+a]=t[a]}}else if(3==t.length&&4==n){i=this.get1dIndexFrom2dPosition(e);i*=n;for(a=0;a<t.length;a++)this._data[i+a]=t[a]}r&&this.computeSimpleStat()}}else console.warn("The image is empty")}},{key:"getPixel",value:function(e){if(this._data){if("x"in e&&e.x>=0&&e.x<this._metadata.width&&"y"in e&&e.y>=0&&e.y<this._metadata.height){var t=this._metadata.ncpp,r=null,n=this.get1dIndexFrom2dPosition(e);return 1==t?r=[this._data[n]]:(n*=t,r=this._data.slice(n,n+t)),r}return console.warn("The requested position is outside the image."),null}console.warn("The image is empty")}},{key:"getWidth",value:function(){return this._metadata.width}},{key:"getHeight",value:function(){return this._metadata.height}},{key:"getComponentsPerPixel",value:function(){return this._metadata.ncpp}},{key:"getNcpp",value:function(){return this.getComponentsPerPixel()}},{key:"getData",value:function(){return this._data}},{key:"getDataCopy",value:function(){return new this._data.constructor(this._data)}},{key:"getDataAsUInt8Array",value:function(){if(this._data){for(var e=this.getMin(),t=this.getMax(),r=new Uint8Array(this._data.length),n=0;n<this._data.length;n++)r[n]=(this._data[n]-e)/t*256;return r}console.warn("No data, cannot make a copy of it.")}},{key:"getDataAsFloat32Array",value:function(){if(this._data)return new Float32Array(this._data);console.warn("No data, cannot make a copy of it.")}},{key:"get2dPositionFrom1dIndex",value:function(e){return{x:e%this._metadata.width,y:Math.floor(e/this._metadata.width)}}},{key:"get1dIndexFrom2dPosition",value:function(e){return e.x+e.y*this._metadata.width}},{key:"computeSimpleStat",value:function(){if(this._data){for(var e=1/0,t=-1/0,r=0,n=0;n<this._data.length;n++)e=Math.min(e,this._data[n]),t=Math.max(e,this._data[n]),r+=this._data[n];this.setMetadata("min",e),this.setMetadata("max",t),this.setMetadata("avg",r/this._data.length)}else console.warn("The image is empty")}},{key:"getMin",value:function(){return this.hasMetadata("min")||this.computeSimpleStat(),this.getMetadata("min")}},{key:"getMax",value:function(){return this.hasMetadata("max")||this.computeSimpleStat(),this.getMetadata("max")}},{key:"getAvg",value:function(){return this.hasMetadata("avg")||this.computeSimpleStat(),this.getMetadata("avg")}},{key:"isInside",value:function(e){return e.x>=0&&e.x<this._metadata.width&&e.y>=0&&e.y<this._metadata.height}},{key:"getSegmentSample",value:function(e,t){if(!this.isInside(e)||!this.isInside(t))return null;for(var r=t.x-e.x,n=t.y-e.y,i=Math.sqrt(Math.pow(r,2)+Math.pow(n,2)),a=Math.floor(i+1),s=r/i,o=n/i,l=this._metadata.ncpp,u=new Array(a).fill(0),c=new Array(l).fill(0),h=new Array(a).fill(0),f=0;f<l;f++)c[f]=new Array(a).fill(0);for(var d=0;d<a;d++){var p={x:Math.round(e.x+d*s),y:Math.round(e.y+d*o)};u[d]=p,h[d]="("+p.x+", "+p.y+")";var g=this.getPixel(p);for(f=0;f<l;f++)c[f][d]=g[f]}return{positions:u,labels:h,colors:c}}}],[{key:"TYPE",value:function(){return"IMAGE2D"}}]),t}();CoreTypes.addCoreType(Image2D);var Image3D=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;classCallCheck(this,t);var r=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));r._type=t.TYPE(),r.setMetadata("ncpp",1),e&&"order"in e?r.setMetadata("order",e.order):r.setMetadata("order",["zspace","yspace","xspace"]);var n={offset:1,step:1},i={step:1},a={step:1};return r.setMetadata("xspace",n),r.setMetadata("yspace",i),r.setMetadata("zspace",a),r.setMetadata("time",{offset:0,space_length:1}),e&&"ncpp"in e&&r.setMetadata("ncpp",e.ncpp),e&&"xSize"in e&&"ySize"in e&&"zSize"in e&&e.xSize>0&&e.ySize>0&&e.zSize>0&&(n.space_length=e.xSize,i.space_length=e.ySize,a.space_length=e.zSize,i.offset=n.space_length,a.offset=n.space_length*i.space_length,r._data=new Float32Array(e.xSize*e.ySize*e.zSize*r.getMetadata("ncpp")),r._data.fill(0),r._scanDataRange(),r._finishHeader()),r}return inherits(t,PixpipeContainer),createClass(t,[{key:"clone",value:function(){var e=new t;return e.setData(this._data,this.getMetadata("xspace").space_length,this.getMetadata("yspace").space_length,this.getMetadata("zspace").space_length,{ncpp:this.getMetadata("ncpp"),order:this.getMetadata("order").slice(),deepCopy:!0}),e.copyMetadataFrom(this),e}},{key:"setData",value:function(e,t,r,n,i){var a=1;if(i&&"ncpp"in i&&(a=i.ncpp),e.length==t*r*n*a){i&&"ncpp"in i&&this.setMetadata("ncpp",i.ncpp),i&&"order"in i&&this.setMetadata("order",i.order),i&&"deepCopy"in i&&i.deepCopy?this._data=new e.constructor(e):this._data=e;var s=this.getMetadata("xspace"),o=this.getMetadata("yspace"),l=this.getMetadata("zspace");s.space_length=t,o.space_length=r,l.space_length=n,o.offset=s.space_length,l.offset=s.space_length*o.space_length,this._scanDataRange(),this._finishHeader()}else console.warn("The array size does not match the width and height. Cannot init the Image3D.")}},{key:"_finishHeader",value:function(){var e=this.getMetadata("xspace"),t=this.getMetadata("yspace"),r=this.getMetadata("zspace");e.name="xspace",t.name="yspace",r.name="zspace",e.width_space=JSON.parse(JSON.stringify(t)),e.width=t.space_length,e.height_space=JSON.parse(JSON.stringify(r)),e.height=r.space_length,t.width_space=JSON.parse(JSON.stringify(e)),t.width=e.space_length,t.height_space=JSON.parse(JSON.stringify(r)),t.height=r.space_length,r.width_space=JSON.parse(JSON.stringify(e)),r.width=e.space_length,r.height_space=JSON.parse(JSON.stringify(t)),r.height=t.space_length}},{key:"_scanDataRange",value:function(){for(var e=1/0,t=-1/0,r=0;r<this._data.length;r++)e=Math.min(e,this._data[r]),t=Math.max(t,this._data[r]);this.setMetadata("voxel_min",e),this.setMetadata("voxel_max",t)}},{key:"setPixel",value:function(e,t){}},{key:"getPixel",value:function(e){return this.getIntensity_xyz(e.x,e.y,e.z)}},{key:"getSize",value:function(e){return this.hasMetadata(e)?this.getMetadata(e).space_length:(console.warn('The space must be "xspace", "yspace" or "zspace".'),null)}},{key:"getData",value:function(){return this._data}},{key:"getDataCopy",value:function(){return new this._data.constructor(this._data)}},{key:"get1dIndexFrom3dPosition",value:function(e){}},{key:"getSlice",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this.hasMetadata(e))return console.warn("The axis "+e+" does not exist."),null;var n,i,a,s,o,l,u=this.hasMetadata("time")?r*this.getMetadata("time").offset:0,c=this.getMetadata(e),h=c.width_space,f=c.height_space,d=c.width,p=c.height,g=c.offset,_=h.offset,y=f.offset,m=new this._data.constructor(d*p),v=h.step>0,b=f.step>0,w=c.step>0,E=0,T=0,k=0,x=1/0,S=-1/0;this.getMetadata("voxel_max");if((a=w?t:c.space_length-t-1)>=0&&a<c.space_length)for(s=u+a*g,n=p-1;n>=0;n--)for(o=s+(b?n:p-n-1)*y,i=0;i<d;i++)l=o+(v?i:d-i-1)*_,T=this._data[l],x=Math.min(x,T),S=Math.max(S,T),k+=T,m[E++]=T;var I=new Image2D;return I.setData(m,d,p,1),I.setMetadata("min",x),I.setMetadata("max",S),I.setMetadata("avg",k/(E-1)),I}},{key:"getIntensity_ijk",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=this.getMetadata("order");if(e<0||e>=this.getMetadata(i[0]).space_length||t<0||t>=this.getMetadata(i[1]).space_length||r<0||r>=this.getMetadata(i[2]).space_length)return console.warn("getIntensity_ijk position is out of range."),0;var a=this._metadata.time.offset*n,s=e*this.getMetadata(i[0]).offset+t*this.getMetadata(i[1]).offset+r*this.getMetadata(i[2]).offset+a;return this._data[s]}},{key:"getIntensity_xyz",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(e<0||e>=this._metadata.xspace.space_length||t<0||t>=this._metadata.yspace.space_length||r<0||r>=this._metadata.zspace.space_length)return console.warn("getIntensity_xyz position is out of range."),0;var i=this._metadata.time.offset*n,a=e*this._metadata.xspace.offset+t*this._metadata.yspace.offset+r*this._metadata.zspace.offset+i;return this._data[a]}},{key:"getIntensity_xyzOrientation",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=this.hasMetadata("time")?n*this.getMetadata("time").offset:0;10==e&&30==t&&20==r&&console.log("stop");var a=this.getMetadata("xspace"),s=this.getMetadata("yspace"),o=this.getMetadata("zspace"),l=a.step>0,u=s.step>0,c=o.step>0,h=l?e:a.space_length-e-1,f=u?t:s.space_length-t-1,d=c?r:o.space_length-r-1;if(e>=0&&e<a.space_length&&t>=0&&t<s.space_length&&r>=0&&r<o.space_length){var p=i+h*a.offset+f*s.offset+d*o.offset;return this._data[p]}return null}},{key:"getTimeLength",value:function(){return this.hasMetadata("time")?this.getMetadata("time").space_length:1}},{key:"isInside",value:function(e){return!(e.x<0||e.x>=this._metadata.xspace.space_length||e.y<0||e.y>=this._metadata.yspace.space_length||e.z<0||e.z>=this._metadata.zspace.space_length)}},{key:"getSegmentSample",value:function(e,t){if(!this.isInside(e)||!this.isInside(t))return null;for(var r=t.x-e.x,n=t.y-e.y,i=t.z-e.z,a=Math.sqrt(Math.pow(r,2)+Math.pow(n,2)+Math.pow(i,2)),s=Math.floor(a+1),o=r/a,l=n/a,u=i/a,c=this._metadata.ncpp,h=new Array(s).fill(0),f=new Array(c).fill(0),d=new Array(s).fill(0),p=0;p<c;p++)f[p]=new Array(s).fill(0);for(var g=0;g<s;g++){var _={x:Math.round(e.x+g*o),y:Math.round(e.y+g*l),z:Math.round(e.z+g*u)};h[g]=_,d[g]="("+_.x+", "+_.y+", "+_.z+")";var y=[this.getIntensity_xyz(_.x,_.y,_.z)];for(p=0;p<c;p++)f[p][g]=y[p]}return{positions:h,labels:d,colors:f}}}],[{key:"TYPE",value:function(){return"IMAGE3D"}}]),t}();CoreTypes.addCoreType(Image3D);var ImageToImageFilter=function(e){function t(){return classCallCheck(this,t),possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return inherits(t,Filter),createClass(t,[{key:"hasSameSizeInput",value:function(){var e=this,t=!0,r=[],n=[];return Object.keys(this._input).forEach(function(t){r.push(e._getInput(t).getWidth()),n.push(e._getInput(t).getHeight())}),r.length&&(r.sort(),n.sort(),(t=r[0]==r[r.length-1]&&n[0]==n[n.length-1])||console.warn("Input image do not all have the same size. Filter not valid")),t}},{key:"hasSameNcppInput",value:function(){var e=Object.keys(this._input);if(!e.length)return!1;for(var t=this._getInput(e[0]).getComponentsPerPixel(),r=0;r<e.length;r++)if(t!=this._getInput(e[r]).getComponentsPerPixel())return console.warn("Input image do not all have the same number of components per pixel. Filter not valid"),!1;return!0}}]),t}(),MniVolume=function(e){function t(){return classCallCheck(this,t),possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return inherits(t,Image3D),createClass(t,[{key:"setData",value:function(e,t){var r=this;this._data=e,this.setMetadata("position",{}),this.setMetadata("current_time",0),Object.keys(t).forEach(function(e){r.setMetadata(e,t[e])}),this._scanDataRange(),this._saveOriginAndTransform(),this._finishHeader(),console.log(this)}},{key:"_saveOriginAndTransform",value:function(){var e=this.getMetadata("xspace"),t=this.getMetadata("yspace"),r=this.getMetadata("zspace"),n=e.start,i=t.start,a=r.start,s=e.direction_cosines,o=t.direction_cosines,l=r.direction_cosines,u=e.step,c=t.step,h=r.step,f={x:n*s[0]+i*o[0]+a*l[0],y:n*s[1]+i*o[1]+a*l[1],z:n*s[2]+i*o[2]+a*l[2]};this.setMetadata("voxel_origin",f);var d=(-f.x*s[0]-f.y*s[1]-f.z*s[2])/u,p=(-f.x*o[0]-f.y*o[1]-f.z*o[2])/c,g=(-f.x*l[0]-f.y*l[1]-f.z*l[2])/h,_=[[s[0]/u,s[1]/u,s[2]/u,d],[o[0]/c,o[1]/c,o[2]/c,p],[l[0]/h,l[1]/h,l[2]/h,g]];this.setMetadata("w2v",_)}}],[{key:"transformToMinc",value:function(e,t){var r=[],n=[],i=[];function a(e){var t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];return t<=0&&(t=1),Math.sqrt(t)}function s(e,t,r){return e[0]*(t[1]*r[2]-t[2]*r[1])-e[1]*(t[0]*r[2]-t[2]*r[0])+e[2]*(t[0]*r[1]-t[1]*r[0])}for(var o=a(e[0]),l=a(e[1]),u=a(e[2]),c=e[0][0]<0?-o:o,h=e[1][1]<0?-l:l,f=e[2][2]<0?-u:u,d=0;d<3;d++)r[d]=e[d][0]/c,n[d]=e[d][1]/h,i[d]=e[d][2]/f;t.xspace.step=c,t.yspace.step=h,t.zspace.step=f;var p=[e[0][3],e[1][3],e[2][3]],g=s(r,n,i),_=s(p,n,i),y=s(r,p,i),m=s(r,n,p);t.xspace.start=_/g,t.yspace.start=y/g,t.zspace.start=m/g,t.xspace.direction_cosines=r,t.yspace.direction_cosines=n,t.zspace.direction_cosines=i}},{key:"swapn",value:function(e,t){for(var r=0;r<e.length;r+=t)for(var n=t-1,i=0;n>i;){var a=e[r+n];e[r+n]=e[r+i],e[r+i]=a,n--,i++}}}]),t}();CoreTypes.addCoreType(MniVolume);var LineString=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setMetadata("closed",!1),e.setMetadata("defaultNod",2),e.setMetadata("nod",2),e._type=t.TYPE(),e._lastPoint=null,e}return inherits(t,PixpipeContainer),createClass(t,[{key:"setData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];-1!=t&&this.setMetadata("nod",t),e.length%this.getMetadata("nod")==0?(this._data=r?new e.constructor(e):e,this._setLastPoint()):console.warn("The number of points is not compatible with the number of dimensions (nod).")}},{key:"setNod",value:function(e){this._data&&this._data.length?this.setMetadata("nod",e):console.warn("The number of dimension can be set only when this LineString is empty.")}},{key:"getNod",value:function(){return this.getMetadata("nod")}},{key:"getData",value:function(){return this._data}},{key:"getDataCopy",value:function(){return new this._data.constructor(this._data)}},{key:"getNumberOfPoints",value:function(){return this._data?this._data.length/this.getMetadata("nod"):0}},{key:"getPoint",value:function(e){if(e>=0&&e<getNumberOfPoints){var t=this._metadata.nod;return this._data.slice(e*t,e*t+t)}return console.warn("Index of point is out of range."),null}},{key:"close",value:function(){this.setMetadata("closed",!0)}},{key:"open",value:function(){this.setMetadata("closed",!1)}},{key:"addPoint",value:function(e){if(e.length==this._metadata.nod){this._data||(this._data=new Array);for(var t=0;t<e.length;t++)this._data.push(e[t]);this._lastPoint=e}else console.warn("Cannot add the point becase it has a diferent number of dimensions.")}},{key:"peekPoint",value:function(){return this._data?this._lastPoint?this._lastPoint:(this._setLastPoint(),this._lastPoint):null}},{key:"_setLastPoint",value:function(){this._lastPoint=this._data.slice(-this._metadata.nod),0==this._lastPoint.length&&(this._lastPoint=null)}},{key:"popPoint",value:function(){if(!this._data)return console.warn("This LineString was not added any point."),null;if(!this._data.length)return console.warn("No more point in this LineString."),null;new Array(this._lastPoint);this._lastPoint.length=this._lastPoint.length-this._metadata.nod,this._setLastPoint()}},{key:"hasPoint",value:function(e){var t=this.getMetadata("nod");if(e.length!=t)return console.warn("The given point does not have the same number of dimensions as the LineString."),!1;for(var r=0;r<this._data.length-1;r+=2)if(this._data[r]==e[0]&&this._data[r+1]==e[1])return!0;return!1}}],[{key:"TYPE",value:function(){return"LINESTRING"}}]),t}();CoreTypes.addCoreType(LineString);var MatrixTricks=function(){function e(){classCallCheck(this,e)}return createClass(e,null,[{key:"setValueMatrix44",value:function(t,r,n,i){e.setValueSquareMatrix(t,4,r,n,i)}},{key:"setValueMatrix33",value:function(t,r,n,i){e.setValueSquareMatrix(t,3,r,n,i)}},{key:"setValueSquareMatrix",value:function(e,t,r,n,i){e[r*t+n]=i}},{key:"getValueMatrix44",value:function(t,r,n){return e.getValueSquareMatrix(t,4,r,n)}},{key:"getValueMatrix33",value:function(t,r,n){return e.getValueSquareMatrix(t,3,r,n)}},{key:"getValueSquareMatrix",value:function(e,t,r,n){return e[r*t+n]}},{key:"getHorizontalFlipMatrix44",value:function(t){return e.getHorizontalFlipSquareMatrix(t,4)}},{key:"getHorizontalFlipMatrix33",value:function(t){return e.getHorizontalFlipSquareMatrix(t,3)}},{key:"getHorizontalFlipSquareMatrix",value:function(t,r){for(var n=new Array(r*r).fill(0),i=0;i<r;i++)for(var a=0;a<r;a++){var s=e.getValueSquareMatrix(t,r,a,i);e.setValueSquareMatrix(n,r,r-1-a,i,s)}return n}},{key:"getExpandedMatrix3x3To4x4",value:function(t){for(var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"LEFT",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"TOP",i="RIGHT"===r?1:0,a="BOTTOM"===n?1:0,s=new Array(16).fill(0),o=0;o<3;o++)for(var l=0;l<3;l++){var u=e.getValueMatrix33(t,l,o);e.setValueMatrix44(s,i+l,a+o,u)}return s}}]),e}(),Image3DAlt=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;classCallCheck(this,t);var r=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._type=t.TYPE(),r._initMetadata(),r._dimensionsWorldLUT={},r._dimensionsVoxelLUT={},r._initData(e),r}return inherits(t,PixpipeContainer),createClass(t,[{key:"_buildMetadataSchema",value:function(){return joiBrowser.object({ncpp:joiBrowser.number().integer().min(1).required(),dimensions:joiBrowser.array().min(3).max(4).items(joiBrowser.object({length:joiBrowser.number().integer().min(1).required(),widthDimension:joiBrowser.number().integer().min(-1).max(2).required(),heightDimension:joiBrowser.number().integer().min(-1).max(2).required(),nameVoxelSpace:joiBrowser.string().regex(/(i|j|k|t)/).required(),nameWorldSpace:joiBrowser.string().regex(/(x|y|z|t)/).required(),worldUnitSize:joiBrowser.number().required(),stride:joiBrowser.number().integer().min(1).required(),step:joiBrowser.number().required()}).unknown()),statistics:joiBrowser.object({upToDate:joiBrowser.boolean().required(),min:joiBrowser.number().required(),max:joiBrowser.number().required()}).required().unknown(),transformations:joiBrowser.object().unknown().pattern(/.+/,joiBrowser.array().length(16).items(joiBrowser.number())).required(),description:joiBrowser.string().allow(""),spatialUnit:joiBrowser.string().allow(""),temporalUnit:joiBrowser.string().allow(""),format:joiBrowser.string().allow(""),formatSpecific:joiBrowser.object().unknown()}).unknown()}},{key:"_metadataRawCopied",value:function(){this._buildDimensionsLUT()}},{key:"_buildDimensionsLUT",value:function(){this._dimensionsWorldLUT={},this._dimensionsVoxelLUT={};var e=["x","y","z"],t=this._metadata.dimensions;this._worldPositionIndex=Array(3),this._worldPositionOrder=Array(3);var r,n=[0,1,2];this._hasNativeCorrectOrder=!0;for(var i=0;i<t.length;i++)this._dimensionsWorldLUT[t[i].nameWorldSpace]=i,this._dimensionsVoxelLUT[t[i].nameVoxelSpace]=i,this._worldPositionIndex[i]=(r=e[i],t[0].nameWorldSpace===r?0:t[1].nameWorldSpace===r?1:t[2].nameWorldSpace===r?2:-1),this._worldPositionOrder[i]=e.indexOf(t[i].nameWorldSpace),this._hasNativeCorrectOrder=this._hasNativeCorrectOrder&&this._worldPositionIndex[i]===n[i]}},{key:"getDimensionIndexFromName",value:function(e){return e in this._dimensionsWorldLUT?this._dimensionsWorldLUT[e]:e in this._dimensionsVoxelLUT?this._dimensionsVoxelLUT[e]:-1}},{key:"_initMetadata",value:function(){var e={upToDate:!0,min:NaN,max:NaN};this.setMetadata("description",""),this.setMetadata("statistics",e),this.setMetadata("ncpp",1),this.setMetadata("spatialUnit","Voxel"),this.setMetadata("temporalUnit","Time"),this.setMetadata("format","generic"),this.setMetadata("formatSpecific",{}),this.setMetadata("transformations",{})}},{key:"clone",value:function(){var e=new t;return e.setRawData(new this._data.constructor(this._data)),e.copyMetadataFrom(this),e}},{key:"setData",value:function(e,t){this._initData(t,e),this.scanDataRange()}},{key:"_get4x4IdentityMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"_initData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e){if("ncpp"in e&&this.setMetadata("ncpp",e.ncpp),"xSize"in e&&"ySize"in e&&"zSize"in e){var r=[{length:e.xSize,widthDimension:1,heightDimension:2,nameVoxelSpace:"k",nameWorldSpace:"x",worldUnitSize:1,stride:1,step:1},{length:e.ySize,widthDimension:0,heightDimension:2,nameVoxelSpace:"j",nameWorldSpace:"y",worldUnitSize:1,stride:e.xSize,step:1},{length:e.zSize,widthDimension:0,heightDimension:1,nameVoxelSpace:"i",nameWorldSpace:"z",worldUnitSize:1,stride:e.xSize*e.ySize,step:1}],n=e.xSize*e.ySize*e.zSize*this.getMetadata("ncpp");if("tSize"in e){var i={length:e.tSize,widthDimension:-1,heightDimension:-1,nameVoxelSpace:"t",nameWorldSpace:"t",worldUnitSize:1,stride:e.xSize*e.ySize*e.zSize,step:1};n*=e.tSize,r.push(i),this.setMetadata("dimensions",r)}var a={v2w:this._get4x4IdentityMatrix(),w2v:this._get4x4IdentityMatrix()};if(this.setMetadata("transformations",a),t){if(t.length!=n)return console.warn("The buffer provided has a wrong size."),!1;"deepCopy"in e&&e.deepCopy?this._data=new t.constructor(t):this._data=t}else{this._data=new Float32Array(n);var s=this.getMetadata("statistics");s.min=0,s.max=0}return this._buildDimensionsLUT(),this.metadataIntegrityCheck()}return console.warn("The necessary options xSize, ySize and zSize were not provided."),!1}return!1}},{key:"resetData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._data&&"number"==typeof e&&this._data.fill(e)}},{key:"scanDataRange",value:function(){for(var e=1/0,t=-1/0,r=0;r<this._data.length;r++)e=Math.min(e,this._data[r]),t=Math.max(t,this._data[r]);var n=this.getMetadata("statistics");n||(this.setMetadata("statistics",{}),n=this.getMetadata("statistics")),n.min=e,n.max=t,n.upToDate=!0}},{key:"getMinValue",value:function(){return this._metadata.statistics.upToDate||this.scanDataRange(),this._metadata.statistics.min}},{key:"getMaxValue",value:function(){return this._metadata.statistics.upToDate||this.scanDataRange(),this._metadata.statistics.max}},{key:"getVoxel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this._metadata.dimensions,n=e.i,i=e.j,a=e.k;if(n<0||i<0||a<0||t<0||n>=r[2].length||i>=r[1].length||a>=r[0].length||r.length>3&&t>=r[3].length)return console.warn("Voxel {i:"+e.i+", j:"+e.j+", k:"+e.k+"} is out of bound."),null;var s=this._metadata.ncpp,o=(r.length>3?t*r[3].stride*t:0)+n*r[2].stride+i*r[1].stride+a*r[0].stride;return o*=s,this._data[o]}},{key:"setVoxel",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=this._metadata.dimensions,i=e.i,a=e.j,s=e.k;if(i<0||a<0||s<0||r<0||i>=n[2].length||a>=n[1].length||s>=n[0].length||n.length>3&&r>=n[3].length)return console.warn("Voxel query is out of bound."),null;var o=this._metadata.ncpp,l=(n.length>3?r*n[3].stride*r:0)+i*n[2].stride+a*n[1].stride+s*n[0].stride;l*=o,this._data[l]=t,t>this._metadata.statistics.max?this._metadata.statistics.max=t:t<this._metadata.statistics.min&&(this._metadata.statistics.min=t)}},{key:"getVoxelSafe",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this._metadata.dimensions,n=e.i,i=e.j,a=e.k;if(n<0||i<0||a<0||t<0||n>=r[0].length||i>=r[1].length||a>=r[2].length||r.length>3&&t>=r[3].length)return console.warn("Voxel query is out of bound."),null;var s=(r.length>3?t*r[3].stride*t:0)+(r[2].step<0?r[2].length-n-1:n)*r[2].stride+(r[1].step<0?r[1].length-i-1:i)*r[1].stride+(r[0].step<0?r[0].length-a-1:a)*r[0].stride;return this._data[s]}},{key:"getDimensionSize",value:function(e){if("string"!=typeof e||-1!=(e=this.getDimensionIndexFromName(e))){var t=this._metadata.dimensions;return e<t.length?t[e].length:(console.warn("A dimensions of such index does not exist."),null)}console.warn("dimensions "+e+" does not exist.")}},{key:"getData",value:function(){return this._data}},{key:"getDataCopy",value:function(){return new this._data.constructor(this._data)}},{key:"getDataUint8",value:function(){for(var e=this._data,t=this.getMinValue(),r=this.getMaxValue()-t,n=new Uint8Array(e.length),i=0;i<n.length;i++)n[i]=Math.round((e[i]-t)/r*256);return n}},{key:"hasTransform",value:function(e){return e in this._metadata.transformations}},{key:"_getTransformedPosition",value:function(e,t){var r=this._metadata.transformations;if(!(t in r))return console.warn("No transform named "+t),null;var n=r[t],i=fromValues$5(e[0],e[1],e[2],1),a=create$5();return transformMat4$1(a,i,n),a}},{key:"getPositionFromVoxelSpaceToTransfoSpace",value:function(e,t){var r=[e.i,e.j,e.k],n=[r[this._worldPositionOrder[2]],r[this._worldPositionOrder[1]],r[this._worldPositionOrder[0]]],i=this._getTransformedPosition(n,t);return{x:i[0],y:i[1],z:i[2]}}},{key:"getPositionFromTransfoSpaceToVoxelSpace",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=[e.x,e.y,e.z],i=this._getTransformedPosition(n,t),a={i:i[this._worldPositionOrder[2]],j:i[this._worldPositionOrder[1]],k:i[this._worldPositionOrder[0]]};return r&&(a.i=Math.round(a.i),a.j=Math.round(a.j),a.k=Math.round(a.k)),a}},{key:"getVoxelCoordinatesSwapMatrix",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=new Array(9).fill(0);MatrixTricks.setValueMatrix33(r,0,this._worldPositionOrder[0],1),MatrixTricks.setValueMatrix33(r,1,this._worldPositionOrder[1],1),MatrixTricks.setValueMatrix33(r,2,this._worldPositionOrder[2],1);var n=r;if(e){var i=MatrixTricks.getHorizontalFlipMatrix33(r);n=i}return t&&(n=MatrixTricks.getExpandedMatrix3x3To4x4(i),MatrixTricks.setValueMatrix33(n,3,3,1)),n}},{key:"getVoxelTransfoSpace",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=this.getPositionFromTransfoSpaceToVoxelSpace(t,e);return this.getVoxel(n,r)}},{key:"setVoxelTransfoSpace",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=this.getPositionFromTransfoSpaceToVoxelSpace(t,e);this.setVoxel(i,r,n)}},{key:"addTransformation",value:function(e,t){var r=this._metadata.transformations,n=joiBrowser.array().length(16).items(joiBrowser.number()),i=joiBrowser.validate(e,n);i.error?console.warn("Invalid transformation: "+i.error):r[t]=e}},{key:"getSlice",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if("string"!=typeof e||-1!=(e=this.getDimensionIndexFromName(e))){var n=this._metadata.dimensions;if(e>2)return console.warn("The dimension of a slice should be lower than 3."),null;var i=n[e],a=n[i.widthDimension],s=n[i.heightDimension];if(t<0||t>=i.length)return console.warn("The slice required is out of bound."),null;for(var o=new this._data.constructor(a.length*s.length),l=n.length>3?n[3].stride*r:0,u=(i.step<0?i.length-t-1:t)*i.stride,c=0,h=s.length-1;h>=0;h--)for(var f=(s.step<0?s.length-h-1:h)*s.stride,d=0;d<a.length;d++){var p=u+l+f+(a.step<0?a.length-d-1:d)*a.stride;o[c]=this._data[p],c++}var g=new Image2D;return g.setData(o,a.length,s.length,1),g}console.warn("dimensions "+e+" does not exist.")}},{key:"getSliceSize",value:function(e){if("string"!=typeof e||-1!=(e=this.getDimensionIndexFromName(e))){var t=this._metadata.dimensions;if(e>2)return console.warn("The dimension of a slice should be lower than 3."),null;var r=t[e],n=t[r.widthDimension],i=t[r.heightDimension];return{w:n.length,h:i.length}}console.warn("dimensions "+e+" does not exist.")}},{key:"getNumberOfSlices",value:function(e){if("string"!=typeof e||-1!=(e=this.getDimensionIndexFromName(e))){var t=this._metadata.dimensions;return e>2?(console.warn("The dimension of a slice should be lower than 3."),null):t[e].length}console.warn("dimensions "+e+" does not exist.")}},{key:"getTimeLength",value:function(){var e=this._metadata.dimensions;return 4==e.length?e[3].length:1}},{key:"isInsideVoxelSpace",value:function(e){var t=this._metadata.dimensions,r=!1;try{r=!(e.i<0||e.i>=t[2].length||e.j<0||e.j>=t[1].length||e.k<0||e.k>=t[0].length)}catch(e){console.warn(e)}return r}},{key:"isInsideTransfoSpace",value:function(e,t){var r=this.getPositionFromTransfoSpaceToVoxelSpace(e,t);return this.isInsideVoxelSpace(r)}},{key:"getSegmentSampleVoxelSpace",value:function(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=t.i-e.i,i=t.j-e.j,a=t.k-e.k,s=Math.sqrt(Math.pow(n,2)+Math.pow(i,2)+Math.pow(a,2)),o=Math.floor(s+1),l=n/s,u=i/s,c=a/s,h=this._metadata.ncpp,f=new Array(o).fill(0),d=new Array(h).fill(0),p=new Array(o).fill(0),g=0;g<h;g++)d[g]=new Array(o).fill(0);for(var _=0;_<o;_++){var y={i:Math.round(e.i+_*l),j:Math.round(e.j+_*u),k:Math.round(e.k+_*c)};f[_]=y,p[_]="("+y.i+", "+y.j+", "+y.k+")";var m=[this.getVoxel(y,r)];for(g=0;g<h;g++)d[g][_]=m[g]}return{positions:f,labels:p,colors:d}}},{key:"getSegmentSampleTransfoSpace",value:function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(!this.hasTransform(e))return console.warn("The transform "+e+" is not available."),null;var a=this.getPositionFromTransfoSpaceToVoxelSpace(r,e,!1),s=this.getPositionFromTransfoSpaceToVoxelSpace(n,e,!1);console.log("voxelFrom {"+a.i+", "+a.j+", "+a.k+"} voxelTo {"+s.i+", "+s.j+", "+s.k+"}");var o=this.getSegmentSampleVoxelSpace(a,s,i);if(!o)return null;for(var l=0;l<o.positions.length;l++){var u=o.positions[l],c=this.getPositionFromVoxelSpaceToTransfoSpace(u,t);o.positions[l]=c,o.labels[l]="("+Math.round(100*c.x)/100+", "+Math.round(100*c.y)/100+", "+Math.round(100*c.z)/100+")"}return o}},{key:"getVoxelBox",value:function(){return{min:{i:0,j:0,k:0,t:0},max:{i:this.getDimensionSize("i"),j:this.getDimensionSize("j"),k:this.getDimensionSize("k"),t:this.getDimensionSize("t")}}}},{key:"getTransfoVolumeCorners",value:function(e){return this.hasTransform(e)?[this.getPositionFromVoxelSpaceToTransfoSpace({i:0,j:0,k:0},e),this.getPositionFromVoxelSpaceToTransfoSpace({i:this.getDimensionSize("i")-1,j:0,k:0},e),this.getPositionFromVoxelSpaceToTransfoSpace({i:this.getDimensionSize("i")-1,j:this.getDimensionSize("j")-1,k:0},e),this.getPositionFromVoxelSpaceToTransfoSpace({i:0,j:this.getDimensionSize("j")-1,k:0},e),this.getPositionFromVoxelSpaceToTransfoSpace({i:0,j:0,k:this.getDimensionSize("j")-1},e),this.getPositionFromVoxelSpaceToTransfoSpace({i:this.getDimensionSize("i")-1,j:0,k:this.getDimensionSize("k")-1},e),this.getPositionFromVoxelSpaceToTransfoSpace({i:this.getDimensionSize("i")-1,j:this.getDimensionSize("j")-1,k:this.getDimensionSize("k")-1},e),this.getPositionFromVoxelSpaceToTransfoSpace({i:0,j:this.getDimensionSize("j")-1,k:this.getDimensionSize("k")-1},e)]:(console.warn("The transform "+e+" is not available."),null)}},{key:"getTransfoBox",value:function(e){if(!this.hasTransform(space2voxelTransformName))return console.warn("The transform "+e+" is not available."),null;for(var t=this.getTransfoVolumeCorners(),r={x:1/0,y:1/0,z:1/0},n={x:-1/0,y:-1/0,z:-1/0},i=0;i<t.length;i++)r.x=Math.min(r.x,t[i].x),r.y=Math.min(r.y,t[i].y),r.z=Math.min(r.z,t[i].z),n.x=Math.max(n.x,t[i].x),n.y=Math.max(n.y,t[i].y),n.z=Math.max(n.z,t[i].z);return{min:{x:r.x,y:r.y,z:r.z,t:0},max:{x:n.x,y:n.y,z:n.z,t:this.getDimensionSize("t")}}}}],[{key:"TYPE",value:function(){return"IMAGE3DALT"}}]),t}();CoreTypes.addCoreType(Image3DAlt);var bvhtree_1=createCommonjsModule(function(e){var t,r,n,i,a=a||{};a.EPSILON=1e-6,a.BVHVector3=function(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0},a.BVHVector3.prototype={constructor:a.BVHVector3,copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},set:function(e,t,r){return this.x=e,this.y=t,this.z=r,this},setFromArray:function(e,t){this.x=e[t],this.y=e[t+1],this.z=e[t+2]},add:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},cross:function(e){var t=this.x,r=this.y,n=this.z;return this.x=r*e.z-n*e.y,this.y=n*e.x-t*e.z,this.z=t*e.y-r*e.x,this},crossVectors:function(e,t){var r=e.x,n=e.y,i=e.z,a=t.x,s=t.y,o=t.z;return this.x=n*o-i*s,this.y=i*a-r*o,this.z=r*s-n*a,this},clone:function(){return new a.BVHVector3(this.x,this.y,this.z)}},a.BVH=function(e,t){this._trianglesArray=e,this._maxTrianglesPerNode=t||10,this._bboxArray=this.calcBoundingBoxes(e),this._bboxHelper=new Float32Array(this._bboxArray);var r=e.length/9,n=this.calcExtents(0,r,a.EPSILON);for(this._rootNode=new a.BVHNode(n[0],n[1],0,r,0),this._nodesToSplit=[this._rootNode];this._nodesToSplit.length>0;){var i=this._nodesToSplit.pop();this.splitNode(i)}},a.BVH.prototype.isInside=function(e){var t=this.intersectRay({x:e[0],y:e[1],z:e[2]},{x:1,y:0,z:0},!1);return!!t&&t.length%2==1},a.BVH.prototype.intersectBox=function(e){return this._intersectShape(e,e,a.BVH._isTriangleInsideBox)},a.BVH.prototype.intersectSphere=function(e){var t={min:[e.center[0]-e.radius,e.center[1]-e.radius,e.center[2]-e.radius],max:[e.center[0]+e.radius,e.center[1]+e.radius,e.center[2]+e.radius]};return this._intersectShape(e,t,a.BVH.isTriangleInsideSphere)},a.BVH.prototype._intersectShape=function(e,t,r){for(var n=[this._rootNode],i=[],s=[];n.length>0;){var o=n.pop();if(a.BVH._nodeIntersectBox(o,t))for(o._node0&&n.push(o._node0),o._node1&&n.push(o._node1),l=o._startIndex;l<o._endIndex;l++)i.push(this._bboxArray[7*l])}for(var l=0;l<i.length;l++){var u=i[l],c=9*u,h=this._trianglesArray.subarray(c,c+9);r(h,e)&&s.push({triangle:new Float32Array(h),triangleIndex:u})}return s},a.BVH._nodeIntersectBox=function(e,t){for(var r=[e._extentsMin.x,e._extentsMin.y,e._extentsMin.z],n=[e._extentsMax.x,e._extentsMax.y,e._extentsMax.z],i=t.min,a=t.max,s=[!1,!1,!1],o=0;o<3;o++){var l=i[o]<n[o]&&a[o]>r[o],u=i[o]<r[o]&&a[o]>n[o]||r[o]<i[o]&&n[o]>a[o];s[o]=l||u}return s[0]&&s[1]&&s[2]},a.BVH._isTriangleInsideBox=function(e,t){for(var r=t.min,n=t.max,i=[!1,!1,!1],a=0;a<3;a++){var s=e[0+a],o=e[3+a],l=e[6+a];i[a]=s>r[a]&&s<n[a]&&o>r[a]&&o<n[a]&&l>r[a]&&l<n[a]}return i[0]&&i[1]&&i[2]},a.BVH.isTriangleInsideSphere=function(e,t){for(var r=!0,n=0;n<3;n++){var i=e[3*n]-t.center[0],a=e[3*n+1]-t.center[1],s=e[3*n+2]-t.center[2],o=Math.sqrt(i*i+a*a+s*s);r=r&&o<t.radius}return r},a.BVH.prototype.intersectRay=function(e,t,r){for(var n,i=[this._rootNode],s=[],o=[],l=new a.BVHVector3(1/t.x,1/t.y,1/t.z);i.length>0;){var u=i.pop();if(a.BVH.intersectNodeBox(e,l,u))for(u._node0&&i.push(u._node0),u._node1&&i.push(u._node1),n=u._startIndex;n<u._endIndex;n++)s.push(this._bboxArray[7*n])}var c=new a.BVHVector3,h=new a.BVHVector3,f=new a.BVHVector3,d=new a.BVHVector3(e.x,e.y,e.z),p=new a.BVHVector3(t.x,t.y,t.z);for(n=0;n<s.length;n++){var g=s[n],_=9*g;c.setFromArray(this._trianglesArray,_),h.setFromArray(this._trianglesArray,_+3),f.setFromArray(this._trianglesArray,_+6);var y=a.BVH.intersectRayTriangle(c,h,f,d,p,r);y&&o.push({triangle:this._trianglesArray.slice(_,_+9),triangleIndex:g,intersectionPoint:y})}return o},a.BVH.prototype.calcBoundingBoxes=function(e){for(var t,r,n,i,s,o,l=e.length/9,u=new Float32Array(7*l),c=0;c<l;c++)t=Math.min(e[9*c],e[9*c+3],e[9*c+6]),r=Math.min(e[9*c+1],e[9*c+4],e[9*c+7]),n=Math.min(e[9*c+2],e[9*c+5],e[9*c+8]),i=Math.max(e[9*c],e[9*c+3],e[9*c+6]),s=Math.max(e[9*c+1],e[9*c+4],e[9*c+7]),o=Math.max(e[9*c+2],e[9*c+5],e[9*c+8]),a.BVH.setBox(u,c,c,t,r,n,i,s,o);return u},a.BVH.prototype.calcExtents=function(e,t,r){if(r=r||0,e>=t)return[{x:0,y:0,z:0},{x:0,y:0,z:0}];for(var n=1/0,i=1/0,a=1/0,s=-1/0,o=-1/0,l=-1/0,u=e;u<t;u++)n=Math.min(this._bboxArray[7*u+1],n),i=Math.min(this._bboxArray[7*u+2],i),a=Math.min(this._bboxArray[7*u+3],a),s=Math.max(this._bboxArray[7*u+4],s),o=Math.max(this._bboxArray[7*u+5],o),l=Math.max(this._bboxArray[7*u+6],l);return[{x:n-r,y:i-r,z:a-r},{x:s+r,y:o+r,z:l+r}]},a.BVH.prototype.splitNode=function(e){if(!(e.elementCount()<=this._maxTrianglesPerNode||0===e.elementCount())){var t=e._startIndex,r=e._endIndex,n=[[],[],[]],i=[[],[],[]],s=[e.centerX(),e.centerY(),e.centerZ()],o=[e._extentsMax.x-e._extentsMin.x,e._extentsMax.y-e._extentsMin.y,e._extentsMax.z-e._extentsMin.z],l=[];l.length=3;for(var u=t;u<r;u++){l[0]=.5*(this._bboxArray[7*u+1]+this._bboxArray[7*u+4]),l[1]=.5*(this._bboxArray[7*u+2]+this._bboxArray[7*u+5]),l[2]=.5*(this._bboxArray[7*u+3]+this._bboxArray[7*u+6]);for(var c=0;c<3;c++)l[c]<s[c]?n[c].push(u):i[c].push(u)}var h=[];if(h.length=3,h[0]=0===n[0].length||0===i[0].length,h[1]=0===n[1].length||0===i[1].length,h[2]=0===n[2].length||0===i[2].length,!(h[0]&&h[1]&&h[2])){var f,d,p=[0,1,2];for(p.sort(function(e,t){return o[t]-o[e]}),c=0;c<3;c++){var g=p[c];if(!h[g]){f=n[g],d=i[g];break}}var _,y=t,m=y+f.length,v=m,b=r,w=e._startIndex,E=f.concat(d);for(u=0;u<E.length;u++)_=E[u],a.BVH.copyBox(this._bboxArray,_,this._bboxHelper,w),w++;var T=this._bboxHelper.subarray(7*e._startIndex,7*e._endIndex);this._bboxArray.set(T,7*e._startIndex);var k=this.calcExtents(y,m,a.EPSILON),x=this.calcExtents(v,b,a.EPSILON),S=new a.BVHNode(k[0],k[1],y,m,e._level+1),I=new a.BVHNode(x[0],x[1],v,b,e._level+1);e._node0=S,e._node1=I,e.clearShapes(),this._nodesToSplit.push(S),this._nodesToSplit.push(I)}}},a.BVH._calcTValues=function(e,t,r,n){var i={min:0,max:0};return n>=0?(i.min=(e-r)*n,i.max=(t-r)*n):(i.min=(t-r)*n,i.max=(e-r)*n),i},a.BVH.intersectNodeBox=function(e,t,r){var n=a.BVH._calcTValues(r._extentsMin.x,r._extentsMax.x,e.x,t.x),i=a.BVH._calcTValues(r._extentsMin.y,r._extentsMax.y,e.y,t.y);if(n.min>i.max||i.min>n.max)return!1;(i.min>n.min||n.min!=n.min)&&(n.min=i.min),(i.max<n.max||n.max!=n.max)&&(n.max=i.max);var s=a.BVH._calcTValues(r._extentsMin.z,r._extentsMax.z,e.z,t.z);return!(n.min>s.max||s.min>n.max)&&((s.min>n.min||n.min!=n.min)&&(n.min=s.min),(s.max<n.max||n.max!=n.max)&&(n.max=s.max),!(n.max<0))},a.BVH.intersectRayTriangle=(t=new a.BVHVector3,r=new a.BVHVector3,n=new a.BVHVector3,i=new a.BVHVector3,function(e,s,o,l,u,c){r.subVectors(s,e),n.subVectors(o,e),i.crossVectors(r,n);var h,f=u.dot(i);if(f>0){if(c)return null;h=1}else{if(!(f<0))return null;h=-1,f=-f}t.subVectors(l,e);var d=h*u.dot(n.crossVectors(t,n));if(d<0)return null;var p=h*u.dot(r.cross(t));if(p<0)return null;if(d+p>f)return null;var g=-h*t.dot(i);if(g<0)return null;var _=g/f;return(new a.BVHVector3).copy(u).multiplyScalar(_).add(l)}),a.BVH.setBox=function(e,t,r,n,i,a,s,o,l){e[7*t]=r,e[7*t+1]=n,e[7*t+2]=i,e[7*t+3]=a,e[7*t+4]=s,e[7*t+5]=o,e[7*t+6]=l},a.BVH.copyBox=function(e,t,r,n){r[7*n]=e[7*t],r[7*n+1]=e[7*t+1],r[7*n+2]=e[7*t+2],r[7*n+3]=e[7*t+3],r[7*n+4]=e[7*t+4],r[7*n+5]=e[7*t+5],r[7*n+6]=e[7*t+6]},a.BVH.getBox=function(e,t,r){r.triangleId=e[7*t],r.minX=e[7*t+1],r.minY=e[7*t+2],r.minZ=e[7*t+3],r.maxX=e[7*t+4],r.maxY=e[7*t+5],r.maxZ=e[7*t+6]},a.BVHNode=function(e,t,r,n,i){this._extentsMin=e,this._extentsMax=t,this._startIndex=r,this._endIndex=n,this._level=i,this._node0=null,this._node1=null},a.BVHNode.prototype.elementCount=function(){return this._endIndex-this._startIndex},a.BVHNode.prototype.centerX=function(){return.5*(this._extentsMin.x+this._extentsMax.x)},a.BVHNode.prototype.centerY=function(){return.5*(this._extentsMin.y+this._extentsMax.y)},a.BVHNode.prototype.centerZ=function(){return.5*(this._extentsMin.z+this._extentsMax.z)},a.BVHNode.prototype.clearShapes=function(){this._startIndex=-1,this._endIndex=-1},a.BVHNode.calcBoundingSphereRadius=function(e,t){var r=.5*(e.x+t.x),n=.5*(e.y+t.y),i=.5*(e.z+t.z),a=(r-e.x)*(r-e.x)+(n-e.y)*(n-e.y)+(i-e.z)*(i-e.z),s=(r-t.x)*(r-t.x)+(n-t.y)*(n-t.y)+(i-t.z)*(i-t.z);return Math.sqrt(Math.max(a,s))},e.exports&&(e.exports.BVH=a.BVH,e.exports.intersectRay=a.intersectRay)}),bvhtree_2=bvhtree_1.BVH,bvhtree_3=bvhtree_1.intersectRay,PixpipeContainerMultiData=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._data=[],e.setMetadata("dataIndex",{}),e.setMetadata("mandatoryDataset",[]),e}return inherits(t,PixpipeContainer),createClass(t,[{key:"getData",value:function(e){var t=this.getDataIndex(e);return-1!==t?this._data[t]:null}},{key:"getDataCopy",value:function(e){var t=this.getData(e);return t?new t.constructor(t):null}},{key:"getDataIndex",value:function(e){var t=-1,r=this._metadata.dataIndex;return e in r&&(t=r[e]),t}},{key:"doesDataExist",value:function(e){return-1!==this.getDataIndex(e)}},{key:"setData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e){var r=this.getDataIndex(t),n=this._metadata.dataIndex;-1!==r?this._data[r]=e:(r=this._data.length,this._data.push(e),n[t]=r)}else console.warn("Cannot add null as a dataset.")}},{key:"checkIntegrity",value:function(){for(var e=!0,t=this.getMetadata("mandatoryDataset"),r=0;r<t.length;r++){var n=this.doesDataExist(t[r]);e=e&&n,n||console.warn("The sub-data of name: "+t[r]+" is missing")}return e}},{key:"clone",value:function(){var e=this.getMetadataClone();if(!e)return console.warn("The metadata object is invalid, cloning is impossible."),null;var t=this._metadata.dataIndex,r=new this.constructor;for(var n in r.setRawMetadata(e),t)r.setData(this.getDataCopy(n),n);return r}}]),t}(),Mesh3D=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e._type=t.TYPE(),e.setMetadata("verticesPerShapes",3),e.setMetadata("componentsPerColor",4);var r=e.getMetadata("mandatoryDataset");return e._datasetNames={vertexPositions:"vertexPositions",polygonFaces:"polygonFaces",polygonNormals:"polygonNormals",vertexColors:"vertexColors"},r.push(e._datasetNames.vertexPositions),r.push(e._datasetNames.polygonFaces),r.push(e._datasetNames.polygonNormals),e._aabb=null,e._bvhTree=null,e._triangleList=null,e}return inherits(t,PixpipeContainerMultiData),createClass(t,[{key:"setVertexPositions",value:function(e){e.length%3==0?this.setData(e,this._datasetNames.vertexPositions):console.warn("The array of vertex positions has a non-multiple-of-three size.")}},{key:"getVertexPositions",value:function(){return this.getData(this._datasetNames.vertexPositions)}},{key:"getVertexPositionCopy",value:function(){return this.getDataCopy(this._datasetNames.vertexPositions)}},{key:"setPolygonFacesOrder",value:function(e){e.length%this.getMetadata("verticesPerShapes")==0?this.setData(e,this._datasetNames.polygonFaces):console.warn("The array of vertext positions must have a size that is a multiple of the metadata 'verticesPerShapes'.")}},{key:"getPolygonFacesOrder",value:function(){return this.getData(this._datasetNames.polygonFaces)}},{key:"getPolygonFacesOrderCopy",value:function(){return this.getDataCopy(this._datasetNames.polygonFaces)}},{key:"setPolygonFacesNormals",value:function(e){e.length%3==0?this.setData(e,this._datasetNames.polygonNormals):console.warn("The array of vertext positions must have a size that is a multiple of 3.")}},{key:"getPolygonFacesNormals",value:function(){return this.getData(this._datasetNames.polygonNormals)}},{key:"getPolygonFacesNormalsCopy",value:function(){return this.getDataCopy(this._datasetNames.polygonNormals)}},{key:"setVertexColors",value:function(e){e.length%this.getMetadata("componentsPerColor")==0?this.setData(e,this._datasetNames.vertexColors):console.warn("The array of vertext positions must have a size that is a multiple of the metadata 'componentsPerColor'.")}},{key:"getVertexColors",value:function(){return this.getData(this._datasetNames.vertexColors)}},{key:"getVertexColorsCopy",value:function(){return this.getDataCopy(this._datasetNames.vertexColors)}},{key:"getNumberOfVerticesPerShapes",value:function(){return this.getMetadata("verticesPerShapes")}},{key:"setNumberOfVerticesPerShapes",value:function(e){e<0&&console.warn("The number of vertice per shapes should be positive."),this.setMetadata("verticesPerShapes",e)}},{key:"getNumberOfComponentsPerColor",value:function(){return this.getMetadata("componentsPerColor")}},{key:"setNumberOfComponentsPerColor",value:function(e){e<0&&console.warn("The number of components per pixel should be positive."),this.setMetadata("componentsPerColor",e)}},{key:"getNumberOfVertices",value:function(){var e=this.getVertexPositions();return e?e.length/3:null}},{key:"generateUniformVertexColor",value:function(e){}},{key:"generateFacesNormalsVectors",value:function(){}},{key:"buildBox",value:function(){var e=this.getVertexPositions();if(e){for(var t=new Float32Array([1/0,1/0,1/0]),r=new Float32Array([-1/0,-1/0,-1/0]),n=0;n<e.length;n+=3)t[0]=Math.min(t[0],e[n]),r[0]=Math.max(r[0],e[n]),t[1]=Math.min(t[1],e[n+1]),r[1]=Math.max(r[1],e[n+1]),t[2]=Math.min(t[2],e[n+2]),r[2]=Math.max(r[2],e[n+2]);this._aabb={min:t,max:r}}}},{key:"getBox",value:function(){return this._aabb||this.buildBox(),this._aabb}},{key:"getBoxCenter",value:function(){return this._aabb||this.buildBox(),this._aabb?new Float32Array([(this._aabb.min[0]+this._aabb.max[0])/2,(this._aabb.min[1]+this._aabb.max[1])/2,(this._aabb.min[2]+this._aabb.max[2])/2]):null}},{key:"buildTriangleList",value:function(){var e=this.getVertexPositions(),t=this.getPolygonFacesOrder();this._triangleList=new Float32Array(3*t.length);for(var r=0;r<t.length;r+=3)this._triangleList[3*r]=e[3*t[r]],this._triangleList[3*r+1]=e[3*t[r]+1],this._triangleList[3*r+2]=e[3*t[r]+2],this._triangleList[3*r+3]=e[3*t[r+1]],this._triangleList[3*r+4]=e[3*t[r+1]+1],this._triangleList[3*r+5]=e[3*t[r+1]+2],this._triangleList[3*r+6]=e[3*t[r+2]],this._triangleList[3*r+7]=e[3*t[r+2]+1],this._triangleList[3*r+8]=e[3*t[r+2]+2]}},{key:"updateColorTriangle",value:function(e,t){var r=this._metadata.componentsPerColor;if(r==t.length){var n=this.getVertexColors(),i=this.getPolygonFacesOrder();if(e<0||e>=i.length/3)console.warn("The triangle index is out of bounds.");else{e*=3;for(var a=0;a<r;a++)n[i[e]*r+a]=t[a],n[i[e+1]*r+a]=t[a],n[i[e+2]*r+a]=t[a]}}else console.warn("The given color array must have the same number of component than the mesh (="+r+")")}},{key:"buildBvhTree",value:function(){this._triangleList||this.buildTriangleList();this._bvhTree=new bvhtree_1.BVH(this._triangleList,4)}},{key:"isInside",value:function(e){return this._aabb||this.buildBox(),!!(e[0]>this._aabb.min[0]&&e[0]<this._aabb.max[0]&&e[1]>this._aabb.min[1]&&e[1]<this._aabb.max[1]&&e[2]>this._aabb.min[2]&&e[2]<this._aabb.max[2])&&this._bvhTree.isInside(e)}},{key:"intersectRay",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._bvhTree||this.buildBvhTree();var n={x:e[0],y:e[1],z:e[2]},i={x:t[0],y:t[1],z:t[2]};return this._bvhTree.intersectRay(n,i,r)}},{key:"intersectBox",value:function(e){return this._bvhTree||this.buildBvhTree(),this._bvhTree.intersectBox(e)}},{key:"intersectSphere",value:function(e){return this._bvhTree||this.buildBvhTree(),this._bvhTree.intersectSphere(e)}}],[{key:"TYPE",value:function(){return"MESH3D"}}]),t}();CoreTypes.addCoreType(Mesh3D);var codecutils_umd=createCommonjsModule(function(e,t){!function(e){var t,r=(function(e){var t=e.exports=function(e){return new r(e)};function r(e){this.value=e}function n(e,t,r){var n=[],s=[],c=!0;return function e(h){var f=r?i(h):h,d={},p=!0,g={node:f,node_:h,path:[].concat(n),parent:s[s.length-1],parents:s,key:n.slice(-1)[0],isRoot:0===n.length,level:n.length,circular:null,update:function(e,t){g.isRoot||(g.parent.node[g.key]=e),g.node=e,t&&(p=!1)},delete:function(e){delete g.parent.node[g.key],e&&(p=!1)},remove:function(e){o(g.parent.node)?g.parent.node.splice(g.key,1):delete g.parent.node[g.key],e&&(p=!1)},keys:null,before:function(e){d.before=e},after:function(e){d.after=e},pre:function(e){d.pre=e},post:function(e){d.post=e},stop:function(){c=!1},block:function(){p=!1}};if(!c)return g;function _(){if("object"===_typeof(g.node)&&null!==g.node){g.keys&&g.node_===g.node||(g.keys=a(g.node)),g.isLeaf=0==g.keys.length;for(var e=0;e<s.length;e++)if(s[e].node_===h){g.circular=s[e];break}}else g.isLeaf=!0,g.keys=null;g.notLeaf=!g.isLeaf,g.notRoot=!g.isRoot}_();var y=t.call(g,g.node);return void 0!==y&&g.update&&g.update(y),d.before&&d.before.call(g,g.node),p?("object"!=_typeof(g.node)||null===g.node||g.circular||(s.push(g),_(),l(g.keys,function(t,i){n.push(t),d.pre&&d.pre.call(g,g.node[t],t);var a=e(g.node[t]);r&&u.call(g.node,t)&&(g.node[t]=a.node),a.isLast=i==g.keys.length-1,a.isFirst=0==i,d.post&&d.post.call(g,a),n.pop()}),s.pop()),d.after&&d.after.call(g,g.node),g):g}(e).node}function i(e){if("object"===(void 0===e?"undefined":_typeof(e))&&null!==e){var t;if(o(e))t=[];else if("[object Date]"===s(e))t=new Date(e.getTime?e.getTime():e);else if(function(e){return"[object RegExp]"===s(e)}(e))t=new RegExp(e);else if(function(e){return"[object Error]"===s(e)}(e))t={message:e.message};else if(function(e){return"[object Boolean]"===s(e)}(e))t=new Boolean(e);else if(function(e){return"[object Number]"===s(e)}(e))t=new Number(e);else if(function(e){return"[object String]"===s(e)}(e))t=new String(e);else if(Object.create&&Object.getPrototypeOf)t=Object.create(Object.getPrototypeOf(e));else if(e.constructor===Object)t={};else{var r=e.constructor&&e.constructor.prototype||e.__proto__||{},n=function(){};n.prototype=r,t=new n}return l(a(e),function(r){t[r]=e[r]}),t}return e}r.prototype.get=function(e){for(var t=this.value,r=0;r<e.length;r++){var n=e[r];if(!t||!u.call(t,n)){t=void 0;break}t=t[n]}return t},r.prototype.has=function(e){for(var t=this.value,r=0;r<e.length;r++){var n=e[r];if(!t||!u.call(t,n))return!1;t=t[n]}return!0},r.prototype.set=function(e,t){for(var r=this.value,n=0;n<e.length-1;n++){var i=e[n];u.call(r,i)||(r[i]={}),r=r[i]}return r[e[n]]=t,t},r.prototype.map=function(e){return n(this.value,e,!0)},r.prototype.forEach=function(e){return this.value=n(this.value,e,!1),this.value},r.prototype.reduce=function(e,t){var r=1===arguments.length,n=r?this.value:t;return this.forEach(function(t){this.isRoot&&r||(n=e.call(this,n,t))}),n},r.prototype.paths=function(){var e=[];return this.forEach(function(t){e.push(this.path)}),e},r.prototype.nodes=function(){var e=[];return this.forEach(function(t){e.push(this.node)}),e},r.prototype.clone=function(){var e=[],t=[];return function r(n){for(var s=0;s<e.length;s++)if(e[s]===n)return t[s];if("object"===(void 0===n?"undefined":_typeof(n))&&null!==n){var o=i(n);return e.push(n),t.push(o),l(a(n),function(e){o[e]=r(n[e])}),e.pop(),t.pop(),o}return n}(this.value)};var a=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};function s(e){return Object.prototype.toString.call(e)}var o=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},l=function(e,t){if(e.forEach)return e.forEach(t);for(var r=0;r<e.length;r++)t(e[r],r,e)};l(a(r.prototype),function(e){t[e]=function(t){var n=[].slice.call(arguments,1),i=new r(t);return i[e].apply(i,n)}});var u=Object.hasOwnProperty||function(e,t){return t in e}}(t={exports:{}},t.exports),t.exports),n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function(){function e(){n(this,e)}return i(e,null,[{key:"isPlatformLittleEndian",value:function(){var e=new Uint32Array([305419896]),t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);return 18!=t[0]}},{key:"arrayBufferToUnicode",value:function(e){for(var t=new Uint8Array(e),r=[],n=0,i=0;n<t.length;){var a=t[n++];if(a<128){if(a<32&&10!=a&&13!=a&&9!=a||127==a)return console.warn("Invalid string: non-printable characters"),null;r[i++]=String.fromCharCode(a)}else if(a>191&&a<224){var s=t[n++];r[i++]=String.fromCharCode((31&a)<<6|63&s)}else if(a>239&&a<365){var s=t[n++],o=t[n++],l=t[n++],u=((7&a)<<18|(63&s)<<12|(63&o)<<6|63&l)-65536;r[i++]=String.fromCharCode(55296+(u>>10)),r[i++]=String.fromCharCode(56320+(1023&u))}else{var s=t[n++],o=t[n++],c=(15&a)<<12|(63&s)<<6|63&o;if(65533===c)return console.warn("Invalid string: a REPLACEMENT CHARACTER was spotted"),null;r[i++]=String.fromCharCode(c)}}return r.join("")}},{key:"unicodeToArrayBuffer",value:function(e){for(var t=[],r=0,n=0;n<e.length;n++){var i=e.charCodeAt(n);i<128?t[r++]=i:i<2048?(t[r++]=i>>6|192,t[r++]=63&i|128):55296==(64512&i)&&n+1<e.length&&56320==(64512&e.charCodeAt(n+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++n)),t[r++]=i>>18|240,t[r++]=i>>12&63|128,t[r++]=i>>6&63|128,t[r++]=63&i|128):(t[r++]=i>>12|224,t[r++]=i>>6&63|128,t[r++]=63&i|128)}return new Uint8Array(t).buffer}},{key:"arrayBufferToString8",value:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}},{key:"string8ToArrayBuffer",value:function(e){for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return t}},{key:"setString8InBuffer",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(r<0)console.warn("The byte offset cannot be negative.");else if(t&&t instanceof ArrayBuffer)if(e.length+r>t.byteLength)console.warn("The string is too long to be writen in this buffer.");else for(var n=new Uint8Array(t),i=0;i<e.length;i++)n[i+r]=e.charCodeAt(i);else console.warn("The buffer must be a valid ArrayBuffer.")}},{key:"getString8FromBuffer",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return r<0?(console.warn("The byte offset cannot be negative."),null):e&&e instanceof ArrayBuffer?t+r>e.byteLength?(console.warn("The string is too long to be writen in this buffer."),null):String.fromCharCode.apply(null,new Uint8Array(e,r,t)):(console.warn("The buffer must be a valid ArrayBuffer."),null)}},{key:"objectToArrayBuffer",value:function(t){var r=null,n=e.makeSerializeFriendly(t);try{var i=JSON.stringify(n);r=e.unicodeToArrayBuffer(i)}catch(e){console.warn(e)}return r}},{key:"ArrayBufferToObject",value:function(t){var r=null;try{var n=e.arrayBufferToUnicode(t);r=JSON.parse(n)}catch(e){console.warn(e)}return r}},{key:"isTypedArray",value:function(e){return e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array}},{key:"mergeBuffers",value:function(e){for(var t=0,r=0;r<e.length;r++)t+=e[r].byteLength;for(var n=new Uint8Array(t),i=0,r=0;r<e.length;r++)n.set(new Uint8Array(e[r]),i),i+=e[r].byteLength;return n.buffer}},{key:"getGlobalObject",value:function(){var e=null;try{e=window}catch(t){try{e=GLOBAL}catch(e){return console.warn("You are not in a Javascript environment?? Weird."),null}}return e}},{key:"extractTypedArray",value:function(e,t,r,n){if(!e)return console.warn("Input Buffer is null."),null;if(!(e instanceof ArrayBuffer))return console.warn("Buffer must be of type ArrayBuffer"),null;if(n<=0)return console.warn("The number of elements to fetch must be greater than 0"),null;if(t<0)return console.warn("The byte offset must be possitive or 0"),null;if(t>=e.byteLength)return console.warn("The offset cannot be larger than the size of the buffer."),null;if(r instanceof Function&&!("BYTES_PER_ELEMENT"in r))return console.warn("ArrayType must be a typed array constructor function."),null;if(!(r.BYTES_PER_ELEMENT*n+t>e.byteLength)){var i=e.slice(t,t+n*r.BYTES_PER_ELEMENT);return new r(i)}console.warn("The requested number of elements is too large for this buffer")}},{key:"getTypedArrayInfo",value:function(e){var t=null,r=!1;return e instanceof Int8Array?(t="int",r=!1):e instanceof Uint8Array?(t="int",r=!0):e instanceof Uint8ClampedArray?(t="int",r=!0):e instanceof Int16Array?(t="int",r=!1):e instanceof Uint16Array?(t="int",r=!0):e instanceof Int32Array?(t="int",r=!1):e instanceof Uint32Array?(t="int",r=!0):e instanceof Float32Array?(t="float",r=!1):e instanceof Float64Array&&(t="float",r=!1),{type:t,signed:r,bytesPerElements:e.BYTES_PER_ELEMENT,byteLength:e.byteLength,length:e.length}}},{key:"howManyTypedArrayAttributes",value:function(t){var n=0;return r(t).forEach(function(t){n+=e.isTypedArray(t)}),n}},{key:"hasCircularReference",value:function(e){var t=!1;return r(e).forEach(function(e){this.circular&&(t=!0)}),t}},{key:"removeCircularReference",value:function(e){var t=!1,n=r(e).map(function(e){this.circular&&(this.remove(),t=!0)});return t?n:null}},{key:"replaceTypedArrayAttributesByArrays",value:function(t){var n=!1,i=r(t).map(function(t){if(e.isTypedArray(t)){for(var r=Object.keys(t).length,i=new Array(r),a=0;a<r;a++)i[a]=t[a];this.update(i),n=!0}});return n?i:null}},{key:"makeSerializeFriendly",value:function(t){var r=t,n=e.removeCircularReference(r);n&&(r=n);var i=e.replaceTypedArrayAttributesByArrays(r);return i&&(r=i),r}},{key:"isValidString",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e.length,n=t?r:Math.min(1e3,r),i=0,a=0;a<n;a++){var s=e.charCodeAt(Math.floor(Math.random()*n));(65533===s||s<32&&10!=s&&13!=s&&9!=s||127==s)&&i++}return!(i>0)}}]),e}();e.CodecUtils=a,Object.defineProperty(e,"__esModule",{value:!0})}(t)}),codecutils=unwrapExports(codecutils_umd),Decoder=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setMetadata("targetType",null),e}return inherits(t,Filter),createClass(t,null,[{key:"isBinary",value:function(){return!0}}]),createClass(t,[{key:"_isBinary",value:function(){return this.constructor.isBinary()}},{key:"_getInput",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_getInput",this).call(this,e),n=this._isBinary();if(n&&r instanceof ArrayBuffer)return r;if(!n&&"string"==typeof r)return r;if(!n&&r instanceof ArrayBuffer){var i=codecutils.CodecUtils.arrayBufferToUnicode(r);return i||(console.warn("The binary buffer could not be converted into a a valid string."),null)}return n&&"string"==typeof r?(console.warn("A binary buffer is expected and a string buffer is given. Unable to continue."),null):null}}]),t}(),CanvasImageWriter=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.addInputValidator(0,Image2D),e.setMetadata("alpha",!1),e.setMetadata("min",0),e.setMetadata("max",255),e.setMetadata("reset",!0),e._canvas=null,e._ctx=null,e}return inherits(t,Filter),createClass(t,[{key:"getCanvas",value:function(){return this._canvas}},{key:"_init",value:function(){var e=document.getElementById(this.getMetadata("parentDivID"));if(!e)return!1;if(this.getMetadata("reset"))for(;e.firstChild;)e.removeChild(e.firstChild);return this._canvas=document.createElement("canvas"),this._canvas.style="image-rendering: pixelated;",this._ctx=this._canvas.getContext("2d"),this._ctx.imageSmoothingEnabled=!1,this._ctx.mozImageSmoothingEnabled=!1,this._ctx.webkitImageSmoothingEnabled=!1,this._ctx.ctxmsImageSmoothingEnabled=!1,document.getElementById(this.getMetadata("parentDivID")).appendChild(this._canvas),!0}},{key:"_run",value:function(){if(this.hasValidInput()){var e=this._input[0],t=e.getComponentsPerPixel();if(1==t||3==t||4==t)if(this.getMetadata("parentDivID"))if(this._init()){var r=this.getMetadata("alpha");this._canvas.width=e.getWidth(),this._canvas.height=e.getHeight();var n=this._ctx.getImageData(0,0,this._canvas.width,this._canvas.height),i=n.data,a=e.getData();if(4==t)for(var s=0;s<a.length;s++)i[s]=r||s%4!=3?this._stretchMinMax(a[s]):255;else if(1==t)for(s=0;s<a.length;s++){var o=4*s,l=this._stretchMinMax(a[s]);i[o]=l,i[o+1]=l,i[o+2]=l,i[o+3]=255}else if(3==t){var u=0;for(s=0;s<i.length;s++)s%4==3?i[s]=255:(i[s]=this._stretchMinMax(a[u]),u++)}this._ctx.putImageData(n,0,0)}else console.warn("The parent div was not specified or does not exist.");else console.error("The parent DIV ID to place the canvas element was not specified. Unable to display anything.");else console.warn("Cannot write Image in canvas if contains other than 1, 3 or 4 bands.")}}},{key:"_stretchMinMax",value:function(e){var t=this._metadata.min,r=this._metadata.max;return 0==t&&255==r?e:(e-t)/(r-t)*255}}]),t}(),UrlImageReader=function(e){function t(e){classCallCheck(this,t);var r=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._loadedCounter=0,r._addOutput(Image2D,0),r}return inherits(t,Filter),createClass(t,[{key:"_run",value:function(){var e=this;this.getInputCategories().forEach(function(t){e._addOutput(Image2D,t),e._loadImage(t)})}},{key:"_loadImage",value:function(e){var t=this,r=new Image;r.src=this._getInput(e),r.onload=function(){var n=document.createElement("canvas");n.width=r.width,n.height=r.height;var i=n.getContext("2d");i.drawImage(r,0,0);try{var a=i.getImageData(0,0,n.width,n.height),s=new Float32Array(a.data);t.getOutput(e).setData(s,r.width,r.height),t._loadedCounter++,t._loadedCounter==t.getNumberOfInputs()&&t.triggerEvent("ready")}catch(e){console.error(e)}}}}]),t}(),FileImageReader=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._allowedTypes=/image.*/,e}return inherits(t,Filter),createClass(t,[{key:"hasValidInput",value:function(){var e=!1,t=this._getInput();return t&&t.type.match(this._allowedTypes)?e=!0:console.error("The file must be an image (jpg/png). The type "+t.type+" is not compatible with FileImageReader."),e}},{key:"_run",value:function(){if(this.hasValidInput()){var e=this,t=this._getInput(),r=new FileReader;r.onload=function(t){var n=new Image;n.onload=function(){var t=document.createElement("canvas");t.width=n.width,t.height=n.height;var r=t.getContext("2d");r.drawImage(n,0,0);var i=r.getImageData(0,0,n.width,n.height).data;e._addOutput(Image2D,0).setData(i,n.width,n.height),e.triggerEvent("ready")},n.src=r.result},r.readAsDataURL(t)}}}]),t}(),global$1="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}var cachedSetTimeout=defaultSetTimout,cachedClearTimeout=defaultClearTimeout;function runTimeout(e){if(cachedSetTimeout===setTimeout)return setTimeout(e,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(e,0);try{return cachedSetTimeout(e,0)}catch(t){try{return cachedSetTimeout.call(null,e,0)}catch(t){return cachedSetTimeout.call(this,e,0)}}}function runClearTimeout(e){if(cachedClearTimeout===clearTimeout)return clearTimeout(e);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(e);try{return cachedClearTimeout(e)}catch(t){try{return cachedClearTimeout.call(null,e)}catch(t){return cachedClearTimeout.call(this,e)}}}"function"==typeof global$1.setTimeout&&(cachedSetTimeout=setTimeout),"function"==typeof global$1.clearTimeout&&(cachedClearTimeout=clearTimeout);var queue=[],draining=!1,currentQueue,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var e=runTimeout(cleanUpNextTick);draining=!0;for(var t=queue.length;t;){for(currentQueue=queue,queue=[];++queueIndex<t;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,t=queue.length}currentQueue=null,draining=!1,runClearTimeout(e)}}function nextTick(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];queue.push(new Item(e,t)),1!==queue.length||draining||runTimeout(drainQueue)}function Item(e,t){this.fun=e,this.array=t}Item.prototype.run=function(){this.fun.apply(null,this.array)};var title="browser",platform="browser",browser=!0,env={},argv=[],version="",versions={},release={},config={};function noop(){}var on=noop,addListener=noop,once=noop,off=noop,removeListener=noop,removeAllListeners=noop,emit=noop;function binding(e){throw new Error("process.binding is not supported")}function cwd(){return"/"}function chdir(e){throw new Error("process.chdir is not supported")}function umask(){return 0}var performance$1=global$1.performance||{},performanceNow=performance$1.now||performance$1.mozNow||performance$1.msNow||performance$1.oNow||performance$1.webkitNow||function(){return(new Date).getTime()};function hrtime(e){var t=.001*performanceNow.call(performance$1),r=Math.floor(t),n=Math.floor(t%1*1e9);return e&&(r-=e[0],(n-=e[1])<0&&(r--,n+=1e9)),[r,n]}var startTime=new Date;function uptime(){return(new Date-startTime)/1e3}var process={nextTick:nextTick,title:title,browser:browser,env:env,argv:argv,version:version,versions:versions,on:on,addListener:addListener,once:once,off:off,removeListener:removeListener,removeAllListeners:removeAllListeners,emit:emit,binding:binding,cwd:cwd,chdir:chdir,umask:umask,hrtime:hrtime,platform:platform,release:release,config:config,uptime:uptime},empty={},empty$1=Object.freeze({default:empty}),lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,inited=!1;function init(){inited=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0,r=e.length;t<r;++t)lookup[t]=e[t],revLookup[e.charCodeAt(t)]=t;revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63}function toByteArray(e){var t,r,n,i,a,s;inited||init();var o=e.length;if(o%4>0)throw new Error("Invalid string. Length must be a multiple of 4");a="="===e[o-2]?2:"="===e[o-1]?1:0,s=new Arr(3*o/4-a),n=a>0?o-4:o;var l=0;for(t=0,r=0;t<n;t+=4,r+=3)i=revLookup[e.charCodeAt(t)]<<18|revLookup[e.charCodeAt(t+1)]<<12|revLookup[e.charCodeAt(t+2)]<<6|revLookup[e.charCodeAt(t+3)],s[l++]=i>>16&255,s[l++]=i>>8&255,s[l++]=255&i;return 2===a?(i=revLookup[e.charCodeAt(t)]<<2|revLookup[e.charCodeAt(t+1)]>>4,s[l++]=255&i):1===a&&(i=revLookup[e.charCodeAt(t)]<<10|revLookup[e.charCodeAt(t+1)]<<4|revLookup[e.charCodeAt(t+2)]>>2,s[l++]=i>>8&255,s[l++]=255&i),s}function tripletToBase64(e){return lookup[e>>18&63]+lookup[e>>12&63]+lookup[e>>6&63]+lookup[63&e]}function encodeChunk(e,t,r){for(var n,i=[],a=t;a<r;a+=3)n=(e[a]<<16)+(e[a+1]<<8)+e[a+2],i.push(tripletToBase64(n));return i.join("")}function fromByteArray(e){var t;inited||init();for(var r=e.length,n=r%3,i="",a=[],s=0,o=r-n;s<o;s+=16383)a.push(encodeChunk(e,s,s+16383>o?o:s+16383));return 1===n?(t=e[r-1],i+=lookup[t>>2],i+=lookup[t<<4&63],i+="=="):2===n&&(t=(e[r-2]<<8)+e[r-1],i+=lookup[t>>10],i+=lookup[t>>4&63],i+=lookup[t<<2&63],i+="="),a.push(i),a.join("")}function read(e,t,r,n,i){var a,s,o=8*i-n-1,l=(1<<o)-1,u=l>>1,c=-7,h=r?i-1:0,f=r?-1:1,d=e[t+h];for(h+=f,a=d&(1<<-c)-1,d>>=-c,c+=o;c>0;a=256*a+e[t+h],h+=f,c-=8);for(s=a&(1<<-c)-1,a>>=-c,c+=n;c>0;s=256*s+e[t+h],h+=f,c-=8);if(0===a)a=1-u;else{if(a===l)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,n),a-=u}return(d?-1:1)*s*Math.pow(2,a-n)}function write(e,t,r,n,i,a){var s,o,l,u=8*a-i-1,c=(1<<u)-1,h=c>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:a-1,p=n?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,s=c):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+h>=1?f/l:f*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=c?(o=0,s=c):s+h>=1?(o=(t*l-1)*Math.pow(2,i),s+=h):(o=t*Math.pow(2,h-1)*Math.pow(2,i),s=0));i>=8;e[r+d]=255&o,d+=p,o/=256,i-=8);for(s=s<<i|o,u+=i;u>0;e[r+d]=255&s,d+=p,s/=256,u-=8);e[r+d-p]|=128*g}var toString={}.toString,isArray=Array.isArray||function(e){return"[object Array]"==toString.call(e)},INSPECT_MAX_BYTES=50;Buffer.TYPED_ARRAY_SUPPORT=void 0===global$1.TYPED_ARRAY_SUPPORT||global$1.TYPED_ARRAY_SUPPORT;var _kMaxLength=kMaxLength();function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(e,t){if(kMaxLength()<t)throw new RangeError("Invalid typed array length");return Buffer.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=Buffer.prototype:(null===e&&(e=new Buffer(t)),e.length=t),e}function Buffer(e,t,r){if(!(Buffer.TYPED_ARRAY_SUPPORT||this instanceof Buffer))return new Buffer(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return allocUnsafe(this,e)}return from(this,e,t,r)}function from(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?fromArrayBuffer(e,t,r,n):"string"==typeof t?fromString(e,t,r):fromObject(e,t)}function assertSize(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function alloc(e,t,r,n){return assertSize(t),t<=0?createBuffer(e,t):void 0!==r?"string"==typeof n?createBuffer(e,t).fill(r,n):createBuffer(e,t).fill(r):createBuffer(e,t)}function allocUnsafe(e,t){if(assertSize(t),e=createBuffer(e,t<0?0:0|checked(t)),!Buffer.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function fromString(e,t,r){if("string"==typeof r&&""!==r||(r="utf8"),!Buffer.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|byteLength(t,r),i=(e=createBuffer(e,n)).write(t,r);return i!==n&&(e=e.slice(0,i)),e}function fromArrayLike(e,t){var r=t.length<0?0:0|checked(t.length);e=createBuffer(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function fromArrayBuffer(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");return t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n),Buffer.TYPED_ARRAY_SUPPORT?(e=t).__proto__=Buffer.prototype:e=fromArrayLike(e,t),e}function fromObject(e,t){if(internalIsBuffer(t)){var r=0|checked(t.length);return 0===(e=createBuffer(e,r)).length?e:(t.copy(e,0,0,r),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||isnan(t.length)?createBuffer(e,0):fromArrayLike(e,t);if("Buffer"===t.type&&isArray(t.data))return fromArrayLike(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(e){if(e>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|e}function SlowBuffer(e){return+e!=e&&(e=0),Buffer.alloc(+e)}function internalIsBuffer(e){return!(null==e||!e._isBuffer)}function byteLength(e,t){if(internalIsBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return utf8ToBytes(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return base64ToBytes(e).length;default:if(n)return utf8ToBytes(e).length;t=(""+t).toLowerCase(),n=!0}}function slowToString(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return hexSlice(this,t,r);case"utf8":case"utf-8":return utf8Slice(this,t,r);case"ascii":return asciiSlice(this,t,r);case"latin1":case"binary":return latin1Slice(this,t,r);case"base64":return base64Slice(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function swap(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function bidirectionalIndexOf(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=Buffer.from(t,n)),internalIsBuffer(t))return 0===t.length?-1:arrayIndexOf(e,t,r,n,i);if("number"==typeof t)return t&=255,Buffer.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):arrayIndexOf(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(e,t,r,n,i){var a,s=1,o=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s=2,o/=2,l/=2,r/=2}function u(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var c=-1;for(a=r;a<o;a++)if(u(e,a)===u(t,-1===c?0:a-c)){if(-1===c&&(c=a),a-c+1===l)return c*s}else-1!==c&&(a-=a-c),c=-1}else for(r+l>o&&(r=o-l),a=r;a>=0;a--){for(var h=!0,f=0;f<l;f++)if(u(e,a+f)!==u(t,f)){h=!1;break}if(h)return a}return-1}function hexWrite(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var a=t.length;if(a%2!=0)throw new TypeError("Invalid hex string");n>a/2&&(n=a/2);for(var s=0;s<n;++s){var o=parseInt(t.substr(2*s,2),16);if(isNaN(o))return s;e[r+s]=o}return s}function utf8Write(e,t,r,n){return blitBuffer(utf8ToBytes(t,e.length-r),e,r,n)}function asciiWrite(e,t,r,n){return blitBuffer(asciiToBytes(t),e,r,n)}function latin1Write(e,t,r,n){return asciiWrite(e,t,r,n)}function base64Write(e,t,r,n){return blitBuffer(base64ToBytes(t),e,r,n)}function ucs2Write(e,t,r,n){return blitBuffer(utf16leToBytes(t,e.length-r),e,r,n)}function base64Slice(e,t,r){return 0===t&&r===e.length?fromByteArray(e):fromByteArray(e.slice(t,r))}function utf8Slice(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var a,s,o,l,u=e[i],c=null,h=u>239?4:u>223?3:u>191?2:1;if(i+h<=r)switch(h){case 1:u<128&&(c=u);break;case 2:128==(192&(a=e[i+1]))&&(l=(31&u)<<6|63&a)>127&&(c=l);break;case 3:a=e[i+1],s=e[i+2],128==(192&a)&&128==(192&s)&&(l=(15&u)<<12|(63&a)<<6|63&s)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:a=e[i+1],s=e[i+2],o=e[i+3],128==(192&a)&&128==(192&s)&&128==(192&o)&&(l=(15&u)<<18|(63&a)<<12|(63&s)<<6|63&o)>65535&&l<1114112&&(c=l)}null===c?(c=65533,h=1):c>65535&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|1023&c),n.push(c),i+=h}return decodeCodePointsArray(n)}Buffer.poolSize=8192,Buffer._augment=function(e){return e.__proto__=Buffer.prototype,e},Buffer.from=function(e,t,r){return from(null,e,t,r)},Buffer.TYPED_ARRAY_SUPPORT&&(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array),Buffer.alloc=function(e,t,r){return alloc(null,e,t,r)},Buffer.allocUnsafe=function(e){return allocUnsafe(null,e)},Buffer.allocUnsafeSlow=function(e){return allocUnsafe(null,e)},Buffer.isBuffer=isBuffer,Buffer.compare=function(e,t){if(!internalIsBuffer(e)||!internalIsBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,a=Math.min(r,n);i<a;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},Buffer.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(e,t){if(!isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return Buffer.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=Buffer.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var a=e[r];if(!internalIsBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(n,i),i+=a.length}return n},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)swap(this,t,t+1);return this},Buffer.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)swap(this,t,t+3),swap(this,t+1,t+2);return this},Buffer.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)swap(this,t,t+7),swap(this,t+1,t+6),swap(this,t+2,t+5),swap(this,t+3,t+4);return this},Buffer.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?utf8Slice(this,0,e):slowToString.apply(this,arguments)},Buffer.prototype.equals=function(e){if(!internalIsBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===Buffer.compare(this,e)},Buffer.prototype.inspect=function(){var e="",t=INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},Buffer.prototype.compare=function(e,t,r,n,i){if(!internalIsBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,i>>>=0,this===e)return 0;for(var a=i-n,s=r-t,o=Math.min(a,s),l=this.slice(n,i),u=e.slice(t,r),c=0;c<o;++c)if(l[c]!==u[c]){a=l[c],s=u[c];break}return a<s?-1:s<a?1:0},Buffer.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},Buffer.prototype.indexOf=function(e,t,r){return bidirectionalIndexOf(this,e,t,r,!0)},Buffer.prototype.lastIndexOf=function(e,t,r){return bidirectionalIndexOf(this,e,t,r,!1)},Buffer.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var a=!1;;)switch(n){case"hex":return hexWrite(this,e,t,r);case"utf8":case"utf-8":return utf8Write(this,e,t,r);case"ascii":return asciiWrite(this,e,t,r);case"latin1":case"binary":return latin1Write(this,e,t,r);case"base64":return base64Write(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,e,t,r);default:if(a)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),a=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(e){var t=e.length;if(t<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,e);for(var r="",n=0;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=MAX_ARGUMENTS_LENGTH));return r}function asciiSlice(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function latin1Slice(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function hexSlice(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",a=t;a<r;++a)i+=toHex(e[a]);return i}function utf16leSlice(e,t,r){for(var n=e.slice(t,r),i="",a=0;a<n.length;a+=2)i+=String.fromCharCode(n[a]+256*n[a+1]);return i}function checkOffset(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function checkInt(e,t,r,n,i,a){if(!internalIsBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function objectWriteUInt16(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,a=Math.min(e.length-r,2);i<a;++i)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function objectWriteUInt32(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,a=Math.min(e.length-r,4);i<a;++i)e[r+i]=t>>>8*(n?i:3-i)&255}function checkIEEE754(e,t,r,n,i,a){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function writeFloat(e,t,r,n,i){return i||checkIEEE754(e,t,r,4,3.4028234663852886e38,-3.4028234663852886e38),write(e,t,r,n,23,4),r+4}function writeDouble(e,t,r,n,i){return i||checkIEEE754(e,t,r,8,1.7976931348623157e308,-1.7976931348623157e308),write(e,t,r,n,52,8),r+8}Buffer.prototype.slice=function(e,t){var r,n=this.length;if(e=~~e,t=void 0===t?n:~~t,e<0?(e+=n)<0&&(e=0):e>n&&(e=n),t<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),Buffer.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=Buffer.prototype;else{var i=t-e;r=new Buffer(i,void 0);for(var a=0;a<i;++a)r[a]=this[a+e]}return r},Buffer.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||checkOffset(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return n},Buffer.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||checkOffset(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},Buffer.prototype.readUInt8=function(e,t){return t||checkOffset(e,1,this.length),this[e]},Buffer.prototype.readUInt16LE=function(e,t){return t||checkOffset(e,2,this.length),this[e]|this[e+1]<<8},Buffer.prototype.readUInt16BE=function(e,t){return t||checkOffset(e,2,this.length),this[e]<<8|this[e+1]},Buffer.prototype.readUInt32LE=function(e,t){return t||checkOffset(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},Buffer.prototype.readUInt32BE=function(e,t){return t||checkOffset(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},Buffer.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||checkOffset(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},Buffer.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||checkOffset(e,t,this.length);for(var n=t,i=1,a=this[e+--n];n>0&&(i*=256);)a+=this[e+--n]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*t)),a},Buffer.prototype.readInt8=function(e,t){return t||checkOffset(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},Buffer.prototype.readInt16LE=function(e,t){t||checkOffset(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},Buffer.prototype.readInt16BE=function(e,t){t||checkOffset(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},Buffer.prototype.readInt32LE=function(e,t){return t||checkOffset(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},Buffer.prototype.readInt32BE=function(e,t){return t||checkOffset(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},Buffer.prototype.readFloatLE=function(e,t){return t||checkOffset(e,4,this.length),read(this,e,!0,23,4)},Buffer.prototype.readFloatBE=function(e,t){return t||checkOffset(e,4,this.length),read(this,e,!1,23,4)},Buffer.prototype.readDoubleLE=function(e,t){return t||checkOffset(e,8,this.length),read(this,e,!0,52,8)},Buffer.prototype.readDoubleBE=function(e,t){return t||checkOffset(e,8,this.length),read(this,e,!1,52,8)},Buffer.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||checkInt(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,a=0;for(this[t]=255&e;++a<r&&(i*=256);)this[t+a]=e/i&255;return t+r},Buffer.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||checkInt(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+r},Buffer.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},Buffer.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):objectWriteUInt16(this,e,t,!0),t+2},Buffer.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):objectWriteUInt16(this,e,t,!1),t+2},Buffer.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):objectWriteUInt32(this,e,t,!0),t+4},Buffer.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):objectWriteUInt32(this,e,t,!1),t+4},Buffer.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);checkInt(this,e,t,r,i-1,-i)}var a=0,s=1,o=0;for(this[t]=255&e;++a<r&&(s*=256);)e<0&&0===o&&0!==this[t+a-1]&&(o=1),this[t+a]=(e/s>>0)-o&255;return t+r},Buffer.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);checkInt(this,e,t,r,i-1,-i)}var a=r-1,s=1,o=0;for(this[t+a]=255&e;--a>=0&&(s*=256);)e<0&&0===o&&0!==this[t+a+1]&&(o=1),this[t+a]=(e/s>>0)-o&255;return t+r},Buffer.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},Buffer.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):objectWriteUInt16(this,e,t,!0),t+2},Buffer.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):objectWriteUInt16(this,e,t,!1),t+2},Buffer.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):objectWriteUInt32(this,e,t,!0),t+4},Buffer.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),Buffer.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):objectWriteUInt32(this,e,t,!1),t+4},Buffer.prototype.writeFloatLE=function(e,t,r){return writeFloat(this,e,t,!0,r)},Buffer.prototype.writeFloatBE=function(e,t,r){return writeFloat(this,e,t,!1,r)},Buffer.prototype.writeDoubleLE=function(e,t,r){return writeDouble(this,e,t,!0,r)},Buffer.prototype.writeDoubleBE=function(e,t,r){return writeDouble(this,e,t,!1,r)},Buffer.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,a=n-r;if(this===e&&r<t&&t<n)for(i=a-1;i>=0;--i)e[i+t]=this[i+r];else if(a<1e3||!Buffer.TYPED_ARRAY_SUPPORT)for(i=0;i<a;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+a),t);return a},Buffer.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!Buffer.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var a;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(a=t;a<r;++a)this[a]=e;else{var s=internalIsBuffer(e)?e:utf8ToBytes(new Buffer(e,n).toString()),o=s.length;for(a=0;a<r-t;++a)this[a+t]=s[a%o]}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;function base64clean(e){if((e=stringtrim(e).replace(INVALID_BASE64_RE,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}function stringtrim(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function toHex(e){return e<16?"0"+e.toString(16):e.toString(16)}function utf8ToBytes(e,t){var r;t=t||1/0;for(var n=e.length,i=null,a=[],s=0;s<n;++s){if((r=e.charCodeAt(s))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&a.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&a.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;a.push(r)}else if(r<2048){if((t-=2)<0)break;a.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;a.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return a}function asciiToBytes(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}function utf16leToBytes(e,t){for(var r,n,i,a=[],s=0;s<e.length&&!((t-=2)<0);++s)n=(r=e.charCodeAt(s))>>8,i=r%256,a.push(i),a.push(n);return a}function base64ToBytes(e){return toByteArray(base64clean(e))}function blitBuffer(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function isnan(e){return e!=e}function isBuffer(e){return null!=e&&(!!e._isBuffer||isFastBuffer(e)||isSlowBuffer(e))}function isFastBuffer(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function isSlowBuffer(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&isFastBuffer(e.slice(0,0))}var bufferEs6=Object.freeze({INSPECT_MAX_BYTES:INSPECT_MAX_BYTES,kMaxLength:_kMaxLength,Buffer:Buffer,SlowBuffer:SlowBuffer,isBuffer:isBuffer}),require$$0=empty$1&&empty||empty$1,md5=createCommonjsModule(function(e){!function(){var t="object"===("undefined"==typeof window?"undefined":_typeof(window))?window:{},r=!t.JS_MD5_NO_NODE_JS&&"object"===(void 0===process?"undefined":_typeof(process))&&process.versions&&process.versions.node;r&&(t=commonjsGlobal);var n,i=!t.JS_MD5_NO_COMMON_JS&&e.exports,a=!t.JS_MD5_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,s="0123456789abcdef".split(""),o=[128,32768,8388608,-2147483648],l=[0,8,16,24],u=["hex","array","digest","buffer","arrayBuffer"],c=[];if(a){var h=new ArrayBuffer(68);n=new Uint8Array(h),c=new Uint32Array(h)}var f=function(e){return function(t){return new p(!0).update(t)[e]()}},d=function(e){var t=require$$0,r=bufferEs6.Buffer;return function(n){if("string"==typeof n)return t.createHash("md5").update(n,"utf8").digest("hex");if(n.constructor===ArrayBuffer)n=new Uint8Array(n);else if(void 0===n.length)return e(n);return t.createHash("md5").update(new r(n)).digest("hex")}};function p(e){if(e)c[0]=c[16]=c[1]=c[2]=c[3]=c[4]=c[5]=c[6]=c[7]=c[8]=c[9]=c[10]=c[11]=c[12]=c[13]=c[14]=c[15]=0,this.blocks=c,this.buffer8=n;else if(a){var t=new ArrayBuffer(68);this.buffer8=new Uint8Array(t),this.blocks=new Uint32Array(t)}else this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.h0=this.h1=this.h2=this.h3=this.start=this.bytes=0,this.finalized=this.hashed=!1,this.first=!0}p.prototype.update=function(e){if(!this.finalized){var r="string"!=typeof e;r&&e.constructor==t.ArrayBuffer&&(e=new Uint8Array(e));for(var n,i,s=0,o=e.length||0,u=this.blocks,c=this.buffer8;s<o;){if(this.hashed&&(this.hashed=!1,u[0]=u[16],u[16]=u[1]=u[2]=u[3]=u[4]=u[5]=u[6]=u[7]=u[8]=u[9]=u[10]=u[11]=u[12]=u[13]=u[14]=u[15]=0),r)if(a)for(i=this.start;s<o&&i<64;++s)c[i++]=e[s];else for(i=this.start;s<o&&i<64;++s)u[i>>2]|=e[s]<<l[3&i++];else if(a)for(i=this.start;s<o&&i<64;++s)(n=e.charCodeAt(s))<128?c[i++]=n:n<2048?(c[i++]=192|n>>6,c[i++]=128|63&n):n<55296||n>=57344?(c[i++]=224|n>>12,c[i++]=128|n>>6&63,c[i++]=128|63&n):(n=65536+((1023&n)<<10|1023&e.charCodeAt(++s)),c[i++]=240|n>>18,c[i++]=128|n>>12&63,c[i++]=128|n>>6&63,c[i++]=128|63&n);else for(i=this.start;s<o&&i<64;++s)(n=e.charCodeAt(s))<128?u[i>>2]|=n<<l[3&i++]:n<2048?(u[i>>2]|=(192|n>>6)<<l[3&i++],u[i>>2]|=(128|63&n)<<l[3&i++]):n<55296||n>=57344?(u[i>>2]|=(224|n>>12)<<l[3&i++],u[i>>2]|=(128|n>>6&63)<<l[3&i++],u[i>>2]|=(128|63&n)<<l[3&i++]):(n=65536+((1023&n)<<10|1023&e.charCodeAt(++s)),u[i>>2]|=(240|n>>18)<<l[3&i++],u[i>>2]|=(128|n>>12&63)<<l[3&i++],u[i>>2]|=(128|n>>6&63)<<l[3&i++],u[i>>2]|=(128|63&n)<<l[3&i++]);this.lastByteIndex=i,this.bytes+=i-this.start,i>=64?(this.start=i-64,this.hash(),this.hashed=!0):this.start=i}return this}},p.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[t>>2]|=o[3&t],t>=56&&(this.hashed||this.hash(),e[0]=e[16],e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.bytes<<3,this.hash()}},p.prototype.hash=function(){var e,t,r,n,i,a,s=this.blocks;this.first?t=((t=((e=((e=s[0]-680876937)<<7|e>>>25)-271733879<<0)^(r=((r=(-271733879^(n=((n=(-1732584194^2004318071&e)+s[1]-117830708)<<12|n>>>20)+e<<0)&(-271733879^e))+s[2]-1126478375)<<17|r>>>15)+n<<0)&(n^e))+s[3]-1316259209)<<22|t>>>10)+r<<0:(e=this.h0,t=this.h1,r=this.h2,t=((t+=((e=((e+=((n=this.h3)^t&(r^n))+s[0]-680876936)<<7|e>>>25)+t<<0)^(r=((r+=(t^(n=((n+=(r^e&(t^r))+s[1]-389564586)<<12|n>>>20)+e<<0)&(e^t))+s[2]+606105819)<<17|r>>>15)+n<<0)&(n^e))+s[3]-1044525330)<<22|t>>>10)+r<<0),t=((t+=((e=((e+=(n^t&(r^n))+s[4]-176418897)<<7|e>>>25)+t<<0)^(r=((r+=(t^(n=((n+=(r^e&(t^r))+s[5]+1200080426)<<12|n>>>20)+e<<0)&(e^t))+s[6]-1473231341)<<17|r>>>15)+n<<0)&(n^e))+s[7]-45705983)<<22|t>>>10)+r<<0,t=((t+=((e=((e+=(n^t&(r^n))+s[8]+1770035416)<<7|e>>>25)+t<<0)^(r=((r+=(t^(n=((n+=(r^e&(t^r))+s[9]-1958414417)<<12|n>>>20)+e<<0)&(e^t))+s[10]-42063)<<17|r>>>15)+n<<0)&(n^e))+s[11]-1990404162)<<22|t>>>10)+r<<0,t=((t+=((e=((e+=(n^t&(r^n))+s[12]+1804603682)<<7|e>>>25)+t<<0)^(r=((r+=(t^(n=((n+=(r^e&(t^r))+s[13]-40341101)<<12|n>>>20)+e<<0)&(e^t))+s[14]-1502002290)<<17|r>>>15)+n<<0)&(n^e))+s[15]+1236535329)<<22|t>>>10)+r<<0,t=((t+=((n=((n+=(t^r&((e=((e+=(r^n&(t^r))+s[1]-165796510)<<5|e>>>27)+t<<0)^t))+s[6]-1069501632)<<9|n>>>23)+e<<0)^e&((r=((r+=(e^t&(n^e))+s[11]+643717713)<<14|r>>>18)+n<<0)^n))+s[0]-373897302)<<20|t>>>12)+r<<0,t=((t+=((n=((n+=(t^r&((e=((e+=(r^n&(t^r))+s[5]-701558691)<<5|e>>>27)+t<<0)^t))+s[10]+38016083)<<9|n>>>23)+e<<0)^e&((r=((r+=(e^t&(n^e))+s[15]-660478335)<<14|r>>>18)+n<<0)^n))+s[4]-405537848)<<20|t>>>12)+r<<0,t=((t+=((n=((n+=(t^r&((e=((e+=(r^n&(t^r))+s[9]+568446438)<<5|e>>>27)+t<<0)^t))+s[14]-1019803690)<<9|n>>>23)+e<<0)^e&((r=((r+=(e^t&(n^e))+s[3]-187363961)<<14|r>>>18)+n<<0)^n))+s[8]+1163531501)<<20|t>>>12)+r<<0,t=((t+=((n=((n+=(t^r&((e=((e+=(r^n&(t^r))+s[13]-1444681467)<<5|e>>>27)+t<<0)^t))+s[2]-51403784)<<9|n>>>23)+e<<0)^e&((r=((r+=(e^t&(n^e))+s[7]+1735328473)<<14|r>>>18)+n<<0)^n))+s[12]-1926607734)<<20|t>>>12)+r<<0,t=((t+=((a=(n=((n+=((i=t^r)^(e=((e+=(i^n)+s[5]-378558)<<4|e>>>28)+t<<0))+s[8]-2022574463)<<11|n>>>21)+e<<0)^e)^(r=((r+=(a^t)+s[11]+1839030562)<<16|r>>>16)+n<<0))+s[14]-35309556)<<23|t>>>9)+r<<0,t=((t+=((a=(n=((n+=((i=t^r)^(e=((e+=(i^n)+s[1]-1530992060)<<4|e>>>28)+t<<0))+s[4]+1272893353)<<11|n>>>21)+e<<0)^e)^(r=((r+=(a^t)+s[7]-155497632)<<16|r>>>16)+n<<0))+s[10]-1094730640)<<23|t>>>9)+r<<0,t=((t+=((a=(n=((n+=((i=t^r)^(e=((e+=(i^n)+s[13]+681279174)<<4|e>>>28)+t<<0))+s[0]-358537222)<<11|n>>>21)+e<<0)^e)^(r=((r+=(a^t)+s[3]-722521979)<<16|r>>>16)+n<<0))+s[6]+76029189)<<23|t>>>9)+r<<0,t=((t+=((a=(n=((n+=((i=t^r)^(e=((e+=(i^n)+s[9]-640364487)<<4|e>>>28)+t<<0))+s[12]-421815835)<<11|n>>>21)+e<<0)^e)^(r=((r+=(a^t)+s[15]+530742520)<<16|r>>>16)+n<<0))+s[2]-995338651)<<23|t>>>9)+r<<0,t=((t+=((n=((n+=(t^((e=((e+=(r^(t|~n))+s[0]-198630844)<<6|e>>>26)+t<<0)|~r))+s[7]+1126891415)<<10|n>>>22)+e<<0)^((r=((r+=(e^(n|~t))+s[14]-1416354905)<<15|r>>>17)+n<<0)|~e))+s[5]-57434055)<<21|t>>>11)+r<<0,t=((t+=((n=((n+=(t^((e=((e+=(r^(t|~n))+s[12]+1700485571)<<6|e>>>26)+t<<0)|~r))+s[3]-1894986606)<<10|n>>>22)+e<<0)^((r=((r+=(e^(n|~t))+s[10]-1051523)<<15|r>>>17)+n<<0)|~e))+s[1]-2054922799)<<21|t>>>11)+r<<0,t=((t+=((n=((n+=(t^((e=((e+=(r^(t|~n))+s[8]+1873313359)<<6|e>>>26)+t<<0)|~r))+s[15]-30611744)<<10|n>>>22)+e<<0)^((r=((r+=(e^(n|~t))+s[6]-1560198380)<<15|r>>>17)+n<<0)|~e))+s[13]+1309151649)<<21|t>>>11)+r<<0,t=((t+=((n=((n+=(t^((e=((e+=(r^(t|~n))+s[4]-145523070)<<6|e>>>26)+t<<0)|~r))+s[11]-1120210379)<<10|n>>>22)+e<<0)^((r=((r+=(e^(n|~t))+s[2]+718787259)<<15|r>>>17)+n<<0)|~e))+s[9]-343485551)<<21|t>>>11)+r<<0,this.first?(this.h0=e+1732584193<<0,this.h1=t-271733879<<0,this.h2=r-1732584194<<0,this.h3=n+271733878<<0,this.first=!1):(this.h0=this.h0+e<<0,this.h1=this.h1+t<<0,this.h2=this.h2+r<<0,this.h3=this.h3+n<<0)},p.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,n=this.h3;return s[e>>4&15]+s[15&e]+s[e>>12&15]+s[e>>8&15]+s[e>>20&15]+s[e>>16&15]+s[e>>28&15]+s[e>>24&15]+s[t>>4&15]+s[15&t]+s[t>>12&15]+s[t>>8&15]+s[t>>20&15]+s[t>>16&15]+s[t>>28&15]+s[t>>24&15]+s[r>>4&15]+s[15&r]+s[r>>12&15]+s[r>>8&15]+s[r>>20&15]+s[r>>16&15]+s[r>>28&15]+s[r>>24&15]+s[n>>4&15]+s[15&n]+s[n>>12&15]+s[n>>8&15]+s[n>>20&15]+s[n>>16&15]+s[n>>28&15]+s[n>>24&15]},p.prototype.toString=p.prototype.hex,p.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,n=this.h3;return[255&e,e>>8&255,e>>16&255,e>>24&255,255&t,t>>8&255,t>>16&255,t>>24&255,255&r,r>>8&255,r>>16&255,r>>24&255,255&n,n>>8&255,n>>16&255,n>>24&255]},p.prototype.array=p.prototype.digest,p.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(16),t=new Uint32Array(e);return t[0]=this.h0,t[1]=this.h1,t[2]=this.h2,t[3]=this.h3,e},p.prototype.buffer=p.prototype.arrayBuffer;var g=function(){var e=f("hex");r&&(e=d(e)),e.create=function(){return new p},e.update=function(t){return e.create().update(t)};for(var t=0;t<u.length;++t){var n=u[t];e[n]=f(n)}return e}();i?e.exports=g:t.md5=g}()}),common=createCommonjsModule(function(e,t){var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!==(void 0===r?"undefined":_typeof(r)))throw new TypeError(r+"must be non-object");for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var n={arraySet:function(e,t,r,n,i){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+n),i);else for(var a=0;a<n;a++)e[i+a]=t[r+a]},flattenChunks:function(e){var t,r,n,i,a,s;for(n=0,t=0,r=e.length;t<r;t++)n+=e[t].length;for(s=new Uint8Array(n),i=0,t=0,r=e.length;t<r;t++)a=e[t],s.set(a,i),i+=a.length;return s}},i={arraySet:function(e,t,r,n,i){for(var a=0;a<n;a++)e[i+a]=t[r+a]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,n)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,i))},t.setTyped(r)}),common_1=common.assign,common_2=common.shrinkBuf,common_3=common.setTyped,common_4=common.Buf8,common_5=common.Buf16,common_6=common.Buf32,Z_FIXED=4,Z_BINARY=0,Z_TEXT=1,Z_UNKNOWN=2;function zero(e){for(var t=e.length;--t>=0;)e[t]=0}var STORED_BLOCK=0,STATIC_TREES=1,DYN_TREES=2,MIN_MATCH=3,MAX_MATCH=258,LENGTH_CODES=29,LITERALS=256,L_CODES=LITERALS+1+LENGTH_CODES,D_CODES=30,BL_CODES=19,HEAP_SIZE=2*L_CODES+1,MAX_BITS=15,Buf_size=16,MAX_BL_BITS=7,END_BLOCK=256,REP_3_6=16,REPZ_3_10=17,REPZ_11_138=18,extra_lbits=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],extra_dbits=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],extra_blbits=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],bl_order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],DIST_CODE_LEN=512,static_ltree=new Array(2*(L_CODES+2));zero(static_ltree);var static_dtree=new Array(2*D_CODES);zero(static_dtree);var _dist_code=new Array(DIST_CODE_LEN);zero(_dist_code);var _length_code=new Array(MAX_MATCH-MIN_MATCH+1);zero(_length_code);var base_length=new Array(LENGTH_CODES);zero(base_length);var base_dist=new Array(D_CODES),static_l_desc,static_d_desc,static_bl_desc;function StaticTreeDesc(e,t,r,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=e&&e.length}function TreeDesc(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function d_code(e){return e<256?_dist_code[e]:_dist_code[256+(e>>>7)]}function put_short(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function send_bits(e,t,r){e.bi_valid>Buf_size-r?(e.bi_buf|=t<<e.bi_valid&65535,put_short(e,e.bi_buf),e.bi_buf=t>>Buf_size-e.bi_valid,e.bi_valid+=r-Buf_size):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function send_code(e,t,r){send_bits(e,r[2*t],r[2*t+1])}function bi_reverse(e,t){var r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1}function bi_flush(e){16===e.bi_valid?(put_short(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}function gen_bitlen(e,t){var r,n,i,a,s,o,l=t.dyn_tree,u=t.max_code,c=t.stat_desc.static_tree,h=t.stat_desc.has_stree,f=t.stat_desc.extra_bits,d=t.stat_desc.extra_base,p=t.stat_desc.max_length,g=0;for(a=0;a<=MAX_BITS;a++)e.bl_count[a]=0;for(l[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;r<HEAP_SIZE;r++)(a=l[2*l[2*(n=e.heap[r])+1]+1]+1)>p&&(a=p,g++),l[2*n+1]=a,n>u||(e.bl_count[a]++,s=0,n>=d&&(s=f[n-d]),o=l[2*n],e.opt_len+=o*(a+s),h&&(e.static_len+=o*(c[2*n+1]+s)));if(0!==g){do{for(a=p-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[p]--,g-=2}while(g>0);for(a=p;0!==a;a--)for(n=e.bl_count[a];0!==n;)(i=e.heap[--r])>u||(l[2*i+1]!==a&&(e.opt_len+=(a-l[2*i+1])*l[2*i],l[2*i+1]=a),n--)}}function gen_codes(e,t,r){var n,i,a=new Array(MAX_BITS+1),s=0;for(n=1;n<=MAX_BITS;n++)a[n]=s=s+r[n-1]<<1;for(i=0;i<=t;i++){var o=e[2*i+1];0!==o&&(e[2*i]=bi_reverse(a[o]++,o))}}function tr_static_init(){var e,t,r,n,i,a=new Array(MAX_BITS+1);for(r=0,n=0;n<LENGTH_CODES-1;n++)for(base_length[n]=r,e=0;e<1<<extra_lbits[n];e++)_length_code[r++]=n;for(_length_code[r-1]=n,i=0,n=0;n<16;n++)for(base_dist[n]=i,e=0;e<1<<extra_dbits[n];e++)_dist_code[i++]=n;for(i>>=7;n<D_CODES;n++)for(base_dist[n]=i<<7,e=0;e<1<<extra_dbits[n]-7;e++)_dist_code[256+i++]=n;for(t=0;t<=MAX_BITS;t++)a[t]=0;for(e=0;e<=143;)static_ltree[2*e+1]=8,e++,a[8]++;for(;e<=255;)static_ltree[2*e+1]=9,e++,a[9]++;for(;e<=279;)static_ltree[2*e+1]=7,e++,a[7]++;for(;e<=287;)static_ltree[2*e+1]=8,e++,a[8]++;for(gen_codes(static_ltree,L_CODES+1,a),e=0;e<D_CODES;e++)static_dtree[2*e+1]=5,static_dtree[2*e]=bi_reverse(e,5);static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS+1,L_CODES,MAX_BITS),static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES,MAX_BITS),static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES,MAX_BL_BITS)}function init_block(e){var t;for(t=0;t<L_CODES;t++)e.dyn_ltree[2*t]=0;for(t=0;t<D_CODES;t++)e.dyn_dtree[2*t]=0;for(t=0;t<BL_CODES;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*END_BLOCK]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function bi_windup(e){e.bi_valid>8?put_short(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function copy_block(e,t,r,n){bi_windup(e),n&&(put_short(e,r),put_short(e,~r)),common.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}function smaller(e,t,r,n){var i=2*t,a=2*r;return e[i]<e[a]||e[i]===e[a]&&n[t]<=n[r]}function pqdownheap(e,t,r){for(var n=e.heap[r],i=r<<1;i<=e.heap_len&&(i<e.heap_len&&smaller(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!smaller(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n}function compress_block(e,t,r){var n,i,a,s,o=0;if(0!==e.last_lit)do{n=e.pending_buf[e.d_buf+2*o]<<8|e.pending_buf[e.d_buf+2*o+1],i=e.pending_buf[e.l_buf+o],o++,0===n?send_code(e,i,t):(send_code(e,(a=_length_code[i])+LITERALS+1,t),0!==(s=extra_lbits[a])&&send_bits(e,i-=base_length[a],s),send_code(e,a=d_code(--n),r),0!==(s=extra_dbits[a])&&send_bits(e,n-=base_dist[a],s))}while(o<e.last_lit);send_code(e,END_BLOCK,t)}function build_tree(e,t){var r,n,i,a=t.dyn_tree,s=t.stat_desc.static_tree,o=t.stat_desc.has_stree,l=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=HEAP_SIZE,r=0;r<l;r++)0!==a[2*r]?(e.heap[++e.heap_len]=u=r,e.depth[r]=0):a[2*r+1]=0;for(;e.heap_len<2;)a[2*(i=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[i]=0,e.opt_len--,o&&(e.static_len-=s[2*i+1]);for(t.max_code=u,r=e.heap_len>>1;r>=1;r--)pqdownheap(e,a,r);i=l;do{r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],pqdownheap(e,a,1),n=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=n,a[2*i]=a[2*r]+a[2*n],e.depth[i]=(e.depth[r]>=e.depth[n]?e.depth[r]:e.depth[n])+1,a[2*r+1]=a[2*n+1]=i,e.heap[1]=i++,pqdownheap(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],gen_bitlen(e,t),gen_codes(a,u,e.bl_count)}function scan_tree(e,t,r){var n,i,a=-1,s=t[1],o=0,l=7,u=4;for(0===s&&(l=138,u=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)i=s,s=t[2*(n+1)+1],++o<l&&i===s||(o<u?e.bl_tree[2*i]+=o:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[2*REP_3_6]++):o<=10?e.bl_tree[2*REPZ_3_10]++:e.bl_tree[2*REPZ_11_138]++,o=0,a=i,0===s?(l=138,u=3):i===s?(l=6,u=3):(l=7,u=4))}function send_tree(e,t,r){var n,i,a=-1,s=t[1],o=0,l=7,u=4;for(0===s&&(l=138,u=3),n=0;n<=r;n++)if(i=s,s=t[2*(n+1)+1],!(++o<l&&i===s)){if(o<u)do{send_code(e,i,e.bl_tree)}while(0!=--o);else 0!==i?(i!==a&&(send_code(e,i,e.bl_tree),o--),send_code(e,REP_3_6,e.bl_tree),send_bits(e,o-3,2)):o<=10?(send_code(e,REPZ_3_10,e.bl_tree),send_bits(e,o-3,3)):(send_code(e,REPZ_11_138,e.bl_tree),send_bits(e,o-11,7));o=0,a=i,0===s?(l=138,u=3):i===s?(l=6,u=3):(l=7,u=4)}}function build_bl_tree(e){var t;for(scan_tree(e,e.dyn_ltree,e.l_desc.max_code),scan_tree(e,e.dyn_dtree,e.d_desc.max_code),build_tree(e,e.bl_desc),t=BL_CODES-1;t>=3&&0===e.bl_tree[2*bl_order[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}function send_all_trees(e,t,r,n){var i;for(send_bits(e,t-257,5),send_bits(e,r-1,5),send_bits(e,n-4,4),i=0;i<n;i++)send_bits(e,e.bl_tree[2*bl_order[i]+1],3);send_tree(e,e.dyn_ltree,t-1),send_tree(e,e.dyn_dtree,r-1)}function detect_data_type(e){var t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return Z_BINARY;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return Z_TEXT;for(t=32;t<LITERALS;t++)if(0!==e.dyn_ltree[2*t])return Z_TEXT;return Z_BINARY}zero(base_dist);var static_init_done=!1;function _tr_init(e){static_init_done||(tr_static_init(),static_init_done=!0),e.l_desc=new TreeDesc(e.dyn_ltree,static_l_desc),e.d_desc=new TreeDesc(e.dyn_dtree,static_d_desc),e.bl_desc=new TreeDesc(e.bl_tree,static_bl_desc),e.bi_buf=0,e.bi_valid=0,init_block(e)}function _tr_stored_block(e,t,r,n){send_bits(e,(STORED_BLOCK<<1)+(n?1:0),3),copy_block(e,t,r,!0)}function _tr_align(e){send_bits(e,STATIC_TREES<<1,3),send_code(e,END_BLOCK,static_ltree),bi_flush(e)}function _tr_flush_block(e,t,r,n){var i,a,s=0;e.level>0?(e.strm.data_type===Z_UNKNOWN&&(e.strm.data_type=detect_data_type(e)),build_tree(e,e.l_desc),build_tree(e,e.d_desc),s=build_bl_tree(e),i=e.opt_len+3+7>>>3,(a=e.static_len+3+7>>>3)<=i&&(i=a)):i=a=r+5,r+4<=i&&-1!==t?_tr_stored_block(e,t,r,n):e.strategy===Z_FIXED||a===i?(send_bits(e,(STATIC_TREES<<1)+(n?1:0),3),compress_block(e,static_ltree,static_dtree)):(send_bits(e,(DYN_TREES<<1)+(n?1:0),3),send_all_trees(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),compress_block(e,e.dyn_ltree,e.dyn_dtree)),init_block(e),n&&bi_windup(e)}function _tr_tally(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(_length_code[r]+LITERALS+1)]++,e.dyn_dtree[2*d_code(t)]++),e.last_lit===e.lit_bufsize-1}var _tr_init_1=_tr_init,_tr_stored_block_1=_tr_stored_block,_tr_flush_block_1=_tr_flush_block,_tr_tally_1=_tr_tally,_tr_align_1=_tr_align,trees={_tr_init:_tr_init_1,_tr_stored_block:_tr_stored_block_1,_tr_flush_block:_tr_flush_block_1,_tr_tally:_tr_tally_1,_tr_align:_tr_align_1};function adler32(e,t,r,n){for(var i=65535&e|0,a=e>>>16&65535|0,s=0;0!==r;){r-=s=r>2e3?2e3:r;do{a=a+(i=i+t[n++]|0)|0}while(--s);i%=65521,a%=65521}return i|a<<16|0}var adler32_1=adler32;function makeTable(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}var crcTable=makeTable();function crc32(e,t,r,n){var i=crcTable,a=n+r;e^=-1;for(var s=n;s<a;s++)e=e>>>8^i[255&(e^t[s])];return-1^e}var crc32_1=crc32,messages={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Z_NO_FLUSH=0,Z_PARTIAL_FLUSH=1,Z_FULL_FLUSH=3,Z_FINISH=4,Z_BLOCK=5,Z_OK=0,Z_STREAM_END=1,Z_STREAM_ERROR=-2,Z_DATA_ERROR=-3,Z_BUF_ERROR=-5,Z_DEFAULT_COMPRESSION=-1,Z_FILTERED=1,Z_HUFFMAN_ONLY=2,Z_RLE=3,Z_FIXED$1=4,Z_DEFAULT_STRATEGY=0,Z_UNKNOWN$1=2,Z_DEFLATED=8,MAX_MEM_LEVEL=9,MAX_WBITS=15,DEF_MEM_LEVEL=8,LENGTH_CODES$1=29,LITERALS$1=256,L_CODES$1=LITERALS$1+1+LENGTH_CODES$1,D_CODES$1=30,BL_CODES$1=19,HEAP_SIZE$1=2*L_CODES$1+1,MAX_BITS$1=15,MIN_MATCH$1=3,MAX_MATCH$1=258,MIN_LOOKAHEAD=MAX_MATCH$1+MIN_MATCH$1+1,PRESET_DICT=32,INIT_STATE=42,EXTRA_STATE=69,NAME_STATE=73,COMMENT_STATE=91,HCRC_STATE=103,BUSY_STATE=113,FINISH_STATE=666,BS_NEED_MORE=1,BS_BLOCK_DONE=2,BS_FINISH_STARTED=3,BS_FINISH_DONE=4,OS_CODE=3,configuration_table;function err(e,t){return e.msg=messages[t],t}function rank(e){return(e<<1)-(e>4?9:0)}function zero$1(e){for(var t=e.length;--t>=0;)e[t]=0}function flush_pending(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(common.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function flush_block_only(e,t){trees._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,flush_pending(e.strm)}function put_byte(e,t){e.pending_buf[e.pending++]=t}function putShortMSB(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function read_buf(e,t,r,n){var i=e.avail_in;return i>n&&(i=n),0===i?0:(e.avail_in-=i,common.arraySet(t,e.input,e.next_in,i,r),1===e.state.wrap?e.adler=adler32_1(e.adler,t,i,r):2===e.state.wrap&&(e.adler=crc32_1(e.adler,t,i,r)),e.next_in+=i,e.total_in+=i,i)}function longest_match(e,t){var r,n,i=e.max_chain_length,a=e.strstart,s=e.prev_length,o=e.nice_match,l=e.strstart>e.w_size-MIN_LOOKAHEAD?e.strstart-(e.w_size-MIN_LOOKAHEAD):0,u=e.window,c=e.w_mask,h=e.prev,f=e.strstart+MAX_MATCH$1,d=u[a+s-1],p=u[a+s];e.prev_length>=e.good_match&&(i>>=2),o>e.lookahead&&(o=e.lookahead);do{if(u[(r=t)+s]===p&&u[r+s-1]===d&&u[r]===u[a]&&u[++r]===u[a+1]){a+=2,r++;do{}while(u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&a<f);if(n=MAX_MATCH$1-(f-a),a=f-MAX_MATCH$1,n>s){if(e.match_start=t,s=n,n>=o)break;d=u[a+s-1],p=u[a+s]}}}while((t=h[t&c])>l&&0!=--i);return s<=e.lookahead?s:e.lookahead}function fill_window(e){var t,r,n,i,a,s=e.w_size;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=s+(s-MIN_LOOKAHEAD)){common.arraySet(e.window,e.window,s,s,0),e.match_start-=s,e.strstart-=s,e.block_start-=s,t=r=e.hash_size;do{n=e.head[--t],e.head[t]=n>=s?n-s:0}while(--r);t=r=s;do{n=e.prev[--t],e.prev[t]=n>=s?n-s:0}while(--r);i+=s}if(0===e.strm.avail_in)break;if(r=read_buf(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=r,e.lookahead+e.insert>=MIN_MATCH$1)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+MIN_MATCH$1-1])&e.hash_mask,e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<MIN_MATCH$1)););}while(e.lookahead<MIN_LOOKAHEAD&&0!==e.strm.avail_in)}function deflate_stored(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(fill_window(e),0===e.lookahead&&t===Z_NO_FLUSH)return BS_NEED_MORE;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+r;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE;if(e.strstart-e.block_start>=e.w_size-MIN_LOOKAHEAD&&(flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE}return e.insert=0,t===Z_FINISH?(flush_block_only(e,!0),0===e.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):(e.strstart>e.block_start&&(flush_block_only(e,!1),e.strm.avail_out),BS_NEED_MORE)}function deflate_fast(e,t){for(var r,n;;){if(e.lookahead<MIN_LOOKAHEAD){if(fill_window(e),e.lookahead<MIN_LOOKAHEAD&&t===Z_NO_FLUSH)return BS_NEED_MORE;if(0===e.lookahead)break}if(r=0,e.lookahead>=MIN_MATCH$1&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+MIN_MATCH$1-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-MIN_LOOKAHEAD&&(e.match_length=longest_match(e,r)),e.match_length>=MIN_MATCH$1)if(n=trees._tr_tally(e,e.strstart-e.match_start,e.match_length-MIN_MATCH$1),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=MIN_MATCH$1){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+MIN_MATCH$1-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=trees._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE}return e.insert=e.strstart<MIN_MATCH$1-1?e.strstart:MIN_MATCH$1-1,t===Z_FINISH?(flush_block_only(e,!0),0===e.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):e.last_lit&&(flush_block_only(e,!1),0===e.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}function deflate_slow(e,t){for(var r,n,i;;){if(e.lookahead<MIN_LOOKAHEAD){if(fill_window(e),e.lookahead<MIN_LOOKAHEAD&&t===Z_NO_FLUSH)return BS_NEED_MORE;if(0===e.lookahead)break}if(r=0,e.lookahead>=MIN_MATCH$1&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+MIN_MATCH$1-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=MIN_MATCH$1-1,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-MIN_LOOKAHEAD&&(e.match_length=longest_match(e,r),e.match_length<=5&&(e.strategy===Z_FILTERED||e.match_length===MIN_MATCH$1&&e.strstart-e.match_start>4096)&&(e.match_length=MIN_MATCH$1-1)),e.prev_length>=MIN_MATCH$1&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-MIN_MATCH$1,n=trees._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-MIN_MATCH$1),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+MIN_MATCH$1-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=MIN_MATCH$1-1,e.strstart++,n&&(flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE}else if(e.match_available){if((n=trees._tr_tally(e,0,e.window[e.strstart-1]))&&flush_block_only(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return BS_NEED_MORE}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=trees._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<MIN_MATCH$1-1?e.strstart:MIN_MATCH$1-1,t===Z_FINISH?(flush_block_only(e,!0),0===e.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):e.last_lit&&(flush_block_only(e,!1),0===e.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}function deflate_rle(e,t){for(var r,n,i,a,s=e.window;;){if(e.lookahead<=MAX_MATCH$1){if(fill_window(e),e.lookahead<=MAX_MATCH$1&&t===Z_NO_FLUSH)return BS_NEED_MORE;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=MIN_MATCH$1&&e.strstart>0&&(n=s[i=e.strstart-1])===s[++i]&&n===s[++i]&&n===s[++i]){a=e.strstart+MAX_MATCH$1;do{}while(n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&i<a);e.match_length=MAX_MATCH$1-(a-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=MIN_MATCH$1?(r=trees._tr_tally(e,1,e.match_length-MIN_MATCH$1),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=trees._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE}return e.insert=0,t===Z_FINISH?(flush_block_only(e,!0),0===e.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):e.last_lit&&(flush_block_only(e,!1),0===e.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}function deflate_huff(e,t){for(var r;;){if(0===e.lookahead&&(fill_window(e),0===e.lookahead)){if(t===Z_NO_FLUSH)return BS_NEED_MORE;break}if(e.match_length=0,r=trees._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE}return e.insert=0,t===Z_FINISH?(flush_block_only(e,!0),0===e.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):e.last_lit&&(flush_block_only(e,!1),0===e.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}function Config(e,t,r,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=i}function lm_init(e){e.window_size=2*e.w_size,zero$1(e.head),e.max_lazy_match=configuration_table[e.level].max_lazy,e.good_match=configuration_table[e.level].good_length,e.nice_match=configuration_table[e.level].nice_length,e.max_chain_length=configuration_table[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=MIN_MATCH$1-1,e.match_available=0,e.ins_h=0}function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z_DEFLATED,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new common.Buf16(2*HEAP_SIZE$1),this.dyn_dtree=new common.Buf16(2*(2*D_CODES$1+1)),this.bl_tree=new common.Buf16(2*(2*BL_CODES$1+1)),zero$1(this.dyn_ltree),zero$1(this.dyn_dtree),zero$1(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new common.Buf16(MAX_BITS$1+1),this.heap=new common.Buf16(2*L_CODES$1+1),zero$1(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new common.Buf16(2*L_CODES$1+1),zero$1(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function deflateResetKeep(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=Z_UNKNOWN$1,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?INIT_STATE:BUSY_STATE,e.adler=2===t.wrap?0:1,t.last_flush=Z_NO_FLUSH,trees._tr_init(t),Z_OK):err(e,Z_STREAM_ERROR)}function deflateReset(e){var t=deflateResetKeep(e);return t===Z_OK&&lm_init(e.state),t}function deflateSetHeader(e,t){return e&&e.state?2!==e.state.wrap?Z_STREAM_ERROR:(e.state.gzhead=t,Z_OK):Z_STREAM_ERROR}function deflateInit2(e,t,r,n,i,a){if(!e)return Z_STREAM_ERROR;var s=1;if(t===Z_DEFAULT_COMPRESSION&&(t=6),n<0?(s=0,n=-n):n>15&&(s=2,n-=16),i<1||i>MAX_MEM_LEVEL||r!==Z_DEFLATED||n<8||n>15||t<0||t>9||a<0||a>Z_FIXED$1)return err(e,Z_STREAM_ERROR);8===n&&(n=9);var o=new DeflateState;return e.state=o,o.strm=e,o.wrap=s,o.gzhead=null,o.w_bits=n,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=i+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+MIN_MATCH$1-1)/MIN_MATCH$1),o.window=new common.Buf8(2*o.w_size),o.head=new common.Buf16(o.hash_size),o.prev=new common.Buf16(o.w_size),o.lit_bufsize=1<<i+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new common.Buf8(o.pending_buf_size),o.d_buf=1*o.lit_bufsize,o.l_buf=3*o.lit_bufsize,o.level=t,o.strategy=a,o.method=r,deflateReset(e)}function deflateInit(e,t){return deflateInit2(e,t,Z_DEFLATED,MAX_WBITS,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY)}function deflate(e,t){var r,n,i,a;if(!e||!e.state||t>Z_BLOCK||t<0)return e?err(e,Z_STREAM_ERROR):Z_STREAM_ERROR;if(n=e.state,!e.output||!e.input&&0!==e.avail_in||n.status===FINISH_STATE&&t!==Z_FINISH)return err(e,0===e.avail_out?Z_BUF_ERROR:Z_STREAM_ERROR);if(n.strm=e,r=n.last_flush,n.last_flush=t,n.status===INIT_STATE)if(2===n.wrap)e.adler=0,put_byte(n,31),put_byte(n,139),put_byte(n,8),n.gzhead?(put_byte(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),put_byte(n,255&n.gzhead.time),put_byte(n,n.gzhead.time>>8&255),put_byte(n,n.gzhead.time>>16&255),put_byte(n,n.gzhead.time>>24&255),put_byte(n,9===n.level?2:n.strategy>=Z_HUFFMAN_ONLY||n.level<2?4:0),put_byte(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(put_byte(n,255&n.gzhead.extra.length),put_byte(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=crc32_1(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=EXTRA_STATE):(put_byte(n,0),put_byte(n,0),put_byte(n,0),put_byte(n,0),put_byte(n,0),put_byte(n,9===n.level?2:n.strategy>=Z_HUFFMAN_ONLY||n.level<2?4:0),put_byte(n,OS_CODE),n.status=BUSY_STATE);else{var s=Z_DEFLATED+(n.w_bits-8<<4)<<8;s|=(n.strategy>=Z_HUFFMAN_ONLY||n.level<2?0:n.level<6?1:6===n.level?2:3)<<6,0!==n.strstart&&(s|=PRESET_DICT),s+=31-s%31,n.status=BUSY_STATE,putShortMSB(n,s),0!==n.strstart&&(putShortMSB(n,e.adler>>>16),putShortMSB(n,65535&e.adler)),e.adler=1}if(n.status===EXTRA_STATE)if(n.gzhead.extra){for(i=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>i&&(e.adler=crc32_1(e.adler,n.pending_buf,n.pending-i,i)),flush_pending(e),i=n.pending,n.pending!==n.pending_buf_size));)put_byte(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>i&&(e.adler=crc32_1(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=NAME_STATE)}else n.status=NAME_STATE;if(n.status===NAME_STATE)if(n.gzhead.name){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(e.adler=crc32_1(e.adler,n.pending_buf,n.pending-i,i)),flush_pending(e),i=n.pending,n.pending===n.pending_buf_size)){a=1;break}a=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,put_byte(n,a)}while(0!==a);n.gzhead.hcrc&&n.pending>i&&(e.adler=crc32_1(e.adler,n.pending_buf,n.pending-i,i)),0===a&&(n.gzindex=0,n.status=COMMENT_STATE)}else n.status=COMMENT_STATE;if(n.status===COMMENT_STATE)if(n.gzhead.comment){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(e.adler=crc32_1(e.adler,n.pending_buf,n.pending-i,i)),flush_pending(e),i=n.pending,n.pending===n.pending_buf_size)){a=1;break}a=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,put_byte(n,a)}while(0!==a);n.gzhead.hcrc&&n.pending>i&&(e.adler=crc32_1(e.adler,n.pending_buf,n.pending-i,i)),0===a&&(n.status=HCRC_STATE)}else n.status=HCRC_STATE;if(n.status===HCRC_STATE&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&flush_pending(e),n.pending+2<=n.pending_buf_size&&(put_byte(n,255&e.adler),put_byte(n,e.adler>>8&255),e.adler=0,n.status=BUSY_STATE)):n.status=BUSY_STATE),0!==n.pending){if(flush_pending(e),0===e.avail_out)return n.last_flush=-1,Z_OK}else if(0===e.avail_in&&rank(t)<=rank(r)&&t!==Z_FINISH)return err(e,Z_BUF_ERROR);if(n.status===FINISH_STATE&&0!==e.avail_in)return err(e,Z_BUF_ERROR);if(0!==e.avail_in||0!==n.lookahead||t!==Z_NO_FLUSH&&n.status!==FINISH_STATE){var o=n.strategy===Z_HUFFMAN_ONLY?deflate_huff(n,t):n.strategy===Z_RLE?deflate_rle(n,t):configuration_table[n.level].func(n,t);if(o!==BS_FINISH_STARTED&&o!==BS_FINISH_DONE||(n.status=FINISH_STATE),o===BS_NEED_MORE||o===BS_FINISH_STARTED)return 0===e.avail_out&&(n.last_flush=-1),Z_OK;if(o===BS_BLOCK_DONE&&(t===Z_PARTIAL_FLUSH?trees._tr_align(n):t!==Z_BLOCK&&(trees._tr_stored_block(n,0,0,!1),t===Z_FULL_FLUSH&&(zero$1(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),flush_pending(e),0===e.avail_out))return n.last_flush=-1,Z_OK}return t!==Z_FINISH?Z_OK:n.wrap<=0?Z_STREAM_END:(2===n.wrap?(put_byte(n,255&e.adler),put_byte(n,e.adler>>8&255),put_byte(n,e.adler>>16&255),put_byte(n,e.adler>>24&255),put_byte(n,255&e.total_in),put_byte(n,e.total_in>>8&255),put_byte(n,e.total_in>>16&255),put_byte(n,e.total_in>>24&255)):(putShortMSB(n,e.adler>>>16),putShortMSB(n,65535&e.adler)),flush_pending(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?Z_OK:Z_STREAM_END)}function deflateEnd(e){var t;return e&&e.state?(t=e.state.status)!==INIT_STATE&&t!==EXTRA_STATE&&t!==NAME_STATE&&t!==COMMENT_STATE&&t!==HCRC_STATE&&t!==BUSY_STATE&&t!==FINISH_STATE?err(e,Z_STREAM_ERROR):(e.state=null,t===BUSY_STATE?err(e,Z_DATA_ERROR):Z_OK):Z_STREAM_ERROR}function deflateSetDictionary(e,t){var r,n,i,a,s,o,l,u,c=t.length;if(!e||!e.state)return Z_STREAM_ERROR;if(2===(a=(r=e.state).wrap)||1===a&&r.status!==INIT_STATE||r.lookahead)return Z_STREAM_ERROR;for(1===a&&(e.adler=adler32_1(e.adler,t,c,0)),r.wrap=0,c>=r.w_size&&(0===a&&(zero$1(r.head),r.strstart=0,r.block_start=0,r.insert=0),u=new common.Buf8(r.w_size),common.arraySet(u,t,c-r.w_size,r.w_size,0),t=u,c=r.w_size),s=e.avail_in,o=e.next_in,l=e.input,e.avail_in=c,e.next_in=0,e.input=t,fill_window(r);r.lookahead>=MIN_MATCH$1;){n=r.strstart,i=r.lookahead-(MIN_MATCH$1-1);do{r.ins_h=(r.ins_h<<r.hash_shift^r.window[n+MIN_MATCH$1-1])&r.hash_mask,r.prev[n&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=n,n++}while(--i);r.strstart=n,r.lookahead=MIN_MATCH$1-1,fill_window(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=MIN_MATCH$1-1,r.match_available=0,e.next_in=o,e.input=l,e.avail_in=s,r.wrap=a,Z_OK}configuration_table=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)];var deflateInit_1=deflateInit,deflateInit2_1=deflateInit2,deflateReset_1=deflateReset,deflateResetKeep_1=deflateResetKeep,deflateSetHeader_1=deflateSetHeader,deflate_2=deflate,deflateEnd_1=deflateEnd,deflateSetDictionary_1=deflateSetDictionary,deflateInfo="pako deflate (from Nodeca project)",deflate_1={deflateInit:deflateInit_1,deflateInit2:deflateInit2_1,deflateReset:deflateReset_1,deflateResetKeep:deflateResetKeep_1,deflateSetHeader:deflateSetHeader_1,deflate:deflate_2,deflateEnd:deflateEnd_1,deflateSetDictionary:deflateSetDictionary_1,deflateInfo:deflateInfo},STR_APPLY_OK=!0,STR_APPLY_UIA_OK=!0;try{String.fromCharCode.apply(null,[0])}catch(e){STR_APPLY_OK=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){STR_APPLY_UIA_OK=!1}for(var _utf8len=new common.Buf8(256),q=0;q<256;q++)_utf8len[q]=q>=252?6:q>=248?5:q>=240?4:q>=224?3:q>=192?2:1;_utf8len[254]=_utf8len[254]=1;var string2buf=function(e){var t,r,n,i,a,s=e.length,o=0;for(i=0;i<s;i++)55296==(64512&(r=e.charCodeAt(i)))&&i+1<s&&56320==(64512&(n=e.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),o+=r<128?1:r<2048?2:r<65536?3:4;for(t=new common.Buf8(o),a=0,i=0;a<o;i++)55296==(64512&(r=e.charCodeAt(i)))&&i+1<s&&56320==(64512&(n=e.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),r<128?t[a++]=r:r<2048?(t[a++]=192|r>>>6,t[a++]=128|63&r):r<65536?(t[a++]=224|r>>>12,t[a++]=128|r>>>6&63,t[a++]=128|63&r):(t[a++]=240|r>>>18,t[a++]=128|r>>>12&63,t[a++]=128|r>>>6&63,t[a++]=128|63&r);return t};function buf2binstring(e,t){if(t<65537&&(e.subarray&&STR_APPLY_UIA_OK||!e.subarray&&STR_APPLY_OK))return String.fromCharCode.apply(null,common.shrinkBuf(e,t));for(var r="",n=0;n<t;n++)r+=String.fromCharCode(e[n]);return r}var buf2binstring_1=function(e){return buf2binstring(e,e.length)},binstring2buf=function(e){for(var t=new common.Buf8(e.length),r=0,n=t.length;r<n;r++)t[r]=e.charCodeAt(r);return t},buf2string=function(e,t){var r,n,i,a,s=t||e.length,o=new Array(2*s);for(n=0,r=0;r<s;)if((i=e[r++])<128)o[n++]=i;else if((a=_utf8len[i])>4)o[n++]=65533,r+=a-1;else{for(i&=2===a?31:3===a?15:7;a>1&&r<s;)i=i<<6|63&e[r++],a--;a>1?o[n++]=65533:i<65536?o[n++]=i:(i-=65536,o[n++]=55296|i>>10&1023,o[n++]=56320|1023&i)}return buf2binstring(o,n)},utf8border=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;r>=0&&128==(192&e[r]);)r--;return r<0?t:0===r?t:r+_utf8len[e[r]]>t?r:t},strings={string2buf:string2buf,buf2binstring:buf2binstring_1,binstring2buf:binstring2buf,buf2string:buf2string,utf8border:utf8border};function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var zstream=ZStream,toString$1=Object.prototype.toString,Z_NO_FLUSH$1=0,Z_FINISH$1=4,Z_OK$1=0,Z_STREAM_END$1=1,Z_SYNC_FLUSH=2,Z_DEFAULT_COMPRESSION$1=-1,Z_DEFAULT_STRATEGY$1=0,Z_DEFLATED$1=8;function Deflate(e){if(!(this instanceof Deflate))return new Deflate(e);this.options=common.assign({level:Z_DEFAULT_COMPRESSION$1,method:Z_DEFLATED$1,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z_DEFAULT_STRATEGY$1,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;var r=deflate_1.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==Z_OK$1)throw new Error(messages[r]);if(t.header&&deflate_1.deflateSetHeader(this.strm,t.header),t.dictionary){var n;if(n="string"==typeof t.dictionary?strings.string2buf(t.dictionary):"[object ArrayBuffer]"===toString$1.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(r=deflate_1.deflateSetDictionary(this.strm,n))!==Z_OK$1)throw new Error(messages[r]);this._dict_set=!0}}function deflate$1(e,t){var r=new Deflate(t);if(r.push(e,!0),r.err)throw r.msg||messages[r.err];return r.result}function deflateRaw(e,t){return(t=t||{}).raw=!0,deflate$1(e,t)}function gzip(e,t){return(t=t||{}).gzip=!0,deflate$1(e,t)}Deflate.prototype.push=function(e,t){var r,n,i=this.strm,a=this.options.chunkSize;if(this.ended)return!1;n=t===~~t?t:!0===t?Z_FINISH$1:Z_NO_FLUSH$1,"string"==typeof e?i.input=strings.string2buf(e):"[object ArrayBuffer]"===toString$1.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;do{if(0===i.avail_out&&(i.output=new common.Buf8(a),i.next_out=0,i.avail_out=a),(r=deflate_1.deflate(i,n))!==Z_STREAM_END$1&&r!==Z_OK$1)return this.onEnd(r),this.ended=!0,!1;0!==i.avail_out&&(0!==i.avail_in||n!==Z_FINISH$1&&n!==Z_SYNC_FLUSH)||("string"===this.options.to?this.onData(strings.buf2binstring(common.shrinkBuf(i.output,i.next_out))):this.onData(common.shrinkBuf(i.output,i.next_out)))}while((i.avail_in>0||0===i.avail_out)&&r!==Z_STREAM_END$1);return n===Z_FINISH$1?(r=deflate_1.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===Z_OK$1):n!==Z_SYNC_FLUSH||(this.onEnd(Z_OK$1),i.avail_out=0,!0)},Deflate.prototype.onData=function(e){this.chunks.push(e)},Deflate.prototype.onEnd=function(e){e===Z_OK$1&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Deflate_1=Deflate,deflate_2$1=deflate$1,deflateRaw_1=deflateRaw,gzip_1=gzip,deflate_1$1={Deflate:Deflate_1,deflate:deflate_2$1,deflateRaw:deflateRaw_1,gzip:gzip_1},BAD=30,TYPE=12,inffast=function(e,t){var r,n,i,a,s,o,l,u,c,h,f,d,p,g,_,y,m,v,b,w,E,T,k,x,S;r=e.state,n=e.next_in,x=e.input,i=n+(e.avail_in-5),a=e.next_out,S=e.output,s=a-(t-e.avail_out),o=a+(e.avail_out-257),l=r.dmax,u=r.wsize,c=r.whave,h=r.wnext,f=r.window,d=r.hold,p=r.bits,g=r.lencode,_=r.distcode,y=(1<<r.lenbits)-1,m=(1<<r.distbits)-1;e:do{p<15&&(d+=x[n++]<<p,p+=8,d+=x[n++]<<p,p+=8),v=g[d&y];t:for(;;){if(d>>>=b=v>>>24,p-=b,0===(b=v>>>16&255))S[a++]=65535&v;else{if(!(16&b)){if(0==(64&b)){v=g[(65535&v)+(d&(1<<b)-1)];continue t}if(32&b){r.mode=TYPE;break e}e.msg="invalid literal/length code",r.mode=BAD;break e}w=65535&v,(b&=15)&&(p<b&&(d+=x[n++]<<p,p+=8),w+=d&(1<<b)-1,d>>>=b,p-=b),p<15&&(d+=x[n++]<<p,p+=8,d+=x[n++]<<p,p+=8),v=_[d&m];r:for(;;){if(d>>>=b=v>>>24,p-=b,!(16&(b=v>>>16&255))){if(0==(64&b)){v=_[(65535&v)+(d&(1<<b)-1)];continue r}e.msg="invalid distance code",r.mode=BAD;break e}if(E=65535&v,p<(b&=15)&&(d+=x[n++]<<p,(p+=8)<b&&(d+=x[n++]<<p,p+=8)),(E+=d&(1<<b)-1)>l){e.msg="invalid distance too far back",r.mode=BAD;break e}if(d>>>=b,p-=b,E>(b=a-s)){if((b=E-b)>c&&r.sane){e.msg="invalid distance too far back",r.mode=BAD;break e}if(T=0,k=f,0===h){if(T+=u-b,b<w){w-=b;do{S[a++]=f[T++]}while(--b);T=a-E,k=S}}else if(h<b){if(T+=u+h-b,(b-=h)<w){w-=b;do{S[a++]=f[T++]}while(--b);if(T=0,h<w){w-=b=h;do{S[a++]=f[T++]}while(--b);T=a-E,k=S}}}else if(T+=h-b,b<w){w-=b;do{S[a++]=f[T++]}while(--b);T=a-E,k=S}for(;w>2;)S[a++]=k[T++],S[a++]=k[T++],S[a++]=k[T++],w-=3;w&&(S[a++]=k[T++],w>1&&(S[a++]=k[T++]))}else{T=a-E;do{S[a++]=S[T++],S[a++]=S[T++],S[a++]=S[T++],w-=3}while(w>2);w&&(S[a++]=S[T++],w>1&&(S[a++]=S[T++]))}break}}break}}while(n<i&&a<o);n-=w=p>>3,d&=(1<<(p-=w<<3))-1,e.next_in=n,e.next_out=a,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=a<o?o-a+257:257-(a-o),r.hold=d,r.bits=p},MAXBITS=15,ENOUGH_LENS=852,ENOUGH_DISTS=592,CODES=0,LENS=1,DISTS=2,lbase=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],lext=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],dbase=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],dext=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],inftrees=function(e,t,r,n,i,a,s,o){var l,u,c,h,f,d,p,g,_,y=o.bits,m=0,v=0,b=0,w=0,E=0,T=0,k=0,x=0,S=0,I=0,A=null,M=0,N=new common.Buf16(MAXBITS+1),C=new common.Buf16(MAXBITS+1),O=null,D=0;for(m=0;m<=MAXBITS;m++)N[m]=0;for(v=0;v<n;v++)N[t[r+v]]++;for(E=y,w=MAXBITS;w>=1&&0===N[w];w--);if(E>w&&(E=w),0===w)return i[a++]=20971520,i[a++]=20971520,o.bits=1,0;for(b=1;b<w&&0===N[b];b++);for(E<b&&(E=b),x=1,m=1;m<=MAXBITS;m++)if(x<<=1,(x-=N[m])<0)return-1;if(x>0&&(e===CODES||1!==w))return-1;for(C[1]=0,m=1;m<MAXBITS;m++)C[m+1]=C[m]+N[m];for(v=0;v<n;v++)0!==t[r+v]&&(s[C[t[r+v]]++]=v);if(e===CODES?(A=O=s,d=19):e===LENS?(A=lbase,M-=257,O=lext,D-=257,d=256):(A=dbase,O=dext,d=-1),I=0,v=0,m=b,f=a,T=E,k=0,c=-1,h=(S=1<<E)-1,e===LENS&&S>ENOUGH_LENS||e===DISTS&&S>ENOUGH_DISTS)return 1;for(;;){p=m-k,s[v]<d?(g=0,_=s[v]):s[v]>d?(g=O[D+s[v]],_=A[M+s[v]]):(g=96,_=0),l=1<<m-k,b=u=1<<T;do{i[f+(I>>k)+(u-=l)]=p<<24|g<<16|_|0}while(0!==u);for(l=1<<m-1;I&l;)l>>=1;if(0!==l?(I&=l-1,I+=l):I=0,v++,0==--N[m]){if(m===w)break;m=t[r+s[v]]}if(m>E&&(I&h)!==c){for(0===k&&(k=E),f+=b,x=1<<(T=m-k);T+k<w&&!((x-=N[T+k])<=0);)T++,x<<=1;if(S+=1<<T,e===LENS&&S>ENOUGH_LENS||e===DISTS&&S>ENOUGH_DISTS)return 1;i[c=I&h]=E<<24|T<<16|f-a|0}}return 0!==I&&(i[f+I]=m-k<<24|64<<16|0),o.bits=E,0},CODES$1=0,LENS$1=1,DISTS$1=2,Z_FINISH$2=4,Z_BLOCK$1=5,Z_TREES=6,Z_OK$2=0,Z_STREAM_END$2=1,Z_NEED_DICT=2,Z_STREAM_ERROR$1=-2,Z_DATA_ERROR$1=-3,Z_MEM_ERROR=-4,Z_BUF_ERROR$1=-5,Z_DEFLATED$2=8,HEAD=1,FLAGS=2,TIME=3,OS=4,EXLEN=5,EXTRA=6,NAME=7,COMMENT=8,HCRC=9,DICTID=10,DICT=11,TYPE$1=12,TYPEDO=13,STORED=14,COPY_=15,COPY=16,TABLE=17,LENLENS=18,CODELENS=19,LEN_=20,LEN=21,LENEXT=22,DIST=23,DISTEXT=24,MATCH=25,LIT=26,CHECK=27,LENGTH=28,DONE=29,BAD$1=30,MEM=31,SYNC=32,ENOUGH_LENS$1=852,ENOUGH_DISTS$1=592,MAX_WBITS$1=15,DEF_WBITS=MAX_WBITS$1;function zswap32(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function InflateState(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new common.Buf16(320),this.work=new common.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function inflateResetKeep(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=HEAD,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new common.Buf32(ENOUGH_LENS$1),t.distcode=t.distdyn=new common.Buf32(ENOUGH_DISTS$1),t.sane=1,t.back=-1,Z_OK$2):Z_STREAM_ERROR$1}function inflateReset(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,inflateResetKeep(e)):Z_STREAM_ERROR$1}function inflateReset2(e,t){var r,n;return e&&e.state?(n=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Z_STREAM_ERROR$1:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,inflateReset(e))):Z_STREAM_ERROR$1}function inflateInit2(e,t){var r,n;return e?(n=new InflateState,e.state=n,n.window=null,(r=inflateReset2(e,t))!==Z_OK$2&&(e.state=null),r):Z_STREAM_ERROR$1}function inflateInit(e){return inflateInit2(e,DEF_WBITS)}var virgin=!0,lenfix,distfix;function fixedtables(e){if(virgin){var t;for(lenfix=new common.Buf32(512),distfix=new common.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(inftrees(LENS$1,e.lens,0,288,lenfix,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;inftrees(DISTS$1,e.lens,0,32,distfix,0,e.work,{bits:5}),virgin=!1}e.lencode=lenfix,e.lenbits=9,e.distcode=distfix,e.distbits=5}function updatewindow(e,t,r,n){var i,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new common.Buf8(a.wsize)),n>=a.wsize?(common.arraySet(a.window,t,r-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((i=a.wsize-a.wnext)>n&&(i=n),common.arraySet(a.window,t,r-n,i,a.wnext),(n-=i)?(common.arraySet(a.window,t,r-n,n,0),a.wnext=n,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0}function inflate(e,t){var r,n,i,a,s,o,l,u,c,h,f,d,p,g,_,y,m,v,b,w,E,T,k,x,S=0,I=new common.Buf8(4),A=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return Z_STREAM_ERROR$1;(r=e.state).mode===TYPE$1&&(r.mode=TYPEDO),s=e.next_out,i=e.output,l=e.avail_out,a=e.next_in,n=e.input,o=e.avail_in,u=r.hold,c=r.bits,h=o,f=l,T=Z_OK$2;e:for(;;)switch(r.mode){case HEAD:if(0===r.wrap){r.mode=TYPEDO;break}for(;c<16;){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}if(2&r.wrap&&35615===u){r.check=0,I[0]=255&u,I[1]=u>>>8&255,r.check=crc32_1(r.check,I,2,0),u=0,c=0,r.mode=FLAGS;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&u)<<8)+(u>>8))%31){e.msg="incorrect header check",r.mode=BAD$1;break}if((15&u)!==Z_DEFLATED$2){e.msg="unknown compression method",r.mode=BAD$1;break}if(c-=4,E=8+(15&(u>>>=4)),0===r.wbits)r.wbits=E;else if(E>r.wbits){e.msg="invalid window size",r.mode=BAD$1;break}r.dmax=1<<E,e.adler=r.check=1,r.mode=512&u?DICTID:TYPE$1,u=0,c=0;break;case FLAGS:for(;c<16;){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}if(r.flags=u,(255&r.flags)!==Z_DEFLATED$2){e.msg="unknown compression method",r.mode=BAD$1;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=BAD$1;break}r.head&&(r.head.text=u>>8&1),512&r.flags&&(I[0]=255&u,I[1]=u>>>8&255,r.check=crc32_1(r.check,I,2,0)),u=0,c=0,r.mode=TIME;case TIME:for(;c<32;){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}r.head&&(r.head.time=u),512&r.flags&&(I[0]=255&u,I[1]=u>>>8&255,I[2]=u>>>16&255,I[3]=u>>>24&255,r.check=crc32_1(r.check,I,4,0)),u=0,c=0,r.mode=OS;case OS:for(;c<16;){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}r.head&&(r.head.xflags=255&u,r.head.os=u>>8),512&r.flags&&(I[0]=255&u,I[1]=u>>>8&255,r.check=crc32_1(r.check,I,2,0)),u=0,c=0,r.mode=EXLEN;case EXLEN:if(1024&r.flags){for(;c<16;){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}r.length=u,r.head&&(r.head.extra_len=u),512&r.flags&&(I[0]=255&u,I[1]=u>>>8&255,r.check=crc32_1(r.check,I,2,0)),u=0,c=0}else r.head&&(r.head.extra=null);r.mode=EXTRA;case EXTRA:if(1024&r.flags&&((d=r.length)>o&&(d=o),d&&(r.head&&(E=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),common.arraySet(r.head.extra,n,a,d,E)),512&r.flags&&(r.check=crc32_1(r.check,n,d,a)),o-=d,a+=d,r.length-=d),r.length))break e;r.length=0,r.mode=NAME;case NAME:if(2048&r.flags){if(0===o)break e;d=0;do{E=n[a+d++],r.head&&E&&r.length<65536&&(r.head.name+=String.fromCharCode(E))}while(E&&d<o);if(512&r.flags&&(r.check=crc32_1(r.check,n,d,a)),o-=d,a+=d,E)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=COMMENT;case COMMENT:if(4096&r.flags){if(0===o)break e;d=0;do{E=n[a+d++],r.head&&E&&r.length<65536&&(r.head.comment+=String.fromCharCode(E))}while(E&&d<o);if(512&r.flags&&(r.check=crc32_1(r.check,n,d,a)),o-=d,a+=d,E)break e}else r.head&&(r.head.comment=null);r.mode=HCRC;case HCRC:if(512&r.flags){for(;c<16;){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}if(u!==(65535&r.check)){e.msg="header crc mismatch",r.mode=BAD$1;break}u=0,c=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=TYPE$1;break;case DICTID:for(;c<32;){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}e.adler=r.check=zswap32(u),u=0,c=0,r.mode=DICT;case DICT:if(0===r.havedict)return e.next_out=s,e.avail_out=l,e.next_in=a,e.avail_in=o,r.hold=u,r.bits=c,Z_NEED_DICT;e.adler=r.check=1,r.mode=TYPE$1;case TYPE$1:if(t===Z_BLOCK$1||t===Z_TREES)break e;case TYPEDO:if(r.last){u>>>=7&c,c-=7&c,r.mode=CHECK;break}for(;c<3;){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}switch(r.last=1&u,c-=1,3&(u>>>=1)){case 0:r.mode=STORED;break;case 1:if(fixedtables(r),r.mode=LEN_,t===Z_TREES){u>>>=2,c-=2;break e}break;case 2:r.mode=TABLE;break;case 3:e.msg="invalid block type",r.mode=BAD$1}u>>>=2,c-=2;break;case STORED:for(u>>>=7&c,c-=7&c;c<32;){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}if((65535&u)!=(u>>>16^65535)){e.msg="invalid stored block lengths",r.mode=BAD$1;break}if(r.length=65535&u,u=0,c=0,r.mode=COPY_,t===Z_TREES)break e;case COPY_:r.mode=COPY;case COPY:if(d=r.length){if(d>o&&(d=o),d>l&&(d=l),0===d)break e;common.arraySet(i,n,a,d,s),o-=d,a+=d,l-=d,s+=d,r.length-=d;break}r.mode=TYPE$1;break;case TABLE:for(;c<14;){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}if(r.nlen=257+(31&u),u>>>=5,c-=5,r.ndist=1+(31&u),u>>>=5,c-=5,r.ncode=4+(15&u),u>>>=4,c-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=BAD$1;break}r.have=0,r.mode=LENLENS;case LENLENS:for(;r.have<r.ncode;){for(;c<3;){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}r.lens[A[r.have++]]=7&u,u>>>=3,c-=3}for(;r.have<19;)r.lens[A[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,k={bits:r.lenbits},T=inftrees(CODES$1,r.lens,0,19,r.lencode,0,r.work,k),r.lenbits=k.bits,T){e.msg="invalid code lengths set",r.mode=BAD$1;break}r.have=0,r.mode=CODELENS;case CODELENS:for(;r.have<r.nlen+r.ndist;){for(;y=(S=r.lencode[u&(1<<r.lenbits)-1])>>>16&255,m=65535&S,!((_=S>>>24)<=c);){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}if(m<16)u>>>=_,c-=_,r.lens[r.have++]=m;else{if(16===m){for(x=_+2;c<x;){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}if(u>>>=_,c-=_,0===r.have){e.msg="invalid bit length repeat",r.mode=BAD$1;break}E=r.lens[r.have-1],d=3+(3&u),u>>>=2,c-=2}else if(17===m){for(x=_+3;c<x;){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}c-=_,E=0,d=3+(7&(u>>>=_)),u>>>=3,c-=3}else{for(x=_+7;c<x;){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}c-=_,E=0,d=11+(127&(u>>>=_)),u>>>=7,c-=7}if(r.have+d>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=BAD$1;break}for(;d--;)r.lens[r.have++]=E}}if(r.mode===BAD$1)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=BAD$1;break}if(r.lenbits=9,k={bits:r.lenbits},T=inftrees(LENS$1,r.lens,0,r.nlen,r.lencode,0,r.work,k),r.lenbits=k.bits,T){e.msg="invalid literal/lengths set",r.mode=BAD$1;break}if(r.distbits=6,r.distcode=r.distdyn,k={bits:r.distbits},T=inftrees(DISTS$1,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,k),r.distbits=k.bits,T){e.msg="invalid distances set",r.mode=BAD$1;break}if(r.mode=LEN_,t===Z_TREES)break e;case LEN_:r.mode=LEN;case LEN:if(o>=6&&l>=258){e.next_out=s,e.avail_out=l,e.next_in=a,e.avail_in=o,r.hold=u,r.bits=c,inffast(e,f),s=e.next_out,i=e.output,l=e.avail_out,a=e.next_in,n=e.input,o=e.avail_in,u=r.hold,c=r.bits,r.mode===TYPE$1&&(r.back=-1);break}for(r.back=0;y=(S=r.lencode[u&(1<<r.lenbits)-1])>>>16&255,m=65535&S,!((_=S>>>24)<=c);){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}if(y&&0==(240&y)){for(v=_,b=y,w=m;y=(S=r.lencode[w+((u&(1<<v+b)-1)>>v)])>>>16&255,m=65535&S,!(v+(_=S>>>24)<=c);){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}u>>>=v,c-=v,r.back+=v}if(u>>>=_,c-=_,r.back+=_,r.length=m,0===y){r.mode=LIT;break}if(32&y){r.back=-1,r.mode=TYPE$1;break}if(64&y){e.msg="invalid literal/length code",r.mode=BAD$1;break}r.extra=15&y,r.mode=LENEXT;case LENEXT:if(r.extra){for(x=r.extra;c<x;){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}r.length+=u&(1<<r.extra)-1,u>>>=r.extra,c-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=DIST;case DIST:for(;y=(S=r.distcode[u&(1<<r.distbits)-1])>>>16&255,m=65535&S,!((_=S>>>24)<=c);){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}if(0==(240&y)){for(v=_,b=y,w=m;y=(S=r.distcode[w+((u&(1<<v+b)-1)>>v)])>>>16&255,m=65535&S,!(v+(_=S>>>24)<=c);){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}u>>>=v,c-=v,r.back+=v}if(u>>>=_,c-=_,r.back+=_,64&y){e.msg="invalid distance code",r.mode=BAD$1;break}r.offset=m,r.extra=15&y,r.mode=DISTEXT;case DISTEXT:if(r.extra){for(x=r.extra;c<x;){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}r.offset+=u&(1<<r.extra)-1,u>>>=r.extra,c-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=BAD$1;break}r.mode=MATCH;case MATCH:if(0===l)break e;if(d=f-l,r.offset>d){if((d=r.offset-d)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=BAD$1;break}d>r.wnext?(d-=r.wnext,p=r.wsize-d):p=r.wnext-d,d>r.length&&(d=r.length),g=r.window}else g=i,p=s-r.offset,d=r.length;d>l&&(d=l),l-=d,r.length-=d;do{i[s++]=g[p++]}while(--d);0===r.length&&(r.mode=LEN);break;case LIT:if(0===l)break e;i[s++]=r.length,l--,r.mode=LEN;break;case CHECK:if(r.wrap){for(;c<32;){if(0===o)break e;o--,u|=n[a++]<<c,c+=8}if(f-=l,e.total_out+=f,r.total+=f,f&&(e.adler=r.check=r.flags?crc32_1(r.check,i,f,s-f):adler32_1(r.check,i,f,s-f)),f=l,(r.flags?u:zswap32(u))!==r.check){e.msg="incorrect data check",r.mode=BAD$1;break}u=0,c=0}r.mode=LENGTH;case LENGTH:if(r.wrap&&r.flags){for(;c<32;){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}if(u!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=BAD$1;break}u=0,c=0}r.mode=DONE;case DONE:T=Z_STREAM_END$2;break e;case BAD$1:T=Z_DATA_ERROR$1;break e;case MEM:return Z_MEM_ERROR;case SYNC:default:return Z_STREAM_ERROR$1}return e.next_out=s,e.avail_out=l,e.next_in=a,e.avail_in=o,r.hold=u,r.bits=c,(r.wsize||f!==e.avail_out&&r.mode<BAD$1&&(r.mode<CHECK||t!==Z_FINISH$2))&&updatewindow(e,e.output,e.next_out,f-e.avail_out)?(r.mode=MEM,Z_MEM_ERROR):(h-=e.avail_in,f-=e.avail_out,e.total_in+=h,e.total_out+=f,r.total+=f,r.wrap&&f&&(e.adler=r.check=r.flags?crc32_1(r.check,i,f,e.next_out-f):adler32_1(r.check,i,f,e.next_out-f)),e.data_type=r.bits+(r.last?64:0)+(r.mode===TYPE$1?128:0)+(r.mode===LEN_||r.mode===COPY_?256:0),(0===h&&0===f||t===Z_FINISH$2)&&T===Z_OK$2&&(T=Z_BUF_ERROR$1),T)}function inflateEnd(e){if(!e||!e.state)return Z_STREAM_ERROR$1;var t=e.state;return t.window&&(t.window=null),e.state=null,Z_OK$2}function inflateGetHeader(e,t){var r;return e&&e.state?0==(2&(r=e.state).wrap)?Z_STREAM_ERROR$1:(r.head=t,t.done=!1,Z_OK$2):Z_STREAM_ERROR$1}function inflateSetDictionary(e,t){var r,n=t.length;return e&&e.state?0!==(r=e.state).wrap&&r.mode!==DICT?Z_STREAM_ERROR$1:r.mode===DICT&&adler32_1(1,t,n,0)!==r.check?Z_DATA_ERROR$1:updatewindow(e,t,n,n)?(r.mode=MEM,Z_MEM_ERROR):(r.havedict=1,Z_OK$2):Z_STREAM_ERROR$1}var inflateReset_1=inflateReset,inflateReset2_1=inflateReset2,inflateResetKeep_1=inflateResetKeep,inflateInit_1=inflateInit,inflateInit2_1=inflateInit2,inflate_2=inflate,inflateEnd_1=inflateEnd,inflateGetHeader_1=inflateGetHeader,inflateSetDictionary_1=inflateSetDictionary,inflateInfo="pako inflate (from Nodeca project)",inflate_1={inflateReset:inflateReset_1,inflateReset2:inflateReset2_1,inflateResetKeep:inflateResetKeep_1,inflateInit:inflateInit_1,inflateInit2:inflateInit2_1,inflate:inflate_2,inflateEnd:inflateEnd_1,inflateGetHeader:inflateGetHeader_1,inflateSetDictionary:inflateSetDictionary_1,inflateInfo:inflateInfo},constants={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};function GZheader(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var gzheader=GZheader,toString$2=Object.prototype.toString;function Inflate(e){if(!(this instanceof Inflate))return new Inflate(e);this.options=common.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;var r=inflate_1.inflateInit2(this.strm,t.windowBits);if(r!==constants.Z_OK)throw new Error(messages[r]);this.header=new gzheader,inflate_1.inflateGetHeader(this.strm,this.header)}function inflate$1(e,t){var r=new Inflate(t);if(r.push(e,!0),r.err)throw r.msg||messages[r.err];return r.result}function inflateRaw(e,t){return(t=t||{}).raw=!0,inflate$1(e,t)}Inflate.prototype.push=function(e,t){var r,n,i,a,s,o,l=this.strm,u=this.options.chunkSize,c=this.options.dictionary,h=!1;if(this.ended)return!1;n=t===~~t?t:!0===t?constants.Z_FINISH:constants.Z_NO_FLUSH,"string"==typeof e?l.input=strings.binstring2buf(e):"[object ArrayBuffer]"===toString$2.call(e)?l.input=new Uint8Array(e):l.input=e,l.next_in=0,l.avail_in=l.input.length;do{if(0===l.avail_out&&(l.output=new common.Buf8(u),l.next_out=0,l.avail_out=u),(r=inflate_1.inflate(l,constants.Z_NO_FLUSH))===constants.Z_NEED_DICT&&c&&(o="string"==typeof c?strings.string2buf(c):"[object ArrayBuffer]"===toString$2.call(c)?new Uint8Array(c):c,r=inflate_1.inflateSetDictionary(this.strm,o)),r===constants.Z_BUF_ERROR&&!0===h&&(r=constants.Z_OK,h=!1),r!==constants.Z_STREAM_END&&r!==constants.Z_OK)return this.onEnd(r),this.ended=!0,!1;l.next_out&&(0!==l.avail_out&&r!==constants.Z_STREAM_END&&(0!==l.avail_in||n!==constants.Z_FINISH&&n!==constants.Z_SYNC_FLUSH)||("string"===this.options.to?(i=strings.utf8border(l.output,l.next_out),a=l.next_out-i,s=strings.buf2string(l.output,i),l.next_out=a,l.avail_out=u-a,a&&common.arraySet(l.output,l.output,i,a,0),this.onData(s)):this.onData(common.shrinkBuf(l.output,l.next_out)))),0===l.avail_in&&0===l.avail_out&&(h=!0)}while((l.avail_in>0||0===l.avail_out)&&r!==constants.Z_STREAM_END);return r===constants.Z_STREAM_END&&(n=constants.Z_FINISH),n===constants.Z_FINISH?(r=inflate_1.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===constants.Z_OK):n!==constants.Z_SYNC_FLUSH||(this.onEnd(constants.Z_OK),l.avail_out=0,!0)},Inflate.prototype.onData=function(e){this.chunks.push(e)},Inflate.prototype.onEnd=function(e){e===constants.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Inflate_1=Inflate,inflate_2$1=inflate$1,inflateRaw_1=inflateRaw,ungzip=inflate$1,inflate_1$1={Inflate:Inflate_1,inflate:inflate_2$1,inflateRaw:inflateRaw_1,ungzip:ungzip},assign=common.assign,pako={};assign(pako,deflate_1$1,inflate_1$1,constants);var pako_1=pako,FileToArrayBufferReader=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._outputCounter=0,e.setMetadata("filenames",{}),e.setMetadata("checksums",{}),e.setMetadata("readAsText",!1),e}return inherits(t,Filter),createClass(t,[{key:"_run",value:function(){var e=this;this._outputCounter=0,this.getInputCategories().forEach(function(t){e._loadFile(t)})}},{key:"_loadFile",value:function(e){var t=this,r=new FileReader,n=this.getMetadata("readAsText"),i=function(r){t.addTimeRecord("startRead");var i=r.target.result,a=t._getInput(e).name.split(/[\\/]/).pop(),s=a.split(".").pop(),o=md5(i);if(t._metadata.filenames[e]=a,t._metadata.checksums[e]=o,s.localeCompare("pixp"))try{i=pako_1.inflate(i).buffer,console.log("File was un-gziped successfully")}catch(e){console.log("Pako: not a gziped file ("+e+")")}if(n){var l=codecutils.CodecUtils.arrayBufferToUnicode(i);if(!l)return void console.warn("The content of this file is not a valid text. It could be read as a binary file if the metadata 'readAsText' is set to false.");i=l}t.addTimeRecord("endRead");var u=t.getTime("startRead","endRead");console.log("Reading file took "+u+"ms."),t._output[e]=i,t._fileLoadCount()};r.onerror=function(e){console.warn("ERROR"),console.warn(e)},n?(r.onloadend=function(n){t.addTimeRecord("startRead");var a=n.target.result;if(!codecutils.CodecUtils.isValidString(a))return r.onloadend=i,void r.readAsArrayBuffer(t._getInput(e));var s=t._getInput(e).name.split(/[\\/]/).pop(),o=(s.split(".").pop(),md5(a));t._metadata.filenames[e]=s,t._metadata.checksums[e]=o,t.addTimeRecord("endRead");var l=t.getTime("startRead","endRead");console.log("Reading file took "+l+"ms."),t._output[e]=a,t._fileLoadCount()},r.readAsText(this._getInput(e))):(r.onloadend=i,r.readAsArrayBuffer(this._getInput(e)))}},{key:"_fileLoadCount",value:function(){this._outputCounter++,this._outputCounter==this.getNumberOfInputs()&&this.triggerEvent("ready")}}]),t}(),UrlToArrayBufferReader=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._outputCounter=0,e.setMetadata("filenames",{}),e.setMetadata("checksums",{}),e.setMetadata("readAsText",!1),e}return inherits(t,Filter),createClass(t,[{key:"_run",value:function(){var e=this;this.getNumberOfInputs()?this._forEachInput(function(t,r){e._loadUrl(t,r)}):console.warn("No input was specified, cannot run this filer.")}},{key:"_loadUrl",value:function(e,t){var r=this,n=this.getMetadata("readAsText"),i=new XMLHttpRequest;i.open("GET",t,!0);var a=function(i){var a=i.target.response,s=t.split(/[\\/]/).pop(),o=s.split(".").pop(),l=md5(a);if(r._metadata.filenames[e]=s,r._metadata.checksums[e]=l,o.localeCompare("pixp"))try{a=pako_1.inflate(a).buffer,console.log("File was un-gziped successfully")}catch(e){console.log("Pako: not a gziped file ("+e+")")}if(n){var u=codecutils.CodecUtils.arrayBufferToUnicode(a);if(!u||!codecutils.CodecUtils.isValidString(u))return void console.warn("The content of this file is not a valid text. It could be read as a binary file if the metadata 'readAsText' is set to false.");a=u}r._output[e]=a,r._outputCounter++,r._outputCounter==r.getNumberOfInputs()&&r.triggerEvent("ready")};i.error=function(){console.log("here go the error")},n?(i.responseType="text",i.onload=function(n){console.log("ooooooooo");var i=n.target.response,s=t.split(/[\\/]/).pop(),o=(s.split(".").pop(),md5(i));if(r._metadata.filenames[e]=s,r._metadata.checksums[e]=o,!codecutils.CodecUtils.isValidString(i)){n.target.abort();var l=new XMLHttpRequest;return l.open("GET",t,!0),l.responseType="arraybuffer",l.onload=a,void l.send()}r._output[e]=i,r._outputCounter++,r._outputCounter==r.getNumberOfInputs()&&r.triggerEvent("ready")}):(i.responseType="arraybuffer",i.onload=a),i.send()}}]),t}(),FileSaver=createCommonjsModule(function(e){var t=t||function(e){if(!(void 0===e||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t=function(){return e.URL||e.webkitURL||e},r=e.document.createElementNS("http://www.w3.org/1999/xhtml","a"),n="download"in r,i=/constructor/i.test(e.HTMLElement)||e.safari,a=/CriOS\/[\d]+/.test(navigator.userAgent),s=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},o=function(e){setTimeout(function(){"string"==typeof e?t().revokeObjectURL(e):e.remove()},4e4)},l=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},u=function(u,c,h){h||(u=l(u));var f,d=this,p="application/octet-stream"===u.type,g=function(){!function(e,t,r){for(var n=(t=[].concat(t)).length;n--;){var i=e["on"+t[n]];if("function"==typeof i)try{i.call(e,r||e)}catch(e){s(e)}}}(d,"writestart progress write writeend".split(" "))};if(d.readyState=d.INIT,n)return f=t().createObjectURL(u),void setTimeout(function(){var e,t;r.href=f,r.download=c,e=r,t=new MouseEvent("click"),e.dispatchEvent(t),g(),o(f),d.readyState=d.DONE});!function(){if((a||p&&i)&&e.FileReader){var r=new FileReader;return r.onloadend=function(){var t=a?r.result:r.result.replace(/^data:[^;]*;/,"data:attachment/file;");e.open(t,"_blank")||(e.location.href=t),t=void 0,d.readyState=d.DONE,g()},r.readAsDataURL(u),void(d.readyState=d.INIT)}f||(f=t().createObjectURL(u)),p?e.location.href=f:e.open(f,"_blank")||(e.location.href=f);d.readyState=d.DONE,g(),o(f)}()},c=u.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,r){return t=t||e.name||"download",r||(e=l(e)),navigator.msSaveOrOpenBlob(e,t)}:(c.abort=function(){},c.readyState=c.INIT=0,c.WRITING=1,c.DONE=2,c.error=c.onwritestart=c.onprogress=c.onwrite=c.onabort=c.onerror=c.onwriteend=null,function(e,t,r){return new u(e,t||e.name||"download",r)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||commonjsGlobal.content);e.exports&&(e.exports.saveAs=t)}),FileSaver_1=FileSaver.saveAs,BrowserDownloadBuffer=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.addInputValidator(0,ArrayBuffer),e.setMetadata("filename",null),e}return inherits(t,Filter),createClass(t,[{key:"_run",value:function(){if(this.hasValidInput()){var e=this.getMetadata("filename");if(e){var t=new Blob([this._getInput()],{type:"application/octet-binary"});FileSaver.saveAs(t,e)}else console.warn("A filename must be specified. Use the method `.setMetadata('filename', 'theFile.ext')` on this filter.")}else console.warn("BrowserDownloadBuffer uses only ArrayBuffer.")}}]),t}(),pixbincodec_umd=createCommonjsModule(function(module,exports){!function(exports){var commonjsGlobal$$1="undefined"!=typeof window?window:void 0!==commonjsGlobal?commonjsGlobal:"undefined"!=typeof self?self:{};function unwrapExports$$1(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function createCommonjsModule$$1(e,t){return e(t={exports:{}},t.exports),t.exports}var common=createCommonjsModule$$1(function(e,t){var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!==(void 0===r?"undefined":_typeof(r)))throw new TypeError(r+"must be non-object");for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var n={arraySet:function(e,t,r,n,i){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+n),i);else for(var a=0;a<n;a++)e[i+a]=t[r+a]},flattenChunks:function(e){var t,r,n,i,a,s;for(n=0,t=0,r=e.length;t<r;t++)n+=e[t].length;for(s=new Uint8Array(n),i=0,t=0,r=e.length;t<r;t++)a=e[t],s.set(a,i),i+=a.length;return s}},i={arraySet:function(e,t,r,n,i){for(var a=0;a<n;a++)e[i+a]=t[r+a]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,n)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,i))},t.setTyped(r)}),common_1=common.assign,common_2=common.shrinkBuf,common_3=common.setTyped,common_4=common.Buf8,common_5=common.Buf16,common_6=common.Buf32,Z_FIXED=4,Z_BINARY=0,Z_TEXT=1,Z_UNKNOWN=2;function zero(e){for(var t=e.length;--t>=0;)e[t]=0}var STORED_BLOCK=0,STATIC_TREES=1,DYN_TREES=2,MIN_MATCH=3,MAX_MATCH=258,LENGTH_CODES=29,LITERALS=256,L_CODES=LITERALS+1+LENGTH_CODES,D_CODES=30,BL_CODES=19,HEAP_SIZE=2*L_CODES+1,MAX_BITS=15,Buf_size=16,MAX_BL_BITS=7,END_BLOCK=256,REP_3_6=16,REPZ_3_10=17,REPZ_11_138=18,extra_lbits=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],extra_dbits=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],extra_blbits=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],bl_order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],DIST_CODE_LEN=512,static_ltree=new Array(2*(L_CODES+2));zero(static_ltree);var static_dtree=new Array(2*D_CODES);zero(static_dtree);var _dist_code=new Array(DIST_CODE_LEN);zero(_dist_code);var _length_code=new Array(MAX_MATCH-MIN_MATCH+1);zero(_length_code);var base_length=new Array(LENGTH_CODES);zero(base_length);var base_dist=new Array(D_CODES),static_l_desc,static_d_desc,static_bl_desc;function StaticTreeDesc(e,t,r,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=e&&e.length}function TreeDesc(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function d_code(e){return e<256?_dist_code[e]:_dist_code[256+(e>>>7)]}function put_short(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function send_bits(e,t,r){e.bi_valid>Buf_size-r?(e.bi_buf|=t<<e.bi_valid&65535,put_short(e,e.bi_buf),e.bi_buf=t>>Buf_size-e.bi_valid,e.bi_valid+=r-Buf_size):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function send_code(e,t,r){send_bits(e,r[2*t],r[2*t+1])}function bi_reverse(e,t){var r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1}function bi_flush(e){16===e.bi_valid?(put_short(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}function gen_bitlen(e,t){var r,n,i,a,s,o,l=t.dyn_tree,u=t.max_code,c=t.stat_desc.static_tree,h=t.stat_desc.has_stree,f=t.stat_desc.extra_bits,d=t.stat_desc.extra_base,p=t.stat_desc.max_length,g=0;for(a=0;a<=MAX_BITS;a++)e.bl_count[a]=0;for(l[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;r<HEAP_SIZE;r++)n=e.heap[r],(a=l[2*l[2*n+1]+1]+1)>p&&(a=p,g++),l[2*n+1]=a,n>u||(e.bl_count[a]++,s=0,n>=d&&(s=f[n-d]),o=l[2*n],e.opt_len+=o*(a+s),h&&(e.static_len+=o*(c[2*n+1]+s)));if(0!==g){do{for(a=p-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[p]--,g-=2}while(g>0);for(a=p;0!==a;a--)for(n=e.bl_count[a];0!==n;)(i=e.heap[--r])>u||(l[2*i+1]!==a&&(e.opt_len+=(a-l[2*i+1])*l[2*i],l[2*i+1]=a),n--)}}function gen_codes(e,t,r){var n,i,a=new Array(MAX_BITS+1),s=0;for(n=1;n<=MAX_BITS;n++)a[n]=s=s+r[n-1]<<1;for(i=0;i<=t;i++){var o=e[2*i+1];0!==o&&(e[2*i]=bi_reverse(a[o]++,o))}}function tr_static_init(){var e,t,r,n,i,a=new Array(MAX_BITS+1);for(r=0,n=0;n<LENGTH_CODES-1;n++)for(base_length[n]=r,e=0;e<1<<extra_lbits[n];e++)_length_code[r++]=n;for(_length_code[r-1]=n,i=0,n=0;n<16;n++)for(base_dist[n]=i,e=0;e<1<<extra_dbits[n];e++)_dist_code[i++]=n;for(i>>=7;n<D_CODES;n++)for(base_dist[n]=i<<7,e=0;e<1<<extra_dbits[n]-7;e++)_dist_code[256+i++]=n;for(t=0;t<=MAX_BITS;t++)a[t]=0;for(e=0;e<=143;)static_ltree[2*e+1]=8,e++,a[8]++;for(;e<=255;)static_ltree[2*e+1]=9,e++,a[9]++;for(;e<=279;)static_ltree[2*e+1]=7,e++,a[7]++;for(;e<=287;)static_ltree[2*e+1]=8,e++,a[8]++;for(gen_codes(static_ltree,L_CODES+1,a),e=0;e<D_CODES;e++)static_dtree[2*e+1]=5,static_dtree[2*e]=bi_reverse(e,5);static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS+1,L_CODES,MAX_BITS),static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES,MAX_BITS),static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES,MAX_BL_BITS)}function init_block(e){var t;for(t=0;t<L_CODES;t++)e.dyn_ltree[2*t]=0;for(t=0;t<D_CODES;t++)e.dyn_dtree[2*t]=0;for(t=0;t<BL_CODES;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*END_BLOCK]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function bi_windup(e){e.bi_valid>8?put_short(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function copy_block(e,t,r,n){bi_windup(e),n&&(put_short(e,r),put_short(e,~r)),common.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}function smaller(e,t,r,n){var i=2*t,a=2*r;return e[i]<e[a]||e[i]===e[a]&&n[t]<=n[r]}function pqdownheap(e,t,r){for(var n=e.heap[r],i=r<<1;i<=e.heap_len&&(i<e.heap_len&&smaller(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!smaller(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n}function compress_block(e,t,r){var n,i,a,s,o=0;if(0!==e.last_lit)do{n=e.pending_buf[e.d_buf+2*o]<<8|e.pending_buf[e.d_buf+2*o+1],i=e.pending_buf[e.l_buf+o],o++,0===n?send_code(e,i,t):(a=_length_code[i],send_code(e,a+LITERALS+1,t),0!==(s=extra_lbits[a])&&(i-=base_length[a],send_bits(e,i,s)),a=d_code(--n),send_code(e,a,r),0!==(s=extra_dbits[a])&&(n-=base_dist[a],send_bits(e,n,s)))}while(o<e.last_lit);send_code(e,END_BLOCK,t)}function build_tree(e,t){var r,n,i,a=t.dyn_tree,s=t.stat_desc.static_tree,o=t.stat_desc.has_stree,l=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=HEAP_SIZE,r=0;r<l;r++)0!==a[2*r]?(e.heap[++e.heap_len]=u=r,e.depth[r]=0):a[2*r+1]=0;for(;e.heap_len<2;)i=e.heap[++e.heap_len]=u<2?++u:0,a[2*i]=1,e.depth[i]=0,e.opt_len--,o&&(e.static_len-=s[2*i+1]);for(t.max_code=u,r=e.heap_len>>1;r>=1;r--)pqdownheap(e,a,r);i=l;do{r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],pqdownheap(e,a,1),n=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=n,a[2*i]=a[2*r]+a[2*n],e.depth[i]=(e.depth[r]>=e.depth[n]?e.depth[r]:e.depth[n])+1,a[2*r+1]=a[2*n+1]=i,e.heap[1]=i++,pqdownheap(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],gen_bitlen(e,t),gen_codes(a,u,e.bl_count)}function scan_tree(e,t,r){var n,i,a=-1,s=t[1],o=0,l=7,u=4;for(0===s&&(l=138,u=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)i=s,s=t[2*(n+1)+1],++o<l&&i===s||(o<u?e.bl_tree[2*i]+=o:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[2*REP_3_6]++):o<=10?e.bl_tree[2*REPZ_3_10]++:e.bl_tree[2*REPZ_11_138]++,o=0,a=i,0===s?(l=138,u=3):i===s?(l=6,u=3):(l=7,u=4))}function send_tree(e,t,r){var n,i,a=-1,s=t[1],o=0,l=7,u=4;for(0===s&&(l=138,u=3),n=0;n<=r;n++)if(i=s,s=t[2*(n+1)+1],!(++o<l&&i===s)){if(o<u)do{send_code(e,i,e.bl_tree)}while(0!=--o);else 0!==i?(i!==a&&(send_code(e,i,e.bl_tree),o--),send_code(e,REP_3_6,e.bl_tree),send_bits(e,o-3,2)):o<=10?(send_code(e,REPZ_3_10,e.bl_tree),send_bits(e,o-3,3)):(send_code(e,REPZ_11_138,e.bl_tree),send_bits(e,o-11,7));o=0,a=i,0===s?(l=138,u=3):i===s?(l=6,u=3):(l=7,u=4)}}function build_bl_tree(e){var t;for(scan_tree(e,e.dyn_ltree,e.l_desc.max_code),scan_tree(e,e.dyn_dtree,e.d_desc.max_code),build_tree(e,e.bl_desc),t=BL_CODES-1;t>=3&&0===e.bl_tree[2*bl_order[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}function send_all_trees(e,t,r,n){var i;for(send_bits(e,t-257,5),send_bits(e,r-1,5),send_bits(e,n-4,4),i=0;i<n;i++)send_bits(e,e.bl_tree[2*bl_order[i]+1],3);send_tree(e,e.dyn_ltree,t-1),send_tree(e,e.dyn_dtree,r-1)}function detect_data_type(e){var t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return Z_BINARY;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return Z_TEXT;for(t=32;t<LITERALS;t++)if(0!==e.dyn_ltree[2*t])return Z_TEXT;return Z_BINARY}zero(base_dist);var static_init_done=!1;function _tr_init(e){static_init_done||(tr_static_init(),static_init_done=!0),e.l_desc=new TreeDesc(e.dyn_ltree,static_l_desc),e.d_desc=new TreeDesc(e.dyn_dtree,static_d_desc),e.bl_desc=new TreeDesc(e.bl_tree,static_bl_desc),e.bi_buf=0,e.bi_valid=0,init_block(e)}function _tr_stored_block(e,t,r,n){send_bits(e,(STORED_BLOCK<<1)+(n?1:0),3),copy_block(e,t,r,!0)}function _tr_align(e){send_bits(e,STATIC_TREES<<1,3),send_code(e,END_BLOCK,static_ltree),bi_flush(e)}function _tr_flush_block(e,t,r,n){var i,a,s=0;e.level>0?(e.strm.data_type===Z_UNKNOWN&&(e.strm.data_type=detect_data_type(e)),build_tree(e,e.l_desc),build_tree(e,e.d_desc),s=build_bl_tree(e),i=e.opt_len+3+7>>>3,(a=e.static_len+3+7>>>3)<=i&&(i=a)):i=a=r+5,r+4<=i&&-1!==t?_tr_stored_block(e,t,r,n):e.strategy===Z_FIXED||a===i?(send_bits(e,(STATIC_TREES<<1)+(n?1:0),3),compress_block(e,static_ltree,static_dtree)):(send_bits(e,(DYN_TREES<<1)+(n?1:0),3),send_all_trees(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),compress_block(e,e.dyn_ltree,e.dyn_dtree)),init_block(e),n&&bi_windup(e)}function _tr_tally(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(_length_code[r]+LITERALS+1)]++,e.dyn_dtree[2*d_code(t)]++),e.last_lit===e.lit_bufsize-1}var _tr_init_1,_tr_stored_block_1,_tr_flush_block_1,_tr_tally_1,_tr_align_1,trees={_tr_init:_tr_init,_tr_stored_block:_tr_stored_block,_tr_flush_block:_tr_flush_block,_tr_tally:_tr_tally,_tr_align:_tr_align};function adler32(e,t,r,n){for(var i=65535&e|0,a=e>>>16&65535|0,s=0;0!==r;){r-=s=r>2e3?2e3:r;do{i=i+t[n++]|0,a=a+i|0}while(--s);i%=65521,a%=65521}return i|a<<16|0}var adler32_1=adler32;function makeTable(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}var crcTable=makeTable();function crc32(e,t,r,n){var i=crcTable,a=n+r;e^=-1;for(var s=n;s<a;s++)e=e>>>8^i[255&(e^t[s])];return-1^e}var crc32_1=crc32,messages={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Z_NO_FLUSH=0,Z_PARTIAL_FLUSH=1,Z_FULL_FLUSH=3,Z_FINISH=4,Z_BLOCK=5,Z_OK=0,Z_STREAM_END=1,Z_STREAM_ERROR=-2,Z_DATA_ERROR=-3,Z_BUF_ERROR=-5,Z_DEFAULT_COMPRESSION=-1,Z_FILTERED=1,Z_HUFFMAN_ONLY=2,Z_RLE=3,Z_FIXED$1=4,Z_DEFAULT_STRATEGY=0,Z_UNKNOWN$1=2,Z_DEFLATED=8,MAX_MEM_LEVEL=9,MAX_WBITS=15,DEF_MEM_LEVEL=8,LENGTH_CODES$1,LITERALS$1,L_CODES$1=286,D_CODES$1=30,BL_CODES$1=19,HEAP_SIZE$1=2*L_CODES$1+1,MAX_BITS$1=15,MIN_MATCH$1=3,MAX_MATCH$1=258,MIN_LOOKAHEAD=MAX_MATCH$1+MIN_MATCH$1+1,PRESET_DICT=32,INIT_STATE=42,EXTRA_STATE=69,NAME_STATE=73,COMMENT_STATE=91,HCRC_STATE=103,BUSY_STATE=113,FINISH_STATE=666,BS_NEED_MORE=1,BS_BLOCK_DONE=2,BS_FINISH_STARTED=3,BS_FINISH_DONE=4,OS_CODE=3,configuration_table;function err(e,t){return e.msg=messages[t],t}function rank(e){return(e<<1)-(e>4?9:0)}function zero$1(e){for(var t=e.length;--t>=0;)e[t]=0}function flush_pending(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(common.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function flush_block_only(e,t){trees._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,flush_pending(e.strm)}function put_byte(e,t){e.pending_buf[e.pending++]=t}function putShortMSB(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function read_buf(e,t,r,n){var i=e.avail_in;return i>n&&(i=n),0===i?0:(e.avail_in-=i,common.arraySet(t,e.input,e.next_in,i,r),1===e.state.wrap?e.adler=adler32_1(e.adler,t,i,r):2===e.state.wrap&&(e.adler=crc32_1(e.adler,t,i,r)),e.next_in+=i,e.total_in+=i,i)}function longest_match(e,t){var r,n,i=e.max_chain_length,a=e.strstart,s=e.prev_length,o=e.nice_match,l=e.strstart>e.w_size-MIN_LOOKAHEAD?e.strstart-(e.w_size-MIN_LOOKAHEAD):0,u=e.window,c=e.w_mask,h=e.prev,f=e.strstart+MAX_MATCH$1,d=u[a+s-1],p=u[a+s];e.prev_length>=e.good_match&&(i>>=2),o>e.lookahead&&(o=e.lookahead);do{if(u[(r=t)+s]===p&&u[r+s-1]===d&&u[r]===u[a]&&u[++r]===u[a+1]){a+=2,r++;do{}while(u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&a<f);if(n=MAX_MATCH$1-(f-a),a=f-MAX_MATCH$1,n>s){if(e.match_start=t,s=n,n>=o)break;d=u[a+s-1],p=u[a+s]}}}while((t=h[t&c])>l&&0!=--i);return s<=e.lookahead?s:e.lookahead}function fill_window(e){var t,r,n,i,a,s=e.w_size;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=s+(s-MIN_LOOKAHEAD)){common.arraySet(e.window,e.window,s,s,0),e.match_start-=s,e.strstart-=s,e.block_start-=s,r=e.hash_size,t=r;do{n=e.head[--t],e.head[t]=n>=s?n-s:0}while(--r);t=r=s;do{n=e.prev[--t],e.prev[t]=n>=s?n-s:0}while(--r);i+=s}if(0===e.strm.avail_in)break;if(r=read_buf(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=r,e.lookahead+e.insert>=MIN_MATCH$1)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+MIN_MATCH$1-1])&e.hash_mask,e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<MIN_MATCH$1)););}while(e.lookahead<MIN_LOOKAHEAD&&0!==e.strm.avail_in)}function deflate_stored(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(fill_window(e),0===e.lookahead&&t===Z_NO_FLUSH)return BS_NEED_MORE;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+r;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE;if(e.strstart-e.block_start>=e.w_size-MIN_LOOKAHEAD&&(flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE}return e.insert=0,t===Z_FINISH?(flush_block_only(e,!0),0===e.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):(e.strstart>e.block_start&&(flush_block_only(e,!1),e.strm.avail_out),BS_NEED_MORE)}function deflate_fast(e,t){for(var r,n;;){if(e.lookahead<MIN_LOOKAHEAD){if(fill_window(e),e.lookahead<MIN_LOOKAHEAD&&t===Z_NO_FLUSH)return BS_NEED_MORE;if(0===e.lookahead)break}if(r=0,e.lookahead>=MIN_MATCH$1&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+MIN_MATCH$1-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-MIN_LOOKAHEAD&&(e.match_length=longest_match(e,r)),e.match_length>=MIN_MATCH$1)if(n=trees._tr_tally(e,e.strstart-e.match_start,e.match_length-MIN_MATCH$1),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=MIN_MATCH$1){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+MIN_MATCH$1-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=trees._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE}return e.insert=e.strstart<MIN_MATCH$1-1?e.strstart:MIN_MATCH$1-1,t===Z_FINISH?(flush_block_only(e,!0),0===e.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):e.last_lit&&(flush_block_only(e,!1),0===e.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}function deflate_slow(e,t){for(var r,n,i;;){if(e.lookahead<MIN_LOOKAHEAD){if(fill_window(e),e.lookahead<MIN_LOOKAHEAD&&t===Z_NO_FLUSH)return BS_NEED_MORE;if(0===e.lookahead)break}if(r=0,e.lookahead>=MIN_MATCH$1&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+MIN_MATCH$1-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=MIN_MATCH$1-1,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-MIN_LOOKAHEAD&&(e.match_length=longest_match(e,r),e.match_length<=5&&(e.strategy===Z_FILTERED||e.match_length===MIN_MATCH$1&&e.strstart-e.match_start>4096)&&(e.match_length=MIN_MATCH$1-1)),e.prev_length>=MIN_MATCH$1&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-MIN_MATCH$1,n=trees._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-MIN_MATCH$1),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+MIN_MATCH$1-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=MIN_MATCH$1-1,e.strstart++,n&&(flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE}else if(e.match_available){if((n=trees._tr_tally(e,0,e.window[e.strstart-1]))&&flush_block_only(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return BS_NEED_MORE}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=trees._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<MIN_MATCH$1-1?e.strstart:MIN_MATCH$1-1,t===Z_FINISH?(flush_block_only(e,!0),0===e.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):e.last_lit&&(flush_block_only(e,!1),0===e.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}function deflate_rle(e,t){for(var r,n,i,a,s=e.window;;){if(e.lookahead<=MAX_MATCH$1){if(fill_window(e),e.lookahead<=MAX_MATCH$1&&t===Z_NO_FLUSH)return BS_NEED_MORE;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=MIN_MATCH$1&&e.strstart>0&&(i=e.strstart-1,(n=s[i])===s[++i]&&n===s[++i]&&n===s[++i])){a=e.strstart+MAX_MATCH$1;do{}while(n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&i<a);e.match_length=MAX_MATCH$1-(a-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=MIN_MATCH$1?(r=trees._tr_tally(e,1,e.match_length-MIN_MATCH$1),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=trees._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE}return e.insert=0,t===Z_FINISH?(flush_block_only(e,!0),0===e.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):e.last_lit&&(flush_block_only(e,!1),0===e.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}function deflate_huff(e,t){for(var r;;){if(0===e.lookahead&&(fill_window(e),0===e.lookahead)){if(t===Z_NO_FLUSH)return BS_NEED_MORE;break}if(e.match_length=0,r=trees._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE}return e.insert=0,t===Z_FINISH?(flush_block_only(e,!0),0===e.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):e.last_lit&&(flush_block_only(e,!1),0===e.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}function Config(e,t,r,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=i}function lm_init(e){e.window_size=2*e.w_size,zero$1(e.head),e.max_lazy_match=configuration_table[e.level].max_lazy,e.good_match=configuration_table[e.level].good_length,e.nice_match=configuration_table[e.level].nice_length,e.max_chain_length=configuration_table[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=MIN_MATCH$1-1,e.match_available=0,e.ins_h=0}function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z_DEFLATED,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new common.Buf16(2*HEAP_SIZE$1),this.dyn_dtree=new common.Buf16(2*(2*D_CODES$1+1)),this.bl_tree=new common.Buf16(2*(2*BL_CODES$1+1)),zero$1(this.dyn_ltree),zero$1(this.dyn_dtree),zero$1(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new common.Buf16(MAX_BITS$1+1),this.heap=new common.Buf16(2*L_CODES$1+1),zero$1(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new common.Buf16(2*L_CODES$1+1),zero$1(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function deflateResetKeep(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=Z_UNKNOWN$1,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?INIT_STATE:BUSY_STATE,e.adler=2===t.wrap?0:1,t.last_flush=Z_NO_FLUSH,trees._tr_init(t),Z_OK):err(e,Z_STREAM_ERROR)}function deflateReset(e){var t=deflateResetKeep(e);return t===Z_OK&&lm_init(e.state),t}function deflateSetHeader(e,t){return e&&e.state?2!==e.state.wrap?Z_STREAM_ERROR:(e.state.gzhead=t,Z_OK):Z_STREAM_ERROR}function deflateInit2(e,t,r,n,i,a){if(!e)return Z_STREAM_ERROR;var s=1;if(t===Z_DEFAULT_COMPRESSION&&(t=6),n<0?(s=0,n=-n):n>15&&(s=2,n-=16),i<1||i>MAX_MEM_LEVEL||r!==Z_DEFLATED||n<8||n>15||t<0||t>9||a<0||a>Z_FIXED$1)return err(e,Z_STREAM_ERROR);8===n&&(n=9);var o=new DeflateState;return e.state=o,o.strm=e,o.wrap=s,o.gzhead=null,o.w_bits=n,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=i+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+MIN_MATCH$1-1)/MIN_MATCH$1),o.window=new common.Buf8(2*o.w_size),o.head=new common.Buf16(o.hash_size),o.prev=new common.Buf16(o.w_size),o.lit_bufsize=1<<i+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new common.Buf8(o.pending_buf_size),o.d_buf=1*o.lit_bufsize,o.l_buf=3*o.lit_bufsize,o.level=t,o.strategy=a,o.method=r,deflateReset(e)}function deflateInit(e,t){return deflateInit2(e,t,Z_DEFLATED,MAX_WBITS,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY)}function deflate(e,t){var r,n,i,a;if(!e||!e.state||t>Z_BLOCK||t<0)return e?err(e,Z_STREAM_ERROR):Z_STREAM_ERROR;if(n=e.state,!e.output||!e.input&&0!==e.avail_in||n.status===FINISH_STATE&&t!==Z_FINISH)return err(e,0===e.avail_out?Z_BUF_ERROR:Z_STREAM_ERROR);if(n.strm=e,r=n.last_flush,n.last_flush=t,n.status===INIT_STATE)if(2===n.wrap)e.adler=0,put_byte(n,31),put_byte(n,139),put_byte(n,8),n.gzhead?(put_byte(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),put_byte(n,255&n.gzhead.time),put_byte(n,n.gzhead.time>>8&255),put_byte(n,n.gzhead.time>>16&255),put_byte(n,n.gzhead.time>>24&255),put_byte(n,9===n.level?2:n.strategy>=Z_HUFFMAN_ONLY||n.level<2?4:0),put_byte(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(put_byte(n,255&n.gzhead.extra.length),put_byte(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=crc32_1(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=EXTRA_STATE):(put_byte(n,0),put_byte(n,0),put_byte(n,0),put_byte(n,0),put_byte(n,0),put_byte(n,9===n.level?2:n.strategy>=Z_HUFFMAN_ONLY||n.level<2?4:0),put_byte(n,OS_CODE),n.status=BUSY_STATE);else{var s=Z_DEFLATED+(n.w_bits-8<<4)<<8,o=-1;o=n.strategy>=Z_HUFFMAN_ONLY||n.level<2?0:n.level<6?1:6===n.level?2:3,s|=o<<6,0!==n.strstart&&(s|=PRESET_DICT),s+=31-s%31,n.status=BUSY_STATE,putShortMSB(n,s),0!==n.strstart&&(putShortMSB(n,e.adler>>>16),putShortMSB(n,65535&e.adler)),e.adler=1}if(n.status===EXTRA_STATE)if(n.gzhead.extra){for(i=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>i&&(e.adler=crc32_1(e.adler,n.pending_buf,n.pending-i,i)),flush_pending(e),i=n.pending,n.pending!==n.pending_buf_size));)put_byte(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>i&&(e.adler=crc32_1(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=NAME_STATE)}else n.status=NAME_STATE;if(n.status===NAME_STATE)if(n.gzhead.name){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(e.adler=crc32_1(e.adler,n.pending_buf,n.pending-i,i)),flush_pending(e),i=n.pending,n.pending===n.pending_buf_size)){a=1;break}a=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,put_byte(n,a)}while(0!==a);n.gzhead.hcrc&&n.pending>i&&(e.adler=crc32_1(e.adler,n.pending_buf,n.pending-i,i)),0===a&&(n.gzindex=0,n.status=COMMENT_STATE)}else n.status=COMMENT_STATE;if(n.status===COMMENT_STATE)if(n.gzhead.comment){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(e.adler=crc32_1(e.adler,n.pending_buf,n.pending-i,i)),flush_pending(e),i=n.pending,n.pending===n.pending_buf_size)){a=1;break}a=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,put_byte(n,a)}while(0!==a);n.gzhead.hcrc&&n.pending>i&&(e.adler=crc32_1(e.adler,n.pending_buf,n.pending-i,i)),0===a&&(n.status=HCRC_STATE)}else n.status=HCRC_STATE;if(n.status===HCRC_STATE&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&flush_pending(e),n.pending+2<=n.pending_buf_size&&(put_byte(n,255&e.adler),put_byte(n,e.adler>>8&255),e.adler=0,n.status=BUSY_STATE)):n.status=BUSY_STATE),0!==n.pending){if(flush_pending(e),0===e.avail_out)return n.last_flush=-1,Z_OK}else if(0===e.avail_in&&rank(t)<=rank(r)&&t!==Z_FINISH)return err(e,Z_BUF_ERROR);if(n.status===FINISH_STATE&&0!==e.avail_in)return err(e,Z_BUF_ERROR);if(0!==e.avail_in||0!==n.lookahead||t!==Z_NO_FLUSH&&n.status!==FINISH_STATE){var l=n.strategy===Z_HUFFMAN_ONLY?deflate_huff(n,t):n.strategy===Z_RLE?deflate_rle(n,t):configuration_table[n.level].func(n,t);if(l!==BS_FINISH_STARTED&&l!==BS_FINISH_DONE||(n.status=FINISH_STATE),l===BS_NEED_MORE||l===BS_FINISH_STARTED)return 0===e.avail_out&&(n.last_flush=-1),Z_OK;if(l===BS_BLOCK_DONE&&(t===Z_PARTIAL_FLUSH?trees._tr_align(n):t!==Z_BLOCK&&(trees._tr_stored_block(n,0,0,!1),t===Z_FULL_FLUSH&&(zero$1(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),flush_pending(e),0===e.avail_out))return n.last_flush=-1,Z_OK}return t!==Z_FINISH?Z_OK:n.wrap<=0?Z_STREAM_END:(2===n.wrap?(put_byte(n,255&e.adler),put_byte(n,e.adler>>8&255),put_byte(n,e.adler>>16&255),put_byte(n,e.adler>>24&255),put_byte(n,255&e.total_in),put_byte(n,e.total_in>>8&255),put_byte(n,e.total_in>>16&255),put_byte(n,e.total_in>>24&255)):(putShortMSB(n,e.adler>>>16),putShortMSB(n,65535&e.adler)),flush_pending(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?Z_OK:Z_STREAM_END)}function deflateEnd(e){var t;return e&&e.state?(t=e.state.status)!==INIT_STATE&&t!==EXTRA_STATE&&t!==NAME_STATE&&t!==COMMENT_STATE&&t!==HCRC_STATE&&t!==BUSY_STATE&&t!==FINISH_STATE?err(e,Z_STREAM_ERROR):(e.state=null,t===BUSY_STATE?err(e,Z_DATA_ERROR):Z_OK):Z_STREAM_ERROR}function deflateSetDictionary(e,t){var r,n,i,a,s,o,l,u,c=t.length;if(!e||!e.state)return Z_STREAM_ERROR;if(r=e.state,2===(a=r.wrap)||1===a&&r.status!==INIT_STATE||r.lookahead)return Z_STREAM_ERROR;for(1===a&&(e.adler=adler32_1(e.adler,t,c,0)),r.wrap=0,c>=r.w_size&&(0===a&&(zero$1(r.head),r.strstart=0,r.block_start=0,r.insert=0),u=new common.Buf8(r.w_size),common.arraySet(u,t,c-r.w_size,r.w_size,0),t=u,c=r.w_size),s=e.avail_in,o=e.next_in,l=e.input,e.avail_in=c,e.next_in=0,e.input=t,fill_window(r);r.lookahead>=MIN_MATCH$1;){n=r.strstart,i=r.lookahead-(MIN_MATCH$1-1);do{r.ins_h=(r.ins_h<<r.hash_shift^r.window[n+MIN_MATCH$1-1])&r.hash_mask,r.prev[n&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=n,n++}while(--i);r.strstart=n,r.lookahead=MIN_MATCH$1-1,fill_window(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=MIN_MATCH$1-1,r.match_available=0,e.next_in=o,e.input=l,e.avail_in=s,r.wrap=a,Z_OK}configuration_table=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)];var deflateInit_1,deflateInit2_1,deflateReset_1,deflateResetKeep_1,deflateSetHeader_1,deflate_2,deflateEnd_1,deflateSetDictionary_1,deflateInfo,deflate_1={deflateInit:deflateInit,deflateInit2:deflateInit2,deflateReset:deflateReset,deflateResetKeep:deflateResetKeep,deflateSetHeader:deflateSetHeader,deflate:deflate,deflateEnd:deflateEnd,deflateSetDictionary:deflateSetDictionary,deflateInfo:"pako deflate (from Nodeca project)"},STR_APPLY_OK=!0,STR_APPLY_UIA_OK=!0,string2buf;try{String.fromCharCode.apply(null,[0])}catch(e){STR_APPLY_OK=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){STR_APPLY_UIA_OK=!1}for(var _utf8len=new common.Buf8(256),q=0;q<256;q++)_utf8len[q]=q>=252?6:q>=248?5:q>=240?4:q>=224?3:q>=192?2:1;function buf2binstring(e,t){if(t<65537&&(e.subarray&&STR_APPLY_UIA_OK||!e.subarray&&STR_APPLY_OK))return String.fromCharCode.apply(null,common.shrinkBuf(e,t));for(var r="",n=0;n<t;n++)r+=String.fromCharCode(e[n]);return r}_utf8len[254]=_utf8len[254]=1;var buf2binstring_1,binstring2buf,buf2string,utf8border,strings={string2buf:function(e){var t,r,n,i,a,s=e.length,o=0;for(i=0;i<s;i++)55296==(64512&(r=e.charCodeAt(i)))&&i+1<s&&56320==(64512&(n=e.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),o+=r<128?1:r<2048?2:r<65536?3:4;for(t=new common.Buf8(o),a=0,i=0;a<o;i++)55296==(64512&(r=e.charCodeAt(i)))&&i+1<s&&56320==(64512&(n=e.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),r<128?t[a++]=r:r<2048?(t[a++]=192|r>>>6,t[a++]=128|63&r):r<65536?(t[a++]=224|r>>>12,t[a++]=128|r>>>6&63,t[a++]=128|63&r):(t[a++]=240|r>>>18,t[a++]=128|r>>>12&63,t[a++]=128|r>>>6&63,t[a++]=128|63&r);return t},buf2binstring:function(e){return buf2binstring(e,e.length)},binstring2buf:function(e){for(var t=new common.Buf8(e.length),r=0,n=t.length;r<n;r++)t[r]=e.charCodeAt(r);return t},buf2string:function(e,t){var r,n,i,a,s=t||e.length,o=new Array(2*s);for(n=0,r=0;r<s;)if((i=e[r++])<128)o[n++]=i;else if((a=_utf8len[i])>4)o[n++]=65533,r+=a-1;else{for(i&=2===a?31:3===a?15:7;a>1&&r<s;)i=i<<6|63&e[r++],a--;a>1?o[n++]=65533:i<65536?o[n++]=i:(i-=65536,o[n++]=55296|i>>10&1023,o[n++]=56320|1023&i)}return buf2binstring(o,n)},utf8border:function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;r>=0&&128==(192&e[r]);)r--;return r<0?t:0===r?t:r+_utf8len[e[r]]>t?r:t}};function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var zstream=ZStream,toString=Object.prototype.toString,Z_NO_FLUSH$1=0,Z_FINISH$1=4,Z_OK$1=0,Z_STREAM_END$1=1,Z_SYNC_FLUSH=2,Z_DEFAULT_COMPRESSION$1=-1,Z_DEFAULT_STRATEGY$1=0,Z_DEFLATED$1=8;function Deflate(e){if(!(this instanceof Deflate))return new Deflate(e);this.options=common.assign({level:Z_DEFAULT_COMPRESSION$1,method:Z_DEFLATED$1,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z_DEFAULT_STRATEGY$1,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;var r=deflate_1.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==Z_OK$1)throw new Error(messages[r]);if(t.header&&deflate_1.deflateSetHeader(this.strm,t.header),t.dictionary){var n;if(n="string"==typeof t.dictionary?strings.string2buf(t.dictionary):"[object ArrayBuffer]"===toString.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(r=deflate_1.deflateSetDictionary(this.strm,n))!==Z_OK$1)throw new Error(messages[r]);this._dict_set=!0}}function deflate$1(e,t){var r=new Deflate(t);if(r.push(e,!0),r.err)throw r.msg||messages[r.err];return r.result}function deflateRaw(e,t){return(t=t||{}).raw=!0,deflate$1(e,t)}function gzip(e,t){return(t=t||{}).gzip=!0,deflate$1(e,t)}Deflate.prototype.push=function(e,t){var r,n,i=this.strm,a=this.options.chunkSize;if(this.ended)return!1;n=t===~~t?t:!0===t?Z_FINISH$1:Z_NO_FLUSH$1,"string"==typeof e?i.input=strings.string2buf(e):"[object ArrayBuffer]"===toString.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;do{if(0===i.avail_out&&(i.output=new common.Buf8(a),i.next_out=0,i.avail_out=a),(r=deflate_1.deflate(i,n))!==Z_STREAM_END$1&&r!==Z_OK$1)return this.onEnd(r),this.ended=!0,!1;0!==i.avail_out&&(0!==i.avail_in||n!==Z_FINISH$1&&n!==Z_SYNC_FLUSH)||("string"===this.options.to?this.onData(strings.buf2binstring(common.shrinkBuf(i.output,i.next_out))):this.onData(common.shrinkBuf(i.output,i.next_out)))}while((i.avail_in>0||0===i.avail_out)&&r!==Z_STREAM_END$1);return n===Z_FINISH$1?(r=deflate_1.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===Z_OK$1):n!==Z_SYNC_FLUSH||(this.onEnd(Z_OK$1),i.avail_out=0,!0)},Deflate.prototype.onData=function(e){this.chunks.push(e)},Deflate.prototype.onEnd=function(e){e===Z_OK$1&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Deflate_1,deflate_2$1,deflateRaw_1,gzip_1,deflate_1$1={Deflate:Deflate,deflate:deflate$1,deflateRaw:deflateRaw,gzip:gzip},BAD=30,TYPE=12,inffast=function(e,t){var r,n,i,a,s,o,l,u,c,h,f,d,p,g,_,y,m,v,b,w,E,T,k,x,S;r=e.state,n=e.next_in,x=e.input,i=n+(e.avail_in-5),a=e.next_out,S=e.output,s=a-(t-e.avail_out),o=a+(e.avail_out-257),l=r.dmax,u=r.wsize,c=r.whave,h=r.wnext,f=r.window,d=r.hold,p=r.bits,g=r.lencode,_=r.distcode,y=(1<<r.lenbits)-1,m=(1<<r.distbits)-1;e:do{p<15&&(d+=x[n++]<<p,p+=8,d+=x[n++]<<p,p+=8),v=g[d&y];t:for(;;){if(d>>>=b=v>>>24,p-=b,0==(b=v>>>16&255))S[a++]=65535&v;else{if(!(16&b)){if(0==(64&b)){v=g[(65535&v)+(d&(1<<b)-1)];continue t}if(32&b){r.mode=TYPE;break e}e.msg="invalid literal/length code",r.mode=BAD;break e}w=65535&v,(b&=15)&&(p<b&&(d+=x[n++]<<p,p+=8),w+=d&(1<<b)-1,d>>>=b,p-=b),p<15&&(d+=x[n++]<<p,p+=8,d+=x[n++]<<p,p+=8),v=_[d&m];r:for(;;){if(d>>>=b=v>>>24,p-=b,!(16&(b=v>>>16&255))){if(0==(64&b)){v=_[(65535&v)+(d&(1<<b)-1)];continue r}e.msg="invalid distance code",r.mode=BAD;break e}if(E=65535&v,p<(b&=15)&&(d+=x[n++]<<p,(p+=8)<b&&(d+=x[n++]<<p,p+=8)),(E+=d&(1<<b)-1)>l){e.msg="invalid distance too far back",r.mode=BAD;break e}if(d>>>=b,p-=b,E>(b=a-s)){if((b=E-b)>c&&r.sane){e.msg="invalid distance too far back",r.mode=BAD;break e}if(T=0,k=f,0===h){if(T+=u-b,b<w){w-=b;do{S[a++]=f[T++]}while(--b);T=a-E,k=S}}else if(h<b){if(T+=u+h-b,(b-=h)<w){w-=b;do{S[a++]=f[T++]}while(--b);if(T=0,h<w){w-=b=h;do{S[a++]=f[T++]}while(--b);T=a-E,k=S}}}else if(T+=h-b,b<w){w-=b;do{S[a++]=f[T++]}while(--b);T=a-E,k=S}for(;w>2;)S[a++]=k[T++],S[a++]=k[T++],S[a++]=k[T++],w-=3;w&&(S[a++]=k[T++],w>1&&(S[a++]=k[T++]))}else{T=a-E;do{S[a++]=S[T++],S[a++]=S[T++],S[a++]=S[T++],w-=3}while(w>2);w&&(S[a++]=S[T++],w>1&&(S[a++]=S[T++]))}break}}break}}while(n<i&&a<o);n-=w=p>>3,d&=(1<<(p-=w<<3))-1,e.next_in=n,e.next_out=a,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=a<o?o-a+257:257-(a-o),r.hold=d,r.bits=p},MAXBITS=15,ENOUGH_LENS=852,ENOUGH_DISTS=592,CODES=0,LENS=1,DISTS=2,lbase=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],lext=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],dbase=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],dext=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],inftrees=function(e,t,r,n,i,a,s,o){var l,u,c,h,f,d,p,g,_,y=o.bits,m=0,v=0,b=0,w=0,E=0,T=0,k=0,x=0,S=0,I=0,A=null,M=0,N=new common.Buf16(MAXBITS+1),C=new common.Buf16(MAXBITS+1),O=null,D=0;for(m=0;m<=MAXBITS;m++)N[m]=0;for(v=0;v<n;v++)N[t[r+v]]++;for(E=y,w=MAXBITS;w>=1&&0===N[w];w--);if(E>w&&(E=w),0===w)return i[a++]=20971520,i[a++]=20971520,o.bits=1,0;for(b=1;b<w&&0===N[b];b++);for(E<b&&(E=b),x=1,m=1;m<=MAXBITS;m++)if(x<<=1,(x-=N[m])<0)return-1;if(x>0&&(e===CODES||1!==w))return-1;for(C[1]=0,m=1;m<MAXBITS;m++)C[m+1]=C[m]+N[m];for(v=0;v<n;v++)0!==t[r+v]&&(s[C[t[r+v]]++]=v);if(e===CODES?(A=O=s,d=19):e===LENS?(A=lbase,M-=257,O=lext,D-=257,d=256):(A=dbase,O=dext,d=-1),I=0,v=0,m=b,f=a,T=E,k=0,c=-1,h=(S=1<<E)-1,e===LENS&&S>ENOUGH_LENS||e===DISTS&&S>ENOUGH_DISTS)return 1;for(;;){p=m-k,s[v]<d?(g=0,_=s[v]):s[v]>d?(g=O[D+s[v]],_=A[M+s[v]]):(g=96,_=0),l=1<<m-k,b=u=1<<T;do{i[f+(I>>k)+(u-=l)]=p<<24|g<<16|_|0}while(0!==u);for(l=1<<m-1;I&l;)l>>=1;if(0!==l?(I&=l-1,I+=l):I=0,v++,0==--N[m]){if(m===w)break;m=t[r+s[v]]}if(m>E&&(I&h)!==c){for(0===k&&(k=E),f+=b,x=1<<(T=m-k);T+k<w&&!((x-=N[T+k])<=0);)T++,x<<=1;if(S+=1<<T,e===LENS&&S>ENOUGH_LENS||e===DISTS&&S>ENOUGH_DISTS)return 1;i[c=I&h]=E<<24|T<<16|f-a|0}}return 0!==I&&(i[f+I]=m-k<<24|64<<16|0),o.bits=E,0},CODES$1=0,LENS$1=1,DISTS$1=2,Z_FINISH$2=4,Z_BLOCK$1=5,Z_TREES=6,Z_OK$2=0,Z_STREAM_END$2=1,Z_NEED_DICT=2,Z_STREAM_ERROR$1=-2,Z_DATA_ERROR$1=-3,Z_MEM_ERROR=-4,Z_BUF_ERROR$1=-5,Z_DEFLATED$2=8,HEAD=1,FLAGS=2,TIME=3,OS=4,EXLEN=5,EXTRA=6,NAME=7,COMMENT=8,HCRC=9,DICTID=10,DICT=11,TYPE$1=12,TYPEDO=13,STORED=14,COPY_=15,COPY=16,TABLE=17,LENLENS=18,CODELENS=19,LEN_=20,LEN=21,LENEXT=22,DIST=23,DISTEXT=24,MATCH=25,LIT=26,CHECK=27,LENGTH=28,DONE=29,BAD$1=30,MEM=31,SYNC=32,ENOUGH_LENS$1=852,ENOUGH_DISTS$1=592,MAX_WBITS$1,DEF_WBITS=15;function zswap32(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function InflateState(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new common.Buf16(320),this.work=new common.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function inflateResetKeep(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=HEAD,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new common.Buf32(ENOUGH_LENS$1),t.distcode=t.distdyn=new common.Buf32(ENOUGH_DISTS$1),t.sane=1,t.back=-1,Z_OK$2):Z_STREAM_ERROR$1}function inflateReset(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,inflateResetKeep(e)):Z_STREAM_ERROR$1}function inflateReset2(e,t){var r,n;return e&&e.state?(n=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Z_STREAM_ERROR$1:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,inflateReset(e))):Z_STREAM_ERROR$1}function inflateInit2(e,t){var r,n;return e?(n=new InflateState,e.state=n,n.window=null,(r=inflateReset2(e,t))!==Z_OK$2&&(e.state=null),r):Z_STREAM_ERROR$1}function inflateInit(e){return inflateInit2(e,DEF_WBITS)}var virgin=!0,lenfix,distfix;function fixedtables(e){if(virgin){var t;for(lenfix=new common.Buf32(512),distfix=new common.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(inftrees(LENS$1,e.lens,0,288,lenfix,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;inftrees(DISTS$1,e.lens,0,32,distfix,0,e.work,{bits:5}),virgin=!1}e.lencode=lenfix,e.lenbits=9,e.distcode=distfix,e.distbits=5}function updatewindow(e,t,r,n){var i,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new common.Buf8(a.wsize)),n>=a.wsize?(common.arraySet(a.window,t,r-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((i=a.wsize-a.wnext)>n&&(i=n),common.arraySet(a.window,t,r-n,i,a.wnext),(n-=i)?(common.arraySet(a.window,t,r-n,n,0),a.wnext=n,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0}function inflate(e,t){var r,n,i,a,s,o,l,u,c,h,f,d,p,g,_,y,m,v,b,w,E,T,k,x,S=0,I=new common.Buf8(4),A=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return Z_STREAM_ERROR$1;(r=e.state).mode===TYPE$1&&(r.mode=TYPEDO),s=e.next_out,i=e.output,l=e.avail_out,a=e.next_in,n=e.input,o=e.avail_in,u=r.hold,c=r.bits,h=o,f=l,T=Z_OK$2;e:for(;;)switch(r.mode){case HEAD:if(0===r.wrap){r.mode=TYPEDO;break}for(;c<16;){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}if(2&r.wrap&&35615===u){r.check=0,I[0]=255&u,I[1]=u>>>8&255,r.check=crc32_1(r.check,I,2,0),u=0,c=0,r.mode=FLAGS;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&u)<<8)+(u>>8))%31){e.msg="incorrect header check",r.mode=BAD$1;break}if((15&u)!==Z_DEFLATED$2){e.msg="unknown compression method",r.mode=BAD$1;break}if(c-=4,E=8+(15&(u>>>=4)),0===r.wbits)r.wbits=E;else if(E>r.wbits){e.msg="invalid window size",r.mode=BAD$1;break}r.dmax=1<<E,e.adler=r.check=1,r.mode=512&u?DICTID:TYPE$1,u=0,c=0;break;case FLAGS:for(;c<16;){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}if(r.flags=u,(255&r.flags)!==Z_DEFLATED$2){e.msg="unknown compression method",r.mode=BAD$1;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=BAD$1;break}r.head&&(r.head.text=u>>8&1),512&r.flags&&(I[0]=255&u,I[1]=u>>>8&255,r.check=crc32_1(r.check,I,2,0)),u=0,c=0,r.mode=TIME;case TIME:for(;c<32;){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}r.head&&(r.head.time=u),512&r.flags&&(I[0]=255&u,I[1]=u>>>8&255,I[2]=u>>>16&255,I[3]=u>>>24&255,r.check=crc32_1(r.check,I,4,0)),u=0,c=0,r.mode=OS;case OS:for(;c<16;){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}r.head&&(r.head.xflags=255&u,r.head.os=u>>8),512&r.flags&&(I[0]=255&u,I[1]=u>>>8&255,r.check=crc32_1(r.check,I,2,0)),u=0,c=0,r.mode=EXLEN;case EXLEN:if(1024&r.flags){for(;c<16;){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}r.length=u,r.head&&(r.head.extra_len=u),512&r.flags&&(I[0]=255&u,I[1]=u>>>8&255,r.check=crc32_1(r.check,I,2,0)),u=0,c=0}else r.head&&(r.head.extra=null);r.mode=EXTRA;case EXTRA:if(1024&r.flags&&((d=r.length)>o&&(d=o),d&&(r.head&&(E=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),common.arraySet(r.head.extra,n,a,d,E)),512&r.flags&&(r.check=crc32_1(r.check,n,d,a)),o-=d,a+=d,r.length-=d),r.length))break e;r.length=0,r.mode=NAME;case NAME:if(2048&r.flags){if(0===o)break e;d=0;do{E=n[a+d++],r.head&&E&&r.length<65536&&(r.head.name+=String.fromCharCode(E))}while(E&&d<o);if(512&r.flags&&(r.check=crc32_1(r.check,n,d,a)),o-=d,a+=d,E)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=COMMENT;case COMMENT:if(4096&r.flags){if(0===o)break e;d=0;do{E=n[a+d++],r.head&&E&&r.length<65536&&(r.head.comment+=String.fromCharCode(E))}while(E&&d<o);if(512&r.flags&&(r.check=crc32_1(r.check,n,d,a)),o-=d,a+=d,E)break e}else r.head&&(r.head.comment=null);r.mode=HCRC;case HCRC:if(512&r.flags){for(;c<16;){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}if(u!==(65535&r.check)){e.msg="header crc mismatch",r.mode=BAD$1;break}u=0,c=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=TYPE$1;break;case DICTID:for(;c<32;){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}e.adler=r.check=zswap32(u),u=0,c=0,r.mode=DICT;case DICT:if(0===r.havedict)return e.next_out=s,e.avail_out=l,e.next_in=a,e.avail_in=o,r.hold=u,r.bits=c,Z_NEED_DICT;e.adler=r.check=1,r.mode=TYPE$1;case TYPE$1:if(t===Z_BLOCK$1||t===Z_TREES)break e;case TYPEDO:if(r.last){u>>>=7&c,c-=7&c,r.mode=CHECK;break}for(;c<3;){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}switch(r.last=1&u,c-=1,3&(u>>>=1)){case 0:r.mode=STORED;break;case 1:if(fixedtables(r),r.mode=LEN_,t===Z_TREES){u>>>=2,c-=2;break e}break;case 2:r.mode=TABLE;break;case 3:e.msg="invalid block type",r.mode=BAD$1}u>>>=2,c-=2;break;case STORED:for(u>>>=7&c,c-=7&c;c<32;){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}if((65535&u)!=(u>>>16^65535)){e.msg="invalid stored block lengths",r.mode=BAD$1;break}if(r.length=65535&u,u=0,c=0,r.mode=COPY_,t===Z_TREES)break e;case COPY_:r.mode=COPY;case COPY:if(d=r.length){if(d>o&&(d=o),d>l&&(d=l),0===d)break e;common.arraySet(i,n,a,d,s),o-=d,a+=d,l-=d,s+=d,r.length-=d;break}r.mode=TYPE$1;break;case TABLE:for(;c<14;){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}if(r.nlen=257+(31&u),u>>>=5,c-=5,r.ndist=1+(31&u),u>>>=5,c-=5,r.ncode=4+(15&u),u>>>=4,c-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=BAD$1;break}r.have=0,r.mode=LENLENS;case LENLENS:for(;r.have<r.ncode;){for(;c<3;){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}r.lens[A[r.have++]]=7&u,u>>>=3,c-=3}for(;r.have<19;)r.lens[A[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,k={bits:r.lenbits},T=inftrees(CODES$1,r.lens,0,19,r.lencode,0,r.work,k),r.lenbits=k.bits,T){e.msg="invalid code lengths set",r.mode=BAD$1;break}r.have=0,r.mode=CODELENS;case CODELENS:for(;r.have<r.nlen+r.ndist;){for(;S=r.lencode[u&(1<<r.lenbits)-1],y=S>>>16&255,m=65535&S,!((_=S>>>24)<=c);){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}if(m<16)u>>>=_,c-=_,r.lens[r.have++]=m;else{if(16===m){for(x=_+2;c<x;){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}if(u>>>=_,c-=_,0===r.have){e.msg="invalid bit length repeat",r.mode=BAD$1;break}E=r.lens[r.have-1],d=3+(3&u),u>>>=2,c-=2}else if(17===m){for(x=_+3;c<x;){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}c-=_,E=0,d=3+(7&(u>>>=_)),u>>>=3,c-=3}else{for(x=_+7;c<x;){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}c-=_,E=0,d=11+(127&(u>>>=_)),u>>>=7,c-=7}if(r.have+d>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=BAD$1;break}for(;d--;)r.lens[r.have++]=E}}if(r.mode===BAD$1)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=BAD$1;break}if(r.lenbits=9,k={bits:r.lenbits},T=inftrees(LENS$1,r.lens,0,r.nlen,r.lencode,0,r.work,k),r.lenbits=k.bits,T){e.msg="invalid literal/lengths set",r.mode=BAD$1;break}if(r.distbits=6,r.distcode=r.distdyn,k={bits:r.distbits},T=inftrees(DISTS$1,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,k),r.distbits=k.bits,T){e.msg="invalid distances set",r.mode=BAD$1;break}if(r.mode=LEN_,t===Z_TREES)break e;case LEN_:r.mode=LEN;case LEN:if(o>=6&&l>=258){e.next_out=s,e.avail_out=l,e.next_in=a,e.avail_in=o,r.hold=u,r.bits=c,inffast(e,f),s=e.next_out,i=e.output,l=e.avail_out,a=e.next_in,n=e.input,o=e.avail_in,u=r.hold,c=r.bits,r.mode===TYPE$1&&(r.back=-1);break}for(r.back=0;S=r.lencode[u&(1<<r.lenbits)-1],y=S>>>16&255,m=65535&S,!((_=S>>>24)<=c);){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}if(y&&0==(240&y)){for(v=_,b=y,w=m;S=r.lencode[w+((u&(1<<v+b)-1)>>v)],y=S>>>16&255,m=65535&S,!(v+(_=S>>>24)<=c);){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}u>>>=v,c-=v,r.back+=v}if(u>>>=_,c-=_,r.back+=_,r.length=m,0===y){r.mode=LIT;break}if(32&y){r.back=-1,r.mode=TYPE$1;break}if(64&y){e.msg="invalid literal/length code",r.mode=BAD$1;break}r.extra=15&y,r.mode=LENEXT;case LENEXT:if(r.extra){for(x=r.extra;c<x;){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}r.length+=u&(1<<r.extra)-1,u>>>=r.extra,c-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=DIST;case DIST:for(;S=r.distcode[u&(1<<r.distbits)-1],y=S>>>16&255,m=65535&S,!((_=S>>>24)<=c);){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}if(0==(240&y)){for(v=_,b=y,w=m;S=r.distcode[w+((u&(1<<v+b)-1)>>v)],y=S>>>16&255,m=65535&S,!(v+(_=S>>>24)<=c);){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}u>>>=v,c-=v,r.back+=v}if(u>>>=_,c-=_,r.back+=_,64&y){e.msg="invalid distance code",r.mode=BAD$1;break}r.offset=m,r.extra=15&y,r.mode=DISTEXT;case DISTEXT:if(r.extra){for(x=r.extra;c<x;){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}r.offset+=u&(1<<r.extra)-1,u>>>=r.extra,c-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=BAD$1;break}r.mode=MATCH;case MATCH:if(0===l)break e;if(d=f-l,r.offset>d){if((d=r.offset-d)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=BAD$1;break}d>r.wnext?(d-=r.wnext,p=r.wsize-d):p=r.wnext-d,d>r.length&&(d=r.length),g=r.window}else g=i,p=s-r.offset,d=r.length;d>l&&(d=l),l-=d,r.length-=d;do{i[s++]=g[p++]}while(--d);0===r.length&&(r.mode=LEN);break;case LIT:if(0===l)break e;i[s++]=r.length,l--,r.mode=LEN;break;case CHECK:if(r.wrap){for(;c<32;){if(0===o)break e;o--,u|=n[a++]<<c,c+=8}if(f-=l,e.total_out+=f,r.total+=f,f&&(e.adler=r.check=r.flags?crc32_1(r.check,i,f,s-f):adler32_1(r.check,i,f,s-f)),f=l,(r.flags?u:zswap32(u))!==r.check){e.msg="incorrect data check",r.mode=BAD$1;break}u=0,c=0}r.mode=LENGTH;case LENGTH:if(r.wrap&&r.flags){for(;c<32;){if(0===o)break e;o--,u+=n[a++]<<c,c+=8}if(u!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=BAD$1;break}u=0,c=0}r.mode=DONE;case DONE:T=Z_STREAM_END$2;break e;case BAD$1:T=Z_DATA_ERROR$1;break e;case MEM:return Z_MEM_ERROR;case SYNC:default:return Z_STREAM_ERROR$1}return e.next_out=s,e.avail_out=l,e.next_in=a,e.avail_in=o,r.hold=u,r.bits=c,(r.wsize||f!==e.avail_out&&r.mode<BAD$1&&(r.mode<CHECK||t!==Z_FINISH$2))&&updatewindow(e,e.output,e.next_out,f-e.avail_out)?(r.mode=MEM,Z_MEM_ERROR):(h-=e.avail_in,f-=e.avail_out,e.total_in+=h,e.total_out+=f,r.total+=f,r.wrap&&f&&(e.adler=r.check=r.flags?crc32_1(r.check,i,f,e.next_out-f):adler32_1(r.check,i,f,e.next_out-f)),e.data_type=r.bits+(r.last?64:0)+(r.mode===TYPE$1?128:0)+(r.mode===LEN_||r.mode===COPY_?256:0),(0===h&&0===f||t===Z_FINISH$2)&&T===Z_OK$2&&(T=Z_BUF_ERROR$1),T)}function inflateEnd(e){if(!e||!e.state)return Z_STREAM_ERROR$1;var t=e.state;return t.window&&(t.window=null),e.state=null,Z_OK$2}function inflateGetHeader(e,t){var r;return e&&e.state?0==(2&(r=e.state).wrap)?Z_STREAM_ERROR$1:(r.head=t,t.done=!1,Z_OK$2):Z_STREAM_ERROR$1}function inflateSetDictionary(e,t){var r,n=t.length;return e&&e.state?0!==(r=e.state).wrap&&r.mode!==DICT?Z_STREAM_ERROR$1:r.mode===DICT&&adler32_1(1,t,n,0)!==r.check?Z_DATA_ERROR$1:updatewindow(e,t,n,n)?(r.mode=MEM,Z_MEM_ERROR):(r.havedict=1,Z_OK$2):Z_STREAM_ERROR$1}var inflateReset_1,inflateReset2_1,inflateResetKeep_1,inflateInit_1,inflateInit2_1,inflate_2,inflateEnd_1,inflateGetHeader_1,inflateSetDictionary_1,inflateInfo,inflate_1={inflateReset:inflateReset,inflateReset2:inflateReset2,inflateResetKeep:inflateResetKeep,inflateInit:inflateInit,inflateInit2:inflateInit2,inflate:inflate,inflateEnd:inflateEnd,inflateGetHeader:inflateGetHeader,inflateSetDictionary:inflateSetDictionary,inflateInfo:"pako inflate (from Nodeca project)"},constants={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};function GZheader(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var gzheader=GZheader,toString$1=Object.prototype.toString;function Inflate(e){if(!(this instanceof Inflate))return new Inflate(e);this.options=common.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;var r=inflate_1.inflateInit2(this.strm,t.windowBits);if(r!==constants.Z_OK)throw new Error(messages[r]);this.header=new gzheader,inflate_1.inflateGetHeader(this.strm,this.header)}function inflate$1(e,t){var r=new Inflate(t);if(r.push(e,!0),r.err)throw r.msg||messages[r.err];return r.result}function inflateRaw(e,t){return(t=t||{}).raw=!0,inflate$1(e,t)}Inflate.prototype.push=function(e,t){var r,n,i,a,s,o,l=this.strm,u=this.options.chunkSize,c=this.options.dictionary,h=!1;if(this.ended)return!1;n=t===~~t?t:!0===t?constants.Z_FINISH:constants.Z_NO_FLUSH,"string"==typeof e?l.input=strings.binstring2buf(e):"[object ArrayBuffer]"===toString$1.call(e)?l.input=new Uint8Array(e):l.input=e,l.next_in=0,l.avail_in=l.input.length;do{if(0===l.avail_out&&(l.output=new common.Buf8(u),l.next_out=0,l.avail_out=u),(r=inflate_1.inflate(l,constants.Z_NO_FLUSH))===constants.Z_NEED_DICT&&c&&(o="string"==typeof c?strings.string2buf(c):"[object ArrayBuffer]"===toString$1.call(c)?new Uint8Array(c):c,r=inflate_1.inflateSetDictionary(this.strm,o)),r===constants.Z_BUF_ERROR&&!0===h&&(r=constants.Z_OK,h=!1),r!==constants.Z_STREAM_END&&r!==constants.Z_OK)return this.onEnd(r),this.ended=!0,!1;l.next_out&&(0!==l.avail_out&&r!==constants.Z_STREAM_END&&(0!==l.avail_in||n!==constants.Z_FINISH&&n!==constants.Z_SYNC_FLUSH)||("string"===this.options.to?(i=strings.utf8border(l.output,l.next_out),a=l.next_out-i,s=strings.buf2string(l.output,i),l.next_out=a,l.avail_out=u-a,a&&common.arraySet(l.output,l.output,i,a,0),this.onData(s)):this.onData(common.shrinkBuf(l.output,l.next_out)))),0===l.avail_in&&0===l.avail_out&&(h=!0)}while((l.avail_in>0||0===l.avail_out)&&r!==constants.Z_STREAM_END);return r===constants.Z_STREAM_END&&(n=constants.Z_FINISH),n===constants.Z_FINISH?(r=inflate_1.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===constants.Z_OK):n!==constants.Z_SYNC_FLUSH||(this.onEnd(constants.Z_OK),l.avail_out=0,!0)},Inflate.prototype.onData=function(e){this.chunks.push(e)},Inflate.prototype.onEnd=function(e){e===constants.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Inflate_1,inflate_2$1,inflateRaw_1,ungzip,inflate_1$1={Inflate:Inflate,inflate:inflate$1,inflateRaw:inflateRaw,ungzip:inflate$1},assign,pako={};(0,common.assign)(pako,deflate_1$1,inflate_1$1,constants);var pako_1=pako,codecutils_umd,codecutils=unwrapExports$$1(createCommonjsModule$$1(function(e,t){!function(e){var t,r=void 0!==commonjsGlobal$$1?commonjsGlobal$$1:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},n=(function(e){var t=e.exports=function(e){return new r(e)};function r(e){this.value=e}function n(e,t,r){var n=[],s=[],c=!0;return function e(h){var f=r?i(h):h,d={},p=!0,g={node:f,node_:h,path:[].concat(n),parent:s[s.length-1],parents:s,key:n.slice(-1)[0],isRoot:0===n.length,level:n.length,circular:null,update:function(e,t){g.isRoot||(g.parent.node[g.key]=e),g.node=e,t&&(p=!1)},delete:function(e){delete g.parent.node[g.key],e&&(p=!1)},remove:function(e){o(g.parent.node)?g.parent.node.splice(g.key,1):delete g.parent.node[g.key],e&&(p=!1)},keys:null,before:function(e){d.before=e},after:function(e){d.after=e},pre:function(e){d.pre=e},post:function(e){d.post=e},stop:function(){c=!1},block:function(){p=!1}};if(!c)return g;function _(){if("object"===_typeof(g.node)&&null!==g.node){g.keys&&g.node_===g.node||(g.keys=a(g.node)),g.isLeaf=0==g.keys.length;for(var e=0;e<s.length;e++)if(s[e].node_===h){g.circular=s[e];break}}else g.isLeaf=!0,g.keys=null;g.notLeaf=!g.isLeaf,g.notRoot=!g.isRoot}_();var y=t.call(g,g.node);return void 0!==y&&g.update&&g.update(y),d.before&&d.before.call(g,g.node),p?("object"!=_typeof(g.node)||null===g.node||g.circular||(s.push(g),_(),l(g.keys,function(t,i){n.push(t),d.pre&&d.pre.call(g,g.node[t],t);var a=e(g.node[t]);r&&u.call(g.node,t)&&(g.node[t]=a.node),a.isLast=i==g.keys.length-1,a.isFirst=0==i,d.post&&d.post.call(g,a),n.pop()}),s.pop()),d.after&&d.after.call(g,g.node),g):g}(e).node}function i(e){if("object"===(void 0===e?"undefined":_typeof(e))&&null!==e){var t;if(o(e))t=[];else if("[object Date]"===s(e))t=new Date(e.getTime?e.getTime():e);else if(function(e){return"[object RegExp]"===s(e)}(e))t=new RegExp(e);else if(function(e){return"[object Error]"===s(e)}(e))t={message:e.message};else if(function(e){return"[object Boolean]"===s(e)}(e))t=new Boolean(e);else if(function(e){return"[object Number]"===s(e)}(e))t=new Number(e);else if(function(e){return"[object String]"===s(e)}(e))t=new String(e);else if(Object.create&&Object.getPrototypeOf)t=Object.create(Object.getPrototypeOf(e));else if(e.constructor===Object)t={};else{var r=e.constructor&&e.constructor.prototype||e.__proto__||{},n=function(){};n.prototype=r,t=new n}return l(a(e),function(r){t[r]=e[r]}),t}return e}r.prototype.get=function(e){for(var t=this.value,r=0;r<e.length;r++){var n=e[r];if(!t||!u.call(t,n)){t=void 0;break}t=t[n]}return t},r.prototype.has=function(e){for(var t=this.value,r=0;r<e.length;r++){var n=e[r];if(!t||!u.call(t,n))return!1;t=t[n]}return!0},r.prototype.set=function(e,t){for(var r=this.value,n=0;n<e.length-1;n++){var i=e[n];u.call(r,i)||(r[i]={}),r=r[i]}return r[e[n]]=t,t},r.prototype.map=function(e){return n(this.value,e,!0)},r.prototype.forEach=function(e){return this.value=n(this.value,e,!1),this.value},r.prototype.reduce=function(e,t){var r=1===arguments.length,n=r?this.value:t;return this.forEach(function(t){this.isRoot&&r||(n=e.call(this,n,t))}),n},r.prototype.paths=function(){var e=[];return this.forEach(function(t){e.push(this.path)}),e},r.prototype.nodes=function(){var e=[];return this.forEach(function(t){e.push(this.node)}),e},r.prototype.clone=function(){var e=[],t=[];return function r(n){for(var s=0;s<e.length;s++)if(e[s]===n)return t[s];if("object"===(void 0===n?"undefined":_typeof(n))&&null!==n){var o=i(n);return e.push(n),t.push(o),l(a(n),function(e){o[e]=r(n[e])}),e.pop(),t.pop(),o}return n}(this.value)};var a=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};function s(e){return Object.prototype.toString.call(e)}var o=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},l=function(e,t){if(e.forEach)return e.forEach(t);for(var r=0;r<e.length;r++)t(e[r],r,e)};l(a(r.prototype),function(e){t[e]=function(t){var n=[].slice.call(arguments,1),i=new r(t);return i[e].apply(i,n)}});var u=Object.hasOwnProperty||function(e,t){return t in e}}(t={exports:{}}),t.exports),i=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=function(){function e(){i(this,e)}return a(e,null,[{key:"isPlatformLittleEndian",value:function(){var e=new Uint32Array([305419896]),t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);return 18!=t[0]}},{key:"arrayBufferToUnicode",value:function(e){for(var t=new Uint8Array(e),r=[],n=0,i=0;n<t.length;){var a=t[n++];if(a<128){if(a<32&&10!=a&&13!=a&&9!=a||127==a)return console.warn("Invalid string: non-printable characters"),null;r[i++]=String.fromCharCode(a)}else if(a>191&&a<224){var s=t[n++];r[i++]=String.fromCharCode((31&a)<<6|63&s)}else if(a>239&&a<365){var s=t[n++],o=t[n++],l=t[n++],u=((7&a)<<18|(63&s)<<12|(63&o)<<6|63&l)-65536;r[i++]=String.fromCharCode(55296+(u>>10)),r[i++]=String.fromCharCode(56320+(1023&u))}else{var s=t[n++],o=t[n++],c=(15&a)<<12|(63&s)<<6|63&o;if(65533===c)return console.warn("Invalid string: a REPLACEMENT CHARACTER was spotted"),null;r[i++]=String.fromCharCode(c)}}return r.join("")}},{key:"unicodeToArrayBuffer",value:function(e){for(var t=[],r=0,n=0;n<e.length;n++){var i=e.charCodeAt(n);i<128?t[r++]=i:i<2048?(t[r++]=i>>6|192,t[r++]=63&i|128):55296==(64512&i)&&n+1<e.length&&56320==(64512&e.charCodeAt(n+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++n)),t[r++]=i>>18|240,t[r++]=i>>12&63|128,t[r++]=i>>6&63|128,t[r++]=63&i|128):(t[r++]=i>>12|224,t[r++]=i>>6&63|128,t[r++]=63&i|128)}return new Uint8Array(t).buffer}},{key:"arrayBufferToString8",value:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}},{key:"string8ToArrayBuffer",value:function(e){for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return t}},{key:"setString8InBuffer",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(r<0)console.warn("The byte offset cannot be negative.");else if(t&&t instanceof ArrayBuffer)if(e.length+r>t.byteLength)console.warn("The string is too long to be writen in this buffer.");else for(var n=new Uint8Array(t),i=0;i<e.length;i++)n[i+r]=e.charCodeAt(i);else console.warn("The buffer must be a valid ArrayBuffer.")}},{key:"getString8FromBuffer",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return r<0?(console.warn("The byte offset cannot be negative."),null):e&&e instanceof ArrayBuffer?t+r>e.byteLength?(console.warn("The string is too long to be writen in this buffer."),null):String.fromCharCode.apply(null,new Uint8Array(e,r,t)):(console.warn("The buffer must be a valid ArrayBuffer."),null)}},{key:"objectToArrayBuffer",value:function(t){var r=null,n=e.makeSerializeFriendly(t);try{var i=JSON.stringify(n);r=e.unicodeToArrayBuffer(i)}catch(e){console.warn(e)}return r}},{key:"ArrayBufferToObject",value:function(t){var r=null;try{var n=e.arrayBufferToUnicode(t);r=JSON.parse(n)}catch(e){console.warn(e)}return r}},{key:"isTypedArray",value:function(e){return e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array}},{key:"mergeBuffers",value:function(e){for(var t=0,r=0;r<e.length;r++)t+=e[r].byteLength;for(var n=new Uint8Array(t),i=0,r=0;r<e.length;r++)n.set(new Uint8Array(e[r]),i),i+=e[r].byteLength;return n.buffer}},{key:"getGlobalObject",value:function(){var e=null;try{e=window}catch(t){try{e=r}catch(e){return console.warn("You are not in a Javascript environment?? Weird."),null}}return e}},{key:"extractTypedArray",value:function(e,t,r,n){if(!e)return console.warn("Input Buffer is null."),null;if(!(e instanceof ArrayBuffer))return console.warn("Buffer must be of type ArrayBuffer"),null;if(n<=0)return console.warn("The number of elements to fetch must be greater than 0"),null;if(t<0)return console.warn("The byte offset must be possitive or 0"),null;if(t>=e.byteLength)return console.warn("The offset cannot be larger than the size of the buffer."),null;if(r instanceof Function&&!("BYTES_PER_ELEMENT"in r))return console.warn("ArrayType must be a typed array constructor function."),null;if(!(r.BYTES_PER_ELEMENT*n+t>e.byteLength)){var i=e.slice(t,t+n*r.BYTES_PER_ELEMENT);return new r(i)}console.warn("The requested number of elements is too large for this buffer")}},{key:"getTypedArrayInfo",value:function(e){var t=null,r=!1;return e instanceof Int8Array?(t="int",r=!1):e instanceof Uint8Array?(t="int",r=!0):e instanceof Uint8ClampedArray?(t="int",r=!0):e instanceof Int16Array?(t="int",r=!1):e instanceof Uint16Array?(t="int",r=!0):e instanceof Int32Array?(t="int",r=!1):e instanceof Uint32Array?(t="int",r=!0):e instanceof Float32Array?(t="float",r=!1):e instanceof Float64Array&&(t="float",r=!1),{type:t,signed:r,bytesPerElements:e.BYTES_PER_ELEMENT,byteLength:e.byteLength,length:e.length}}},{key:"howManyTypedArrayAttributes",value:function(t){var r=0;return n(t).forEach(function(t){r+=e.isTypedArray(t)}),r}},{key:"hasCircularReference",value:function(e){var t=!1;return n(e).forEach(function(e){this.circular&&(t=!0)}),t}},{key:"removeCircularReference",value:function(e){var t=!1,r=n(e).map(function(e){this.circular&&(this.remove(),t=!0)});return t?r:null}},{key:"replaceTypedArrayAttributesByArrays",value:function(t){var r=!1,i=n(t).map(function(t){if(e.isTypedArray(t)){for(var n=Object.keys(t).length,i=new Array(n),a=0;a<n;a++)i[a]=t[a];this.update(i),r=!0}});return r?i:null}},{key:"makeSerializeFriendly",value:function(t){var r=t,n=e.removeCircularReference(r);n&&(r=n);var i=e.replaceTypedArrayAttributesByArrays(r);return i&&(r=i),r}},{key:"isValidString",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e.length,n=t?r:Math.min(1e3,r),i=0,a=0;a<n;a++){var s=e.charCodeAt(Math.floor(Math.random()*n));(65533===s||s<32&&10!=s&&13!=s&&9!=s||127==s)&&i++}return!(i>0)}}]),e}();e.CodecUtils=s,Object.defineProperty(e,"__esModule",{value:!0})}(t)})),classCallCheck$$1=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass$$1=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),dataCases={invalid:null,typedArray:1,mixedArrays:2,complexObject:3},PixBlockEncoder=function(){function e(){classCallCheck$$1(this,e),this._compress=!1,this.reset()}return createClass$$1(e,[{key:"reset",value:function(){this._input=null,this._inputCase=null,this._output=null}},{key:"enableDataCompression",value:function(e){this._compress=e}},{key:"setInput",value:function(t){this._inputCase=e.isGoodCandidate(t),this._inputCase&&(this._input=t)}},{key:"getOutput",value:function(){return this._output}},{key:"run",value:function(){var e=this._input;if(e&&this._inputCase){this._compress;var t=e._data,r=null,n=null,i=[],a=!1;switch(this._inputCase){case dataCases.typedArray:r=t;var s=this._getDataSubsetInfo(t);s.compressedByteLength=null,this._compress&&(r=pako_1.deflate(r.buffer),s.compressedByteLength=r.byteLength),i.push(s);break;case dataCases.mixedArrays:a=!0,n=[],r=new Array(t.length);for(var o=0;o<t.length;o++){var l=t[o],s=this._getDataSubsetInfo(l);if(s.isTypedArray||(l=new Uint8Array(codecutils.CodecUtils.objectToArrayBuffer(l)),s.byteLength=l.byteLength),this._compress){var u=pako_1.deflate(l.buffer);s.compressedByteLength=u.byteLength,n.push(u)}i.push(s),r[o]=l}this._compress&&(r=n);break;case dataCases.complexObject:var s=this._getDataSubsetInfo(t);r=new Uint8Array(codecutils.CodecUtils.objectToArrayBuffer(t)),s.byteLength=r.byteLength,this._compress&&(r=pako_1.deflate(r),s.compressedByteLength=r.byteLength),i.push(s);break;default:return void console.warn("A problem occured.")}var c=codecutils.CodecUtils.objectToArrayBuffer(e._metadata),h={byteStreamInfo:i,useMultipleDataStreams:a,originalBlockType:e.constructor.name,metadataByteLength:c.byteLength},f=codecutils.CodecUtils.objectToArrayBuffer(h),d=[new Uint8Array([+codecutils.CodecUtils.isPlatformLittleEndian()]).buffer,new Uint32Array([f.byteLength]).buffer,f,c];if(a)for(var o=0;o<r.length;o++)d.push(r[o].buffer);else d.push(r.buffer);this._output=codecutils.CodecUtils.mergeBuffers(d)}else console.warn("An input must be given to the PixBlockEncoder.")}},{key:"_getDataSubsetInfo",value:function(e){var t=null;return codecutils.CodecUtils.isTypedArray(e)?((t=codecutils.CodecUtils.getTypedArrayInfo(e)).isTypedArray=!0,t.compressedByteLength=null):t={type:e.constructor.name,compressedByteLength:null,byteLength:null,length:null,isTypedArray:!1},t}}],[{key:"isGoodCandidate",value:function(t){if(!t)return console.warn("Input object cannot be null."),!1;if(!("_metadata"in t))return console.warn("Input object must contain a _metadata object."),!1;if(!("_data"in t))return console.warn("Input object must contain a _data object."),!1;var r=t._metadata,n=t._data;try{JSON.stringify(r)}catch(e){return console.warn("The metadata object contains cyclic structures. Cannot be used."),!1}var i=e.determineDataCase(n);return i===dataCases.invalid&&console.warn("The input is invalid."),i}},{key:"determineDataCase",value:function(e){return e instanceof Object?codecutils.CodecUtils.isTypedArray(e)?dataCases.typedArray:e instanceof Array?dataCases.mixedArrays:dataCases.complexObject:dataCases.invalid}}]),e}(),PixBlockDecoder=function(){function e(){classCallCheck$$1(this,e),this.reset()}return createClass$$1(e,[{key:"reset",value:function(){this._input=null,this._output=null}},{key:"setInput",value:function(e){e instanceof ArrayBuffer?this._input=e:console.warn("Input should be a valid ArrayBuffer")}},{key:"getOutput",value:function(){return this._output}},{key:"run",value:function(){var e=this._input,t=new DataView(e),r=(t.getUint8(0),0);t.getUint8(0),r+=1;var n=t.getUint32(1,r);r+=4;var i=e.slice(r,r+n),a=codecutils.CodecUtils.ArrayBufferToObject(i);r+=n;var s=e.slice(r,r+a.metadataByteLength),o=codecutils.CodecUtils.ArrayBufferToObject(s);r+=a.metadataByteLength;for(var l=[],u=0;u<a.byteStreamInfo.length;u++){var c=a.byteStreamInfo[u].compressedByteLength,h=this._getDataTypeFromByteStreamInfo(a.byteStreamInfo[u]),f=a.byteStreamInfo[u].isTypedArray;if(c){var d=new Uint8Array(e,r,c),p=pako_1.inflate(d),g=null;g=f?new h(p.buffer):codecutils.CodecUtils.ArrayBufferToObject(p.buffer),l.push(g),r+=c}else{var g=null;if(f)g=codecutils.CodecUtils.extractTypedArray(e,r,this._getDataTypeFromByteStreamInfo(a.byteStreamInfo[u]),a.byteStreamInfo[u].length);else{var _=codecutils.CodecUtils.extractTypedArray(e,r,Uint8Array,a.byteStreamInfo[u].byteLength);g=codecutils.CodecUtils.ArrayBufferToObject(_.buffer)}l.push(g),r+=a.byteStreamInfo[u].byteLength}}a.useMultipleDataStreams||(l=l[0]),this._output={originalBlockType:a.originalBlockType,_data:l,_metadata:o}}},{key:"_getDataTypeFromByteStreamInfo",value:function(e){var t="Object",r=codecutils.CodecUtils.getGlobalObject();if("int"===e.type)t=e.signed?"Uint":"Int",t+=8*e.bytesPerElements+"Array";else if("float"===e.type){t="Float",t+=8*e.bytesPerElements+"Array";var r=codecutils.CodecUtils.getGlobalObject()}return r[t]}}]),e}(),global$1=void 0!==commonjsGlobal?commonjsGlobal:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}var cachedSetTimeout=defaultSetTimout,cachedClearTimeout=defaultClearTimeout;function runTimeout(e){if(cachedSetTimeout===setTimeout)return setTimeout(e,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(e,0);try{return cachedSetTimeout(e,0)}catch(t){try{return cachedSetTimeout.call(null,e,0)}catch(t){return cachedSetTimeout.call(this,e,0)}}}function runClearTimeout(e){if(cachedClearTimeout===clearTimeout)return clearTimeout(e);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(e);try{return cachedClearTimeout(e)}catch(t){try{return cachedClearTimeout.call(null,e)}catch(t){return cachedClearTimeout.call(this,e)}}}"function"==typeof global$1.setTimeout&&(cachedSetTimeout=setTimeout),"function"==typeof global$1.clearTimeout&&(cachedClearTimeout=clearTimeout);var queue=[],draining=!1,currentQueue,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var e=runTimeout(cleanUpNextTick);draining=!0;for(var t=queue.length;t;){for(currentQueue=queue,queue=[];++queueIndex<t;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,t=queue.length}currentQueue=null,draining=!1,runClearTimeout(e)}}function nextTick(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];queue.push(new Item(e,t)),1!==queue.length||draining||runTimeout(drainQueue)}function Item(e,t){this.fun=e,this.array=t}Item.prototype.run=function(){this.fun.apply(null,this.array)};var title="browser",platform="browser",browser=!0,env={},argv=[],version="",versions={},release={},config={};function noop(){}var on=noop,addListener=noop,once=noop,off=noop,removeListener=noop,removeAllListeners=noop,emit=noop;function binding(e){throw new Error("process.binding is not supported")}function cwd(){return"/"}function chdir(e){throw new Error("process.chdir is not supported")}function umask(){return 0}var performance=global$1.performance||{},performanceNow=performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow||function(){return(new Date).getTime()};function hrtime(e){var t=.001*performanceNow.call(performance),r=Math.floor(t),n=Math.floor(t%1*1e9);return e&&(r-=e[0],(n-=e[1])<0&&(r--,n+=1e9)),[r,n]}var startTime=new Date;function uptime(){var e=new Date,t=e-startTime;return t/1e3}var process={nextTick:nextTick,title:title,browser:browser,env:env,argv:argv,version:version,versions:versions,on:on,addListener:addListener,once:once,off:off,removeListener:removeListener,removeAllListeners:removeAllListeners,emit:emit,binding:binding,cwd:cwd,chdir:chdir,umask:umask,hrtime:hrtime,platform:platform,release:release,config:config,uptime:uptime},md5=createCommonjsModule$$1(function(module){!function(){var ERROR="input is invalid type",WINDOW="object"===("undefined"==typeof window?"undefined":_typeof(window)),root=WINDOW?window:{};root.JS_MD5_NO_WINDOW&&(WINDOW=!1);var WEB_WORKER=!WINDOW&&"object"===("undefined"==typeof self?"undefined":_typeof(self)),NODE_JS=!root.JS_MD5_NO_NODE_JS&&"object"===(void 0===process?"undefined":_typeof(process))&&process.versions&&process.versions.node;NODE_JS?root=commonjsGlobal$$1:WEB_WORKER&&(root=self);var COMMON_JS=!root.JS_MD5_NO_COMMON_JS&&module.exports,AMD=!1,ARRAY_BUFFER=!root.JS_MD5_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,HEX_CHARS="0123456789abcdef".split(""),EXTRA=[128,32768,8388608,-2147483648],SHIFT=[0,8,16,24],OUTPUT_TYPES=["hex","array","digest","buffer","arrayBuffer","base64"],BASE64_ENCODE_CHAR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),blocks=[],buffer8;if(ARRAY_BUFFER){var buffer=new ArrayBuffer(68);buffer8=new Uint8Array(buffer),blocks=new Uint32Array(buffer)}!root.JS_MD5_NO_NODE_JS&&Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)});var createOutputMethod=function(e){return function(t){return new Md5(!0).update(t)[e]()}},createMethod=function(){var e=createOutputMethod("hex");NODE_JS&&(e=nodeWrap(e)),e.create=function(){return new Md5},e.update=function(t){return e.create().update(t)};for(var t=0;t<OUTPUT_TYPES.length;++t){var r=OUTPUT_TYPES[t];e[r]=createOutputMethod(r)}return e},nodeWrap=function nodeWrap(method){var crypto=eval("require('crypto')"),Buffer=eval("require('buffer').Buffer"),nodeMethod=function(e){if("string"==typeof e)return crypto.createHash("md5").update(e,"utf8").digest("hex");if(null===e||void 0===e)throw ERROR;return e.constructor===ArrayBuffer&&(e=new Uint8Array(e)),Array.isArray(e)||ArrayBuffer.isView(e)||e.constructor===Buffer?crypto.createHash("md5").update(new Buffer(e)).digest("hex"):method(e)};return nodeMethod};function Md5(e){if(e)blocks[0]=blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0,this.blocks=blocks,this.buffer8=buffer8;else if(ARRAY_BUFFER){var t=new ArrayBuffer(68);this.buffer8=new Uint8Array(t),this.blocks=new Uint32Array(t)}else this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.h0=this.h1=this.h2=this.h3=this.start=this.bytes=0,this.finalized=this.hashed=!1,this.first=!0}Md5.prototype.update=function(e){if(!this.finalized){var t="string"!=typeof e;if(t){if(null===e||void 0===e)throw ERROR;e.constructor===root.ArrayBuffer&&(e=new Uint8Array(e))}var r=e.length;if(t&&("number"!=typeof r||!Array.isArray(e)&&(!ARRAY_BUFFER||!ArrayBuffer.isView(e))))throw ERROR;for(var n,i,a=0,s=this.blocks,o=this.buffer8;a<r;){if(this.hashed&&(this.hashed=!1,s[0]=s[16],s[16]=s[1]=s[2]=s[3]=s[4]=s[5]=s[6]=s[7]=s[8]=s[9]=s[10]=s[11]=s[12]=s[13]=s[14]=s[15]=0),t)if(ARRAY_BUFFER)for(i=this.start;a<r&&i<64;++a)o[i++]=e[a];else for(i=this.start;a<r&&i<64;++a)s[i>>2]|=e[a]<<SHIFT[3&i++];else if(ARRAY_BUFFER)for(i=this.start;a<r&&i<64;++a)(n=e.charCodeAt(a))<128?o[i++]=n:n<2048?(o[i++]=192|n>>6,o[i++]=128|63&n):n<55296||n>=57344?(o[i++]=224|n>>12,o[i++]=128|n>>6&63,o[i++]=128|63&n):(n=65536+((1023&n)<<10|1023&e.charCodeAt(++a)),o[i++]=240|n>>18,o[i++]=128|n>>12&63,o[i++]=128|n>>6&63,o[i++]=128|63&n);else for(i=this.start;a<r&&i<64;++a)(n=e.charCodeAt(a))<128?s[i>>2]|=n<<SHIFT[3&i++]:n<2048?(s[i>>2]|=(192|n>>6)<<SHIFT[3&i++],s[i>>2]|=(128|63&n)<<SHIFT[3&i++]):n<55296||n>=57344?(s[i>>2]|=(224|n>>12)<<SHIFT[3&i++],s[i>>2]|=(128|n>>6&63)<<SHIFT[3&i++],s[i>>2]|=(128|63&n)<<SHIFT[3&i++]):(n=65536+((1023&n)<<10|1023&e.charCodeAt(++a)),s[i>>2]|=(240|n>>18)<<SHIFT[3&i++],s[i>>2]|=(128|n>>12&63)<<SHIFT[3&i++],s[i>>2]|=(128|n>>6&63)<<SHIFT[3&i++],s[i>>2]|=(128|63&n)<<SHIFT[3&i++]);this.lastByteIndex=i,this.bytes+=i-this.start,i>=64?(this.start=i-64,this.hash(),this.hashed=!0):this.start=i}return this}},Md5.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[t>>2]|=EXTRA[3&t],t>=56&&(this.hashed||this.hash(),e[0]=e[16],e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.bytes<<3,this.hash()}},Md5.prototype.hash=function(){var e,t,r,n,i,a,s=this.blocks;this.first?(e=s[0]-680876937,n=(-1732584194^2004318071&(e=(e<<7|e>>>25)-271733879<<0))+s[1]-117830708,r=(-271733879^(n=(n<<12|n>>>20)+e<<0)&(-271733879^e))+s[2]-1126478375,t=((t=(e^(r=(r<<17|r>>>15)+n<<0)&(n^e))+s[3]-1316259209)<<22|t>>>10)+r<<0):(e=this.h0,t=this.h1,r=this.h2,n=this.h3,e+=(n^t&(r^n))+s[0]-680876936,n+=(r^(e=(e<<7|e>>>25)+t<<0)&(t^r))+s[1]-389564586,r+=(t^(n=(n<<12|n>>>20)+e<<0)&(e^t))+s[2]+606105819,t=((t+=(e^(r=(r<<17|r>>>15)+n<<0)&(n^e))+s[3]-1044525330)<<22|t>>>10)+r<<0),e+=(n^t&(r^n))+s[4]-176418897,n+=(r^(e=(e<<7|e>>>25)+t<<0)&(t^r))+s[5]+1200080426,r+=(t^(n=(n<<12|n>>>20)+e<<0)&(e^t))+s[6]-1473231341,t+=(e^(r=(r<<17|r>>>15)+n<<0)&(n^e))+s[7]-45705983,e+=(n^(t=(t<<22|t>>>10)+r<<0)&(r^n))+s[8]+1770035416,n+=(r^(e=(e<<7|e>>>25)+t<<0)&(t^r))+s[9]-1958414417,r+=(t^(n=(n<<12|n>>>20)+e<<0)&(e^t))+s[10]-42063,t+=(e^(r=(r<<17|r>>>15)+n<<0)&(n^e))+s[11]-1990404162,e+=(n^(t=(t<<22|t>>>10)+r<<0)&(r^n))+s[12]+1804603682,n+=(r^(e=(e<<7|e>>>25)+t<<0)&(t^r))+s[13]-40341101,r+=(t^(n=(n<<12|n>>>20)+e<<0)&(e^t))+s[14]-1502002290,t+=(e^(r=(r<<17|r>>>15)+n<<0)&(n^e))+s[15]+1236535329,e+=(r^n&((t=(t<<22|t>>>10)+r<<0)^r))+s[1]-165796510,n+=(t^r&((e=(e<<5|e>>>27)+t<<0)^t))+s[6]-1069501632,r+=(e^t&((n=(n<<9|n>>>23)+e<<0)^e))+s[11]+643717713,t+=(n^e&((r=(r<<14|r>>>18)+n<<0)^n))+s[0]-373897302,e+=(r^n&((t=(t<<20|t>>>12)+r<<0)^r))+s[5]-701558691,n+=(t^r&((e=(e<<5|e>>>27)+t<<0)^t))+s[10]+38016083,r+=(e^t&((n=(n<<9|n>>>23)+e<<0)^e))+s[15]-660478335,t+=(n^e&((r=(r<<14|r>>>18)+n<<0)^n))+s[4]-405537848,e+=(r^n&((t=(t<<20|t>>>12)+r<<0)^r))+s[9]+568446438,n+=(t^r&((e=(e<<5|e>>>27)+t<<0)^t))+s[14]-1019803690,r+=(e^t&((n=(n<<9|n>>>23)+e<<0)^e))+s[3]-187363961,t+=(n^e&((r=(r<<14|r>>>18)+n<<0)^n))+s[8]+1163531501,e+=(r^n&((t=(t<<20|t>>>12)+r<<0)^r))+s[13]-1444681467,n+=(t^r&((e=(e<<5|e>>>27)+t<<0)^t))+s[2]-51403784,r+=(e^t&((n=(n<<9|n>>>23)+e<<0)^e))+s[7]+1735328473,t+=(n^e&((r=(r<<14|r>>>18)+n<<0)^n))+s[12]-1926607734,e+=((i=(t=(t<<20|t>>>12)+r<<0)^r)^n)+s[5]-378558,n+=(i^(e=(e<<4|e>>>28)+t<<0))+s[8]-2022574463,r+=((a=(n=(n<<11|n>>>21)+e<<0)^e)^t)+s[11]+1839030562,t+=(a^(r=(r<<16|r>>>16)+n<<0))+s[14]-35309556,e+=((i=(t=(t<<23|t>>>9)+r<<0)^r)^n)+s[1]-1530992060,n+=(i^(e=(e<<4|e>>>28)+t<<0))+s[4]+1272893353,r+=((a=(n=(n<<11|n>>>21)+e<<0)^e)^t)+s[7]-155497632,t+=(a^(r=(r<<16|r>>>16)+n<<0))+s[10]-1094730640,e+=((i=(t=(t<<23|t>>>9)+r<<0)^r)^n)+s[13]+681279174,n+=(i^(e=(e<<4|e>>>28)+t<<0))+s[0]-358537222,r+=((a=(n=(n<<11|n>>>21)+e<<0)^e)^t)+s[3]-722521979,t+=(a^(r=(r<<16|r>>>16)+n<<0))+s[6]+76029189,e+=((i=(t=(t<<23|t>>>9)+r<<0)^r)^n)+s[9]-640364487,n+=(i^(e=(e<<4|e>>>28)+t<<0))+s[12]-421815835,r+=((a=(n=(n<<11|n>>>21)+e<<0)^e)^t)+s[15]+530742520,t+=(a^(r=(r<<16|r>>>16)+n<<0))+s[2]-995338651,e+=(r^((t=(t<<23|t>>>9)+r<<0)|~n))+s[0]-198630844,n+=(t^((e=(e<<6|e>>>26)+t<<0)|~r))+s[7]+1126891415,r+=(e^((n=(n<<10|n>>>22)+e<<0)|~t))+s[14]-1416354905,t+=(n^((r=(r<<15|r>>>17)+n<<0)|~e))+s[5]-57434055,e+=(r^((t=(t<<21|t>>>11)+r<<0)|~n))+s[12]+1700485571,n+=(t^((e=(e<<6|e>>>26)+t<<0)|~r))+s[3]-1894986606,r+=(e^((n=(n<<10|n>>>22)+e<<0)|~t))+s[10]-1051523,t+=(n^((r=(r<<15|r>>>17)+n<<0)|~e))+s[1]-2054922799,e+=(r^((t=(t<<21|t>>>11)+r<<0)|~n))+s[8]+1873313359,n+=(t^((e=(e<<6|e>>>26)+t<<0)|~r))+s[15]-30611744,r+=(e^((n=(n<<10|n>>>22)+e<<0)|~t))+s[6]-1560198380,t+=(n^((r=(r<<15|r>>>17)+n<<0)|~e))+s[13]+1309151649,e+=(r^((t=(t<<21|t>>>11)+r<<0)|~n))+s[4]-145523070,n+=(t^((e=(e<<6|e>>>26)+t<<0)|~r))+s[11]-1120210379,r+=(e^((n=(n<<10|n>>>22)+e<<0)|~t))+s[2]+718787259,t=((t+=(n^((r=(r<<15|r>>>17)+n<<0)|~e))+s[9]-343485551)<<21|t>>>11)+r<<0,this.first?(this.h0=e+1732584193<<0,this.h1=t-271733879<<0,this.h2=r-1732584194<<0,this.h3=n+271733878<<0,this.first=!1):(this.h0=this.h0+e<<0,this.h1=this.h1+t<<0,this.h2=this.h2+r<<0,this.h3=this.h3+n<<0)},Md5.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,n=this.h3;return HEX_CHARS[e>>4&15]+HEX_CHARS[15&e]+HEX_CHARS[e>>12&15]+HEX_CHARS[e>>8&15]+HEX_CHARS[e>>20&15]+HEX_CHARS[e>>16&15]+HEX_CHARS[e>>28&15]+HEX_CHARS[e>>24&15]+HEX_CHARS[t>>4&15]+HEX_CHARS[15&t]+HEX_CHARS[t>>12&15]+HEX_CHARS[t>>8&15]+HEX_CHARS[t>>20&15]+HEX_CHARS[t>>16&15]+HEX_CHARS[t>>28&15]+HEX_CHARS[t>>24&15]+HEX_CHARS[r>>4&15]+HEX_CHARS[15&r]+HEX_CHARS[r>>12&15]+HEX_CHARS[r>>8&15]+HEX_CHARS[r>>20&15]+HEX_CHARS[r>>16&15]+HEX_CHARS[r>>28&15]+HEX_CHARS[r>>24&15]+HEX_CHARS[n>>4&15]+HEX_CHARS[15&n]+HEX_CHARS[n>>12&15]+HEX_CHARS[n>>8&15]+HEX_CHARS[n>>20&15]+HEX_CHARS[n>>16&15]+HEX_CHARS[n>>28&15]+HEX_CHARS[n>>24&15]},Md5.prototype.toString=Md5.prototype.hex,Md5.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,n=this.h3;return[255&e,e>>8&255,e>>16&255,e>>24&255,255&t,t>>8&255,t>>16&255,t>>24&255,255&r,r>>8&255,r>>16&255,r>>24&255,255&n,n>>8&255,n>>16&255,n>>24&255]},Md5.prototype.array=Md5.prototype.digest,Md5.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(16),t=new Uint32Array(e);return t[0]=this.h0,t[1]=this.h1,t[2]=this.h2,t[3]=this.h3,e},Md5.prototype.buffer=Md5.prototype.arrayBuffer,Md5.prototype.base64=function(){for(var e,t,r,n="",i=this.array(),a=0;a<15;)e=i[a++],t=i[a++],r=i[a++],n+=BASE64_ENCODE_CHAR[e>>>2]+BASE64_ENCODE_CHAR[63&(e<<4|t>>>4)]+BASE64_ENCODE_CHAR[63&(t<<2|r>>>6)]+BASE64_ENCODE_CHAR[63&r];return e=i[a],n+=BASE64_ENCODE_CHAR[e>>>2]+BASE64_ENCODE_CHAR[e<<4&63]+"=="};var exports=createMethod();COMMON_JS?module.exports=exports:(root.md5=exports,AMD&&(void 0)(function(){return exports}))}()}),PixBinEncoder=function(){function e(){classCallCheck$$1(this,e),this._compress=!0,this.reset()}return createClass$$1(e,[{key:"reset",value:function(){this._inputs=[],this._output=null,this._options={madeWith:"pixbincodec_js",userObject:null,description:null}}},{key:"enableDataCompression",value:function(e){this._compress=e}},{key:"setOption",value:function(e,t){e in this._options&&(this._options[e]=t)}},{key:"addInput",value:function(e){PixBlockEncoder.isGoodCandidate(e)&&this._inputs.push(e)}},{key:"getOutput",value:function(){return this._output}},{key:"run",value:function(){if(this._inputs.length){var t=this,r=new Date,n=codecutils.CodecUtils.isPlatformLittleEndian(),i=new PixBlockEncoder,a={date:r.toISOString(),createdWith:this._options.madeWith,description:this._options.description,userObject:this._options.userObject,pixblocksInfo:[]},s=[],o=a.pixblocksInfo;this._inputs.forEach(function(e,r){i.setInput(e),i.enableDataCompression(t._compress),i.run();var n=i.getOutput();if(n){var a={type:e.constructor.name,description:"description"in e._metadata?e._metadata.description:null,byteLength:n.byteLength,checksum:md5(n)};o.push(a),s.push(n)}else console.warn("The input of index "+r+" could not be encoded as a PixBlock.")}),s.length||console.warn("No input was compatible for PixBlock encoding.");var l=codecutils.CodecUtils.objectToArrayBuffer(a),u=e.MAGIC_NUMBER(),c=new ArrayBuffer(u.length+5),h=new DataView(c);codecutils.CodecUtils.setString8InBuffer(u,c),h.setUint8(u.length,+n),h.setUint32(u.length+1,l.byteLength,n);var f=[c,l].concat(s);this._output=codecutils.CodecUtils.mergeBuffers(f)}else console.warn("The encoder must be specified at least one input.")}}],[{key:"MAGIC_NUMBER",value:function(){return"PIXPIPE_PIXBIN"}}]),e}(),PixBinDecoder=function(){function e(){classCallCheck$$1(this,e),this._verifyChecksum=!1,this._input=null,this._output=null,this._binMeta=null,this._parsingInfo={offsetToReachFirstBlock:-1,isLittleEndian:-1},this._decodedBlocks={},this._isValid=!1,this.reset()}return createClass$$1(e,[{key:"setInput",value:function(e){this.reset(),e instanceof ArrayBuffer&&(this._input=e,this._isValid=this._parseIndex())}},{key:"isValid",value:function(){return this._isValid}},{key:"getOutput",value:function(){return this._output}},{key:"getNumberOfBlocks",value:function(){return this._binMeta.pixblocksInfo.length}},{key:"getBinCreationDate",value:function(){return this._binMeta.date}},{key:"getBinDescription",value:function(){return this._binMeta.description}},{key:"getBinUserObject",value:function(){return this._binMeta.userObject}},{key:"getBlockDescription",value:function(e){return e<0||e>=this.getNumberOfBlocks()?(console.warn("The block index is out of range."),null):this._binMeta.pixblocksInfo[e].description}},{key:"getBlockType",value:function(e){return e<0||e>=this.getNumberOfBlocks()?(console.warn("The block index is out of range."),null):this._binMeta.pixblocksInfo[e].type}},{key:"reset",value:function(){this._isValid=!1,this._input=null,this._output=null,this._binMeta=null,this._parsingInfo={offsetToReachFirstBlock:-1,isLittleEndian:-1},this._decodedBlocks={}}},{key:"enableBlockVerification",value:function(e){this._verifyChecksum=e}},{key:"_parseIndex",value:function(){var e=this._input;if(!e)return console.warn("Input cannot be null"),!1;var t=e.byteLength,r=PixBinEncoder.MAGIC_NUMBER();if(t<r.length+5)return console.warn("This buffer does not match a PixBin file."),!1;var n=new DataView(e),i=0,a=codecutils.CodecUtils.getString8FromBuffer(e,r.length);if(a!==r)return console.warn("This file is not of PixBin type. (wrong magic number)"),!1;i=r.length;var s=n.getUint8(i);if(0!=s&&1!=s)return console.warn("This file is not of PixBin type. (wrong endianess code)"),!1;i+=1;var o=n.getUint32(i,s);i+=4;var l=codecutils.CodecUtils.ArrayBufferToObject(e.slice(i,i+o));return i+=o,this._parsingInfo.offsetToReachFirstBlock=i,this._parsingInfo.isLittleEndian=s,this._binMeta=l,!0}},{key:"fetchBlock",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.getNumberOfBlocks();if(e<0||e>=r)return console.warn("The block index is out of range."),null;if(e in this._decodedBlocks&&!t)return this._decodedBlocks[e];for(var n=this._parsingInfo.offsetToReachFirstBlock,i=0;i<e;i++)n+=this._binMeta.pixblocksInfo[i].byteLength;var a=this._binMeta.pixblocksInfo[e],s=this._input.slice(n,n+a.byteLength);if(this._verifyChecksum&&md5(s)!==a.checksum)return console.warn("The block #"+e+" is corrupted."),null;var o=new PixBlockDecoder;o.setInput(s),o.run();var l=o.getOutput();return l?(this._decodedBlocks[e]=l,l):(console.warn("The block #"+e+" could not be decoded."),null)}}]),e}();exports.PixBlockEncoder=PixBlockEncoder,exports.PixBlockDecoder=PixBlockDecoder,exports.PixBinEncoder=PixBinEncoder,exports.PixBinDecoder=PixBinDecoder,Object.defineProperty(exports,"__esModule",{value:!0})}(exports)}),pixbincodec=unwrapExports(pixbincodec_umd),PixBinDecoder=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setMetadata("targetType","*"),e.addInputValidator(0,ArrayBuffer),e.setMetadata("blockVerification",!1),e}return inherits(t,Decoder),createClass(t,[{key:"_run",value:function(){if(this.hasValidInput()){var e=this._getInput(),t=new pixbincodec.PixBinDecoder;if(t.enableBlockVerification(this.getMetadata("blockVerification")),t.setInput(e),t.isValid()){for(var r={creationDate:t.getBinCreationDate(),description:t.getBinDescription(),userObject:t.getBinUserObject(),numberOfBlocks:t.getNumberOfBlocks()},n=t.getNumberOfBlocks(),i=0,a=0;a<n;a++){var s=t.getBlockType(a);if(this._shouldDecodeType(s)){var o=t.fetchBlock(a),l=null,u=CoreTypes.getCoreType(s);if(u)(l=new u).setRawData(o._data),l.setRawMetadata(o._metadata);else{var c=codecutils.CodecUtils.getGlobalObject();s in c&&((l=new c[s])._metadata=o._metadata,l._data=o._data)}this._output[i]=l,i++}}n&&(this._output.PixBinMeta=r)}else console.warn("The input buffer is invalid.")}else console.warn("PixBinDecoder can only decode ArrayBuffer.")}},{key:"_shouldDecodeType",value:function(e){var t=this.getMetadata("targetType");return"*"===t||(Array.isArray(t)?-1!=t.indexOf(e):e===t)}}]),t}(),GenericDecoderInterface=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._decoders=[],e.setMetadata("enablePixBin",!1),e}return inherits(t,Decoder),createClass(t,[{key:"_run",value:function(){if(0!==this._decoders.length){var e=this._getInput(0);if(e){for(var t=!1,r=[],n=0;n<this._decoders.length;n++){var i=new this._decoders[n];i.addInput(e),i.update();var a=i.getMetadata("targetType");if(-1===r.indexOf(a)&&r.push(a),i.getNumberOfOutputs()){t=!0,this._output[0]=i.getOutput(),this.setMetadata("decoderConstructor",this._decoders[n]),this.setMetadata("decoderName",this._decoders[n].name);break}}if(!t&&this.getMetadata("enablePixBin")){this.setMetadata("targetType",r);var s=this,o=new PixBinDecoder;o.setMetadata("targetType",this.getMetadata("targetType")),o.addInput(e),o.update(),o.forEachOutput(function(e,t){s._output[e]=t})}}else console.warn("The input buffer must not be null.")}else console.warn("No decoder was specified. Unable to continue.")}}]),t}(),Minc2Decoder=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setMetadata("targetType",MniVolume.name),e.addInputValidator(0,ArrayBuffer),e.setMetadata("debug",!1),e._type_enum={INT8:1,UINT8:2,INT16:3,UINT16:4,INT32:5,UINT32:6,FLT:7,DBL:8,STR:9},e._type_matching=["int8","uint8","int16","uint16","int32","uint32","float32","float64","undef"],e.type_sizes=[0,1,1,2,2,4,4,4,8,0],e._dv_offset=0,e._align=8,e._little_endian=!0,e._continuation_queue=[],e._dv=null,e._superblk={},e._start_offset=0,e._huge_id=0,e}return inherits(t,Decoder),createClass(t,[{key:"createLink",value:function(){var e={hdr_offset:0,data_offset:0,data_length:0,n_filled:0,chunk_size:0,sym_btree:0,sym_lheap:0,name:"",attributes:{},children:[],array:void 0,type:-1,inflate:!1,dims:[]};return e}},{key:"startAlignment",value:function(){this._start_offset=this._dv_offset}},{key:"checkAlignment",value:function(){var e=this._dv_offset-this._start_offset;if(e%this._align!=0){var t=this._align-e%this._align;this._dv_offset+=t,this.getMetadata("debug")&&console.log("skipping "+t+" bytes at "+e+" for alignmnent")}}},{key:"skip",value:function(e){this._dv_offset+=e}},{key:"seek",value:function(e){this._dv_offset=e}},{key:"tell",value:function(){return this._dv_offset}},{key:"getU8",value:function(){var e=this._dv.getUint8(this._dv_offset);return this._dv_offset+=1,e}},{key:"getU16",value:function(){var e=this._dv.getUint16(this._dv_offset,this._little_endian);return this._dv_offset+=2,e}},{key:"getU32",value:function(){var e=this._dv.getUint32(this._dv_offset,this._little_endian);return this._dv_offset+=4,e}},{key:"getU64",value:function(){var e=this._dv.getUint64(this._dv_offset,this._little_endian);return this._dv_offset+=8,e}},{key:"getF32",value:function(){var e=this._dv.getFloat32(this._dv_offset,this._little_endian);return this._dv_offset+=4,e}},{key:"getF64",value:function(){var e=this._dv.getFloat64(this._dv_offset,this._little_endian);return this._dv_offset+=8,e}},{key:"getOffset",value:function(e){var t=0;if(4===(e=e||this._superblk.offsz))t=this._dv.getUint32(this._dv_offset,this._little_endian);else{if(8!==e)throw new Error("Unsupported value for offset size "+e);t=this._dv.getUint64(this._dv_offset,this._little_endian)}return this._dv_offset+=e,t}},{key:"getLength",value:function(){var e=this._dv.getUint64(this._dv_offset,this._little_endian);return this._dv_offset+=this._superblk.lensz,e}},{key:"getString",value:function(e){var t,r,n="";for(t=0;t<e;t+=1){if(0===(r=this.getU8())){this._dv_offset+=e-t-1;break}n+=String.fromCharCode(r)}return n}},{key:"getArray",value:function(e,t,r){var n,i,a,s,o=this._getInput(),l=this._dv_offset;switch(r&&(this._dv_offset=r),e){case this._type_enum.INT8:n=new Int8Array(o,this._dv_offset,t);break;case this._type_enum.UINT8:n=new Uint8Array(o,this._dv_offset,t);break;case this._type_enum.INT16:if(this._dv_offset%2!=0)for(a=new ArrayBuffer(t),i=t/2,n=new Int16Array(a),s=0;s<i;s+=1)n[s]=this.getU16();else n=new Int16Array(o,this._dv_offset,t/2),this._dv_offset+=t;break;case this._type_enum.UINT16:if(this._dv_offset%2!=0)for(a=new ArrayBuffer(t),i=t/2,n=new Uint16Array(a),s=0;s<i;s+=1)n[s]=this.getU16();else n=new Uint16Array(o,this._dv_offset,t/2),this._dv_offset+=t;break;case this._type_enum.INT32:if(this._dv_offset%4!=0)for(a=new ArrayBuffer(t),i=t/4,n=new Int32Array(a),s=0;s<i;s+=1)n[s]=this.getU32();else n=new Int32Array(o,this._dv_offset,t/4),this._dv_offset+=t;break;case this._type_enum.UINT32:if(this._dv_offset%4!=0)for(a=new ArrayBuffer(t),i=t/4,n=new Uint32Array(a),s=0;s<i;s+=1)n[s]=this.getU32();else n=new Uint32Array(o,this._dv_offset,t/4),this._dv_offset+=t;break;case this._type_enum.FLT:if(this._dv_offset%4!=0)for(a=new ArrayBuffer(t),i=t/4,n=new Float32Array(a),s=0;s<i;s+=1)n[s]=this.getF32();else n=new Float32Array(o,this._dv_offset,t/4),this._dv_offset+=t;break;case this._type_enum.DBL:if(this._dv_offset%8!=0)for(a=new ArrayBuffer(t),i=t/8,n=new Float64Array(a),s=0;s<i;s+=1)n[s]=this.getF64();else n=new Float64Array(o,this._dv_offset,t/8),this._dv_offset+=t;break;default:throw new Error("Bad type in this.getArray "+e)}return r&&(this._dv_offset=l),n}},{key:"getUXX",value:function(e){var t,r;switch(e){case 1:t=this._dv.getUint8(this._dv_offset);break;case 2:t=this._dv.getUint16(this._dv_offset,this._little_endian);break;case 4:t=this._dv.getUint32(this._dv_offset,this._little_endian);break;case 8:t=this._dv.getUint64(this._dv_offset,this._little_endian);break;default:if(t=0,this._little_endian)for(r=e-1;r>=0;r--)t=(t<<8)+this._dv.getUint8(this._dv_offset+r);else for(r=0;r<e;r++)t=(t<<8)+this._dv.getUint8(this._dv_offset+r)}return this._dv_offset+=e,t}},{key:"checkSignature",value:function(e){var t;for(t=0;t<e.length;t+=1)if(this._dv.getUint8(this._dv_offset+t)!==e.charCodeAt(t))return!1;return this.skip(e.length),!0}},{key:"hdf5Superblock",value:function(){var e={};if(!this.checkSignature("HDF\r\n\n"))throw new Error("Bad magic string in HDF5");if(e.sbver=this.getU8(),e.sbver>2)throw new Error("Unsupported HDF5 superblock version "+e.sbver);return e.sbver<=1?(e.fsver=this.getU8(),e.rgver=this.getU8(),this.skip(1),e.shver=this.getU8(),e.offsz=this.getU8(),e.lensz=this.getU8(),this.skip(1),e.gln_k=this.getU16(),e.gin_k=this.getU16(),e.cflags=this.getU32(),1===e.sbver&&(e.isin_k=this.getU16(),this.skip(2)),e.base_addr=this.getOffset(e.offsz),e.gfsi_addr=this.getOffset(e.offsz),e.eof_addr=this.getOffset(e.offsz),e.dib_addr=this.getOffset(e.offsz),e.root_ln_offs=this.getOffset(e.offsz),e.root_addr=this.getOffset(e.offsz),e.root_cache_type=this.getU32(),this.skip(4),this.skip(16)):(e.offsz=this.getU8(),e.lensz=this.getU8(),e.cflags=this.getU8(),e.base_addr=this.getOffset(e.offsz),e.ext_addr=this.getOffset(e.offsz),e.eof_addr=this.getOffset(e.offsz),e.root_addr=this.getOffset(e.offsz),e.checksum=this.getU32()),this.getMetadata("debug")&&console.log("HDF5 SB "+e.sbver+" "+e.offsz+" "+e.lensz+" "+e.cflags),e}},{key:"hdf5FractalHeapHeader",value:function(){var e={};if(!this.checkSignature("FRHP"))throw new Error("Bad or missing FRHP signature");e.ver=this.getU8(),e.idlen=this.getU16(),e.iof_el=this.getU16(),e.flags=this.getU8(),e.objmax=this.getU32(),e.objnid=this.getLength(),e.objbta=this.getOffset(),e.nf_blk=this.getLength(),e.af_blk=this.getOffset(),e.heap_total=this.getLength(),e.heap_alloc=this.getLength(),e.bai_offset=this.getLength(),e.heap_nobj=this.getLength(),e.heap_chuge=this.getLength(),e.heap_nhuge=this.getLength(),e.heap_ctiny=this.getLength(),e.heap_ntiny=this.getLength(),e.table_width=this.getU16(),e.start_blksz=this.getLength(),e.max_blksz=this.getLength(),e.max_heapsz=this.getU16(),e.rib_srows=this.getU16(),e.root_addr=this.getOffset(),e.rib_crows=this.getU16();var t=Math.log2(e.max_blksz)-Math.log2(e.start_blksz)+2;if(e.K=Math.min(e.rib_crows,t)*e.table_width,e.N=e.rib_crows<t?0:e.K-t*e.table_width,this.getMetadata("debug")&&(console.log("FRHP V"+e.ver+" F"+e.flags+" "+e.objbta+" Total:"+e.heap_total+" Alloc:"+e.heap_alloc+" #obj:"+e.heap_nobj+" width:"+e.table_width+" start_blksz:"+e.start_blksz+" max_blksz:"+e.max_blksz+" "+e.max_heapsz+" srows:"+e.rib_srows+" crows:"+e.rib_crows+" "+e.heap_nhuge),console.log("   K: "+e.K+" N: "+e.N)),e.iof_el>0)throw new Error("Filters present in fractal heap.");return e}},{key:"hdf5V2BtreeHeader",value:function(){var e={};if(!this.checkSignature("BTHD"))throw new Error("Bad or missing BTHD signature");return e.ver=this.getU8(),e.type=this.getU8(),e.nodesz=this.getU32(),e.recsz=this.getU16(),e.depth=this.getU16(),e.splitp=this.getU8(),e.mergep=this.getU8(),e.root_addr=this.getOffset(),e.root_nrec=this.getU16(),e.total_nrec=this.getLength(),e.checksum=this.getU32(),this.getMetadata("debug")&&console.log("BTHD V"+e.ver+" T"+e.type+" "+e.nodesz+" "+e.recsz+" "+e.depth+" "+e.root_addr+" "+e.root_nrec+" "+e.total_nrec),e}},{key:"hdf5V2BtreeRecords",value:function(e,t,r,n){var i,a,s,o;if(1===t)for(i=0;i<r;i++){s=this.getOffset(),o=this.getLength();var l=this.getLength();this.getMetadata("debug")&&console.log("  -> "+s+" "+o+" "+l+" "+this._this._huge_id),a=this.tell(),l===this._this._huge_id&&(this.seek(s),this.hdf5MsgAttribute(o,n)),this.seek(a)}else{if(8!==t)throw new Error("Unhandled V2 btree type.");var u,c;u=e.max_heapsz/8;var h=Math.min(e.objmax,e.max_blksz);for(c=h<=256?1:h<=65536?2:4,i=0;i<r;i++){var f=this.getU8();if(0!=(192&f))throw new Error("Bad Fractal Heap ID version "+f);var d,p=48&f;if(16===p)this._this._huge_id=this.getUXX(7);else{if(0!==p)throw new Error("Can't handle this Heap ID: "+f);s=this.getUXX(u),o=this.getUXX(c)}if(d=this.getU8(),this.getU32(),this.getU32(),this.getMetadata("debug")&&console.log("  -> "+f+" "+s+" "+o+" "+d),a=this.tell(),16===p){this.seek(e.objbta);var g=this.hdf5V2BtreeHeader();if(1!==g.type)throw new Error("Can only handle type-1 btrees");this.seek(g.root_addr),this.hdf5V2BtreeLeafNode(e,g.root_nrec,n)}else{var _=this.hdf5FractalHeapOffset(e,s);this.seek(_),this.hdf5MsgAttribute(o,n)}this.seek(a)}}}},{key:"hdf5V2BtreeLeafNode",value:function(e,t,r){if(!this.checkSignature("BTLF"))throw new Error("Bad or missing BTLF signature");var n=this.getU8(),i=this.getU8();this.getMetadata("debug")&&console.log("BTLF V"+n+" T"+i+" "+this.tell()),this.hdf5V2BtreeRecords(e,i,t,r)}},{key:"hdf5V2BtreeInternalNode",value:function(e,t,r,n){if(!this.checkSignature("BTIN"))throw new Error("Bad or missing BTIN signature");var i,a=this.getU8(),s=this.getU8();for(this.getMetadata("debug")&&console.log("BTIN V"+a+" T"+s),this.hdf5V2BtreeRecords(e,s,t,n),i=0;i<=t;i++){var o,l=this.getOffset(),u=this.getUXX(1);r>1&&(o=this.getUXX(1)),this.getMetadata("debug")&&console.log(" child->"+l+" "+u+" "+o)}}},{key:"hdf5GetMsgName",value:function(e){var t=["NIL","Dataspace","LinkInfo","Datatype","FillValue 1","FillValue 2","Link","ExternalFiles","Layout","BOGUS","GroupInfo","FilterPipeline","Attribute","ObjectComment","ObjectModTime 1","SharedMsgTable","ObjHdrContinue","SymbolTable","ObjectModTime 2","BtreeKValue","DriverInfo","AttrInfo","ObjectRefCnt","MESSAGE23","FileSpaceInfo"];if(e<t.length)return t[e];throw new Error("Unknown message type "+e+" "+this.tell())}},{key:"hdf5V1BtreeNode",value:function(e){var t,r=this._getInput(),n={};if(!this.checkSignature("TREE"))throw new Error("Bad TREE signature at "+this.tell());if(n.keys=[],n.node_type=this.getU8(),n.node_level=this.getU8(),n.entries_used=this.getU16(),n.left_sibling=this.getOffset(),n.right_sibling=this.getOffset(),this.getMetadata("debug")&&console.log("BTREE type "+n.node_type+" lvl "+n.node_level+" n_used "+n.entries_used+" "+n.left_sibling+" "+n.right_sibling),e){var i,a,s,o,l,u=[];for(t=0;t<n.entries_used;t+=1){for(n.keys[t]={},u[t]={},u[t].chunk_size=this.getU32(),u[t].filter_mask=this.getU32(),u[t].chunk_offsets=[],i=0;i<e.dims.length+1;i+=1)u[t].chunk_offsets.push(this.getU64());n.keys[t].child_address=this.getOffset(),t<n.entries_used&&this.getMetadata("debug")&&console.log("  BTREE "+t+" chunk_size "+u[t].chunk_size+" filter_mask "+u[t].filter_mask+" addr "+n.keys[t].child_address)}for(u[t]={},u[t].chunk_size=this.getU32(),u[t].filter_mask=this.getU32(),u[t].chunk_offsets=[],i=0;i<e.dims.length+1;i+=1)u[t].chunk_offsets.push(this.getU64());if(0===n.node_level)for(t=0;t<n.entries_used;t+=1)if(a=u[t].chunk_size,s=n.keys[t].child_address,e.inflate){switch(o=new Uint8Array(r,s,a),l=pako_1.inflate(o),e.type){case this._type_enum.INT8:l=new Int8Array(l.buffer);break;case this._type_enum.UINT8:l=new Uint8Array(l.buffer);break;case this._type_enum.INT16:l=new Int16Array(l.buffer);break;case this._type_enum.UINT16:l=new Uint16Array(l.buffer);break;case this._type_enum.INT32:l=new Int32Array(l.buffer);break;case this._type_enum.UINT32:l=new Uint32Array(l.buffer);break;case this._type_enum.FLT:l=new Float32Array(l.buffer);break;case this._type_enum.DBL:l=new Float64Array(l.buffer);break;default:throw new Error("Unknown type code "+e.type)}e.array.length-e.n_filled<l.length&&(l=l.subarray(0,e.array.length-e.n_filled)),e.array.set(l,e.n_filled),e.n_filled+=l.length,this.getMetadata("debug")&&console.log(e.name+" "+o.length+" "+l.length+" "+e.n_filled+"/"+e.array.length)}else l=this.getArray(e.type,a,s),e.array.set(l,e.n_filled),e.n_filled+=l.length;else for(t=0;t<n.entries_used;t+=1)this.seek(n.keys[t].child_address),this.hdf5V1BtreeNode(e)}else for(t=0;t<n.entries_used;t+=1)n.keys[t]={},n.keys[t].key_value=this.getLength(),n.keys[t].child_address=this.getOffset(),this.getMetadata("debug")&&console.log("  BTREE "+t+" key "+n.keys[t].key_value+" adr "+n.keys[t].child_address);return n}},{key:"hdf5GroupSymbolTable",value:function(e,t){if(!this.checkSignature("SNOD"))throw new Error("Bad or missing SNOD signature");var r=this.getU8();this.skip(1);var n,i,a,s,o,l,u=this.getU16();for(this.getMetadata("debug")&&console.log("this.hdf5GroupSymbolTable V"+r+" #"+u+" '"+t.name+"'"),n=0;n<2*this._superblk.gln_k;n+=1)i=this.getOffset(),a=this.getOffset(),s=this.getU32(),this.skip(20),n<u&&((o=this.createLink()).hdr_offset=a,e&&(l=this.tell(),this.seek(e.lh_dseg_off+i),o.name=this.getString(e.lh_dseg_len),this.seek(l)),this.getMetadata("debug")&&console.log("    "+n+" O "+i+" A "+a+" T "+s+" '"+o.name+"'"),t.children.push(o))}},{key:"hdf5LocalHeap",value:function(){var e={};if(!this.checkSignature("HEAP"))throw new Error("Bad or missing HEAP signature");return e.lh_ver=this.getU8(),this.skip(3),e.lh_dseg_len=this.getLength(),e.lh_flst_len=this.getLength(),e.lh_dseg_off=this.getOffset(),this.getMetadata("debug")&&console.log("LHEAP V"+e.lh_ver+" "+e.lh_dseg_len+" "+e.lh_flst_len+" "+e.lh_dseg_off),e}},{key:"hdf5MsgDataspace",value:function(e,t){var r,n=this.getU8(),i=this.getU8(),a=this.getU8();n<=1?this.skip(5):this.skip(1);var s,o=1,l=[];for(s=0;s<i;s+=1)l[s]=this.getLength(),o*=l[s];r=i*this._superblk.lensz+(n<=1?8:4);var u=[];if(0!=(1&a))for(r+=i*this._superblk.lensz,s=0;s<i;s+=1)u[s]=this.getLength();var c=[];if(0!=(2&a))for(r+=i*this._superblk.lensz,s=0;s<i;s+=1)c[s]=this.getLength();var h="this.hdf5MsgDataspace V"+n+" N"+i+" F"+a;return this.getMetadata("debug")&&(0!==i&&(h+="["+l.join(", ")+"]"),console.log(h)),r<e&&this.skip(e-r),t&&(t.dims=l),o}},{key:"hdf5MsgLinkInfo",value:function(e){var t=this,r=this.getU8(),n=this.getU8();0!=(1&n)&&this.getU64();var i=this.getOffset(),a=this.getOffset();0!=(2&n)&&this.getOffset(),this.getMetadata("debug")&&console.log("this.hdf5MsgLinkInfo V"+r+" F"+n+" FH "+i+" BT "+a);var s=this.tell();if(i<this._superblk.eof_addr){this.seek(i);var o=this.hdf5FractalHeapHeader(),l=0;this.hdf5FractalHeapEnumerate(o,function(r,n,i,a){for(var s=n+a;l<o.heap_nobj&&t.tell()<s;)t.hdf5MsgLink(e),l+=1;return!0})}this.seek(s)}},{key:"dt_class_name",value:function(e){var t=["Fixed-Point","Floating-Point","Time","String","BitField","Opaque","Compound","Reference","Enumerated","Variable-Length","Array"];if(e<t.length)return t[e];throw new Error("Unknown datatype class: "+e)}},{key:"hdf5MsgDatatype",value:function(e){var t,r,n,i,a,s,o,l,u={},c=8,h="",f=this.getU8(),d=f>>4,p=15&f,g=[];for(l=0;l<3;l+=1)g[l]=this.getU8();var _=this.getU32();switch(this.getMetadata("debug")&&console.log("this.hdf5MsgDatatype V"+d+" C"+p+" "+this.dt_class_name(p)+" "+g[0]+"."+g[1]+"."+g[2]+" "+_),p){case 0:switch(t=this.getU16(),r=this.getU16(),_){case 4:u.typ_type=8&g[0]?this._type_enum.INT32:this._type_enum.UINT32;break;case 2:u.typ_type=8&g[0]?this._type_enum.INT16:this._type_enum.UINT16;break;case 1:u.typ_type=8&g[0]?this._type_enum.INT8:this._type_enum.UINT8;break;default:throw new Error("Unknown type size "+_)}u.typ_length=_,c+=4,this.getMetadata("debug")&&console.log("  ("+t+" "+r+")");break;case 1:if(h="",this.getMetadata("debug"))switch(65&g[0]){case 0:h+="LE ";break;case 1:h+="BE ";break;case 65:h+="VX ";break;default:throw new Error("Reserved fp byte order: "+g[0])}if(t=this.getU16(),r=this.getU16(),n=this.getU8(),i=this.getU8(),a=this.getU8(),s=this.getU8(),o=this.getU32(),this.getMetadata("debug")&&(h+=t+" "+r+" "+n+" "+i+" "+a+" "+s+" "+o),64===r&&0===t&&52===n&&11===i&&0===a&&52===s&&1023===o&&8===_)u.typ_type=this._type_enum.DBL;else{if(32!==r||0!==t||23!==n||8!==i||0!==a||23!==s||127!==o||4!==_)throw new Error("Unsupported floating-point type");u.typ_type=this._type_enum.FLT}this.getMetadata("debug")&&console.log(h),u.typ_length=_,c+=12;break;case 3:u.typ_type=this._type_enum.STR,u.typ_length=_;break;default:throw new Error("Unimplemented HDF5 data class "+p)}return e>c&&this.skip(e-c),u}},{key:"hdf5MsgLayout",value:function(e){var t,r,n,i,a,s,o,l="",u=this.getU8(),c=[],h=1;if(1===u||2===u){if(r=this.getU8(),t=this.getU8(),this.skip(5),this.getMetadata("debug")&&(l+="this.hdf5MsgLayout V"+u+" N"+r+" C"+t),1===t||2===t){var f=this.getOffset();this.getMetadata("debug")&&(l+=" A"+f),e.data_offset=f}for(i=0;i<r;i+=1)c[i]=this.getU32(),h*=c[i];this.getMetadata("debug")&&(l+="["+c.join(", ")+"]"),2===t&&(o=this.getU32(),e.chunk_size=h*o,this.getMetadata("debug")&&(l+=" E"+o)),0===t?(n=this.getU32(),this.getMetadata("debug")&&(l+="("+n+")"),e.data_offset=this.tell(),e.data_length=n):1===t&&(e.data_length=h)}else{if(3!==u)throw new Error("Illegal layout version "+u);if(l="this.hdf5MsgLayout V"+u+" C"+(t=this.getU8()),0===t)n=this.getU16(),this.getMetadata("debug")&&(l+="("+n+")"),e.data_offset=this.tell(),e.data_length=n;else if(1===t)a=this.getOffset(),s=this.getLength(),this.getMetadata("debug")&&(l+="("+a+", "+s+")"),e.data_offset=a,e.data_length=s;else if(2===t){for(r=this.getU8(),a=this.getOffset(),e.data_offset=a,e.chunk_size=1,i=0;i<r-1;i+=1)c[i]=this.getU32(),h*=c[i];this.getMetadata("debug")&&(l+="(N"+r+", A"+a+" ["+c.join(",")+"]"),o=this.getU32(),e.chunk_size=h*o,this.getMetadata("debug")&&(l+=" E"+o)}}this.getMetadata("debug")&&console.log(l)}},{key:"hdf5MsgPipeline",value:function(e){var t,r,n,i,a,s=this.getU8(),o=this.getU8(),l="this.hdf5MsgPipeline V"+s+" N"+o;for(1===s&&this.skip(6),this.getMetadata("debug")&&console.log(l),t=0;t<o;t+=1){if(1!==(r=this.getU16()))throw new Error("Unimplemented HDF5 filter "+r);if("object"!==(void 0===pako_1?"undefined":_typeof(pako_1)))throw new Error("Need pako to inflate data.");e.inflate=!0,n=1===s||r>256?this.getU16():0,i=this.getU16(),0!=(1&(a=this.getU16()))&&(a+=1),0!==n&&this.skip(n),this.skip(4*a),this.getMetadata("debug")&&console.log("  "+t+" ID"+r+" F"+i+" "+a)}}},{key:"hdf5MsgAttribute",value:function(e,t){var r=this.getU8(),n=this.getU8(),i=this.getU16(),a=this.getU16(),s=this.getU16(),o="this.hdf5MsgAttribute V"+r+" F"+n+" "+e+": ";if(0!=(3&n))throw new Error("Shared dataspaces and datatypes are not supported.");if(3===r){var l=this.getU8();this.getMetadata("debug")&&(o+=0===l?"ASCII":"UTF-8")}this.getMetadata("debug")&&(o+="("+i+" "+a+" "+s+")"),r<3&&(i=8*Math.floor((i+7)/8),a=8*Math.floor((a+7)/8),s=8*Math.floor((s+7)/8),this.getMetadata("debug")&&(o+="/("+i+" "+a+" "+s+")"));var u=this.getString(i);this.getMetadata("debug")&&(o+=" Name: "+u,console.log(o));var c,h=this.hdf5MsgDatatype(a),f=this.hdf5MsgDataspace(s),d=0;d=e>0?r<3?e-(8+i+a+s):e-(9+i+a+s):h.typ_length*f,this.getMetadata("debug")&&console.log("  attribute data size "+d+" "+this.tell()),c=h.typ_type===this._type_enum.STR?this.getString(d):this.getArray(h.typ_type,d),t.attributes[u]=c}},{key:"hdf5MsgGroupInfo",value:function(){var e=4,t=8,r=this.getU8(),n=this.getU8();0!=(1&n)&&(this.getU16(),this.getU16()),0!=(2&n)&&(e=this.getU16(),t=this.getU16()),this.getMetadata("debug")&&console.log("this.hdf5MsgGroupInfo V"+r+" F"+n+" ENT "+e+" LNL "+t)}},{key:"hdf5MsgLink",value:function(e){var t=this.getU8(),r=0;if(1!==t)throw new Error("Bad link message version "+t);var n=this.getU8();0!=(8&n)&&(r=this.getU8()),0!=(4&n)&&this.getU64(),0!=(16&n)&&this.getU8();var i=1<<(3&n),a=this.getUXX(i),s=this.createLink();s.name=this.getString(a),0==(8&n)&&(s.hdr_offset=this.getOffset()),this.getMetadata("debug")&&console.log("this.hdf5MsgLink V"+t+" F"+n+" T"+r+" NM "+s.name+" OF "+s.hdr_offset),e.children.push(s)}},{key:"hdf5FractalHeapDirectBlock",value:function(e,t,r,n){if(!this.checkSignature("FHDB"))throw new Error("Bad or missing FHDB signature");var i=this.getU8();if(0!==i)throw new Error("Bad FHDB version: "+i);this.getOffset();var a=Math.ceil(e.max_heapsz/8),s=this.getUXX(a);0!=(2&e.flags)&&this.getU32(),this.getMetadata("debug")&&console.log("FHDB V:"+i+" R:"+t+" O:"+s+" A:"+r);var o;this._superblk.offsz;return 0!=(2&e.flags)&&4,o=t<=1?e.start_blksz:Math.pow(2,t-1)*e.start_blksz,!n||n(t,r,s,o)}},{key:"hdf5FractalHeapIndirectBlock",value:function(e,t){if(!this.checkSignature("FHIB"))throw new Error("Bad or missing FHIB signature");var r=this.getU8();if(0!==r)throw new Error("Bad FHIB version: "+r);this.getOffset();var n,i,a=Math.ceil(e.max_heapsz/8),s=this.getUXX(a);this.getMetadata("debug")&&console.log("FHIB V:"+r+" O:"+s);var o=[];for(n=0;n<e.K;n+=1)(i=this.getOffset())<this._superblk.eof_addr&&(this.getMetadata("debug")&&console.log("direct block at "+i),o.push(i));var l=[];for(n=0;n<e.N;n+=1)(i=this.getOffset())<this._superblk.eof_addr&&(this.getMetadata("debug")&&console.log("indirect block at "+i),l.push(i));for(this.getU32(),n=0;n<o.length;n++)if(this.seek(o[n]),!this.hdf5FractalHeapDirectBlock(e,n/e.table_width,o[n],t))return!1;for(n=0;n<l.length;n++)if(this.seek(l[n]),!this.hdf5FractalHeapIndirectBlock(e,t))return!1;return!0}},{key:"hdf5FractalHeapEnumerate",value:function(e,t){this.seek(e.root_addr),0===e.K?this.hdf5FractalHeapDirectBlock(e,0,e.root_addr,t):this.hdf5FractalHeapIndirectBlock(e,t)}},{key:"hdf5FractalHeapOffset",value:function(e,t){var r;return this.hdf5FractalHeapEnumerate(e,function(e,n,i,a){return!(t>=i&&t<i+a)||(r=n+(t-i),!1)}),r}},{key:"hdf5MsgAttrInfo",value:function(e){var t=this.getU8();if(0!==t)throw new Error("Bad attribute information message version: "+t);var r=this.getU8();0!=(1&r)&&this.getU16();var n=this.getOffset(),i=this.getOffset();0!=(2&r)&&this.getOffset(),this.getMetadata("debug")&&console.log("this.hdf5MsgAttrInfo V"+t+" F"+r+" HP "+n+" AN "+i);var a,s=this.tell();if(n<this._superblk.eof_addr&&(this.seek(n),a=this.hdf5FractalHeapHeader()),i<this._superblk.eof_addr){this.seek(i);var o=this.hdf5V2BtreeHeader();if(8!==o.type)throw new Error("Can only handle indexed attributes.");this.seek(o.root_addr),o.depth>0?this.hdf5V2BtreeInternalNode(a,o.root_nrec,o.depth,e):this.hdf5V2BtreeLeafNode(a,o.root_nrec,e)}this.seek(s)}},{key:"hdf5ProcessMessage",value:function(e,t){var r,n={};switch(e.hm_type){case 1:this.hdf5MsgDataspace(e.hm_size,t);break;case 2:this.hdf5MsgLinkInfo(t);break;case 3:r=this.hdf5MsgDatatype(e.hm_size),t&&(t.type=r.typ_type);break;case 6:this.hdf5MsgLink(t);break;case 8:this.hdf5MsgLayout(t);break;case 10:this.hdf5MsgGroupInfo();break;case 11:this.hdf5MsgPipeline(t);break;case 12:this.hdf5MsgAttribute(e.hm_size,t);break;case 16:n.cq_off=this.getOffset(),n.cq_len=this.getLength(),this._continuation_queue.push(n),this.getMetadata("debug")&&console.log("hdf5MsgObjHdrContinue "+n.cq_off+" "+n.cq_len);break;case 17:t.sym_btree=this.getOffset(),t.sym_lheap=this.getOffset(),this.getMetadata("debug")&&console.log("hdf5MsgSymbolTable "+t.sym_btree+" "+t.sym_lheap);break;case 21:this.hdf5MsgAttrInfo(t);break;case 0:case 4:case 5:case 7:case 18:case 19:case 20:case 22:case 24:this.skip(e.hm_size);break;default:throw new Error("Unknown message type: "+e.hm_type)}}},{key:"hdf5V2ObjectHeader",value:function(e){if(!this.checkSignature("OHDR"))throw new Error("Bad or missing OHDR signature");var t=this,r=this.getU8(),n=this.getU8();0!=(32&n)&&(this.getU32(),this.getU32(),this.getU32(),this.getU32()),0!=(16&n)&&(this.getU16(),this.getU16());var i,a,s,o=1<<(3&n),l=this.getUXX(o),u=0,c=0,h=l;for(this.getMetadata("debug")&&console.log("this.hdf5V2ObjectHeader V"+r+" F"+n+" HS"+l);;){for(;h-c>=8;)(i={}).hm_type=this.getU8(),i.hm_size=this.getU16(),i.hm_flags=this.getU8(),this.getMetadata("debug")&&console.log("  msg"+u+" F"+i.hm_flags+" T "+i.hm_type+" S "+i.hm_size+" ("+c+"/"+h+") "+this.hdf5GetMsgName(i.hm_type)),0!=(4&n)&&(i.hm_corder=this.getU16()),s=this.tell(),this.hdf5ProcessMessage(i,e),this.seek(s+i.hm_size),c+=i.hm_size+4,u+=1;if(h-c>4&&this.skip(h-(c+4)),this.getU32(),0===this._continuation_queue.length)break;if(a=this._continuation_queue.shift(),this.seek(a.cq_off),h=a.cq_len-4,c=0,this.getMetadata("debug")&&console.log("continuing with "+a.cq_len+" bytes at "+this.tell()),!this.checkSignature("OCHK"))throw new Error("Bad v2 object continuation")}e.children.forEach(function(e,r){t.seek(e.hdr_offset),t.getMetadata("debug")&&console.log(r+" "+e.hdr_offset+" "+e.name),t.checkSignature("OHDR")?(t.seek(e.hdr_offset),t.hdf5V2ObjectHeader(e)):(t.seek(e.hdr_offset),t.hdf5V1ObjectHeader(e))})}},{key:"loadData",value:function(e){var t=this;if(0!==e.chunk_size){this.seek(e.data_offset);var r,n=1;for(r=0;r<e.dims.length;r+=1)n*=e.dims[r];n*=this.typeSize(e.type),this.getMetadata("debug")&&console.log("allocating "+n+" bytes");var i=new ArrayBuffer(n);switch(e.n_filled=0,e.type){case this._type_enum.INT8:e.array=new Int8Array(i);break;case this._type_enum.UINT8:e.array=new Uint8Array(i);break;case this._type_enum.INT16:e.array=new Int16Array(i);break;case this._type_enum.UINT16:e.array=new Uint16Array(i);break;case this._type_enum.INT32:e.array=new Int32Array(i);break;case this._type_enum.UINT32:e.array=new Uint32Array(i);break;case this._type_enum.FLT:e.array=new Float32Array(i);break;case this._type_enum.DBL:e.array=new Float64Array(i);break;default:throw new Error("Illegal type: "+e.type)}this.hdf5V1BtreeNode(e)}else e.data_offset>0&&e.data_offset<this._superblk.eof_addr?(this.getMetadata("debug")&&console.log("loading "+e.data_length+" bytes from "+e.data_offset+" to "+e.name),e.array=this.getArray(e.type,e.data_length,e.data_offset)):this.getMetadata("debug")&&console.log("data not present for /"+e.name+"/");e.children.forEach(function(e){t.loadData(e)})}},{key:"hdf5V1ObjectHeader",value:function(e){var t=this,r={};if(this.startAlignment(),r.oh_ver=this.getU8(),this.skip(1),r.oh_n_msgs=this.getU16(),r.oh_ref_cnt=this.getU32(),r.oh_hdr_sz=this.getU32(),1!==r.oh_ver)throw new Error("Bad v1 object header version: "+r.oh_ver);this.getMetadata("debug")&&console.log("this.hdf5V1ObjectHeader V"+r.oh_ver+" #M "+r.oh_n_msgs+" RC "+r.oh_ref_cnt+" HS "+r.oh_hdr_sz);var n,i,a,s,o=r.oh_hdr_sz;for(i=0;i<r.oh_n_msgs;i+=1){if(o<=8){if(0===this._continuation_queue.length)break;n=this._continuation_queue.shift(),this.seek(n.cq_off),o=n.cq_len,this.getMetadata("debug")&&console.log("continuing with "+o+" bytes at "+this.tell()),this.startAlignment()}if(this.checkAlignment(),(a={}).hm_type=this.getU16(),a.hm_size=this.getU16(),a.hm_flags=this.getU8(),a.hm_size%8!=0)throw new Error("Size is not 8-byte aligned: "+a.hm_size);this.skip(3),o-=8+a.hm_size,this.getMetadata("debug")&&console.log("  msg"+i+" F "+a.hm_flags+" T "+a.hm_type+" S "+a.hm_size+"("+o+") "+this.hdf5GetMsgName(a.hm_type)),s=this.tell(),this.hdf5ProcessMessage(a,e),this.seek(s+a.hm_size)}if(0!==e.sym_btree&&0!==e.sym_lheap){this.seek(e.sym_btree);var l=this.hdf5V1BtreeNode();this.seek(e.sym_lheap);var u,c=this.hdf5LocalHeap();for(u=0;u<l.entries_used;u+=1)this.seek(l.keys[u].child_address),this.checkSignature("SNOD")?(this.seek(l.keys[u].child_address),this.hdf5GroupSymbolTable(c,e)):(this.seek(l.keys[u].child_address),this.hdf5V1ObjectHeader(e));e.children.forEach(function(e){t.seek(e.hdr_offset),t.hdf5V1ObjectHeader(e)})}}},{key:"getTypeMatchMinc",value:function(e){return this._type_matching[e-1]}},{key:"defined",value:function(e){return void 0!==e}},{key:"typeName",value:function(e){return this.defined(e)?e.constructor.name:"undefined"}},{key:"typeSize",value:function(e){if(e>=this._type_enum.INT8&&e<this.type_sizes.length)return this.type_sizes[e];throw new Error("Unknown type "+e)}},{key:"typeIsFloat",value:function(e){return e>=this._type_enum.FLT&&e<=this._type_enum.DBL}},{key:"join",value:function(e,t){var r="";if(e&&e.length){var n;for(n=0;n<e.length-1;n+=1)r+=e[n],r+=t;r+=e[n]}return r}},{key:"printStructure",value:function(e,t){var r,n=this,i="";for(r=0;r<2*t;r+=1)i+=" ";i+=e.name+(e.children.length?"/":""),e.type>0&&(i+=" "+this.typeName(e.array),e.dims.length&&(i+="["+e.dims.join(", ")+"]"),e.array?i+=":"+e.array.length:i+=" NULL"),console.log(i),Object.keys(e.attributes).forEach(function(a){var s=e.attributes[a];for(i="",r=0;r<2*t+1;r+=1)i+=" ";i+=e.name+":"+a+" "+n.typeName(s)+"["+s.length+"] ","string"==typeof s?i+=JSON.stringify(s):(i+="{"+n.join(s.slice(0,16),", "),s.length>16&&(i+=", ..."),i+="}"),console.log(i)}),e.children.forEach(function(e){n.printStructure(e,t+1)})}},{key:"findDataset",value:function(e,t,r){var n,i=this;return e&&e.name===t&&e.type>0?n=e:e.children.find(function(e){return n=i.findDataset(e,t,r+1),i.defined(n)}),n}},{key:"findAttribute",value:function(e,t,r){var n=this,i=e.attributes[t];return i||(e.children.find(function(e){return i=n.findAttribute(e,t,r+1),n.defined(i)}),i)}},{key:"scaleVoxels",value:function(e,t,r,n,i){var a=null,s=null;switch(this.getTypeMatchMinc(e.type)){case"int8":a=new ArrayBuffer(e.array.length*Int8Array.BYTES_PER_ELEMENT),s=new Int8Array(a);break;case"int16":a=new ArrayBuffer(e.array.length*Int16Array.BYTES_PER_ELEMENT),s=new Int16Array(a);break;case"int32":a=new ArrayBuffer(e.array.length*Int32Array.BYTES_PER_ELEMENT),s=new Int32Array(a);break;case"float32":a=new ArrayBuffer(e.array.length*Float32Array.BYTES_PER_ELEMENT),s=new Float32Array(a);break;case"float64":a=new ArrayBuffer(e.array.length*Float64Array.BYTES_PER_ELEMENT),s=new Float64Array(a);break;case"uint8":a=new ArrayBuffer(e.array.length*Uint8Array.BYTES_PER_ELEMENT),s=new Uint8Array(a);break;case"uint16":a=new ArrayBuffer(e.array.length*Uint16Array.BYTES_PER_ELEMENT),s=new Uint16Array(a);break;case"uint32":a=new ArrayBuffer(e.array.length*Uint32Array.BYTES_PER_ELEMENT),s=new Uint32Array(a);break;default:var o="Unsupported data type: "+header.datatype;throw console.log({message:o}),new Error(o)}if(e.dims.length-t.dims.length<1)throw new Error("Too few slice dimensions: "+e.dims.length+" "+t.dims.length);var l,u=1;for(l=t.dims.length;l<e.dims.length;l+=1)u*=e.dims[l];i&&console.log(u+" voxels in slice.");var c,h,f=0,d=0,p=-Number.MAX_VALUE,g=Number.MAX_VALUE,_=e.array,y=r.array,m=t.array;i&&console.log("valid range is "+n[0]+" to "+n[1]);var v,b,w,E=n[0],T=this.typeIsFloat(e.type);for(l=0;l<t.array.length;l+=1)if(i&&console.log(l+" "+m[l]+" "+y[l]+" "+_[l*u]),T)for(b=0;b<u;b+=1)(w=_[d])<n[0]||w>n[1]?s[d]=0:(s[d]=w,f+=w,w>p&&(p=w),w<g&&(g=w)),d+=1;else for(c=n[1]-n[0],h=y[l]-m[l],v=m[l],b=0;b<u;b+=1)w=(w=(_[d]-E)/c*h+v)/y[l]*n[1],s[d]=w,f+=w,d+=1,w>p&&(p=w),w<g&&(g=w);return i&&(console.log("Min: "+g),console.log("Max: "+p),console.log("Sum: "+f),console.log("Mean: "+f/d)),a}},{key:"isRgbVolume",value:function(e,t){var r=e.order;return"Uint8Array"===t.array.constructor.name&&r.length>0&&"vector_dimension"===r[r.length-1]&&3===e.vector_dimension.space_length}},{key:"rgbVoxels",value:function(e){var t,r=e.array,n=r.length,i=new ArrayBuffer(n/3*4),a=new Uint8Array(i),s=0;for(t=0;t<n;t+=3)a[s+0]=r[t+0],a[s+1]=r[t+1],a[s+2]=r[t+2],a[s+3]=255,s+=4;return i}},{key:"parseHeader",value:function(e){var t,r;try{t=JSON.parse(e)}catch(t){throw r="server did not respond with valid JSON\nResponse was: \n"+e,console.log({message:r}),new Error(r)}return 4===t.order.length&&(t.order=t.order.slice(1)),t.datatype=t.datatype||"uint8",t.xspace.space_length=parseFloat(t.xspace.space_length),t.yspace.space_length=parseFloat(t.yspace.space_length),t.zspace.space_length=parseFloat(t.zspace.space_length),t.xspace.start=parseFloat(t.xspace.start),t.yspace.start=parseFloat(t.yspace.start),t.zspace.start=parseFloat(t.zspace.start),t.xspace.step=parseFloat(t.xspace.step),t.yspace.step=parseFloat(t.yspace.step),t.zspace.step=parseFloat(t.zspace.step),t.xspace.direction_cosines=t.xspace.direction_cosines||[1,0,0],t.yspace.direction_cosines=t.yspace.direction_cosines||[0,1,0],t.zspace.direction_cosines=t.zspace.direction_cosines||[0,0,1],t.xspace.direction_cosines=t.xspace.direction_cosines.map(parseFloat),t.yspace.direction_cosines=t.yspace.direction_cosines.map(parseFloat),t.zspace.direction_cosines=t.zspace.direction_cosines.map(parseFloat),t[t.order[0]].offset=t[t.order[1]].space_length*t[t.order[2]].space_length,t[t.order[1]].offset=t[t.order[2]].space_length,t[t.order[2]].offset=1,t.time&&(t.time.space_length=parseFloat(t.time.space_length),t.time.start=parseFloat(t.time.start),t.time.step=parseFloat(t.time.step),t.time.offset=t.xspace.space_length*t.yspace.space_length*t.zspace.space_length),t}},{key:"createMincData",value:function(e,t){var r=null;switch(e.datatype){case"int8":r=new Int8Array(t);break;case"int16":r=new Int16Array(t);break;case"int32":r=new Int32Array(t);break;case"float32":r=new Float32Array(t);break;case"float64":r=new Float64Array(t);break;case"uint8":r=new Uint8Array(t);break;case"uint16":r=new Uint16Array(t);break;case"uint32":case"rgb8":r=new Uint32Array(t);break;default:var n="Unsupported data type: "+e.datatype;throw console.log({message:n}),new Error(n)}return r}},{key:"_run",value:function(){var e=this,t=this._getInput(0);if(t){this._dv=new DataView(t),this._dv.getUint64=function(t,r){var n=e._dv.getUint32(t+0,r),i=e._dv.getUint32(t+4,r);return r?(i<<32)+n:(n<<32)+i};var r=this.createLink();try{this._superblk=this.hdf5Superblock()}catch(e){return void console.warn("The input file is not a Minc2 file.")}this.seek(this._superblk.root_addr),this._superblk.sbver<=1?this.hdf5V1ObjectHeader(r):this.hdf5V2ObjectHeader(r),this.loadData(r),this.getMetadata("debug")&&this.printStructure(r,0);var n=this.findDataset(r,"image");if(!this.defined(n))throw new Error("Can't find image dataset.");var i=this.findAttribute(n,"valid_range",0);if(!this.defined(i)){var a,s;switch(n.type){case this._type_enum.INT8:a=-128,s=127;break;case this._type_enum.UINT8:a=0,s=255;break;case this._type_enum.INT16:a=-32768,s=32767;break;case this._type_enum.UINT16:a=0,s=65535;break;case this._type_enum.INT32:a=-(1<<31),s=(1<<31)-1;break;case this._type_enum.UINT32:a=0,s=0}i=Float32Array.of(a,s)}var o=this.findDataset(r,"image-min");this.defined(o)||(o={array:Float32Array.of(0),dims:[]});var l=this.findDataset(r,"image-max");this.defined(l)||(l={array:Float32Array.of(1),dims:[]});var u,c={},h=this.findAttribute(n,"dimorder",0);if("string"!=typeof h)throw new Error("Can't find dimension order.");c.order=h.split(","),c.order.forEach(function(t){var n=e.findDataset(r,t);if(!e.defined(n))throw new Error("Can't find dimension variable "+t);if(c[t]={},h=e.findAttribute(n,"step",0),e.defined(h)||(h=Float32Array.of(1)),c[t].step=h[0],h=e.findAttribute(n,"start",0),e.defined(h)||(h=Float32Array.of(0)),c[t].start=h[0],h=e.findAttribute(n,"length",0),!e.defined(h))throw new Error("Can't find length for "+t);c[t].space_length=h[0],h=e.findAttribute(n,"direction_cosines",0),e.defined(h)?c[t].direction_cosines=Array.prototype.slice.call(h):"xspace"===t?c[t].direction_cosines=[1,0,0]:"yspace"===t?c[t].direction_cosines=[0,1,0]:"zspace"===t&&(c[t].direction_cosines=[0,0,1])}),this.isRgbVolume(c,n)?(c.order.pop(),c.datatype="rgb8",u=this.rgbVoxels(n)):(c.datatype=this.getTypeMatchMinc(n.type),u=this.scaleVoxels(n,o,l,i,this.getMetadata("debug")));var f=this.parseHeader(JSON.stringify(c)),d=this.createMincData(f,u);this._addOutput(MniVolume);var p=this.getOutput();p.setData(d,f),p.setMetadata("format","minc2")}else console.warn('Minc2Decoder requires an ArrayBuffer as input "0". Unable to continue.')}}]),t}(),NiftiDecoder=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setMetadata("targetType",MniVolume.name),e.addInputValidator(0,ArrayBuffer),e.setMetadata("debug",!1),e}return inherits(t,Decoder),createClass(t,[{key:"parseNifti1Header",value:function(e){var t={order:[],xspace:{},yspace:{},zspace:{}},r=null,n=new DataView(e,0,348),i=new Uint8Array(e,0,348),a=!0,s=n.getUint32(0,!0);348===s?a=!0:1543569408===s?a=!1:r="This does not look like a NIfTI-1 file.";var o=n.getUint16(40,a);(o<3||o>4)&&(r="Cannot handle "+o+"-dimensional images yet.");var l=String.fromCharCode.apply(null,i.subarray(344,348));if("n+1\0"!==l&&(r="Bad magic number: '"+l+"'"),r)return console.warn("The input file is not a NIfTI file."),null;t.xspace.space_length=n.getUint16(42,a),t.yspace.space_length=n.getUint16(44,a),t.zspace.space_length=n.getUint16(46,a);var u=n.getUint16(48,a),c=n.getUint16(70,a),h=n.getUint16(72,a),f=n.getFloat32(80,a),d=n.getFloat32(84,a),p=n.getFloat32(88,a),g=n.getFloat32(92,a),_=n.getFloat32(108,a);_<352&&(_=352);var y,m,v=n.getFloat32(112,a),b=n.getFloat32(116,a),w=n.getUint16(252,a),E=n.getUint16(254,a),T=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];if(u>=1&&(t.time={},t.time.space_length=u,t.time.step=g,t.time.start=0,t.time.name="time"),t.bytes_per_voxel=h/8,t.must_swap_data=!a&&t.bytes_per_voxel>1,E>0)T[0][0]=n.getFloat32(280,a),T[0][1]=n.getFloat32(284,a),T[0][2]=n.getFloat32(288,a),T[0][3]=n.getFloat32(292,a),T[1][0]=n.getFloat32(296,a),T[1][1]=n.getFloat32(300,a),T[1][2]=n.getFloat32(304,a),T[1][3]=n.getFloat32(308,a),T[2][0]=n.getFloat32(312,a),T[2][1]=n.getFloat32(316,a),T[2][2]=n.getFloat32(320,a),T[2][3]=n.getFloat32(324,a);else if(w>0){var k=n.getFloat32(256,a),x=n.getFloat32(260,a),S=n.getFloat32(264,a),I=n.getFloat32(268,a),A=n.getFloat32(272,a),M=n.getFloat32(276,a),N=n.getFloat32(76,a)<0?-1:1;T=this.niftiQuaternToMat44(k,x,S,I,A,M,f,d,p,N)}else T[0][0]=f,T[1][1]=d,T[2][2]=p;var C=[0,1,2],O=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,1]];for(y=0;y<3;y++){var D=Math.abs(T[0][y]),R=Math.abs(T[1][y]),B=Math.abs(T[2][y]);D>R&&D>B?(t.order[2-y]="xspace",C[y]=0):R>D&&R>B?(t.order[2-y]="yspace",C[y]=1):(t.order[2-y]="zspace",C[y]=2)}for(y=0;y<3;y++)for(m=0;m<4;m++){var F=m;m<3&&(F=C[m]),O[y][F]=T[y][m]}return MniVolume.transformToMinc(O,t),t[t.order[2]].space_length=n.getUint16(42,a),t[t.order[1]].space_length=n.getUint16(44,a),t[t.order[0]].space_length=n.getUint16(46,a),u>=1&&t.order.unshift("time"),t.datatype=c,t.vox_offset=_,t.scl_slope=v,t.scl_inter=b,t}},{key:"niftiQuaternToMat44",value:function(e,t,r,n,i,a,s,o,l,u){var c,h,f,d,p=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,1]],g=e,_=t,y=r;return(c=1-(g*g+_*_+y*y))<1e-7?(g*=c=1/Math.sqrt(g*g+_*_+y*y),_*=c,y*=c,c=0):c=Math.sqrt(c),h=s>0?s:1,f=o>0?o:1,d=l>0?l:1,u<0&&(d=-d),p[0][0]=(c*c+g*g-_*_-y*y)*h,p[0][1]=2*(g*_-c*y)*f,p[0][2]=2*(g*y+c*_)*d,p[1][0]=2*(g*_+c*y)*h,p[1][1]=(c*c+_*_-g*g-y*y)*f,p[1][2]=2*(_*y-c*g)*d,p[2][0]=2*(g*y-c*_)*h,p[2][1]=2*(_*y+c*g)*f,p[2][2]=(c*c+y*y-_*_-g*g)*d,p[0][3]=n,p[1][3]=i,p[2][3]=a,p}},{key:"createNifti1Data",value:function(e,t){var r=null;switch(e.must_swap_data&&MniVolume.swapn(new Uint8Array(t,e.vox_offset),e.bytes_per_voxel),e.datatype){case 2:r=new Uint8Array(t,e.vox_offset);break;case 4:r=new Int16Array(t,e.vox_offset);break;case 8:r=new Int32Array(t,e.vox_offset);break;case 16:r=new Float32Array(t,e.vox_offset);break;case 64:r=new Float64Array(t,e.vox_offset);break;case 256:r=new Int8Array(t,e.vox_offset);break;case 512:r=new Uint16Array(t,e.vox_offset);break;case 768:r=new Uint32Array(t,e.vox_offset);break;default:throw new Error("Unsupported data type: "+e.datatype)}var n=0,i=e.scl_slope,a=e.scl_inter;if(0!==i){var s=new Float32Array(r.length);for(n=0;n<r.length;n++)s[n]=r[n]*i+a;r=s}return 4===e.order.length&&(e.order=e.order.slice(1)),e[e.order[0]].offset=e[e.order[1]].space_length*e[e.order[2]].space_length,e[e.order[1]].offset=e[e.order[2]].space_length,e[e.order[2]].offset=1,e.time&&(e.time.offset=e.xspace.space_length*e.yspace.space_length*e.zspace.space_length),r}},{key:"_run",value:function(){var e=this._getInput(0);if(e){var t=null;try{t=this.parseNifti1Header(e)}catch(e){}if(t){var r=this.createNifti1Data(t,e);this._addOutput(MniVolume);var n=this.getOutput();n.setData(r,t),n.setMetadata("format","nifti")}else console.warn("This file is not a NIfTI file.")}else console.warn('NiftiDecoder requires an ArrayBuffer as input "0". Unable to continue.')}}]),t}(),utilities=createCommonjsModule(function(e){var t=t||{};t.Utils=t.Utils||{},t.Utils.crcTable=null,t.Utils.GUNZIP_MAGIC_COOKIE1=31,t.Utils.GUNZIP_MAGIC_COOKIE2=139,t.Utils.getStringAt=function(e,t,r){var n,i,a="";for(n=t;n<r;n+=1)0!==(i=e.getUint8(n))&&(a+=String.fromCharCode(i));return a},t.Utils.getByteAt=function(e,t){return e.getInt8(t)},t.Utils.getShortAt=function(e,t,r){return e.getInt16(t,r)},t.Utils.getIntAt=function(e,t,r){return e.getInt32(t,r)},t.Utils.getFloatAt=function(e,t,r){return e.getFloat32(t,r)},t.Utils.getDoubleAt=function(e,t,r){return e.getFloat64(t,r)},t.Utils.getLongAt=function(e,r,n){var i,a=[],s=0;for(i=0;i<8;i+=1)a[i]=t.Utils.getByteAt(e,r+i,n);for(i=a.length-1;i>=0;i--)s=256*s+a[i];return s},t.Utils.toArrayBuffer=function(e){var t,r,n;for(t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n<e.length;n+=1)r[n]=e[n];return t},t.Utils.isString=function(e){return"string"==typeof e||e instanceof String},t.Utils.formatNumber=function(e,r){var n=0;return n=t.Utils.isString(e)?Number(e):e,n=r?n.toPrecision(5):n.toPrecision(7),parseFloat(n)},t.Utils.makeCRCTable=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t},t.Utils.crc32=function(e){for(var r=t.Utils.crcTable||(t.Utils.crcTable=t.Utils.makeCRCTable()),n=-1,i=0;i<e.byteLength;i++)n=n>>>8^r[255&(n^e.getUint8(i))];return(-1^n)>>>0};e.exports&&(e.exports=t.Utils)}),nifti1=createCommonjsModule(function(e){var t=t||{};t.Utils=t.Utils||(void 0!==commonjsRequire?utilities:null),t.NIFTI1=t.NIFTI1||function(){this.littleEndian=!1,this.dim_info=0,this.dims=[],this.intent_p1=0,this.intent_p2=0,this.intent_p3=0,this.intent_code=0,this.datatypeCode=0,this.numBitsPerVoxel=0,this.slice_start=0,this.slice_end=0,this.slice_code=0,this.pixDims=[],this.vox_offset=0,this.scl_slope=1,this.scl_inter=0,this.xyzt_units=0,this.cal_max=0,this.cal_min=0,this.slice_duration=0,this.toffset=0,this.description="",this.aux_file="",this.intent_name="",this.qform_code=0,this.sform_code=0,this.quatern_b=0,this.quatern_c=0,this.quatern_d=0,this.qoffset_x=0,this.qoffset_y=0,this.qoffset_z=0,this.affine=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],this.magic=0,this.isHDR=!1,this.extensionFlag=[0,0,0,0],this.extensionSize=0,this.extensionCode=0},t.NIFTI1.TYPE_NONE=0,t.NIFTI1.TYPE_BINARY=1,t.NIFTI1.TYPE_UINT8=2,t.NIFTI1.TYPE_INT16=4,t.NIFTI1.TYPE_INT32=8,t.NIFTI1.TYPE_FLOAT32=16,t.NIFTI1.TYPE_COMPLEX64=32,t.NIFTI1.TYPE_FLOAT64=64,t.NIFTI1.TYPE_RGB24=128,t.NIFTI1.TYPE_INT8=256,t.NIFTI1.TYPE_UINT16=512,t.NIFTI1.TYPE_UINT32=768,t.NIFTI1.TYPE_INT64=1024,t.NIFTI1.TYPE_UINT64=1280,t.NIFTI1.TYPE_FLOAT128=1536,t.NIFTI1.TYPE_COMPLEX128=1792,t.NIFTI1.TYPE_COMPLEX256=2048,t.NIFTI1.XFORM_UNKNOWN=0,t.NIFTI1.XFORM_SCANNER_ANAT=1,t.NIFTI1.XFORM_ALIGNED_ANAT=2,t.NIFTI1.XFORM_TALAIRACH=3,t.NIFTI1.XFORM_MNI_152=4,t.NIFTI1.SPATIAL_UNITS_MASK=7,t.NIFTI1.TEMPORAL_UNITS_MASK=56,t.NIFTI1.UNITS_UNKNOWN=0,t.NIFTI1.UNITS_METER=1,t.NIFTI1.UNITS_MM=2,t.NIFTI1.UNITS_MICRON=3,t.NIFTI1.UNITS_SEC=8,t.NIFTI1.UNITS_MSEC=16,t.NIFTI1.UNITS_USEC=24,t.NIFTI1.UNITS_HZ=32,t.NIFTI1.UNITS_PPM=40,t.NIFTI1.UNITS_RADS=48,t.NIFTI1.MAGIC_COOKIE=348,t.NIFTI1.STANDARD_HEADER_SIZE=348,t.NIFTI1.MAGIC_NUMBER_LOCATION=344,t.NIFTI1.MAGIC_NUMBER=[110,43,49],t.NIFTI1.MAGIC_NUMBER2=[110,105,49],t.NIFTI1.EXTENSION_HEADER_SIZE=8,t.NIFTI1.prototype.readHeader=function(e){var r,n,i,a,s=new DataView(e),o=t.Utils.getIntAt(s,0,this.littleEndian);if(o!==t.NIFTI1.MAGIC_COOKIE&&(this.littleEndian=!0,o=t.Utils.getIntAt(s,0,this.littleEndian)),o!==t.NIFTI1.MAGIC_COOKIE)throw new Error("This does not appear to be a NIFTI file!");for(this.dim_info=t.Utils.getByteAt(s,39),r=0;r<8;r+=1)a=40+2*r,this.dims[r]=t.Utils.getShortAt(s,a,this.littleEndian);for(this.intent_p1=t.Utils.getFloatAt(s,56,this.littleEndian),this.intent_p2=t.Utils.getFloatAt(s,60,this.littleEndian),this.intent_p3=t.Utils.getFloatAt(s,64,this.littleEndian),this.intent_code=t.Utils.getShortAt(s,68,this.littleEndian),this.datatypeCode=t.Utils.getShortAt(s,70,this.littleEndian),this.numBitsPerVoxel=t.Utils.getShortAt(s,72,this.littleEndian),this.slice_start=t.Utils.getShortAt(s,74,this.littleEndian),r=0;r<8;r+=1)a=76+4*r,this.pixDims[r]=t.Utils.getFloatAt(s,a,this.littleEndian);for(this.vox_offset=t.Utils.getFloatAt(s,108,this.littleEndian),this.scl_slope=t.Utils.getFloatAt(s,112,this.littleEndian),this.scl_inter=t.Utils.getFloatAt(s,116,this.littleEndian),this.slice_end=t.Utils.getShortAt(s,120,this.littleEndian),this.slice_code=t.Utils.getByteAt(s,122),this.xyzt_units=t.Utils.getByteAt(s,123),this.cal_max=t.Utils.getFloatAt(s,124,this.littleEndian),this.cal_min=t.Utils.getFloatAt(s,128,this.littleEndian),this.slice_duration=t.Utils.getFloatAt(s,132,this.littleEndian),this.toffset=t.Utils.getFloatAt(s,136,this.littleEndian),this.description=t.Utils.getStringAt(s,148,228),this.aux_file=t.Utils.getStringAt(s,228,252),this.qform_code=t.Utils.getShortAt(s,252,this.littleEndian),this.sform_code=t.Utils.getShortAt(s,254,this.littleEndian),this.quatern_b=t.Utils.getFloatAt(s,256,this.littleEndian),this.quatern_c=t.Utils.getFloatAt(s,260,this.littleEndian),this.quatern_d=t.Utils.getFloatAt(s,264,this.littleEndian),this.qoffset_x=t.Utils.getFloatAt(s,268,this.littleEndian),this.qoffset_y=t.Utils.getFloatAt(s,272,this.littleEndian),this.qoffset_z=t.Utils.getFloatAt(s,276,this.littleEndian),n=0;n<3;n+=1)for(i=0;i<4;i+=1)a=280+4*(4*n+i),this.affine[n][i]=t.Utils.getFloatAt(s,a,this.littleEndian);this.affine[3][0]=0,this.affine[3][1]=0,this.affine[3][2]=0,this.affine[3][3]=1,this.intent_name=t.Utils.getStringAt(s,328,344),this.magic=t.Utils.getStringAt(s,344,348),this.isHDR=this.magic===t.NIFTI1.MAGIC_NUMBER2,s.byteLength>t.NIFTI1.MAGIC_COOKIE&&(this.extensionFlag[0]=t.Utils.getByteAt(s,348),this.extensionFlag[1]=t.Utils.getByteAt(s,349),this.extensionFlag[2]=t.Utils.getByteAt(s,350),this.extensionFlag[3]=t.Utils.getByteAt(s,351),this.extensionFlag[0]&&(this.extensionSize=this.getExtensionSize(s),this.extensionCode=this.getExtensionCode(s)))},t.NIFTI1.prototype.toFormattedString=function(){var e=t.Utils.formatNumber,r="";return r+="Dim Info = "+this.dim_info+"\n",r+="Image Dimensions (1-8): "+this.dims[0]+", "+this.dims[1]+", "+this.dims[2]+", "+this.dims[3]+", "+this.dims[4]+", "+this.dims[5]+", "+this.dims[6]+", "+this.dims[7]+"\n",r+="Intent Parameters (1-3): "+this.intent_p1+", "+this.intent_p2+", "+this.intent_p3+"\n",r+="Intent Code = "+this.intent_code+"\n",r+="Datatype = "+this.datatypeCode+" ("+this.getDatatypeCodeString(this.datatypeCode)+")\n",r+="Bits Per Voxel = "+this.numBitsPerVoxel+"\n",r+="Slice Start = "+this.slice_start+"\n",r+="Voxel Dimensions (1-8): "+e(this.pixDims[0])+", "+e(this.pixDims[1])+", "+e(this.pixDims[2])+", "+e(this.pixDims[3])+", "+e(this.pixDims[4])+", "+e(this.pixDims[5])+", "+e(this.pixDims[6])+", "+e(this.pixDims[7])+"\n",r+="Image Offset = "+this.vox_offset+"\n",r+="Data Scale:  Slope = "+e(this.scl_slope)+"  Intercept = "+e(this.scl_inter)+"\n",r+="Slice End = "+this.slice_end+"\n",r+="Slice Code = "+this.slice_code+"\n",r+="Units Code = "+this.xyzt_units+" ("+this.getUnitsCodeString(t.NIFTI1.SPATIAL_UNITS_MASK&this.xyzt_units)+", "+this.getUnitsCodeString(t.NIFTI1.TEMPORAL_UNITS_MASK&this.xyzt_units)+")\n",r+="Display Range:  Max = "+e(this.cal_max)+"  Min = "+e(this.cal_min)+"\n",r+="Slice Duration = "+this.slice_duration+"\n",r+="Time Axis Shift = "+this.toffset+"\n",r+='Description: "'+this.description+'"\n',r+='Auxiliary File: "'+this.aux_file+'"\n',r+="Q-Form Code = "+this.qform_code+" ("+this.getTransformCodeString(this.qform_code)+")\n",r+="S-Form Code = "+this.sform_code+" ("+this.getTransformCodeString(this.sform_code)+")\n",r+="Quaternion Parameters:  b = "+e(this.quatern_b)+"  c = "+e(this.quatern_c)+"  d = "+e(this.quatern_d)+"\n",r+="Quaternion Offsets:  x = "+this.qoffset_x+"  y = "+this.qoffset_y+"  z = "+this.qoffset_z+"\n",r+="S-Form Parameters X: "+e(this.affine[0][0])+", "+e(this.affine[0][1])+", "+e(this.affine[0][2])+", "+e(this.affine[0][3])+"\n",r+="S-Form Parameters Y: "+e(this.affine[1][0])+", "+e(this.affine[1][1])+", "+e(this.affine[1][2])+", "+e(this.affine[1][3])+"\n",r+="S-Form Parameters Z: "+e(this.affine[2][0])+", "+e(this.affine[2][1])+", "+e(this.affine[2][2])+", "+e(this.affine[2][3])+"\n",r+='Intent Name: "'+this.intent_name+'"\n',this.extensionFlag[0]&&(r+="Extension: Size = "+this.extensionSize+"  Code = "+this.extensionCode+"\n"),r},t.NIFTI1.prototype.getDatatypeCodeString=function(e){return e===t.NIFTI1.TYPE_UINT8?"1-Byte Unsigned Integer":e===t.NIFTI1.TYPE_INT16?"2-Byte Signed Integer":e===t.NIFTI1.TYPE_INT32?"4-Byte Signed Integer":e===t.NIFTI1.TYPE_FLOAT32?"4-Byte Float":e===t.NIFTI1.TYPE_FLOAT64?"8-Byte Float":e===t.NIFTI1.TYPE_RGB24?"RGB":e===t.NIFTI1.TYPE_INT8?"1-Byte Signed Integer":e===t.NIFTI1.TYPE_UINT16?"2-Byte Unsigned Integer":e===t.NIFTI1.TYPE_UINT32?"4-Byte Unsigned Integer":e===t.NIFTI1.TYPE_INT64?"8-Byte Signed Integer":e===t.NIFTI1.TYPE_UINT64?"8-Byte Unsigned Integer":"Unknown"},t.NIFTI1.prototype.getTransformCodeString=function(e){return e===t.NIFTI1.XFORM_SCANNER_ANAT?"Scanner":e===t.NIFTI1.XFORM_ALIGNED_ANAT?"Aligned":e===t.NIFTI1.XFORM_TALAIRACH?"Talairach":e===t.NIFTI1.XFORM_MNI_152?"MNI":"Unknown"},t.NIFTI1.prototype.getUnitsCodeString=function(e){return e===t.NIFTI1.UNITS_METER?"Meters":e===t.NIFTI1.UNITS_MM?"Millimeters":e===t.NIFTI1.UNITS_MICRON?"Microns":e===t.NIFTI1.UNITS_SEC?"Seconds":e===t.NIFTI1.UNITS_MSEC?"Milliseconds":e===t.NIFTI1.UNITS_USEC?"Microseconds":e===t.NIFTI1.UNITS_HZ?"Hz":e===t.NIFTI1.UNITS_PPM?"PPM":e===t.NIFTI1.UNITS_RADS?"Rads":"Unknown"},t.NIFTI1.prototype.getQformMat=function(){return this.convertNiftiQFormToNiftiSForm(this.quatern_b,this.quatern_c,this.quatern_d,this.qoffset_x,this.qoffset_y,this.qoffset_z,this.pixDims[1],this.pixDims[2],this.pixDims[3],this.pixDims[0])},t.NIFTI1.prototype.convertNiftiQFormToNiftiSForm=function(e,t,r,n,i,a,s,o,l,u){var c,h,f,d,p=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],g=e,_=t,y=r;return p[3][0]=p[3][1]=p[3][2]=0,p[3][3]=1,(c=1-(g*g+_*_+y*y))<1e-7?(g*=c=1/Math.sqrt(g*g+_*_+y*y),_*=c,y*=c,c=0):c=Math.sqrt(c),h=s>0?s:1,f=o>0?o:1,d=l>0?l:1,u<0&&(d=-d),p[0][0]=(c*c+g*g-_*_-y*y)*h,p[0][1]=2*(g*_-c*y)*f,p[0][2]=2*(g*y+c*_)*d,p[1][0]=2*(g*_+c*y)*h,p[1][1]=(c*c+_*_-g*g-y*y)*f,p[1][2]=2*(_*y-c*g)*d,p[2][0]=2*(g*y-c*_)*h,p[2][1]=2*(_*y+c*g)*f,p[2][2]=(c*c+y*y-_*_-g*g)*d,p[0][3]=n,p[1][3]=i,p[2][3]=a,p},t.NIFTI1.prototype.convertNiftiSFormToNEMA=function(e){var t,r,n,i,a,s,o,l,u,c,h,f,d,p,g,_,y,m,v,b,w,E,T,k,x,S,I,A,M,N,C,O,D;if(p=0,S=[[0,0,0],[0,0,0],[0,0,0]],I=[[0,0,0],[0,0,0],[0,0,0]],t=e[0][0],r=e[0][1],n=e[0][2],i=e[1][0],a=e[1][1],s=e[1][2],o=e[2][0],l=e[2][1],u=e[2][2],0===(c=Math.sqrt(t*t+i*i+o*o)))return null;if(t/=c,i/=c,o/=c,0===(c=Math.sqrt(r*r+a*a+l*l)))return null;if(c=t*(r/=c)+i*(a/=c)+o*(l/=c),Math.abs(c)>1e-4){if(r-=c*t,a-=c*i,l-=c*o,0===(c=Math.sqrt(r*r+a*a+l*l)))return null;r/=c,a/=c,l/=c}if(0===(c=Math.sqrt(n*n+s*s+u*u))?(n=i*l-o*a,s=o*r-l*t,u=t*a-i*r):(n/=c,s/=c,u/=c),c=t*n+i*s+o*u,Math.abs(c)>1e-4){if(n-=c*t,s-=c*i,u-=c*o,0===(c=Math.sqrt(n*n+s*s+u*u)))return null;n/=c,s/=c,u/=c}if(c=r*n+a*s+l*u,Math.abs(c)>1e-4){if(n-=c*r,s-=c*a,u-=c*l,0===(c=Math.sqrt(n*n+s*s+u*u)))return null;n/=c,s/=c,u/=c}if(S[0][0]=t,S[0][1]=r,S[0][2]=n,S[1][0]=i,S[1][1]=a,S[1][2]=s,S[2][0]=o,S[2][1]=l,S[2][2]=u,0===(h=this.nifti_mat33_determ(S)))return null;for(x=-666,m=w=E=T=1,v=2,b=3,f=1;f<=3;f+=1)for(d=1;d<=3;d+=1)if(f!==d)for(p=1;p<=3;p+=1)if(f!==p&&d!==p)for(I[0][0]=I[0][1]=I[0][2]=I[1][0]=I[1][1]=I[1][2]=I[2][0]=I[2][1]=I[2][2]=0,g=-1;g<=1;g+=2)for(_=-1;_<=1;_+=2)for(y=-1;y<=1;y+=2)I[0][f-1]=g,I[1][d-1]=_,I[2][p-1]=y,this.nifti_mat33_determ(I)*h>0&&(c=(k=this.nifti_mat33_mul(I,S))[0][0]+k[1][1]+k[2][2])>x&&(x=c,m=f,v=d,b=p,w=g,E=_,T=y);switch(A=M=N=C=O=D=0,m*w){case 1:A="X",C="+";break;case-1:A="X",C="-";break;case 2:A="Y",C="+";break;case-2:A="Y",C="-";break;case 3:A="Z",C="+";break;case-3:A="Z",C="-"}switch(v*E){case 1:M="X",O="+";break;case-1:M="X",O="-";break;case 2:M="Y",O="+";break;case-2:M="Y",O="-";break;case 3:M="Z",O="+";break;case-3:M="Z",O="-"}switch(b*T){case 1:N="X",D="+";break;case-1:N="X",D="-";break;case 2:N="Y",D="+";break;case-2:N="Y",D="-";break;case 3:N="Z",D="+";break;case-3:N="Z",D="-"}return A+M+N+C+O+D},t.NIFTI1.prototype.nifti_mat33_mul=function(e,t){var r,n,i=[[0,0,0],[0,0,0],[0,0,0]];for(r=0;r<3;r+=1)for(n=0;n<3;n+=1)i[r][n]=e[r][0]*t[0][n]+e[r][1]*t[1][n]+e[r][2]*t[2][n];return i},t.NIFTI1.prototype.nifti_mat33_determ=function(e){var t,r,n,i,a,s,o,l,u;return t=e[0][0],r=e[0][1],n=e[0][2],i=e[1][0],a=e[1][1],s=e[1][2],o=e[2][0],l=e[2][1],t*a*(u=e[2][2])-t*l*s-i*r*u+i*l*n+o*r*s-o*a*n},t.NIFTI1.prototype.getExtensionLocation=function(){return t.NIFTI1.MAGIC_COOKIE+4},t.NIFTI1.prototype.getExtensionSize=function(e){return t.Utils.getIntAt(e,this.getExtensionLocation(),this.littleEndian)},t.NIFTI1.prototype.getExtensionCode=function(e){return t.Utils.getIntAt(e,this.getExtensionLocation()+4,this.littleEndian)};e.exports&&(e.exports=t.NIFTI1)}),nifti2=createCommonjsModule(function(e){var t=t||{};t.Utils=t.Utils||(void 0!==commonjsRequire?utilities:null),t.NIFTI1=t.NIFTI1||(void 0!==commonjsRequire?nifti1:null),t.NIFTI2=t.NIFTI2||function(){this.littleEndian=!1,this.dim_info=0,this.dims=[],this.intent_p1=0,this.intent_p2=0,this.intent_p3=0,this.intent_code=0,this.datatypeCode=0,this.numBitsPerVoxel=0,this.slice_start=0,this.slice_end=0,this.slice_code=0,this.pixDims=[],this.vox_offset=0,this.scl_slope=1,this.scl_inter=0,this.xyzt_units=0,this.cal_max=0,this.cal_min=0,this.slice_duration=0,this.toffset=0,this.description="",this.aux_file="",this.intent_name="",this.qform_code=0,this.sform_code=0,this.quatern_b=0,this.quatern_c=0,this.quatern_d=0,this.qoffset_x=0,this.qoffset_y=0,this.qoffset_z=0,this.affine=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],this.magic=0,this.extensionFlag=[0,0,0,0]},t.NIFTI2.MAGIC_COOKIE=540,t.NIFTI2.MAGIC_NUMBER_LOCATION=4,t.NIFTI2.MAGIC_NUMBER=[110,43,50,0,13,10,26,10],t.NIFTI2.prototype.readHeader=function(e){var r,n,i,a,s=new DataView(e),o=t.Utils.getIntAt(s,0,this.littleEndian);if(o!==t.NIFTI2.MAGIC_COOKIE&&(this.littleEndian=!0,o=t.Utils.getIntAt(s,0,this.littleEndian)),o!==t.NIFTI2.MAGIC_COOKIE)throw new Error("This does not appear to be a NIFTI file!");for(this.datatypeCode=t.Utils.getShortAt(s,12,this.littleEndian),this.numBitsPerVoxel=t.Utils.getShortAt(s,14,this.littleEndian),r=0;r<8;r+=1)a=16+8*r,this.dims[r]=t.Utils.getLongAt(s,a,this.littleEndian);for(this.intent_p1=t.Utils.getDoubleAt(s,80,this.littleEndian),this.intent_p2=t.Utils.getDoubleAt(s,88,this.littleEndian),this.intent_p3=t.Utils.getDoubleAt(s,96,this.littleEndian),r=0;r<8;r+=1)a=104+8*r,this.pixDims[r]=t.Utils.getDoubleAt(s,a,this.littleEndian);for(this.vox_offset=t.Utils.getLongAt(s,168,this.littleEndian),this.scl_slope=t.Utils.getDoubleAt(s,176,this.littleEndian),this.scl_inter=t.Utils.getDoubleAt(s,184,this.littleEndian),this.cal_max=t.Utils.getDoubleAt(s,192,this.littleEndian),this.cal_min=t.Utils.getDoubleAt(s,200,this.littleEndian),this.slice_duration=t.Utils.getDoubleAt(s,208,this.littleEndian),this.toffset=t.Utils.getDoubleAt(s,216,this.littleEndian),this.slice_start=t.Utils.getLongAt(s,224,this.littleEndian),this.slice_end=t.Utils.getLongAt(s,232,this.littleEndian),this.description=t.Utils.getStringAt(s,240,320),this.aux_file=t.Utils.getStringAt(s,320,344),this.qform_code=t.Utils.getIntAt(s,344,this.littleEndian),this.sform_code=t.Utils.getIntAt(s,348,this.littleEndian),this.quatern_b=t.Utils.getDoubleAt(s,352,this.littleEndian),this.quatern_c=t.Utils.getDoubleAt(s,360,this.littleEndian),this.quatern_d=t.Utils.getDoubleAt(s,368,this.littleEndian),this.qoffset_x=t.Utils.getDoubleAt(s,376,this.littleEndian),this.qoffset_y=t.Utils.getDoubleAt(s,384,this.littleEndian),this.qoffset_z=t.Utils.getDoubleAt(s,392,this.littleEndian),n=0;n<3;n+=1)for(i=0;i<4;i+=1)a=400+8*(4*n+i),this.affine[n][i]=t.Utils.getDoubleAt(s,a,this.littleEndian);this.affine[3][0]=0,this.affine[3][1]=0,this.affine[3][2]=0,this.affine[3][3]=1,this.slice_code=t.Utils.getIntAt(s,496,this.littleEndian),this.xyzt_units=t.Utils.getIntAt(s,500,this.littleEndian),this.intent_code=t.Utils.getIntAt(s,504,this.littleEndian),this.intent_name=t.Utils.getStringAt(s,508,524),this.dim_info=t.Utils.getByteAt(s,524),s.byteLength>t.NIFTI2.MAGIC_COOKIE&&(this.extensionFlag[0]=t.Utils.getByteAt(s,540),this.extensionFlag[1]=t.Utils.getByteAt(s,541),this.extensionFlag[2]=t.Utils.getByteAt(s,542),this.extensionFlag[3]=t.Utils.getByteAt(s,543),this.extensionFlag[0]&&(this.extensionSize=this.getExtensionSize(s),this.extensionCode=this.getExtensionCode(s)))},t.NIFTI2.prototype.toFormattedString=function(){var e=t.Utils.formatNumber,r="";return r+="Datatype = "+ +this.datatypeCode+" ("+this.getDatatypeCodeString(this.datatypeCode)+")\n",r+="Bits Per Voxel =  = "+this.numBitsPerVoxel+"\n",r+="Image Dimensions (1-8): "+this.dims[0]+", "+this.dims[1]+", "+this.dims[2]+", "+this.dims[3]+", "+this.dims[4]+", "+this.dims[5]+", "+this.dims[6]+", "+this.dims[7]+"\n",r+="Intent Parameters (1-3): "+this.intent_p1+", "+this.intent_p2+", "+this.intent_p3+"\n",r+="Voxel Dimensions (1-8): "+e(this.pixDims[0])+", "+e(this.pixDims[1])+", "+e(this.pixDims[2])+", "+e(this.pixDims[3])+", "+e(this.pixDims[4])+", "+e(this.pixDims[5])+", "+e(this.pixDims[6])+", "+e(this.pixDims[7])+"\n",r+="Image Offset = "+this.vox_offset+"\n",r+="Data Scale:  Slope = "+e(this.scl_slope)+"  Intercept = "+e(this.scl_inter)+"\n",r+="Display Range:  Max = "+e(this.cal_max)+"  Min = "+e(this.cal_min)+"\n",r+="Slice Duration = "+this.slice_duration+"\n",r+="Time Axis Shift = "+this.toffset+"\n",r+="Slice Start = "+this.slice_start+"\n",r+="Slice End = "+this.slice_end+"\n",r+='Description: "'+this.description+'"\n',r+='Auxiliary File: "'+this.aux_file+'"\n',r+="Q-Form Code = "+this.qform_code+" ("+this.getTransformCodeString(this.qform_code)+")\n",r+="S-Form Code = "+this.sform_code+" ("+this.getTransformCodeString(this.sform_code)+")\n",r+="Quaternion Parameters:  b = "+e(this.quatern_b)+"  c = "+e(this.quatern_c)+"  d = "+e(this.quatern_d)+"\n",r+="Quaternion Offsets:  x = "+this.qoffset_x+"  y = "+this.qoffset_y+"  z = "+this.qoffset_z+"\n",r+="S-Form Parameters X: "+e(this.affine[0][0])+", "+e(this.affine[0][1])+", "+e(this.affine[0][2])+", "+e(this.affine[0][3])+"\n",r+="S-Form Parameters Y: "+e(this.affine[1][0])+", "+e(this.affine[1][1])+", "+e(this.affine[1][2])+", "+e(this.affine[1][3])+"\n",r+="S-Form Parameters Z: "+e(this.affine[2][0])+", "+e(this.affine[2][1])+", "+e(this.affine[2][2])+", "+e(this.affine[2][3])+"\n",r+="Slice Code = "+this.slice_code+"\n",r+="Units Code = "+this.xyzt_units+" ("+this.getUnitsCodeString(t.NIFTI1.SPATIAL_UNITS_MASK&this.xyzt_units)+", "+this.getUnitsCodeString(t.NIFTI1.TEMPORAL_UNITS_MASK&this.xyzt_units)+")\n",r+="Intent Code = "+this.intent_code+"\n",r+='Intent Name: "'+this.intent_name+'"\n',r+="Dim Info = "+this.dim_info+"\n"},t.NIFTI2.prototype.getExtensionLocation=function(){return t.NIFTI2.MAGIC_COOKIE+4},t.NIFTI2.prototype.getExtensionSize=t.NIFTI1.prototype.getExtensionSize,t.NIFTI2.prototype.getExtensionCode=t.NIFTI1.prototype.getExtensionCode,t.NIFTI2.prototype.getDatatypeCodeString=t.NIFTI1.prototype.getDatatypeCodeString,t.NIFTI2.prototype.getTransformCodeString=t.NIFTI1.prototype.getTransformCodeString,t.NIFTI2.prototype.getUnitsCodeString=t.NIFTI1.prototype.getUnitsCodeString,t.NIFTI2.prototype.getQformMat=t.NIFTI1.prototype.getQformMat,t.NIFTI2.prototype.convertNiftiQFormToNiftiSForm=t.NIFTI1.prototype.convertNiftiQFormToNiftiSForm,t.NIFTI2.prototype.convertNiftiSFormToNEMA=t.NIFTI1.prototype.convertNiftiSFormToNEMA,t.NIFTI2.prototype.nifti_mat33_mul=t.NIFTI1.prototype.nifti_mat33_mul,t.NIFTI2.prototype.nifti_mat33_determ=t.NIFTI1.prototype.nifti_mat33_determ;e.exports&&(e.exports=t.NIFTI2)}),nifti_1=createCommonjsModule(function(e){var t=t||{};t.NIFTI1=t.NIFTI1||(void 0!==commonjsRequire?nifti1:null),t.NIFTI2=t.NIFTI2||(void 0!==commonjsRequire?nifti2:null),t.Utils=t.Utils||(void 0!==commonjsRequire?utilities:null);var r=r||(void 0!==commonjsRequire?pako_1:null);t.isNIFTI1=function(e){var r,n,i,a;return!(e.byteLength<t.NIFTI1.STANDARD_HEADER_SIZE)&&((r=new DataView(e))&&(n=r.getUint8(t.NIFTI1.MAGIC_NUMBER_LOCATION)),i=r.getUint8(t.NIFTI1.MAGIC_NUMBER_LOCATION+1),a=r.getUint8(t.NIFTI1.MAGIC_NUMBER_LOCATION+2),!(n!==t.NIFTI1.MAGIC_NUMBER[0]||i!==t.NIFTI1.MAGIC_NUMBER[1]||a!==t.NIFTI1.MAGIC_NUMBER[2]))},t.isNIFTI2=function(e){var r,n,i,a;return!(e.byteLength<t.NIFTI1.STANDARD_HEADER_SIZE)&&(n=(r=new DataView(e)).getUint8(t.NIFTI2.MAGIC_NUMBER_LOCATION),i=r.getUint8(t.NIFTI2.MAGIC_NUMBER_LOCATION+1),a=r.getUint8(t.NIFTI2.MAGIC_NUMBER_LOCATION+2),!(n!==t.NIFTI2.MAGIC_NUMBER[0]||i!==t.NIFTI2.MAGIC_NUMBER[1]||a!==t.NIFTI2.MAGIC_NUMBER[2]))},t.isNIFTI=function(e){return t.isNIFTI1(e)||t.isNIFTI2(e)},t.isCompressed=function(e){var r,n,i;if(e){if(n=(r=new DataView(e)).getUint8(0),i=r.getUint8(1),n===t.Utils.GUNZIP_MAGIC_COOKIE1)return!0;if(i===t.Utils.GUNZIP_MAGIC_COOKIE2)return!0}return!1},t.decompress=function(e){return r.inflate(e).buffer},t.readHeader=function(e){var r=null;return t.isCompressed(e)&&(e=t.decompress(e)),t.isNIFTI1(e)?r=new t.NIFTI1:t.isNIFTI2(e)&&(r=new t.NIFTI2),r?r.readHeader(e):console.error("That file does not appear to be NIFTI!"),r},t.hasExtension=function(e){return 0!=e.extensionFlag[0]},t.readImage=function(e,t){var r=e.vox_offset,n=1,i=1;e.dims[4]&&(n=e.dims[4]),e.dims[5]&&(i=e.dims[5]);var a=e.dims[1]*e.dims[2]*e.dims[3]*n*i*(e.numBitsPerVoxel/8);return t.slice(r,r+a)},t.readExtension=function(e,t){var r=e.getExtensionLocation(),n=e.extensionSize;return t.slice(r,r+n)},t.readExtensionData=function(e,t){var r=e.getExtensionLocation(),n=e.extensionSize;return t.slice(r+8,r+n-8)};e.exports&&(e.exports=t)}),NiftiDecoderAlt=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setMetadata("targetType",Image3DAlt.name),e.addInputValidator(0,ArrayBuffer),e}return inherits(t,Decoder),createClass(t,[{key:"_run",value:function(){var e=this._getInput(0);if(e)if(nifti_1.isNIFTI(e)){var t,r={},n=nifti_1.readHeader(e),i=nifti_1.readImage(n,e);if(t=this._fetchDataArray(n,i)){this._scaleData(t,n);var a=n.dims[0];r.formatSpecific=n,r.statistics={upToDate:!0,min:"sdfsdf",max:NaN},r.ncpp=this._fetchNcpp(n),r.description=n.description,r.format="nifti",r.spatialUnit=n.getUnitsCodeString(nifti_1.NIFTI1.SPATIAL_UNITS_MASK&n.xyzt_units),r.temporalUnit=n.getUnitsCodeString(nifti_1.NIFTI1.TEMPORAL_UNITS_MASK&n.xyzt_units);var s=n.getQformMat();0==n.qform_code&&(s=n.affine),console.log(n);for(var o=["k","j","i","t"],l=["x","y","z","t"],u=[],c=0;c<a;c++){for(var h=1,f=0;f<c;f++)h*=n.dims[f+1];var d={length:n.dims[c+1],widthDimension:-1,heightDimension:-1,nameVoxelSpace:o[c],nameWorldSpace:l[c],worldUnitSize:n.pixDims[c+1],stride:h,step:n.pixDims[c+1]};u.push(d)}u.length>=3&&(u[0].widthDimension=1,u[0].heightDimension=2,u[1].widthDimension=0,u[1].heightDimension=2,u[2].widthDimension=0,u[2].heightDimension=1);var p,g=[A(s,0),A(s,1),A(s,2)],_=[g.indexOf(0),g.indexOf(1),g.indexOf(2)],y=JSON.parse(JSON.stringify(s)),m=u;if(0!=g[0]||1!=g[1]||2!=g[2]){for(var v=0;v<3;v++)for(var b=0;b<4;b++){var w=b;b<3&&(w=g[b]),y[v][w]=s[v][b]}var E=JSON.parse(JSON.stringify(u));E[0].nameVoxelSpace="k",E[1].nameVoxelSpace="j",E[2].nameVoxelSpace="i",E[_[0]].nameWorldSpace="x",E[_[1]].nameWorldSpace="y",E[_[2]].nameWorldSpace="z",E[_[0]].widthDimension=_[1],E[_[0]].heightDimension=_[2],E[_[1]].widthDimension=_[0],E[_[1]].heightDimension=_[2],E[_[2]].widthDimension=_[0],E[_[2]].heightDimension=_[1],m=E}for(v=0;v<3;v++){var T=(p=y[v],Math.sqrt(p[0]*p[0]+p[1]*p[1]+p[2]*p[2])),k=Math.sign(y[v][v]);(d=M(l[v])).step=T*k}r.dimensions=m;var x=fromValues$3(y[0][0],y[1][0],y[2][0],y[3][0],y[0][1],y[1][1],y[2][1],y[3][1],y[0][2],y[1][2],y[2][2],y[3][2],y[0][3],y[1][3],y[2][3],y[3][3]),S=create$3();invert$3(S,x),r.transformations={v2w:x,w2v:S},r.statistics={upToDate:!1,min:0,max:0};var I=new Image3DAlt;I.setRawData(t),I.setRawMetadata(r),console.log(r),I.metadataIntegrityCheck()&&(I.scanDataRange(),this._output[0]=I)}else console.warn("This NIfTI file is valid but does not contain any readable data.")}else console.warn("Not a NIfTI file");else console.warn('NiftiDecoderAlt requires an ArrayBuffer as input "0". Unable to continue.');function A(e,t){var r=Math.abs(e[0][t]),n=Math.abs(e[1][t]),i=Math.abs(e[2][t]);return r>n&&r>i?0:n>r&&n>i?1:2}function M(e){for(var t=0;t<m.length;t++)if(m[t].nameWorldSpace===e)return m[t];return null}}},{key:"_scaleData",value:function(e,t){if(t.datatypeCode!=nifti_1.NIFTI1.TYPE_RGB24&&(1!=t.scl_slope||0!=t.scl_inter)&&t.scl_slope)for(var r=0;r<e.length;r++)e[r]=e[r]*t.scl_slope+t.scl_inter}},{key:"_fetchNcpp",value:function(e){var t=0;switch(e.datatypeCode){case nifti_1.NIFTI1.TYPE_BINARY:console.warn("The datatype nifti.TYPE_BINARY is not compatible yet.");break;case nifti_1.NIFTI1.TYPE_COMPLEX64:console.warn("The datatype nifti.TYPE_COMPLEX64 is not compatible yet.");break;case nifti_1.NIFTI1.TYPE_COMPLEX128:console.warn("The datatype nifti.TYPE_COMPLEX128 is not compatible yet.");break;case nifti_1.NIFTI1.TYPE_COMPLEX256:console.warn("The datatype nifti.TYPE_COMPLEX256 is not compatible yet.");break;case nifti_1.NIFTI1.TYPE_FLOAT128:console.warn("The datatype nifti.TYPE_FLOAT128 is not compatible yet.");break;case nifti_1.NIFTI1.TYPE_INT64:console.warn("The datatype nifti.TYPE_INT64 is not compatible yet.");break;case nifti_1.NIFTI1.TYPE_NONE:console.warn("The datatype nifti.TYPE_NONE is not compatible.");break;case nifti_1.NIFTI1.TYPE_UINT64:console.warn("The datatype nifti.TYPE_INT64 is not compatible yet.");break;case nifti_1.NIFTI1.TYPE_FLOAT32:case nifti_1.NIFTI1.TYPE_FLOAT64:case nifti_1.NIFTI1.TYPE_INT8:case nifti_1.NIFTI1.TYPE_INT16:case nifti_1.NIFTI1.TYPE_INT32:case nifti_1.NIFTI1.TYPE_UINT8:case nifti_1.NIFTI1.TYPE_UINT16:case nifti_1.NIFTI1.TYPE_UINT32:t=1;break;case nifti_1.NIFTI1.TYPE_RGB24:t=3;break;default:console.warn("The datatype is unknown.")}return t}},{key:"_fetchDataArray",value:function(e,t){var r=null;switch(e.datatypeCode){case nifti_1.NIFTI1.TYPE_BINARY:console.warn("The datatype nifti.TYPE_BINARY is not compatible yet.");break;case nifti_1.NIFTI1.TYPE_COMPLEX64:console.warn("The datatype nifti.TYPE_COMPLEX64 is not compatible yet.");break;case nifti_1.NIFTI1.TYPE_COMPLEX128:console.warn("The datatype nifti.TYPE_COMPLEX128 is not compatible yet.");break;case nifti_1.NIFTI1.TYPE_COMPLEX256:console.warn("The datatype nifti.TYPE_COMPLEX256 is not compatible yet.");break;case nifti_1.NIFTI1.TYPE_FLOAT128:console.warn("The datatype nifti.TYPE_FLOAT128 is not compatible yet.");break;case nifti_1.NIFTI1.TYPE_INT64:console.warn("The datatype nifti.TYPE_INT64 is not compatible yet.");break;case nifti_1.NIFTI1.TYPE_NONE:console.warn("The datatype nifti.TYPE_NONE is not compatible.");break;case nifti_1.NIFTI1.TYPE_UINT64:console.warn("The datatype nifti.TYPE_INT64 is not compatible yet.");break;case nifti_1.NIFTI1.TYPE_FLOAT32:r=new Float32Array(t);break;case nifti_1.NIFTI1.TYPE_FLOAT64:r=new Float64Array(t);break;case nifti_1.NIFTI1.TYPE_INT8:r=new Int8Array(t);break;case nifti_1.NIFTI1.TYPE_INT16:r=new Int16Array(t);break;case nifti_1.NIFTI1.TYPE_INT32:r=new Int32Array(t);break;case nifti_1.NIFTI1.TYPE_UINT8:r=new Uint8Array(t);break;case nifti_1.NIFTI1.TYPE_UINT16:r=new Uint16Array(t);break;case nifti_1.NIFTI1.TYPE_UINT32:r=new Uint32Array(t);break;case nifti_1.NIFTI1.TYPE_RGB24:r=new Uint8Array(t);break;default:console.warn("The datatype is unknown.")}return r}},{key:"_computeSubjsctBasedCoord",value:function(e){}}]),t}(),PixpEncoder=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setMetadata("filename","untitled.pixp"),e}return inherits(t,Filter),createClass(t,[{key:"hasValidInput",value:function(){var e=this._getInput();return e&&(e.isOfType(Image2D.TYPE())||e.isOfType(Image3D.TYPE()))}},{key:"_run",value:function(){if(this.hasValidInput()){var e=this._getInput(),t={dataType:e.getData().constructor.name,data:Array.prototype.slice.call(e.getData()),metadata:e.getMetadataCopy(),pixpipeType:e.constructor.name},r=JSON.stringify(t),n=new pako_1.Deflate({level:6,gzip:!0,header:{text:!0,time:+new Date,comment:"This file was created by Pixpipe.js"}});n.push(r,!0),this._output[0]=new Blob([n.result],{type:"application/gzip"})}else console.warn("PixpEncoder can only encode Image2D and Image3D.")}},{key:"download",value:function(){this.getOutput()?FileSaver.saveAs(this.getOutput(),this.getMetadata("filename")):console.warn("No output computed yet.")}}]),t}(),PixpDecoder=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setMetadata("targetType","*"),e.addInputValidator(0,ArrayBuffer),e}return inherits(t,Decoder),createClass(t,[{key:"_run",value:function(){if(this.hasValidInput()){var e=this._getInput(),t=new pako_1.Inflate({level:6,to:"string"});if(t.push(e,!0),t.err)console.warn("This file is not a Pixp file.");else{var r=null;try{r=JSON.parse(t.result)}catch(e){return console.warn("Could not parse pixp file."),void console.error(e)}if(r.pixpipeType in pixpipe){var n=null;try{n=window}catch(e){try{n=GLOBAL}catch(e){return void console.warn("You are not in a Javascript environment?? Weird.")}}if(n[r.dataType]){var i=new n[r.dataType](r.data),a=new pixpipe[r.pixpipeType];a.setRawData(i),a.setRawMetadata(r.metadata),this._output[0]=a}else console.warn("Data array from pixp file is unknown: "+r.dataType)}else console.warn("Unknown type pixpipe."+r.pixpipeType+", cannot create any output.")}}else console.warn("PixpDecoder can only decode ArrayBuffer.")}}]),t}(),MghDecoder=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setMetadata("targetType",MniVolume.name),e.addInputValidator(0,ArrayBuffer),e.setMetadata("debug",!1),e}return inherits(t,Decoder),createClass(t,[{key:"_parseMGHHeader",value:function(e,t){var r={order:["xspace","yspace","zspace"],xspace:{},yspace:{},zspace:{}},n=new DataView(e,0,284),i=!0,a=n.getUint32(0,!0);if(1===a)i=!0;else{if(16777216!==a)return console.warn("This does not look like an MGH file."),null;i=!1}var s=0,o=[0,0,0,0],l=4,u=1;for(s=0;s<4&&(o[s]=n.getUint32(l,i),!(o[s]<=1));s++)u*=o[s],l+=4;if(s<3||s>4)return console.warn("Cannot handle "+s+"-dimensional images yet."),null;var c,h,f=n.getUint32(20,i),d=[1,1,1],p=[[-1,0,0],[0,0,-1],[0,1,0],[0,0,0]];if(n.getUint16(28,i)){for(l=30,c=0;c<3;c++)d[c]=n.getFloat32(l,i),l+=4;for(c=0;c<4;c++)for(h=0;h<3;h++)p[c][h]=n.getFloat32(l,i),l+=4}if(this._metadata.debug)for(c=0;c<3;c++){var g="";for(h=0;h<4;h++)g+="xyzc"[h]+"_"+"ras"[c]+" "+p[h][c]+" ";console.log(g)}for(var _=[0,1,2],y=0;y<3;y++){var m=0,v=Math.abs(p[y][0]),b=Math.abs(p[y][1]),w=Math.abs(p[y][2]);r.order[y]="xspace",b>v&&b>w&&(m=1,r.order[y]="yspace"),w>v&&w>b&&(m=2,r.order[y]="zspace"),_[y]=m}4===s&&(this._metadata.debug&&console.log("Creating time dimension: "+o[3]),r.time={space_length:o[3],step:1,start:0,name:"time"},r.order.push("time"));var E=[[0,0,0,0],[0,0,0,0],[0,0,0,0]];for(c=0;c<3;c++)for(h=0;h<3;h++)E[c][h]=p[h][c]*d[c];for(c=0;c<3;c++){var T=0;for(h=0;h<3;h++)T+=E[c][h]*(o[h]/2);E[c][3]=p[3][c]-T}var k=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];for(c=0;c<3;c++)for(h=0;h<4;h++){var x=h;h<3&&(x=_[h]),k[c][x]=E[c][h]}for(MniVolume.transformToMinc(k,r),r.datatype=f,r.little_endian=i,r.nvoxels=u,c=0;c<3;c++)r[r.order[c]].space_length=o[c];return r}},{key:"_createMGHData",value:function(e,t){var r=null,n=1;switch(e.datatype){case 0:n=1;break;case 1:case 3:n=4;break;case 4:n=2;break;default:return console.warn("Unsupported data type: "+e.datatype),null}var i=e.nvoxels*n;switch(n>1&&!e.little_endian&&MniVolume.swapn(new Uint8Array(t,284,i),n),e.datatype){case 0:r=new Uint8Array(t,284,e.nvoxels);break;case 1:r=new Int32Array(t,284,e.nvoxels);break;case 3:r=new Float32Array(t,284,e.nvoxels);break;case 4:r=new Int16Array(t,284,e.nvoxels)}for(var a=1,s=0;s<e.order.length;s++)e[e.order[s]].offset=a,a*=e[e.order[s]].space_length;return r}},{key:"_run",value:function(){var e=this._getInput(0);if(e){var t=null;try{t=this._parseMGHHeader(e)}catch(e){}if(t){var r=this._createMGHData(t,e);if(!r)return null;this._addOutput(MniVolume);var n=this.getOutput();n.setData(r,t),n.setMetadata("format","mgh")}else console.log("The input file is not a MGH file.")}else console.warn('MghDecoder requires an ArrayBuffer as input "0". Unable to continue.')}}]),t}(),Image3DGenericDecoder=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._decoders=[Minc2Decoder,NiftiDecoder,MghDecoder,PixpDecoder],e}return inherits(t,Filter),createClass(t,[{key:"_run",value:function(){var e=this._getInput(0);if(e)for(var t=0;t<this._decoders.length;t++){var r=new this._decoders[t];if(r.addInput(e),r.update(),r.getNumberOfOutputs()){this._output[0]=r.getOutput(),this.setMetadata("decoderConstructor",this._decoders[t]),this.setMetadata("decoderName",this._decoders[t].name);break}}else console.warn("The input buffer must not be null.")}}]),t}(),Image3DMetadataConverter=function(){function e(){classCallCheck(this,e)}return createClass(e,null,[{key:"convertOld2New",value:function(e){for(var t={ncpp:1,dimensions:[]},r=["k","j","i","t"],n=0;n<e.order.length;n++){var i=e[e.order[n]],a={};a.length=i.space_length,a.nameWorldSpace=e.order[n][0],a.nameVoxelSpace="",a.worldUnitSize=Math.abs(i.step),a.step=i.step,a.worldStep=i.step,a.stride=i.offset,t.dimensions.push(a)}t.dimensions.sort(function(e,t){return e.stride>t.stride});for(n=0;n<e.order.length;n++)t.dimensions[n].nameVoxelSpace=r[n];function s(e){for(var r=0;r<t.dimensions.length;r++)if(t.dimensions[r].nameWorldSpace===e)return r;return-1}function o(e){return"x"===e?"y":"y"===e?"x":"z"===e?"x":null}function l(e){return"x"===e?"z":"y"===e?"z":"z"===e?"y":null}for(n=0;n<t.dimensions.length;n++){var u=t.dimensions[n].nameWorldSpace;t.dimensions[n].widthDimension=s(o(u)),t.dimensions[n].heightDimension=s(l(u))}t.statistics={upToDate:!1,min:0,max:0},t.description="",t.spatialUnit="",t.temporalUnit="",t.format="format"in e?e.format:"generic";var c=fromValues$3(e.w2v[0][0],e.w2v[1][0],e.w2v[2][0],0,e.w2v[0][1],e.w2v[1][1],e.w2v[2][1],0,e.w2v[0][2],e.w2v[1][2],e.w2v[2][2],0,e.w2v[0][3],e.w2v[1][3],e.w2v[2][3],1),h=create$3();return invert$3(h,c),t.transformations={v2w:h,w2v:c},t}},{key:"convertImage3DMetadata",value:function(t){return e.completeHeader(t),e.convertOld2New(t)}},{key:"completeHeader",value:function(e){var t=e.xspace,r=e.yspace,n=e.zspace,i=t.start,a=r.start,s=n.start,o=t.direction_cosines,l=r.direction_cosines,u=n.direction_cosines,c=t.step,h=r.step,f=n.step,d={x:i*o[0]+a*l[0]+s*u[0],y:i*o[1]+a*l[1]+s*u[1],z:i*o[2]+a*l[2]+s*u[2]};e.voxel_origin=d;var p=(-d.x*o[0]-d.y*o[1]-d.z*o[2])/c,g=(-d.x*l[0]-d.y*l[1]-d.z*l[2])/h,_=(-d.x*u[0]-d.y*u[1]-d.z*u[2])/f,y=[[o[0]/c,o[1]/c,o[2]/c,p],[l[0]/h,l[1]/h,l[2]/h,g],[u[0]/f,u[1]/f,u[2]/f,_]];o[0],o[1],o[2],l[0],l[1],l[2],u[0],u[1],u[2];e.w2v=y,t.width_space=JSON.parse(JSON.stringify(r)),t.width=r.space_length,t.height_space=JSON.parse(JSON.stringify(n)),t.height=n.space_length,r.width_space=JSON.parse(JSON.stringify(t)),r.width=t.space_length,r.height_space=JSON.parse(JSON.stringify(n)),r.height=n.space_length,n.width_space=JSON.parse(JSON.stringify(t)),n.width=t.space_length,n.height_space=JSON.parse(JSON.stringify(r)),n.height=r.space_length}},{key:"transformToMinc",value:function(e,t){var r=[],n=[],i=[];function a(e){var t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];return t<=0&&(t=1),Math.sqrt(t)}function s(e,t,r){return e[0]*(t[1]*r[2]-t[2]*r[1])-e[1]*(t[0]*r[2]-t[2]*r[0])+e[2]*(t[0]*r[1]-t[1]*r[0])}for(var o=a(e[0]),l=a(e[1]),u=a(e[2]),c=e[0][0]<0?-o:o,h=e[1][1]<0?-l:l,f=e[2][2]<0?-u:u,d=0;d<3;d++)r[d]=e[d][0]/c,n[d]=e[d][1]/h,i[d]=e[d][2]/f;t.xspace.step=c,t.yspace.step=h,t.zspace.step=f;var p=[e[0][3],e[1][3],e[2][3]],g=s(r,n,i),_=s(p,n,i),y=s(r,p,i),m=s(r,n,p);t.xspace.start=_/g,t.yspace.start=y/g,t.zspace.start=m/g,t.xspace.direction_cosines=r,t.yspace.direction_cosines=n,t.zspace.direction_cosines=i}},{key:"swapn",value:function(e,t){for(var r=0;r<e.length;r+=t)for(var n=t-1,i=0;n>i;){var a=e[r+n];e[r+n]=e[r+i],e[r+i]=a,n--,i++}}}]),e}(),Minc2DecoderAlt=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setMetadata("targetType",Image3DAlt.name),e.addInputValidator(0,ArrayBuffer),e.setMetadata("debug",!1),e._type_enum={INT8:1,UINT8:2,INT16:3,UINT16:4,INT32:5,UINT32:6,FLT:7,DBL:8,STR:9},e._type_matching=["int8","uint8","int16","uint16","int32","uint32","float32","float64","undef"],e.type_sizes=[0,1,1,2,2,4,4,4,8,0],e._dv_offset=0,e._align=8,e._little_endian=!0,e._continuation_queue=[],e._dv=null,e._superblk={},e._start_offset=0,e._huge_id=0,e}return inherits(t,Decoder),createClass(t,[{key:"createLink",value:function(){var e={hdr_offset:0,data_offset:0,data_length:0,n_filled:0,chunk_size:0,sym_btree:0,sym_lheap:0,name:"",attributes:{},children:[],array:void 0,type:-1,inflate:!1,dims:[]};return e}},{key:"startAlignment",value:function(){this._start_offset=this._dv_offset}},{key:"checkAlignment",value:function(){var e=this._dv_offset-this._start_offset;if(e%this._align!=0){var t=this._align-e%this._align;this._dv_offset+=t,this.getMetadata("debug")&&console.log("skipping "+t+" bytes at "+e+" for alignmnent")}}},{key:"skip",value:function(e){this._dv_offset+=e}},{key:"seek",value:function(e){this._dv_offset=e}},{key:"tell",value:function(){return this._dv_offset}},{key:"getU8",value:function(){var e=this._dv.getUint8(this._dv_offset);return this._dv_offset+=1,e}},{key:"getU16",value:function(){var e=this._dv.getUint16(this._dv_offset,this._little_endian);return this._dv_offset+=2,e}},{key:"getU32",value:function(){var e=this._dv.getUint32(this._dv_offset,this._little_endian);return this._dv_offset+=4,e}},{key:"getU64",value:function(){var e=this._dv.getUint64(this._dv_offset,this._little_endian);return this._dv_offset+=8,e}},{key:"getF32",value:function(){var e=this._dv.getFloat32(this._dv_offset,this._little_endian);return this._dv_offset+=4,e}},{key:"getF64",value:function(){var e=this._dv.getFloat64(this._dv_offset,this._little_endian);return this._dv_offset+=8,e}},{key:"getOffset",value:function(e){var t=0;if(4===(e=e||this._superblk.offsz))t=this._dv.getUint32(this._dv_offset,this._little_endian);else{if(8!==e)throw new Error("Unsupported value for offset size "+e);t=this._dv.getUint64(this._dv_offset,this._little_endian)}return this._dv_offset+=e,t}},{key:"getLength",value:function(){var e=this._dv.getUint64(this._dv_offset,this._little_endian);return this._dv_offset+=this._superblk.lensz,e}},{key:"getString",value:function(e){var t,r,n="";for(t=0;t<e;t+=1){if(0===(r=this.getU8())){this._dv_offset+=e-t-1;break}n+=String.fromCharCode(r)}return n}},{key:"getArray",value:function(e,t,r){var n,i,a,s,o=this._getInput(),l=this._dv_offset;switch(r&&(this._dv_offset=r),e){case this._type_enum.INT8:n=new Int8Array(o,this._dv_offset,t);break;case this._type_enum.UINT8:n=new Uint8Array(o,this._dv_offset,t);break;case this._type_enum.INT16:if(this._dv_offset%2!=0)for(a=new ArrayBuffer(t),i=t/2,n=new Int16Array(a),s=0;s<i;s+=1)n[s]=this.getU16();else n=new Int16Array(o,this._dv_offset,t/2),this._dv_offset+=t;break;case this._type_enum.UINT16:if(this._dv_offset%2!=0)for(a=new ArrayBuffer(t),i=t/2,n=new Uint16Array(a),s=0;s<i;s+=1)n[s]=this.getU16();else n=new Uint16Array(o,this._dv_offset,t/2),this._dv_offset+=t;break;case this._type_enum.INT32:if(this._dv_offset%4!=0)for(a=new ArrayBuffer(t),i=t/4,n=new Int32Array(a),s=0;s<i;s+=1)n[s]=this.getU32();else n=new Int32Array(o,this._dv_offset,t/4),this._dv_offset+=t;break;case this._type_enum.UINT32:if(this._dv_offset%4!=0)for(a=new ArrayBuffer(t),i=t/4,n=new Uint32Array(a),s=0;s<i;s+=1)n[s]=this.getU32();else n=new Uint32Array(o,this._dv_offset,t/4),this._dv_offset+=t;break;case this._type_enum.FLT:if(this._dv_offset%4!=0)for(a=new ArrayBuffer(t),i=t/4,n=new Float32Array(a),s=0;s<i;s+=1)n[s]=this.getF32();else n=new Float32Array(o,this._dv_offset,t/4),this._dv_offset+=t;break;case this._type_enum.DBL:if(this._dv_offset%8!=0)for(a=new ArrayBuffer(t),i=t/8,n=new Float64Array(a),s=0;s<i;s+=1)n[s]=this.getF64();else n=new Float64Array(o,this._dv_offset,t/8),this._dv_offset+=t;break;default:throw new Error("Bad type in this.getArray "+e)}return r&&(this._dv_offset=l),n}},{key:"getUXX",value:function(e){var t,r;switch(e){case 1:t=this._dv.getUint8(this._dv_offset);break;case 2:t=this._dv.getUint16(this._dv_offset,this._little_endian);break;case 4:t=this._dv.getUint32(this._dv_offset,this._little_endian);break;case 8:t=this._dv.getUint64(this._dv_offset,this._little_endian);break;default:if(t=0,this._little_endian)for(r=e-1;r>=0;r--)t=(t<<8)+this._dv.getUint8(this._dv_offset+r);else for(r=0;r<e;r++)t=(t<<8)+this._dv.getUint8(this._dv_offset+r)}return this._dv_offset+=e,t}},{key:"checkSignature",value:function(e){var t;for(t=0;t<e.length;t+=1)if(this._dv.getUint8(this._dv_offset+t)!==e.charCodeAt(t))return!1;return this.skip(e.length),!0}},{key:"hdf5Superblock",value:function(){var e={};if(!this.checkSignature("HDF\r\n\n"))throw new Error("Bad magic string in HDF5");if(e.sbver=this.getU8(),e.sbver>2)throw new Error("Unsupported HDF5 superblock version "+e.sbver);return e.sbver<=1?(e.fsver=this.getU8(),e.rgver=this.getU8(),this.skip(1),e.shver=this.getU8(),e.offsz=this.getU8(),e.lensz=this.getU8(),this.skip(1),e.gln_k=this.getU16(),e.gin_k=this.getU16(),e.cflags=this.getU32(),1===e.sbver&&(e.isin_k=this.getU16(),this.skip(2)),e.base_addr=this.getOffset(e.offsz),e.gfsi_addr=this.getOffset(e.offsz),e.eof_addr=this.getOffset(e.offsz),e.dib_addr=this.getOffset(e.offsz),e.root_ln_offs=this.getOffset(e.offsz),e.root_addr=this.getOffset(e.offsz),e.root_cache_type=this.getU32(),this.skip(4),this.skip(16)):(e.offsz=this.getU8(),e.lensz=this.getU8(),e.cflags=this.getU8(),e.base_addr=this.getOffset(e.offsz),e.ext_addr=this.getOffset(e.offsz),e.eof_addr=this.getOffset(e.offsz),e.root_addr=this.getOffset(e.offsz),e.checksum=this.getU32()),this.getMetadata("debug")&&console.log("HDF5 SB "+e.sbver+" "+e.offsz+" "+e.lensz+" "+e.cflags),e}},{key:"hdf5FractalHeapHeader",value:function(){var e={};if(!this.checkSignature("FRHP"))throw new Error("Bad or missing FRHP signature");e.ver=this.getU8(),e.idlen=this.getU16(),e.iof_el=this.getU16(),e.flags=this.getU8(),e.objmax=this.getU32(),e.objnid=this.getLength(),e.objbta=this.getOffset(),e.nf_blk=this.getLength(),e.af_blk=this.getOffset(),e.heap_total=this.getLength(),e.heap_alloc=this.getLength(),e.bai_offset=this.getLength(),e.heap_nobj=this.getLength(),e.heap_chuge=this.getLength(),e.heap_nhuge=this.getLength(),e.heap_ctiny=this.getLength(),e.heap_ntiny=this.getLength(),e.table_width=this.getU16(),e.start_blksz=this.getLength(),e.max_blksz=this.getLength(),e.max_heapsz=this.getU16(),e.rib_srows=this.getU16(),e.root_addr=this.getOffset(),e.rib_crows=this.getU16();var t=Math.log2(e.max_blksz)-Math.log2(e.start_blksz)+2;if(e.K=Math.min(e.rib_crows,t)*e.table_width,e.N=e.rib_crows<t?0:e.K-t*e.table_width,this.getMetadata("debug")&&(console.log("FRHP V"+e.ver+" F"+e.flags+" "+e.objbta+" Total:"+e.heap_total+" Alloc:"+e.heap_alloc+" #obj:"+e.heap_nobj+" width:"+e.table_width+" start_blksz:"+e.start_blksz+" max_blksz:"+e.max_blksz+" "+e.max_heapsz+" srows:"+e.rib_srows+" crows:"+e.rib_crows+" "+e.heap_nhuge),console.log("   K: "+e.K+" N: "+e.N)),e.iof_el>0)throw new Error("Filters present in fractal heap.");return e}},{key:"hdf5V2BtreeHeader",value:function(){var e={};if(!this.checkSignature("BTHD"))throw new Error("Bad or missing BTHD signature");return e.ver=this.getU8(),e.type=this.getU8(),e.nodesz=this.getU32(),e.recsz=this.getU16(),e.depth=this.getU16(),e.splitp=this.getU8(),e.mergep=this.getU8(),e.root_addr=this.getOffset(),e.root_nrec=this.getU16(),e.total_nrec=this.getLength(),e.checksum=this.getU32(),this.getMetadata("debug")&&console.log("BTHD V"+e.ver+" T"+e.type+" "+e.nodesz+" "+e.recsz+" "+e.depth+" "+e.root_addr+" "+e.root_nrec+" "+e.total_nrec),e}},{key:"hdf5V2BtreeRecords",value:function(e,t,r,n){var i,a,s,o;if(1===t)for(i=0;i<r;i++){s=this.getOffset(),o=this.getLength();var l=this.getLength();this.getMetadata("debug")&&console.log("  -> "+s+" "+o+" "+l+" "+this._this._huge_id),a=this.tell(),l===this._this._huge_id&&(this.seek(s),this.hdf5MsgAttribute(o,n)),this.seek(a)}else{if(8!==t)throw new Error("Unhandled V2 btree type.");var u,c;u=e.max_heapsz/8;var h=Math.min(e.objmax,e.max_blksz);for(c=h<=256?1:h<=65536?2:4,i=0;i<r;i++){var f=this.getU8();if(0!=(192&f))throw new Error("Bad Fractal Heap ID version "+f);var d,p=48&f;if(16===p)this._this._huge_id=this.getUXX(7);else{if(0!==p)throw new Error("Can't handle this Heap ID: "+f);s=this.getUXX(u),o=this.getUXX(c)}if(d=this.getU8(),this.getU32(),this.getU32(),this.getMetadata("debug")&&console.log("  -> "+f+" "+s+" "+o+" "+d),a=this.tell(),16===p){this.seek(e.objbta);var g=this.hdf5V2BtreeHeader();if(1!==g.type)throw new Error("Can only handle type-1 btrees");this.seek(g.root_addr),this.hdf5V2BtreeLeafNode(e,g.root_nrec,n)}else{var _=this.hdf5FractalHeapOffset(e,s);this.seek(_),this.hdf5MsgAttribute(o,n)}this.seek(a)}}}},{key:"hdf5V2BtreeLeafNode",value:function(e,t,r){if(!this.checkSignature("BTLF"))throw new Error("Bad or missing BTLF signature");var n=this.getU8(),i=this.getU8();this.getMetadata("debug")&&console.log("BTLF V"+n+" T"+i+" "+this.tell()),this.hdf5V2BtreeRecords(e,i,t,r)}},{key:"hdf5V2BtreeInternalNode",value:function(e,t,r,n){if(!this.checkSignature("BTIN"))throw new Error("Bad or missing BTIN signature");var i,a=this.getU8(),s=this.getU8();for(this.getMetadata("debug")&&console.log("BTIN V"+a+" T"+s),this.hdf5V2BtreeRecords(e,s,t,n),i=0;i<=t;i++){var o,l=this.getOffset(),u=this.getUXX(1);r>1&&(o=this.getUXX(1)),this.getMetadata("debug")&&console.log(" child->"+l+" "+u+" "+o)}}},{key:"hdf5GetMsgName",value:function(e){var t=["NIL","Dataspace","LinkInfo","Datatype","FillValue 1","FillValue 2","Link","ExternalFiles","Layout","BOGUS","GroupInfo","FilterPipeline","Attribute","ObjectComment","ObjectModTime 1","SharedMsgTable","ObjHdrContinue","SymbolTable","ObjectModTime 2","BtreeKValue","DriverInfo","AttrInfo","ObjectRefCnt","MESSAGE23","FileSpaceInfo"];if(e<t.length)return t[e];throw new Error("Unknown message type "+e+" "+this.tell())}},{key:"hdf5V1BtreeNode",value:function(e){var t,r=this._getInput(),n={};if(!this.checkSignature("TREE"))throw new Error("Bad TREE signature at "+this.tell());if(n.keys=[],n.node_type=this.getU8(),n.node_level=this.getU8(),n.entries_used=this.getU16(),n.left_sibling=this.getOffset(),n.right_sibling=this.getOffset(),this.getMetadata("debug")&&console.log("BTREE type "+n.node_type+" lvl "+n.node_level+" n_used "+n.entries_used+" "+n.left_sibling+" "+n.right_sibling),e){var i,a,s,o,l,u=[];for(t=0;t<n.entries_used;t+=1){for(n.keys[t]={},u[t]={},u[t].chunk_size=this.getU32(),u[t].filter_mask=this.getU32(),u[t].chunk_offsets=[],i=0;i<e.dims.length+1;i+=1)u[t].chunk_offsets.push(this.getU64());n.keys[t].child_address=this.getOffset(),t<n.entries_used&&this.getMetadata("debug")&&console.log("  BTREE "+t+" chunk_size "+u[t].chunk_size+" filter_mask "+u[t].filter_mask+" addr "+n.keys[t].child_address)}for(u[t]={},u[t].chunk_size=this.getU32(),u[t].filter_mask=this.getU32(),u[t].chunk_offsets=[],i=0;i<e.dims.length+1;i+=1)u[t].chunk_offsets.push(this.getU64());if(0===n.node_level)for(t=0;t<n.entries_used;t+=1)if(a=u[t].chunk_size,s=n.keys[t].child_address,e.inflate){switch(o=new Uint8Array(r,s,a),l=pako_1.inflate(o),e.type){case this._type_enum.INT8:l=new Int8Array(l.buffer);break;case this._type_enum.UINT8:l=new Uint8Array(l.buffer);break;case this._type_enum.INT16:l=new Int16Array(l.buffer);break;case this._type_enum.UINT16:l=new Uint16Array(l.buffer);break;case this._type_enum.INT32:l=new Int32Array(l.buffer);break;case this._type_enum.UINT32:l=new Uint32Array(l.buffer);break;case this._type_enum.FLT:l=new Float32Array(l.buffer);break;case this._type_enum.DBL:l=new Float64Array(l.buffer);break;default:throw new Error("Unknown type code "+e.type)}e.array.length-e.n_filled<l.length&&(l=l.subarray(0,e.array.length-e.n_filled)),e.array.set(l,e.n_filled),e.n_filled+=l.length,this.getMetadata("debug")&&console.log(e.name+" "+o.length+" "+l.length+" "+e.n_filled+"/"+e.array.length)}else l=this.getArray(e.type,a,s),e.array.set(l,e.n_filled),e.n_filled+=l.length;else for(t=0;t<n.entries_used;t+=1)this.seek(n.keys[t].child_address),this.hdf5V1BtreeNode(e)}else for(t=0;t<n.entries_used;t+=1)n.keys[t]={},n.keys[t].key_value=this.getLength(),n.keys[t].child_address=this.getOffset(),this.getMetadata("debug")&&console.log("  BTREE "+t+" key "+n.keys[t].key_value+" adr "+n.keys[t].child_address);return n}},{key:"hdf5GroupSymbolTable",value:function(e,t){if(!this.checkSignature("SNOD"))throw new Error("Bad or missing SNOD signature");var r=this.getU8();this.skip(1);var n,i,a,s,o,l,u=this.getU16();for(this.getMetadata("debug")&&console.log("this.hdf5GroupSymbolTable V"+r+" #"+u+" '"+t.name+"'"),n=0;n<2*this._superblk.gln_k;n+=1)i=this.getOffset(),a=this.getOffset(),s=this.getU32(),this.skip(20),n<u&&((o=this.createLink()).hdr_offset=a,e&&(l=this.tell(),this.seek(e.lh_dseg_off+i),o.name=this.getString(e.lh_dseg_len),this.seek(l)),this.getMetadata("debug")&&console.log("    "+n+" O "+i+" A "+a+" T "+s+" '"+o.name+"'"),t.children.push(o))}},{key:"hdf5LocalHeap",value:function(){var e={};if(!this.checkSignature("HEAP"))throw new Error("Bad or missing HEAP signature");return e.lh_ver=this.getU8(),this.skip(3),e.lh_dseg_len=this.getLength(),e.lh_flst_len=this.getLength(),e.lh_dseg_off=this.getOffset(),this.getMetadata("debug")&&console.log("LHEAP V"+e.lh_ver+" "+e.lh_dseg_len+" "+e.lh_flst_len+" "+e.lh_dseg_off),e}},{key:"hdf5MsgDataspace",value:function(e,t){var r,n=this.getU8(),i=this.getU8(),a=this.getU8();n<=1?this.skip(5):this.skip(1);var s,o=1,l=[];for(s=0;s<i;s+=1)l[s]=this.getLength(),o*=l[s];r=i*this._superblk.lensz+(n<=1?8:4);var u=[];if(0!=(1&a))for(r+=i*this._superblk.lensz,s=0;s<i;s+=1)u[s]=this.getLength();var c=[];if(0!=(2&a))for(r+=i*this._superblk.lensz,s=0;s<i;s+=1)c[s]=this.getLength();var h="this.hdf5MsgDataspace V"+n+" N"+i+" F"+a;return this.getMetadata("debug")&&(0!==i&&(h+="["+l.join(", ")+"]"),console.log(h)),r<e&&this.skip(e-r),t&&(t.dims=l),o}},{key:"hdf5MsgLinkInfo",value:function(e){var t=this,r=this.getU8(),n=this.getU8();0!=(1&n)&&this.getU64();var i=this.getOffset(),a=this.getOffset();0!=(2&n)&&this.getOffset(),this.getMetadata("debug")&&console.log("this.hdf5MsgLinkInfo V"+r+" F"+n+" FH "+i+" BT "+a);var s=this.tell();if(i<this._superblk.eof_addr){this.seek(i);var o=this.hdf5FractalHeapHeader(),l=0;this.hdf5FractalHeapEnumerate(o,function(r,n,i,a){for(var s=n+a;l<o.heap_nobj&&t.tell()<s;)t.hdf5MsgLink(e),l+=1;return!0})}this.seek(s)}},{key:"dt_class_name",value:function(e){var t=["Fixed-Point","Floating-Point","Time","String","BitField","Opaque","Compound","Reference","Enumerated","Variable-Length","Array"];if(e<t.length)return t[e];throw new Error("Unknown datatype class: "+e)}},{key:"hdf5MsgDatatype",value:function(e){var t,r,n,i,a,s,o,l,u={},c=8,h="",f=this.getU8(),d=f>>4,p=15&f,g=[];for(l=0;l<3;l+=1)g[l]=this.getU8();var _=this.getU32();switch(this.getMetadata("debug")&&console.log("this.hdf5MsgDatatype V"+d+" C"+p+" "+this.dt_class_name(p)+" "+g[0]+"."+g[1]+"."+g[2]+" "+_),p){case 0:switch(t=this.getU16(),r=this.getU16(),_){case 4:u.typ_type=8&g[0]?this._type_enum.INT32:this._type_enum.UINT32;break;case 2:u.typ_type=8&g[0]?this._type_enum.INT16:this._type_enum.UINT16;break;case 1:u.typ_type=8&g[0]?this._type_enum.INT8:this._type_enum.UINT8;break;default:throw new Error("Unknown type size "+_)}u.typ_length=_,c+=4,this.getMetadata("debug")&&console.log("  ("+t+" "+r+")");break;case 1:if(h="",this.getMetadata("debug"))switch(65&g[0]){case 0:h+="LE ";break;case 1:h+="BE ";break;case 65:h+="VX ";break;default:throw new Error("Reserved fp byte order: "+g[0])}if(t=this.getU16(),r=this.getU16(),n=this.getU8(),i=this.getU8(),a=this.getU8(),s=this.getU8(),o=this.getU32(),this.getMetadata("debug")&&(h+=t+" "+r+" "+n+" "+i+" "+a+" "+s+" "+o),64===r&&0===t&&52===n&&11===i&&0===a&&52===s&&1023===o&&8===_)u.typ_type=this._type_enum.DBL;else{if(32!==r||0!==t||23!==n||8!==i||0!==a||23!==s||127!==o||4!==_)throw new Error("Unsupported floating-point type");u.typ_type=this._type_enum.FLT}this.getMetadata("debug")&&console.log(h),u.typ_length=_,c+=12;break;case 3:u.typ_type=this._type_enum.STR,u.typ_length=_;break;default:throw new Error("Unimplemented HDF5 data class "+p)}return e>c&&this.skip(e-c),u}},{key:"hdf5MsgLayout",value:function(e){var t,r,n,i,a,s,o,l="",u=this.getU8(),c=[],h=1;if(1===u||2===u){if(r=this.getU8(),t=this.getU8(),this.skip(5),this.getMetadata("debug")&&(l+="this.hdf5MsgLayout V"+u+" N"+r+" C"+t),1===t||2===t){var f=this.getOffset();this.getMetadata("debug")&&(l+=" A"+f),e.data_offset=f}for(i=0;i<r;i+=1)c[i]=this.getU32(),h*=c[i];this.getMetadata("debug")&&(l+="["+c.join(", ")+"]"),2===t&&(o=this.getU32(),e.chunk_size=h*o,this.getMetadata("debug")&&(l+=" E"+o)),0===t?(n=this.getU32(),this.getMetadata("debug")&&(l+="("+n+")"),e.data_offset=this.tell(),e.data_length=n):1===t&&(e.data_length=h)}else{if(3!==u)throw new Error("Illegal layout version "+u);if(l="this.hdf5MsgLayout V"+u+" C"+(t=this.getU8()),0===t)n=this.getU16(),this.getMetadata("debug")&&(l+="("+n+")"),e.data_offset=this.tell(),e.data_length=n;else if(1===t)a=this.getOffset(),s=this.getLength(),this.getMetadata("debug")&&(l+="("+a+", "+s+")"),e.data_offset=a,e.data_length=s;else if(2===t){for(r=this.getU8(),a=this.getOffset(),e.data_offset=a,e.chunk_size=1,i=0;i<r-1;i+=1)c[i]=this.getU32(),h*=c[i];this.getMetadata("debug")&&(l+="(N"+r+", A"+a+" ["+c.join(",")+"]"),o=this.getU32(),e.chunk_size=h*o,this.getMetadata("debug")&&(l+=" E"+o)}}this.getMetadata("debug")&&console.log(l)}},{key:"hdf5MsgPipeline",value:function(e){var t,r,n,i,a,s=this.getU8(),o=this.getU8(),l="this.hdf5MsgPipeline V"+s+" N"+o;for(1===s&&this.skip(6),this.getMetadata("debug")&&console.log(l),t=0;t<o;t+=1){if(1!==(r=this.getU16()))throw new Error("Unimplemented HDF5 filter "+r);if("object"!==(void 0===pako_1?"undefined":_typeof(pako_1)))throw new Error("Need pako to inflate data.");e.inflate=!0,n=1===s||r>256?this.getU16():0,i=this.getU16(),0!=(1&(a=this.getU16()))&&(a+=1),0!==n&&this.skip(n),this.skip(4*a),this.getMetadata("debug")&&console.log("  "+t+" ID"+r+" F"+i+" "+a)}}},{key:"hdf5MsgAttribute",value:function(e,t){var r=this.getU8(),n=this.getU8(),i=this.getU16(),a=this.getU16(),s=this.getU16(),o="this.hdf5MsgAttribute V"+r+" F"+n+" "+e+": ";if(0!=(3&n))throw new Error("Shared dataspaces and datatypes are not supported.");if(3===r){var l=this.getU8();this.getMetadata("debug")&&(o+=0===l?"ASCII":"UTF-8")}this.getMetadata("debug")&&(o+="("+i+" "+a+" "+s+")"),r<3&&(i=8*Math.floor((i+7)/8),a=8*Math.floor((a+7)/8),s=8*Math.floor((s+7)/8),this.getMetadata("debug")&&(o+="/("+i+" "+a+" "+s+")"));var u=this.getString(i);this.getMetadata("debug")&&(o+=" Name: "+u,console.log(o));var c,h=this.hdf5MsgDatatype(a),f=this.hdf5MsgDataspace(s),d=0;d=e>0?r<3?e-(8+i+a+s):e-(9+i+a+s):h.typ_length*f,this.getMetadata("debug")&&console.log("  attribute data size "+d+" "+this.tell()),c=h.typ_type===this._type_enum.STR?this.getString(d):this.getArray(h.typ_type,d),t.attributes[u]=c}},{key:"hdf5MsgGroupInfo",value:function(){var e=4,t=8,r=this.getU8(),n=this.getU8();0!=(1&n)&&(this.getU16(),this.getU16()),0!=(2&n)&&(e=this.getU16(),t=this.getU16()),this.getMetadata("debug")&&console.log("this.hdf5MsgGroupInfo V"+r+" F"+n+" ENT "+e+" LNL "+t)}},{key:"hdf5MsgLink",value:function(e){var t=this.getU8(),r=0;if(1!==t)throw new Error("Bad link message version "+t);var n=this.getU8();0!=(8&n)&&(r=this.getU8()),0!=(4&n)&&this.getU64(),0!=(16&n)&&this.getU8();var i=1<<(3&n),a=this.getUXX(i),s=this.createLink();s.name=this.getString(a),0==(8&n)&&(s.hdr_offset=this.getOffset()),this.getMetadata("debug")&&console.log("this.hdf5MsgLink V"+t+" F"+n+" T"+r+" NM "+s.name+" OF "+s.hdr_offset),e.children.push(s)}},{key:"hdf5FractalHeapDirectBlock",value:function(e,t,r,n){if(!this.checkSignature("FHDB"))throw new Error("Bad or missing FHDB signature");var i=this.getU8();if(0!==i)throw new Error("Bad FHDB version: "+i);this.getOffset();var a=Math.ceil(e.max_heapsz/8),s=this.getUXX(a);0!=(2&e.flags)&&this.getU32(),this.getMetadata("debug")&&console.log("FHDB V:"+i+" R:"+t+" O:"+s+" A:"+r);var o;this._superblk.offsz;return 0!=(2&e.flags)&&4,o=t<=1?e.start_blksz:Math.pow(2,t-1)*e.start_blksz,!n||n(t,r,s,o)}},{key:"hdf5FractalHeapIndirectBlock",value:function(e,t){if(!this.checkSignature("FHIB"))throw new Error("Bad or missing FHIB signature");var r=this.getU8();if(0!==r)throw new Error("Bad FHIB version: "+r);this.getOffset();var n,i,a=Math.ceil(e.max_heapsz/8),s=this.getUXX(a);this.getMetadata("debug")&&console.log("FHIB V:"+r+" O:"+s);var o=[];for(n=0;n<e.K;n+=1)(i=this.getOffset())<this._superblk.eof_addr&&(this.getMetadata("debug")&&console.log("direct block at "+i),o.push(i));var l=[];for(n=0;n<e.N;n+=1)(i=this.getOffset())<this._superblk.eof_addr&&(this.getMetadata("debug")&&console.log("indirect block at "+i),l.push(i));for(this.getU32(),n=0;n<o.length;n++)if(this.seek(o[n]),!this.hdf5FractalHeapDirectBlock(e,n/e.table_width,o[n],t))return!1;for(n=0;n<l.length;n++)if(this.seek(l[n]),!this.hdf5FractalHeapIndirectBlock(e,t))return!1;return!0}},{key:"hdf5FractalHeapEnumerate",value:function(e,t){this.seek(e.root_addr),0===e.K?this.hdf5FractalHeapDirectBlock(e,0,e.root_addr,t):this.hdf5FractalHeapIndirectBlock(e,t)}},{key:"hdf5FractalHeapOffset",value:function(e,t){var r;return this.hdf5FractalHeapEnumerate(e,function(e,n,i,a){return!(t>=i&&t<i+a)||(r=n+(t-i),!1)}),r}},{key:"hdf5MsgAttrInfo",value:function(e){var t=this.getU8();if(0!==t)throw new Error("Bad attribute information message version: "+t);var r=this.getU8();0!=(1&r)&&this.getU16();var n=this.getOffset(),i=this.getOffset();0!=(2&r)&&this.getOffset(),this.getMetadata("debug")&&console.log("this.hdf5MsgAttrInfo V"+t+" F"+r+" HP "+n+" AN "+i);var a,s=this.tell();if(n<this._superblk.eof_addr&&(this.seek(n),a=this.hdf5FractalHeapHeader()),i<this._superblk.eof_addr){this.seek(i);var o=this.hdf5V2BtreeHeader();if(8!==o.type)throw new Error("Can only handle indexed attributes.");this.seek(o.root_addr),o.depth>0?this.hdf5V2BtreeInternalNode(a,o.root_nrec,o.depth,e):this.hdf5V2BtreeLeafNode(a,o.root_nrec,e)}this.seek(s)}},{key:"hdf5ProcessMessage",value:function(e,t){var r,n={};switch(e.hm_type){case 1:this.hdf5MsgDataspace(e.hm_size,t);break;case 2:this.hdf5MsgLinkInfo(t);break;case 3:r=this.hdf5MsgDatatype(e.hm_size),t&&(t.type=r.typ_type);break;case 6:this.hdf5MsgLink(t);break;case 8:this.hdf5MsgLayout(t);break;case 10:this.hdf5MsgGroupInfo();break;case 11:this.hdf5MsgPipeline(t);break;case 12:this.hdf5MsgAttribute(e.hm_size,t);break;case 16:n.cq_off=this.getOffset(),n.cq_len=this.getLength(),this._continuation_queue.push(n),this.getMetadata("debug")&&console.log("hdf5MsgObjHdrContinue "+n.cq_off+" "+n.cq_len);break;case 17:t.sym_btree=this.getOffset(),t.sym_lheap=this.getOffset(),this.getMetadata("debug")&&console.log("hdf5MsgSymbolTable "+t.sym_btree+" "+t.sym_lheap);break;case 21:this.hdf5MsgAttrInfo(t);break;case 0:case 4:case 5:case 7:case 18:case 19:case 20:case 22:case 24:this.skip(e.hm_size);break;default:throw new Error("Unknown message type: "+e.hm_type)}}},{key:"hdf5V2ObjectHeader",value:function(e){if(!this.checkSignature("OHDR"))throw new Error("Bad or missing OHDR signature");var t=this,r=this.getU8(),n=this.getU8();0!=(32&n)&&(this.getU32(),this.getU32(),this.getU32(),this.getU32()),0!=(16&n)&&(this.getU16(),this.getU16());var i,a,s,o=1<<(3&n),l=this.getUXX(o),u=0,c=0,h=l;for(this.getMetadata("debug")&&console.log("this.hdf5V2ObjectHeader V"+r+" F"+n+" HS"+l);;){for(;h-c>=8;)(i={}).hm_type=this.getU8(),i.hm_size=this.getU16(),i.hm_flags=this.getU8(),this.getMetadata("debug")&&console.log("  msg"+u+" F"+i.hm_flags+" T "+i.hm_type+" S "+i.hm_size+" ("+c+"/"+h+") "+this.hdf5GetMsgName(i.hm_type)),0!=(4&n)&&(i.hm_corder=this.getU16()),s=this.tell(),this.hdf5ProcessMessage(i,e),this.seek(s+i.hm_size),c+=i.hm_size+4,u+=1;if(h-c>4&&this.skip(h-(c+4)),this.getU32(),0===this._continuation_queue.length)break;if(a=this._continuation_queue.shift(),this.seek(a.cq_off),h=a.cq_len-4,c=0,this.getMetadata("debug")&&console.log("continuing with "+a.cq_len+" bytes at "+this.tell()),!this.checkSignature("OCHK"))throw new Error("Bad v2 object continuation")}e.children.forEach(function(e,r){t.seek(e.hdr_offset),t.getMetadata("debug")&&console.log(r+" "+e.hdr_offset+" "+e.name),t.checkSignature("OHDR")?(t.seek(e.hdr_offset),t.hdf5V2ObjectHeader(e)):(t.seek(e.hdr_offset),t.hdf5V1ObjectHeader(e))})}},{key:"loadData",value:function(e){var t=this;if(0!==e.chunk_size){this.seek(e.data_offset);var r,n=1;for(r=0;r<e.dims.length;r+=1)n*=e.dims[r];n*=this.typeSize(e.type),this.getMetadata("debug")&&console.log("allocating "+n+" bytes");var i=new ArrayBuffer(n);switch(e.n_filled=0,e.type){case this._type_enum.INT8:e.array=new Int8Array(i);break;case this._type_enum.UINT8:e.array=new Uint8Array(i);break;case this._type_enum.INT16:e.array=new Int16Array(i);break;case this._type_enum.UINT16:e.array=new Uint16Array(i);break;case this._type_enum.INT32:e.array=new Int32Array(i);break;case this._type_enum.UINT32:e.array=new Uint32Array(i);break;case this._type_enum.FLT:e.array=new Float32Array(i);break;case this._type_enum.DBL:e.array=new Float64Array(i);break;default:throw new Error("Illegal type: "+e.type)}this.hdf5V1BtreeNode(e)}else e.data_offset>0&&e.data_offset<this._superblk.eof_addr?(this.getMetadata("debug")&&console.log("loading "+e.data_length+" bytes from "+e.data_offset+" to "+e.name),e.array=this.getArray(e.type,e.data_length,e.data_offset)):this.getMetadata("debug")&&console.log("data not present for /"+e.name+"/");e.children.forEach(function(e){t.loadData(e)})}},{key:"hdf5V1ObjectHeader",value:function(e){var t=this,r={};if(this.startAlignment(),r.oh_ver=this.getU8(),this.skip(1),r.oh_n_msgs=this.getU16(),r.oh_ref_cnt=this.getU32(),r.oh_hdr_sz=this.getU32(),1!==r.oh_ver)throw new Error("Bad v1 object header version: "+r.oh_ver);this.getMetadata("debug")&&console.log("this.hdf5V1ObjectHeader V"+r.oh_ver+" #M "+r.oh_n_msgs+" RC "+r.oh_ref_cnt+" HS "+r.oh_hdr_sz);var n,i,a,s,o=r.oh_hdr_sz;for(i=0;i<r.oh_n_msgs;i+=1){if(o<=8){if(0===this._continuation_queue.length)break;n=this._continuation_queue.shift(),this.seek(n.cq_off),o=n.cq_len,this.getMetadata("debug")&&console.log("continuing with "+o+" bytes at "+this.tell()),this.startAlignment()}if(this.checkAlignment(),(a={}).hm_type=this.getU16(),a.hm_size=this.getU16(),a.hm_flags=this.getU8(),a.hm_size%8!=0)throw new Error("Size is not 8-byte aligned: "+a.hm_size);this.skip(3),o-=8+a.hm_size,this.getMetadata("debug")&&console.log("  msg"+i+" F "+a.hm_flags+" T "+a.hm_type+" S "+a.hm_size+"("+o+") "+this.hdf5GetMsgName(a.hm_type)),s=this.tell(),this.hdf5ProcessMessage(a,e),this.seek(s+a.hm_size)}if(0!==e.sym_btree&&0!==e.sym_lheap){this.seek(e.sym_btree);var l=this.hdf5V1BtreeNode();this.seek(e.sym_lheap);var u,c=this.hdf5LocalHeap();for(u=0;u<l.entries_used;u+=1)this.seek(l.keys[u].child_address),this.checkSignature("SNOD")?(this.seek(l.keys[u].child_address),this.hdf5GroupSymbolTable(c,e)):(this.seek(l.keys[u].child_address),this.hdf5V1ObjectHeader(e));e.children.forEach(function(e){t.seek(e.hdr_offset),t.hdf5V1ObjectHeader(e)})}}},{key:"getTypeMatchMinc",value:function(e){return this._type_matching[e-1]}},{key:"defined",value:function(e){return void 0!==e}},{key:"typeName",value:function(e){return this.defined(e)?e.constructor.name:"undefined"}},{key:"typeSize",value:function(e){if(e>=this._type_enum.INT8&&e<this.type_sizes.length)return this.type_sizes[e];throw new Error("Unknown type "+e)}},{key:"typeIsFloat",value:function(e){return e>=this._type_enum.FLT&&e<=this._type_enum.DBL}},{key:"join",value:function(e,t){var r="";if(e&&e.length){var n;for(n=0;n<e.length-1;n+=1)r+=e[n],r+=t;r+=e[n]}return r}},{key:"printStructure",value:function(e,t){var r,n=this,i="";for(r=0;r<2*t;r+=1)i+=" ";i+=e.name+(e.children.length?"/":""),e.type>0&&(i+=" "+this.typeName(e.array),e.dims.length&&(i+="["+e.dims.join(", ")+"]"),e.array?i+=":"+e.array.length:i+=" NULL"),console.log(i),Object.keys(e.attributes).forEach(function(a){var s=e.attributes[a];for(i="",r=0;r<2*t+1;r+=1)i+=" ";i+=e.name+":"+a+" "+n.typeName(s)+"["+s.length+"] ","string"==typeof s?i+=JSON.stringify(s):(i+="{"+n.join(s.slice(0,16),", "),s.length>16&&(i+=", ..."),i+="}"),console.log(i)}),e.children.forEach(function(e){n.printStructure(e,t+1)})}},{key:"findDataset",value:function(e,t,r){var n,i=this;return e&&e.name===t&&e.type>0?n=e:e.children.find(function(e){return n=i.findDataset(e,t,r+1),i.defined(n)}),n}},{key:"findAttribute",value:function(e,t,r){var n=this,i=e.attributes[t];return i||(e.children.find(function(e){return i=n.findAttribute(e,t,r+1),n.defined(i)}),i)}},{key:"scaleVoxels",value:function(e,t,r,n,i){var a=null,s=null;switch(this.getTypeMatchMinc(e.type)){case"int8":a=new ArrayBuffer(e.array.length*Int8Array.BYTES_PER_ELEMENT),s=new Int8Array(a);break;case"int16":a=new ArrayBuffer(e.array.length*Int16Array.BYTES_PER_ELEMENT),s=new Int16Array(a);break;case"int32":a=new ArrayBuffer(e.array.length*Int32Array.BYTES_PER_ELEMENT),s=new Int32Array(a);break;case"float32":a=new ArrayBuffer(e.array.length*Float32Array.BYTES_PER_ELEMENT),s=new Float32Array(a);break;case"float64":a=new ArrayBuffer(e.array.length*Float64Array.BYTES_PER_ELEMENT),s=new Float64Array(a);break;case"uint8":a=new ArrayBuffer(e.array.length*Uint8Array.BYTES_PER_ELEMENT),s=new Uint8Array(a);break;case"uint16":a=new ArrayBuffer(e.array.length*Uint16Array.BYTES_PER_ELEMENT),s=new Uint16Array(a);break;case"uint32":a=new ArrayBuffer(e.array.length*Uint32Array.BYTES_PER_ELEMENT),s=new Uint32Array(a);break;default:var o="Unsupported data type: "+header.datatype;throw console.log({message:o}),new Error(o)}if(e.dims.length-t.dims.length<1)throw new Error("Too few slice dimensions: "+e.dims.length+" "+t.dims.length);var l,u=1;for(l=t.dims.length;l<e.dims.length;l+=1)u*=e.dims[l];i&&console.log(u+" voxels in slice.");var c,h,f=0,d=0,p=-Number.MAX_VALUE,g=Number.MAX_VALUE,_=e.array,y=r.array,m=t.array;i&&console.log("valid range is "+n[0]+" to "+n[1]);var v,b,w,E=n[0],T=this.typeIsFloat(e.type);for(l=0;l<t.array.length;l+=1)if(i&&console.log(l+" "+m[l]+" "+y[l]+" "+_[l*u]),T)for(b=0;b<u;b+=1)(w=_[d])<n[0]||w>n[1]?s[d]=0:(s[d]=w,f+=w,w>p&&(p=w),w<g&&(g=w)),d+=1;else for(c=n[1]-n[0],h=y[l]-m[l],v=m[l],b=0;b<u;b+=1)w=(w=(_[d]-E)/c*h+v)/y[l]*n[1],s[d]=w,f+=w,d+=1,w>p&&(p=w),w<g&&(g=w);return i&&(console.log("Min: "+g),console.log("Max: "+p),console.log("Sum: "+f),console.log("Mean: "+f/d)),a}},{key:"isRgbVolume",value:function(e,t){var r=e.order;return"Uint8Array"===t.array.constructor.name&&r.length>0&&"vector_dimension"===r[r.length-1]&&3===e.vector_dimension.space_length}},{key:"rgbVoxels",value:function(e){var t,r=e.array,n=r.length,i=new ArrayBuffer(n/3*4),a=new Uint8Array(i),s=0;for(t=0;t<n;t+=3)a[s+0]=r[t+0],a[s+1]=r[t+1],a[s+2]=r[t+2],a[s+3]=255,s+=4;return i}},{key:"parseHeader",value:function(e){var t,r;try{t=JSON.parse(e)}catch(t){throw r="server did not respond with valid JSON\nResponse was: \n"+e,console.log({message:r}),new Error(r)}return 4===t.order.length&&(t.order=t.order.slice(1)),t.datatype=t.datatype||"uint8",t.xspace.space_length=parseFloat(t.xspace.space_length),t.yspace.space_length=parseFloat(t.yspace.space_length),t.zspace.space_length=parseFloat(t.zspace.space_length),t.xspace.start=parseFloat(t.xspace.start),t.yspace.start=parseFloat(t.yspace.start),t.zspace.start=parseFloat(t.zspace.start),t.xspace.step=parseFloat(t.xspace.step),t.yspace.step=parseFloat(t.yspace.step),t.zspace.step=parseFloat(t.zspace.step),t.xspace.direction_cosines=t.xspace.direction_cosines||[1,0,0],t.yspace.direction_cosines=t.yspace.direction_cosines||[0,1,0],t.zspace.direction_cosines=t.zspace.direction_cosines||[0,0,1],t.xspace.direction_cosines=t.xspace.direction_cosines.map(parseFloat),t.yspace.direction_cosines=t.yspace.direction_cosines.map(parseFloat),t.zspace.direction_cosines=t.zspace.direction_cosines.map(parseFloat),t[t.order[0]].offset=t[t.order[1]].space_length*t[t.order[2]].space_length,t[t.order[1]].offset=t[t.order[2]].space_length,t[t.order[2]].offset=1,t.time&&(t.time.space_length=parseFloat(t.time.space_length),t.time.start=parseFloat(t.time.start),t.time.step=parseFloat(t.time.step),t.time.offset=t.xspace.space_length*t.yspace.space_length*t.zspace.space_length),t}},{key:"createMincData",value:function(e,t){var r=null;switch(e.datatype){case"int8":r=new Int8Array(t);break;case"int16":r=new Int16Array(t);break;case"int32":r=new Int32Array(t);break;case"float32":r=new Float32Array(t);break;case"float64":r=new Float64Array(t);break;case"uint8":r=new Uint8Array(t);break;case"uint16":r=new Uint16Array(t);break;case"uint32":case"rgb8":r=new Uint32Array(t);break;default:var n="Unsupported data type: "+e.datatype;throw console.log({message:n}),new Error(n)}return r}},{key:"_run",value:function(){var e=this,t=this._getInput(0);if(t){this._dv=new DataView(t),this._dv.getUint64=function(t,r){var n=e._dv.getUint32(t+0,r),i=e._dv.getUint32(t+4,r);return r?(i<<32)+n:(n<<32)+i};var r=this.createLink();try{this._superblk=this.hdf5Superblock()}catch(e){return void console.warn("The input file is not a Minc2 file.")}this.seek(this._superblk.root_addr),this._superblk.sbver<=1?this.hdf5V1ObjectHeader(r):this.hdf5V2ObjectHeader(r),this.loadData(r),this.getMetadata("debug")&&this.printStructure(r,0);var n=this.findDataset(r,"image");if(!this.defined(n))throw new Error("Can't find image dataset.");var i=this.findAttribute(n,"valid_range",0);if(!this.defined(i)){var a,s;switch(n.type){case this._type_enum.INT8:a=-128,s=127;break;case this._type_enum.UINT8:a=0,s=255;break;case this._type_enum.INT16:a=-32768,s=32767;break;case this._type_enum.UINT16:a=0,s=65535;break;case this._type_enum.INT32:a=-(1<<31),s=(1<<31)-1;break;case this._type_enum.UINT32:a=0,s=0}i=Float32Array.of(a,s)}var o=this.findDataset(r,"image-min");this.defined(o)||(o={array:Float32Array.of(0),dims:[]});var l=this.findDataset(r,"image-max");this.defined(l)||(l={array:Float32Array.of(1),dims:[]});var u,c={},h=this.findAttribute(n,"dimorder",0);if("string"!=typeof h)throw new Error("Can't find dimension order.");c.order=h.split(","),c.order.forEach(function(t){var n=e.findDataset(r,t);if(!e.defined(n))throw new Error("Can't find dimension variable "+t);if(c[t]={},h=e.findAttribute(n,"step",0),e.defined(h)||(h=Float32Array.of(1)),c[t].step=h[0],h=e.findAttribute(n,"start",0),e.defined(h)||(h=Float32Array.of(0)),c[t].start=h[0],h=e.findAttribute(n,"length",0),!e.defined(h))throw new Error("Can't find length for "+t);c[t].space_length=h[0],h=e.findAttribute(n,"direction_cosines",0),e.defined(h)?c[t].direction_cosines=Array.prototype.slice.call(h):"xspace"===t?c[t].direction_cosines=[1,0,0]:"yspace"===t?c[t].direction_cosines=[0,1,0]:"zspace"===t&&(c[t].direction_cosines=[0,0,1])}),this.isRgbVolume(c,n)?(c.order.pop(),c.datatype="rgb8",u=this.rgbVoxels(n)):(c.datatype=this.getTypeMatchMinc(n.type),u=this.scaleVoxels(n,o,l,i,this.getMetadata("debug")));var f=this.parseHeader(JSON.stringify(c));f.format="minc2";var d=this.createMincData(f,u),p=Image3DMetadataConverter.convertImage3DMetadata(f),g=new Image3DAlt;g.setRawData(d),g.setRawMetadata(p),g.metadataIntegrityCheck()&&(g.scanDataRange(),this._output[0]=g)}else console.warn('Minc2DecoderAlt requires an ArrayBuffer as input "0". Unable to continue.')}}]),t}(),MghDecoderAlt=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setMetadata("targetType",Image3DAlt.name),e.addInputValidator(0,ArrayBuffer),e.setMetadata("debug",!1),e}return inherits(t,Decoder),createClass(t,[{key:"_parseMGHHeader",value:function(e,t){var r={order:["xspace","yspace","zspace"],xspace:{},yspace:{},zspace:{}},n=new DataView(e,0,284),i=!0,a=n.getUint32(0,!0);if(1===a)i=!0;else{if(16777216!==a)return console.warn("This does not look like an MGH file."),null;i=!1}var s=0,o=[0,0,0,0],l=4,u=1;for(s=0;s<4&&(o[s]=n.getUint32(l,i),!(o[s]<=1));s++)u*=o[s],l+=4;if(s<3||s>4)return console.warn("Cannot handle "+s+"-dimensional images yet."),null;var c,h,f=n.getUint32(20,i),d=[1,1,1],p=[[-1,0,0],[0,0,-1],[0,1,0],[0,0,0]];if(n.getUint16(28,i)){for(l=30,c=0;c<3;c++)d[c]=n.getFloat32(l,i),l+=4;for(c=0;c<4;c++)for(h=0;h<3;h++)p[c][h]=n.getFloat32(l,i),l+=4}if(this._metadata.debug)for(c=0;c<3;c++){for(h=0;h<4;h++)"xyzc"[h]+"_"+"ras"[c]+" "+p[h][c]+" "}for(var g=[0,1,2],_=0;_<3;_++){var y=0,m=Math.abs(p[_][0]),v=Math.abs(p[_][1]),b=Math.abs(p[_][2]);r.order[_]="xspace",v>m&&v>b&&(y=1,r.order[_]="yspace"),b>m&&b>v&&(y=2,r.order[_]="zspace"),g[_]=y}4===s&&(this._metadata.debug&&console.log("Creating time dimension: "+o[3]),r.time={space_length:o[3],step:1,start:0,name:"time"},r.order.push("time"));var w=[[0,0,0,0],[0,0,0,0],[0,0,0,0]];for(c=0;c<3;c++)for(h=0;h<3;h++)w[c][h]=p[h][c]*d[c];for(c=0;c<3;c++){var E=0;for(h=0;h<3;h++)E+=w[c][h]*(o[h]/2);w[c][3]=p[3][c]-E}var T=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];for(c=0;c<3;c++)for(h=0;h<4;h++){var k=h;h<3&&(k=g[h]),T[c][k]=w[c][h]}for(Image3DMetadataConverter.transformToMinc(T,r),r.datatype=f,r.little_endian=i,r.nvoxels=u,c=0;c<3;c++)r[r.order[c]].space_length=o[c];return r}},{key:"_createMGHData",value:function(e,t){var r=null,n=1;switch(e.datatype){case 0:n=1;break;case 1:case 3:n=4;break;case 4:n=2;break;default:return console.warn("Unsupported data type: "+e.datatype),null}var i=e.nvoxels*n;switch(n>1&&!e.little_endian&&Image3DMetadataConverter.swapn(new Uint8Array(t,284,i),n),e.datatype){case 0:r=new Uint8Array(t,284,e.nvoxels);break;case 1:r=new Int32Array(t,284,e.nvoxels);break;case 3:r=new Float32Array(t,284,e.nvoxels);break;case 4:r=new Int16Array(t,284,e.nvoxels)}for(var a=1,s=0;s<e.order.length;s++)e[e.order[s]].offset=a,a*=e[e.order[s]].space_length;return r}},{key:"_run",value:function(){var e=this._getInput(0);if(e){var t=null;try{t=this._parseMGHHeader(e)}catch(e){}if(t){var r=this._createMGHData(t,e);if(!r)return null;var n,i=Image3DMetadataConverter.convertImage3DMetadata(t),a=i.dimensions;a.sort(function(e,t){return e.stride<t.stride});for(var s=0;s<a.length;s++){var o=a[s].nameWorldSpace;a[s].heightDimension=c("x"===(n=o)?"z":"y"===n?"z":"z"===n?"y":null),a[s].widthDimension=c(u(o))}var l=new Image3DAlt;l.setRawData(r),l.setRawMetadata(i),l.metadataIntegrityCheck()&&(l.scanDataRange(),this._output[0]=l)}else console.log("The input file is not a MGH file.")}else console.warn('MghDecoderAlt requires an ArrayBuffer as input "0". Unable to continue.');function u(e){return"x"===e?"y":"y"===e?"x":"z"===e?"x":null}function c(e){for(var t=0;t<a.length;t++)if(a[t].nameWorldSpace===e)return t;return-1}}}]),t}(),Image3DGenericDecoderAlt=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setMetadata("enablePixBin",!0),e._decoders=[Minc2DecoderAlt,NiftiDecoderAlt,MghDecoderAlt],e}return inherits(t,GenericDecoderInterface),t}(),nameStartChar=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,nameChar=new RegExp("[\\-\\.0-9"+nameStartChar.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),tagNamePattern=new RegExp("^"+nameStartChar.source+nameChar.source+"*(?::"+nameStartChar.source+nameChar.source+"*)?$"),S_TAG=0,S_ATTR=1,S_ATTR_SPACE=2,S_EQ=3,S_ATTR_NOQUOT_VALUE=4,S_ATTR_END=5,S_TAG_SPACE=6,S_TAG_CLOSE=7;function XMLReader(){}function _parse(e,t,r,n,i){function a(e){var t=e.slice(1,-1);return t in r?r[t]:"#"===t.charAt(0)?function(e){if(e>65535){var t=55296+((e-=65536)>>10),r=56320+(1023&e);return String.fromCharCode(t,r)}return String.fromCharCode(e)}(parseInt(t.substr(1).replace("x","0x"))):(i.error("entity not found:"+e),e)}function s(t){if(t>p){var r=e.substring(p,t).replace(/&#?\w+;/g,a);h&&o(p),n.characters(r,0,t-p),p=t}}function o(t,r){for(;t>=u&&(r=c.exec(e));)l=r.index,u=l+r[0].length,h.lineNumber++;h.columnNumber=t-l+1}for(var l=0,u=0,c=/.*(?:\r\n?|\n)|.*$/g,h=n.locator,f=[{currentNSMap:t}],d={},p=0;;){try{var g=e.indexOf("<",p);if(g<0){if(!e.substr(p).match(/^\s*$/)){var _=n.doc,y=_.createTextNode(e.substr(p));_.appendChild(y),n.currentElement=y}return}switch(g>p&&s(g),e.charAt(g+1)){case"/":var m=e.indexOf(">",g+3),v=e.substring(g+2,m),b=f.pop();m<0?(v=e.substring(g+2).replace(/[\s<].*/,""),i.error("end tag name: "+v+" is not complete:"+b.tagName),m=g+1+v.length):v.match(/\s</)&&(v=v.replace(/[\s<].*/,""),i.error("end tag name: "+v+" maybe not complete"),m=g+1+v.length);var w=b.localNSMap,E=b.tagName==v;if(E||b.tagName&&b.tagName.toLowerCase()==v.toLowerCase()){if(n.endElement(b.uri,b.localName,v),w)for(var T in w)n.endPrefixMapping(T);E||i.fatalError("end tag name: "+v+" is not match the current start tagName:"+b.tagName)}else f.push(b);m++;break;case"?":h&&o(g),m=parseInstruction(e,g,n);break;case"!":h&&o(g),m=parseDCC(e,g,n,i);break;default:h&&o(g);var k=new ElementAttributes,x=f[f.length-1].currentNSMap,S=(m=parseElementStartPart(e,g,k,x,a,i),k.length);if(!k.closed&&fixSelfClosed(e,m,k.tagName,d)&&(k.closed=!0,r.nbsp||i.warning("unclosed xml attribute")),h&&S){for(var I=copyLocator(h,{}),A=0;A<S;A++){var M=k[A];o(M.offset),M.locator=copyLocator(h,{})}n.locator=I,appendElement(k,n,x)&&f.push(k),n.locator=h}else appendElement(k,n,x)&&f.push(k);"http://www.w3.org/1999/xhtml"!==k.uri||k.closed?m++:m=parseHtmlSpecialContent(e,m,k.tagName,a,n)}}catch(e){i.error("element parse error: "+e),m=-1}m>p?p=m:s(Math.max(g,p)+1)}}function copyLocator(e,t){return t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber,t}function parseElementStartPart(e,t,r,n,i,a){for(var s,o=++t,l=S_TAG;;){var u=e.charAt(o);switch(u){case"=":if(l===S_ATTR)s=e.slice(t,o),l=S_EQ;else{if(l!==S_ATTR_SPACE)throw new Error("attribute equal must after attrName");l=S_EQ}break;case"'":case'"':if(l===S_EQ||l===S_ATTR){if(l===S_ATTR&&(a.warning('attribute value must after "="'),s=e.slice(t,o)),t=o+1,!((o=e.indexOf(u,t))>0))throw new Error("attribute value no end '"+u+"' match");c=e.slice(t,o).replace(/&#?\w+;/g,i),r.add(s,c,t-1),l=S_ATTR_END}else{if(l!=S_ATTR_NOQUOT_VALUE)throw new Error('attribute value must after "="');c=e.slice(t,o).replace(/&#?\w+;/g,i),r.add(s,c,t),a.warning('attribute "'+s+'" missed start quot('+u+")!!"),t=o+1,l=S_ATTR_END}break;case"/":switch(l){case S_TAG:r.setTagName(e.slice(t,o));case S_ATTR_END:case S_TAG_SPACE:case S_TAG_CLOSE:l=S_TAG_CLOSE,r.closed=!0;case S_ATTR_NOQUOT_VALUE:case S_ATTR:case S_ATTR_SPACE:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return a.error("unexpected end of input"),l==S_TAG&&r.setTagName(e.slice(t,o)),o;case">":switch(l){case S_TAG:r.setTagName(e.slice(t,o));case S_ATTR_END:case S_TAG_SPACE:case S_TAG_CLOSE:break;case S_ATTR_NOQUOT_VALUE:case S_ATTR:"/"===(c=e.slice(t,o)).slice(-1)&&(r.closed=!0,c=c.slice(0,-1));case S_ATTR_SPACE:l===S_ATTR_SPACE&&(c=s),l==S_ATTR_NOQUOT_VALUE?(a.warning('attribute "'+c+'" missed quot(")!!'),r.add(s,c.replace(/&#?\w+;/g,i),t)):("http://www.w3.org/1999/xhtml"===n[""]&&c.match(/^(?:disabled|checked|selected)$/i)||a.warning('attribute "'+c+'" missed value!! "'+c+'" instead!!'),r.add(c,c,t));break;case S_EQ:throw new Error("attribute value missed!!")}return o;case"":u=" ";default:if(u<=" ")switch(l){case S_TAG:r.setTagName(e.slice(t,o)),l=S_TAG_SPACE;break;case S_ATTR:s=e.slice(t,o),l=S_ATTR_SPACE;break;case S_ATTR_NOQUOT_VALUE:var c=e.slice(t,o).replace(/&#?\w+;/g,i);a.warning('attribute "'+c+'" missed quot(")!!'),r.add(s,c,t);case S_ATTR_END:l=S_TAG_SPACE}else switch(l){case S_ATTR_SPACE:r.tagName;"http://www.w3.org/1999/xhtml"===n[""]&&s.match(/^(?:disabled|checked|selected)$/i)||a.warning('attribute "'+s+'" missed value!! "'+s+'" instead2!!'),r.add(s,s,t),t=o,l=S_ATTR;break;case S_ATTR_END:a.warning('attribute space is required"'+s+'"!!');case S_TAG_SPACE:l=S_ATTR,t=o;break;case S_EQ:l=S_ATTR_NOQUOT_VALUE,t=o;break;case S_TAG_CLOSE:throw new Error("elements closed character '/' and '>' must be connected to")}}o++}}function appendElement(e,t,r){for(var n=e.tagName,i=null,a=e.length;a--;){var s=e[a],o=s.qName,l=s.value;if((f=o.indexOf(":"))>0)var u=s.prefix=o.slice(0,f),c=o.slice(f+1),h="xmlns"===u&&c;else c=o,u=null,h="xmlns"===o&&"";s.localName=c,!1!==h&&(null==i&&(i={},_copy(r,r={})),r[h]=i[h]=l,s.uri="http://www.w3.org/2000/xmlns/",t.startPrefixMapping(h,l))}for(a=e.length;a--;){(u=(s=e[a]).prefix)&&("xml"===u&&(s.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==u&&(s.uri=r[u||""]))}var f;(f=n.indexOf(":"))>0?(u=e.prefix=n.slice(0,f),c=e.localName=n.slice(f+1)):(u=null,c=e.localName=n);var d=e.uri=r[u||""];if(t.startElement(d,c,n,e),!e.closed)return e.currentNSMap=r,e.localNSMap=i,!0;if(t.endElement(d,c,n),i)for(u in i)t.endPrefixMapping(u)}function parseHtmlSpecialContent(e,t,r,n,i){if(/^(?:script|textarea)$/i.test(r)){var a=e.indexOf("</"+r+">",t),s=e.substring(t+1,a);if(/[&<]/.test(s))return/^script$/i.test(r)?(i.characters(s,0,s.length),a):(s=s.replace(/&#?\w+;/g,n),i.characters(s,0,s.length),a)}return t+1}function fixSelfClosed(e,t,r,n){var i=n[r];return null==i&&((i=e.lastIndexOf("</"+r+">"))<t&&(i=e.lastIndexOf("</"+r)),n[r]=i),i<t}function _copy(e,t){for(var r in e)t[r]=e[r]}function parseDCC(e,t,r,n){switch(e.charAt(t+2)){case"-":return"-"===e.charAt(t+3)?(i=e.indexOf("--\x3e",t+4))>t?(r.comment(e,t+4,i-t-4),i+3):(n.error("Unclosed comment"),-1):-1;default:if("CDATA["==e.substr(t+3,6)){var i=e.indexOf("]]>",t+9);return r.startCDATA(),r.characters(e,t+9,i-t-9),r.endCDATA(),i+3}var a=split(e,t),s=a.length;if(s>1&&/!doctype/i.test(a[0][0])){var o=a[1][0],l=s>3&&/^public$/i.test(a[2][0])&&a[3][0],u=s>4&&a[4][0],c=a[s-1];return r.startDTD(o,l&&l.replace(/^(['"])(.*?)\1$/,"$2"),u&&u.replace(/^(['"])(.*?)\1$/,"$2")),r.endDTD(),c.index+c[0].length}}return-1}function parseInstruction(e,t,r){var n=e.indexOf("?>",t);if(n){var i=e.substring(t,n).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);if(i){i[0].length;return r.processingInstruction(i[1],i[2]),n+2}return-1}return-1}function ElementAttributes(e){}function _set_proto_(e,t){return e.__proto__=t,e}function split(e,t){var r,n=[],i=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(i.lastIndex=t,i.exec(e);r=i.exec(e);)if(n.push(r),r[1])return n}XMLReader.prototype={parse:function(e,t,r){var n=this.domBuilder;n.startDocument(),_copy(t,t={}),_parse(e,t,r,n,this.errorHandler),n.endDocument()}},ElementAttributes.prototype={setTagName:function(e){if(!tagNamePattern.test(e))throw new Error("invalid tagName:"+e);this.tagName=e},add:function(e,t,r){if(!tagNamePattern.test(e))throw new Error("invalid attribute:"+e);this[this.length++]={qName:e,value:t,offset:r}},length:0,getLocalName:function(e){return this[e].localName},getLocator:function(e){return this[e].locator},getQName:function(e){return this[e].qName},getURI:function(e){return this[e].uri},getValue:function(e){return this[e].value}},_set_proto_({},_set_proto_.prototype)instanceof _set_proto_||(_set_proto_=function(e,t){function r(){}for(t in r.prototype=t,r=new r,e)r[t]=e[t];return r});var XMLReader_1=XMLReader,sax={XMLReader:XMLReader_1};function copy$8(e,t){for(var r in e)t[r]=e[r]}function _extends$1(e,t){var r=e.prototype;if(Object.create){var n=Object.create(t.prototype);r.__proto__=n}if(!(r instanceof t)){var i=function(){};i.prototype=t.prototype,copy$8(r,i=new i),e.prototype=r=i}r.constructor!=e&&("function"!=typeof e&&console.error("unknow Class:"+e),r.constructor=e)}var htmlns="http://www.w3.org/1999/xhtml",NodeType={},ELEMENT_NODE=NodeType.ELEMENT_NODE=1,ATTRIBUTE_NODE=NodeType.ATTRIBUTE_NODE=2,TEXT_NODE=NodeType.TEXT_NODE=3,CDATA_SECTION_NODE=NodeType.CDATA_SECTION_NODE=4,ENTITY_REFERENCE_NODE=NodeType.ENTITY_REFERENCE_NODE=5,ENTITY_NODE=NodeType.ENTITY_NODE=6,PROCESSING_INSTRUCTION_NODE=NodeType.PROCESSING_INSTRUCTION_NODE=7,COMMENT_NODE=NodeType.COMMENT_NODE=8,DOCUMENT_NODE=NodeType.DOCUMENT_NODE=9,DOCUMENT_TYPE_NODE=NodeType.DOCUMENT_TYPE_NODE=10,DOCUMENT_FRAGMENT_NODE=NodeType.DOCUMENT_FRAGMENT_NODE=11,NOTATION_NODE=NodeType.NOTATION_NODE=12,ExceptionCode={},ExceptionMessage={},INDEX_SIZE_ERR=ExceptionCode.INDEX_SIZE_ERR=(ExceptionMessage[1]="Index size error",1),DOMSTRING_SIZE_ERR=ExceptionCode.DOMSTRING_SIZE_ERR=(ExceptionMessage[2]="DOMString size error",2),HIERARCHY_REQUEST_ERR=ExceptionCode.HIERARCHY_REQUEST_ERR=(ExceptionMessage[3]="Hierarchy request error",3),WRONG_DOCUMENT_ERR=ExceptionCode.WRONG_DOCUMENT_ERR=(ExceptionMessage[4]="Wrong document",4),INVALID_CHARACTER_ERR=ExceptionCode.INVALID_CHARACTER_ERR=(ExceptionMessage[5]="Invalid character",5),NO_DATA_ALLOWED_ERR=ExceptionCode.NO_DATA_ALLOWED_ERR=(ExceptionMessage[6]="No data allowed",6),NO_MODIFICATION_ALLOWED_ERR=ExceptionCode.NO_MODIFICATION_ALLOWED_ERR=(ExceptionMessage[7]="No modification allowed",7),NOT_FOUND_ERR=ExceptionCode.NOT_FOUND_ERR=(ExceptionMessage[8]="Not found",8),NOT_SUPPORTED_ERR=ExceptionCode.NOT_SUPPORTED_ERR=(ExceptionMessage[9]="Not supported",9),INUSE_ATTRIBUTE_ERR=ExceptionCode.INUSE_ATTRIBUTE_ERR=(ExceptionMessage[10]="Attribute in use",10),INVALID_STATE_ERR=ExceptionCode.INVALID_STATE_ERR=(ExceptionMessage[11]="Invalid state",11),SYNTAX_ERR=ExceptionCode.SYNTAX_ERR=(ExceptionMessage[12]="Syntax error",12),INVALID_MODIFICATION_ERR=ExceptionCode.INVALID_MODIFICATION_ERR=(ExceptionMessage[13]="Invalid modification",13),NAMESPACE_ERR=ExceptionCode.NAMESPACE_ERR=(ExceptionMessage[14]="Invalid namespace",14),INVALID_ACCESS_ERR=ExceptionCode.INVALID_ACCESS_ERR=(ExceptionMessage[15]="Invalid access",15);function DOMException(e,t){if(t instanceof Error)var r=t;else r=this,Error.call(this,ExceptionMessage[e]),this.message=ExceptionMessage[e],Error.captureStackTrace&&Error.captureStackTrace(this,DOMException);return r.code=e,t&&(this.message=this.message+": "+t),r}function NodeList(){}function LiveNodeList(e,t){this._node=e,this._refresh=t,_updateLiveList(this)}function _updateLiveList(e){var t=e._node._inc||e._node.ownerDocument._inc;if(e._inc!=t){var r=e._refresh(e._node);__set__(e,"length",r.length),copy$8(r,e),e._inc=t}}function NamedNodeMap(){}function _findNodeIndex(e,t){for(var r=e.length;r--;)if(e[r]===t)return r}function _addNamedNode(e,t,r,n){if(n?t[_findNodeIndex(t,n)]=r:t[t.length++]=r,e){r.ownerElement=e;var i=e.ownerDocument;i&&(n&&_onRemoveAttribute(i,e,n),_onAddAttribute(i,e,r))}}function _removeNamedNode(e,t,r){var n=_findNodeIndex(t,r);if(!(n>=0))throw DOMException(NOT_FOUND_ERR,new Error(e.tagName+"@"+r));for(var i=t.length-1;n<i;)t[n]=t[++n];if(t.length=i,e){var a=e.ownerDocument;a&&(_onRemoveAttribute(a,e,r),r.ownerElement=null)}}function DOMImplementation(e){if(this._features={},e)for(var t in e)this._features=e[t]}function Node(){}function _xmlEncoder(e){return("<"==e?"&lt;":">"==e&&"&gt;")||"&"==e&&"&amp;"||'"'==e&&"&quot;"||"&#"+e.charCodeAt()+";"}function _visitNode(e,t){if(t(e))return!0;if(e=e.firstChild)do{if(_visitNode(e,t))return!0}while(e=e.nextSibling)}function Document(){}function _onAddAttribute(e,t,r){e&&e._inc++,"http://www.w3.org/2000/xmlns/"==r.namespaceURI&&(t._nsMap[r.prefix?r.localName:""]=r.value)}function _onRemoveAttribute(e,t,r,n){e&&e._inc++,"http://www.w3.org/2000/xmlns/"==r.namespaceURI&&delete t._nsMap[r.prefix?r.localName:""]}function _onUpdateChild(e,t,r){if(e&&e._inc){e._inc++;var n=t.childNodes;if(r)n[n.length++]=r;else{for(var i=t.firstChild,a=0;i;)n[a++]=i,i=i.nextSibling;n.length=a}}}function _removeChild(e,t){var r=t.previousSibling,n=t.nextSibling;return r?r.nextSibling=n:e.firstChild=n,n?n.previousSibling=r:e.lastChild=r,_onUpdateChild(e.ownerDocument,e),t}function _insertBefore(e,t,r){var n=t.parentNode;if(n&&n.removeChild(t),t.nodeType===DOCUMENT_FRAGMENT_NODE){var i=t.firstChild;if(null==i)return t;var a=t.lastChild}else i=a=t;var s=r?r.previousSibling:e.lastChild;i.previousSibling=s,a.nextSibling=r,s?s.nextSibling=i:e.firstChild=i,null==r?e.lastChild=a:r.previousSibling=a;do{i.parentNode=e}while(i!==a&&(i=i.nextSibling));return _onUpdateChild(e.ownerDocument||e,e),t.nodeType==DOCUMENT_FRAGMENT_NODE&&(t.firstChild=t.lastChild=null),t}function _appendSingleChild(e,t){var r=t.parentNode;if(r){var n=e.lastChild;r.removeChild(t);n=e.lastChild}n=e.lastChild;return t.parentNode=e,t.previousSibling=n,t.nextSibling=null,n?n.nextSibling=t:e.firstChild=t,e.lastChild=t,_onUpdateChild(e.ownerDocument,e,t),t}function Element(){this._nsMap={}}function Attr(){}function CharacterData(){}function Text(){}function Comment(){}function CDATASection(){}function DocumentType(){}function Notation(){}function Entity(){}function EntityReference(){}function DocumentFragment(){}function ProcessingInstruction(){}function XMLSerializer(){}function nodeSerializeToString(e,t){var r=[],n=9==this.nodeType?this.documentElement:this,i=n.prefix,a=n.namespaceURI;if(a&&null==i&&null==(i=n.lookupPrefix(a)))var s=[{namespace:a,prefix:null}];return serializeToString(this,r,e,t,s),r.join("")}function needNamespaceDefine(e,t,r){var n=e.prefix||"",i=e.namespaceURI;if(!n&&!i)return!1;if("xml"===n&&"http://www.w3.org/XML/1998/namespace"===i||"http://www.w3.org/2000/xmlns/"==i)return!1;for(var a=r.length;a--;){var s=r[a];if(s.prefix==n)return s.namespace!=i}return!0}function serializeToString(e,t,r,n,i){if(n){if(!(e=n(e)))return;if("string"==typeof e)return void t.push(e)}switch(e.nodeType){case ELEMENT_NODE:i||(i=[]);i.length;var a=e.attributes,s=a.length,o=e.firstChild,l=e.tagName;r=htmlns===e.namespaceURI||r,t.push("<",l);for(var u=0;u<s;u++){"xmlns"==(c=a.item(u)).prefix?i.push({prefix:c.localName,namespace:c.value}):"xmlns"==c.nodeName&&i.push({prefix:"",namespace:c.value})}for(u=0;u<s;u++){var c;if(needNamespaceDefine(c=a.item(u),r,i)){var h=c.prefix||"",f=c.namespaceURI,d=h?" xmlns:"+h:" xmlns";t.push(d,'="',f,'"'),i.push({prefix:h,namespace:f})}serializeToString(c,t,r,n,i)}if(needNamespaceDefine(e,r,i)){h=e.prefix||"",f=e.namespaceURI,d=h?" xmlns:"+h:" xmlns";t.push(d,'="',f,'"'),i.push({prefix:h,namespace:f})}if(o||r&&!/^(?:meta|link|img|br|hr|input)$/i.test(l)){if(t.push(">"),r&&/^script$/i.test(l))for(;o;)o.data?t.push(o.data):serializeToString(o,t,r,n,i),o=o.nextSibling;else for(;o;)serializeToString(o,t,r,n,i),o=o.nextSibling;t.push("</",l,">")}else t.push("/>");return;case DOCUMENT_NODE:case DOCUMENT_FRAGMENT_NODE:for(o=e.firstChild;o;)serializeToString(o,t,r,n,i),o=o.nextSibling;return;case ATTRIBUTE_NODE:return t.push(" ",e.name,'="',e.value.replace(/[<&"]/g,_xmlEncoder),'"');case TEXT_NODE:return t.push(e.data.replace(/[<&]/g,_xmlEncoder));case CDATA_SECTION_NODE:return t.push("<![CDATA[",e.data,"]]>");case COMMENT_NODE:return t.push("\x3c!--",e.data,"--\x3e");case DOCUMENT_TYPE_NODE:var p=e.publicId,g=e.systemId;if(t.push("<!DOCTYPE ",e.name),p)t.push(' PUBLIC "',p),g&&"."!=g&&t.push('" "',g),t.push('">');else if(g&&"."!=g)t.push(' SYSTEM "',g,'">');else{var _=e.internalSubset;_&&t.push(" [",_,"]"),t.push(">")}return;case PROCESSING_INSTRUCTION_NODE:return t.push("<?",e.target," ",e.data,"?>");case ENTITY_REFERENCE_NODE:return t.push("&",e.nodeName,";");default:t.push("??",e.nodeName)}}function _importNode(e,t,r){var n;switch(t.nodeType){case ELEMENT_NODE:(n=t.cloneNode(!1)).ownerDocument=e;case DOCUMENT_FRAGMENT_NODE:break;case ATTRIBUTE_NODE:r=!0}if(n||(n=t.cloneNode(!1)),n.ownerDocument=e,n.parentNode=null,r)for(var i=t.firstChild;i;)n.appendChild(_importNode(e,i,r)),i=i.nextSibling;return n}function _cloneNode(e,t,r){var n=new t.constructor;for(var i in t){var a=t[i];"object"!=(void 0===a?"undefined":_typeof(a))&&a!=n[i]&&(n[i]=a)}switch(t.childNodes&&(n.childNodes=new NodeList),n.ownerDocument=e,n.nodeType){case ELEMENT_NODE:var s=t.attributes,o=n.attributes=new NamedNodeMap,l=s.length;o._ownerElement=n;for(var u=0;u<l;u++)n.setAttributeNode(_cloneNode(e,s.item(u),!0));break;case ATTRIBUTE_NODE:r=!0}if(r)for(var c=t.firstChild;c;)n.appendChild(_cloneNode(e,c,r)),c=c.nextSibling;return n}function __set__(e,t,r){e[t]=r}DOMException.prototype=Error.prototype,copy$8(ExceptionCode,DOMException),NodeList.prototype={length:0,item:function(e){return this[e]||null},toString:function(e,t){for(var r=[],n=0;n<this.length;n++)serializeToString(this[n],r,e,t);return r.join("")}},LiveNodeList.prototype.item=function(e){return _updateLiveList(this),this[e]},_extends$1(LiveNodeList,NodeList),NamedNodeMap.prototype={length:0,item:NodeList.prototype.item,getNamedItem:function(e){for(var t=this.length;t--;){var r=this[t];if(r.nodeName==e)return r}},setNamedItem:function(e){var t=e.ownerElement;if(t&&t!=this._ownerElement)throw new DOMException(INUSE_ATTRIBUTE_ERR);var r=this.getNamedItem(e.nodeName);return _addNamedNode(this._ownerElement,this,e,r),r},setNamedItemNS:function(e){var t,r=e.ownerElement;if(r&&r!=this._ownerElement)throw new DOMException(INUSE_ATTRIBUTE_ERR);return t=this.getNamedItemNS(e.namespaceURI,e.localName),_addNamedNode(this._ownerElement,this,e,t),t},removeNamedItem:function(e){var t=this.getNamedItem(e);return _removeNamedNode(this._ownerElement,this,t),t},removeNamedItemNS:function(e,t){var r=this.getNamedItemNS(e,t);return _removeNamedNode(this._ownerElement,this,r),r},getNamedItemNS:function(e,t){for(var r=this.length;r--;){var n=this[r];if(n.localName==t&&n.namespaceURI==e)return n}return null}},DOMImplementation.prototype={hasFeature:function(e,t){var r=this._features[e.toLowerCase()];return!(!r||t&&!(t in r))},createDocument:function(e,t,r){var n=new Document;if(n.implementation=this,n.childNodes=new NodeList,n.doctype=r,r&&n.appendChild(r),t){var i=n.createElementNS(e,t);n.appendChild(i)}return n},createDocumentType:function(e,t,r){var n=new DocumentType;return n.name=e,n.nodeName=e,n.publicId=t,n.systemId=r,n}},Node.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(e,t){return _insertBefore(this,e,t)},replaceChild:function(e,t){this.insertBefore(e,t),t&&this.removeChild(t)},removeChild:function(e){return _removeChild(this,e)},appendChild:function(e){return this.insertBefore(e,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(e){return _cloneNode(this.ownerDocument||this,this,e)},normalize:function(){for(var e=this.firstChild;e;){var t=e.nextSibling;t&&t.nodeType==TEXT_NODE&&e.nodeType==TEXT_NODE?(this.removeChild(t),e.appendData(t.data)):(e.normalize(),e=t)}},isSupported:function(e,t){return this.ownerDocument.implementation.hasFeature(e,t)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(e){for(var t=this;t;){var r=t._nsMap;if(r)for(var n in r)if(r[n]==e)return n;t=t.nodeType==ATTRIBUTE_NODE?t.ownerDocument:t.parentNode}return null},lookupNamespaceURI:function(e){for(var t=this;t;){var r=t._nsMap;if(r&&e in r)return r[e];t=t.nodeType==ATTRIBUTE_NODE?t.ownerDocument:t.parentNode}return null},isDefaultNamespace:function(e){return null==this.lookupPrefix(e)}},copy$8(NodeType,Node),copy$8(NodeType,Node.prototype),Document.prototype={nodeName:"#document",nodeType:DOCUMENT_NODE,doctype:null,documentElement:null,_inc:1,insertBefore:function(e,t){if(e.nodeType==DOCUMENT_FRAGMENT_NODE){for(var r=e.firstChild;r;){var n=r.nextSibling;this.insertBefore(r,t),r=n}return e}return null==this.documentElement&&e.nodeType==ELEMENT_NODE&&(this.documentElement=e),_insertBefore(this,e,t),e.ownerDocument=this,e},removeChild:function(e){return this.documentElement==e&&(this.documentElement=null),_removeChild(this,e)},importNode:function(e,t){return _importNode(this,e,t)},getElementById:function(e){var t=null;return _visitNode(this.documentElement,function(r){if(r.nodeType==ELEMENT_NODE&&r.getAttribute("id")==e)return t=r,!0}),t},createElement:function(e){var t=new Element;return t.ownerDocument=this,t.nodeName=e,t.tagName=e,t.childNodes=new NodeList,(t.attributes=new NamedNodeMap)._ownerElement=t,t},createDocumentFragment:function(){var e=new DocumentFragment;return e.ownerDocument=this,e.childNodes=new NodeList,e},createTextNode:function(e){var t=new Text;return t.ownerDocument=this,t.appendData(e),t},createComment:function(e){var t=new Comment;return t.ownerDocument=this,t.appendData(e),t},createCDATASection:function(e){var t=new CDATASection;return t.ownerDocument=this,t.appendData(e),t},createProcessingInstruction:function(e,t){var r=new ProcessingInstruction;return r.ownerDocument=this,r.tagName=r.target=e,r.nodeValue=r.data=t,r},createAttribute:function(e){var t=new Attr;return t.ownerDocument=this,t.name=e,t.nodeName=e,t.localName=e,t.specified=!0,t},createEntityReference:function(e){var t=new EntityReference;return t.ownerDocument=this,t.nodeName=e,t},createElementNS:function(e,t){var r=new Element,n=t.split(":"),i=r.attributes=new NamedNodeMap;return r.childNodes=new NodeList,r.ownerDocument=this,r.nodeName=t,r.tagName=t,r.namespaceURI=e,2==n.length?(r.prefix=n[0],r.localName=n[1]):r.localName=t,i._ownerElement=r,r},createAttributeNS:function(e,t){var r=new Attr,n=t.split(":");return r.ownerDocument=this,r.nodeName=t,r.name=t,r.namespaceURI=e,r.specified=!0,2==n.length?(r.prefix=n[0],r.localName=n[1]):r.localName=t,r}},_extends$1(Document,Node),Element.prototype={nodeType:ELEMENT_NODE,hasAttribute:function(e){return null!=this.getAttributeNode(e)},getAttribute:function(e){var t=this.getAttributeNode(e);return t&&t.value||""},getAttributeNode:function(e){return this.attributes.getNamedItem(e)},setAttribute:function(e,t){var r=this.ownerDocument.createAttribute(e);r.value=r.nodeValue=""+t,this.setAttributeNode(r)},removeAttribute:function(e){var t=this.getAttributeNode(e);t&&this.removeAttributeNode(t)},appendChild:function(e){return e.nodeType===DOCUMENT_FRAGMENT_NODE?this.insertBefore(e,null):_appendSingleChild(this,e)},setAttributeNode:function(e){return this.attributes.setNamedItem(e)},setAttributeNodeNS:function(e){return this.attributes.setNamedItemNS(e)},removeAttributeNode:function(e){return this.attributes.removeNamedItem(e.nodeName)},removeAttributeNS:function(e,t){var r=this.getAttributeNodeNS(e,t);r&&this.removeAttributeNode(r)},hasAttributeNS:function(e,t){return null!=this.getAttributeNodeNS(e,t)},getAttributeNS:function(e,t){var r=this.getAttributeNodeNS(e,t);return r&&r.value||""},setAttributeNS:function(e,t,r){var n=this.ownerDocument.createAttributeNS(e,t);n.value=n.nodeValue=""+r,this.setAttributeNode(n)},getAttributeNodeNS:function(e,t){return this.attributes.getNamedItemNS(e,t)},getElementsByTagName:function(e){return new LiveNodeList(this,function(t){var r=[];return _visitNode(t,function(n){n===t||n.nodeType!=ELEMENT_NODE||"*"!==e&&n.tagName!=e||r.push(n)}),r})},getElementsByTagNameNS:function(e,t){return new LiveNodeList(this,function(r){var n=[];return _visitNode(r,function(i){i===r||i.nodeType!==ELEMENT_NODE||"*"!==e&&i.namespaceURI!==e||"*"!==t&&i.localName!=t||n.push(i)}),n})}},Document.prototype.getElementsByTagName=Element.prototype.getElementsByTagName,Document.prototype.getElementsByTagNameNS=Element.prototype.getElementsByTagNameNS,_extends$1(Element,Node),Attr.prototype.nodeType=ATTRIBUTE_NODE,_extends$1(Attr,Node),CharacterData.prototype={data:"",substringData:function(e,t){return this.data.substring(e,e+t)},appendData:function(e){e=this.data+e,this.nodeValue=this.data=e,this.length=e.length},insertData:function(e,t){this.replaceData(e,0,t)},appendChild:function(e){throw new Error(ExceptionMessage[HIERARCHY_REQUEST_ERR])},deleteData:function(e,t){this.replaceData(e,t,"")},replaceData:function(e,t,r){r=this.data.substring(0,e)+r+this.data.substring(e+t),this.nodeValue=this.data=r,this.length=r.length}},_extends$1(CharacterData,Node),Text.prototype={nodeName:"#text",nodeType:TEXT_NODE,splitText:function(e){var t=this.data,r=t.substring(e);t=t.substring(0,e),this.data=this.nodeValue=t,this.length=t.length;var n=this.ownerDocument.createTextNode(r);return this.parentNode&&this.parentNode.insertBefore(n,this.nextSibling),n}},_extends$1(Text,CharacterData),Comment.prototype={nodeName:"#comment",nodeType:COMMENT_NODE},_extends$1(Comment,CharacterData),CDATASection.prototype={nodeName:"#cdata-section",nodeType:CDATA_SECTION_NODE},_extends$1(CDATASection,CharacterData),DocumentType.prototype.nodeType=DOCUMENT_TYPE_NODE,_extends$1(DocumentType,Node),Notation.prototype.nodeType=NOTATION_NODE,_extends$1(Notation,Node),Entity.prototype.nodeType=ENTITY_NODE,_extends$1(Entity,Node),EntityReference.prototype.nodeType=ENTITY_REFERENCE_NODE,_extends$1(EntityReference,Node),DocumentFragment.prototype.nodeName="#document-fragment",DocumentFragment.prototype.nodeType=DOCUMENT_FRAGMENT_NODE,_extends$1(DocumentFragment,Node),ProcessingInstruction.prototype.nodeType=PROCESSING_INSTRUCTION_NODE,_extends$1(ProcessingInstruction,Node),XMLSerializer.prototype.serializeToString=function(e,t,r){return nodeSerializeToString.call(e,t,r)},Node.prototype.toString=nodeSerializeToString;try{if(Object.defineProperty){var getTextContent=function e(t){switch(t.nodeType){case ELEMENT_NODE:case DOCUMENT_FRAGMENT_NODE:var r=[];for(t=t.firstChild;t;)7!==t.nodeType&&8!==t.nodeType&&r.push(e(t)),t=t.nextSibling;return r.join("");default:return t.nodeValue}};Object.defineProperty(LiveNodeList.prototype,"length",{get:function(){return _updateLiveList(this),this.$$length}}),Object.defineProperty(Node.prototype,"textContent",{get:function(){return getTextContent(this)},set:function(e){switch(this.nodeType){case ELEMENT_NODE:case DOCUMENT_FRAGMENT_NODE:for(;this.firstChild;)this.removeChild(this.firstChild);(e||String(e))&&this.appendChild(this.ownerDocument.createTextNode(e));break;default:this.data=e,this.value=e,this.nodeValue=e}}}),__set__=function(e,t,r){e["$$"+t]=r}}}catch(e){}var DOMImplementation_1=DOMImplementation,XMLSerializer_1=XMLSerializer,dom={DOMImplementation:DOMImplementation_1,XMLSerializer:XMLSerializer_1},domParser=createCommonjsModule(function(e,t){function r(e){this.options=e||{locator:{}}}function n(){this.cdata=!1}function i(e,t){t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber}function a(e){if(e)return"\n@"+(e.systemId||"")+"#[line:"+e.lineNumber+",col:"+e.columnNumber+"]"}function s(e,t,r){return"string"==typeof e?e.substr(t,r):e.length>=t+r||t?new java.lang.String(e,t,r)+"":e}function o(e,t){e.currentElement?e.currentElement.appendChild(t):e.doc.appendChild(t)}r.prototype.parseFromString=function(e,t){var r=this.options,i=new l,s=r.domBuilder||new n,o=r.errorHandler,u=r.locator,c=r.xmlns||{},h={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return u&&s.setDocumentLocator(u),i.errorHandler=function(e,t,r){if(!e){if(t instanceof n)return t;e=t}var i={},s=e instanceof Function;function o(t){var n=e[t];!n&&s&&(n=2==e.length?function(r){e(t,r)}:e),i[t]=n&&function(e){n("[xmldom "+t+"]\t"+e+a(r))}||function(){}}return r=r||{},o("warning"),o("error"),o("fatalError"),i}(o,s,u),i.domBuilder=r.domBuilder||s,/\/x?html?$/.test(t)&&(h.nbsp=" ",h.copy="©",c[""]="http://www.w3.org/1999/xhtml"),c.xml=c.xml||"http://www.w3.org/XML/1998/namespace",e?i.parse(e,c,h):i.errorHandler.error("invalid doc source"),s.doc},n.prototype={startDocument:function(){this.doc=(new u).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(e,t,r,n){var a=this.doc,s=a.createElementNS(e,r||t),l=n.length;o(this,s),this.currentElement=s,this.locator&&i(this.locator,s);for(var u=0;u<l;u++){e=n.getURI(u);var c=n.getValue(u),h=(r=n.getQName(u),a.createAttributeNS(e,r));this.locator&&i(n.getLocator(u),h),h.value=h.nodeValue=c,s.setAttributeNode(h)}},endElement:function(e,t,r){var n=this.currentElement;n.tagName;this.currentElement=n.parentNode},startPrefixMapping:function(e,t){},endPrefixMapping:function(e){},processingInstruction:function(e,t){var r=this.doc.createProcessingInstruction(e,t);this.locator&&i(this.locator,r),o(this,r)},ignorableWhitespace:function(e,t,r){},characters:function(e,t,r){if(e=s.apply(this,arguments)){if(this.cdata)var n=this.doc.createCDATASection(e);else n=this.doc.createTextNode(e);this.currentElement?this.currentElement.appendChild(n):/^\s*$/.test(e)&&this.doc.appendChild(n),this.locator&&i(this.locator,n)}},skippedEntity:function(e){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(e){(this.locator=e)&&(e.lineNumber=0)},comment:function(e,t,r){e=s.apply(this,arguments);var n=this.doc.createComment(e);this.locator&&i(this.locator,n),o(this,n)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(e,t,r){var n=this.doc.implementation;if(n&&n.createDocumentType){var a=n.createDocumentType(e,t,r);this.locator&&i(this.locator,a),o(this,a)}},warning:function(e){console.warn("[xmldom warning]\t"+e,a(this.locator))},error:function(e){console.error("[xmldom error]\t"+e,a(this.locator))},fatalError:function(e){throw console.error("[xmldom fatalError]\t"+e,a(this.locator)),e}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(e){n.prototype[e]=function(){return null}});var l=sax.XMLReader,u=t.DOMImplementation=dom.DOMImplementation;t.XMLSerializer=dom.XMLSerializer,t.DOMParser=r}),domParser_1=domParser.DOMImplementation,domParser_2=domParser.XMLSerializer,domParser_3=domParser.DOMParser,fieldTagNames={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams"},key,fieldTags={};for(key in fieldTagNames)fieldTags[fieldTagNames[key]]=parseInt(key);var arrayFields=[fieldTags.BitsPerSample,fieldTags.ExtraSamples,fieldTags.SampleFormat,fieldTags.StripByteCounts,fieldTags.StripOffsets,fieldTags.StripRowCounts,fieldTags.TileByteCounts,fieldTags.TileOffsets],fieldTypeNames={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",16:"LONG8",17:"SLONG8",18:"IFD8"},fieldTypes={};for(key in fieldTypeNames)fieldTypes[fieldTypeNames[key]]=parseInt(key);var photometricInterpretations={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},geoKeyNames={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"},geoKeys={},parseXml;for(key in geoKeyNames)geoKeys[geoKeyNames[key]]=parseInt(key);"undefined"==typeof window?parseXml=function(e){return(new(0,domParser.DOMParser)).parseFromString(e,"text/xml")}:void 0!==window.DOMParser?parseXml=function(e){return(new window.DOMParser).parseFromString(e,"text/xml")}:void 0!==window.ActiveXObject&&new window.ActiveXObject("Microsoft.XMLDOM")&&(parseXml=function(e){var t=new window.ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(e),t});var globals={fieldTags:fieldTags,fieldTagNames:fieldTagNames,arrayFields:arrayFields,fieldTypes:fieldTypes,fieldTypeNames:fieldTypeNames,photometricInterpretations:photometricInterpretations,geoKeys:geoKeys,geoKeyNames:geoKeyNames,parseXml:parseXml};function fromWhiteIsZero(e,t,r,n){for(var i,a=new Uint8Array(r*n*3),s=0,o=0;s<e.length;++s,o+=3)i=256-e[s]/t*256,a[o]=i,a[o+1]=i,a[o+2]=i;return a}function fromBlackIsZero(e,t,r,n){for(var i,a=new Uint8Array(r*n*3),s=0,o=0;s<e.length;++s,o+=3)i=e[s]/t*256,a[o]=i,a[o+1]=i,a[o+2]=i;return a}function fromPalette(e,t,r,n){for(var i=new Uint8Array(r*n*3),a=t.length/3,s=t.length/3*2,o=0,l=0;o<e.length;++o,l+=3){var u=e[o];i[l]=t[u]/65536*256,i[l+1]=t[u+a]/65536*256,i[l+2]=t[u+s]/65536*256}return i}function fromCMYK(e,t,r){for(var n,i,a,s,o=new Uint8Array(t*r*3),l=0,u=0;l<e.length;l+=4,u+=3)n=e[l],i=e[l+1],a=e[l+2],s=e[l+3],o[u]=(255-n)/256*255*((255-s)/256),o[u+1]=(255-i)/256*255*((255-s)/256),o[u+2]=(255-a)/256*255*((255-s)/256);return o}function fromYCbCr(e,t,r){for(var n,i,a,s=new Uint8Array(t*r*3),o=0,l=0;o<e.length;o+=3,l+=3)n=e[o],i=e[o+1],a=e[o+2],s[l]=n+1.402*(a-128),s[l+1]=n-.34414*(i-128)-.71414*(a-128),s[l+2]=n+1.772*(i-128);return s}function fromCIELab(e,t,r){for(var n,i,a,s,o,l,u,c,h,f,d,p,g=[3.240479,-1.53715,-.498535,-.969256,1.875992,.041556,.055648,-.204043,1.057311],_=new Uint8Array(t*r*3),y=0,m=0;y<e.length;y+=3,m+=3)n=e[y],i=e[y+1],a=e[y+2],d=o=(0!==(c=(o=Math.pow((n+16)/116,3))>.008856))*(n/903.3)+c*o,f=(u=(s=i/500+(o=c*Math.pow(o,1/3)+(0!==c)*(7.787*o+16/116)))>.206893)*Math.pow(s,3)+(0!==u)*((s-16/116)/7.787),p=(h=(l=o-a/200)>.206893)*Math.pow(l,3)+(0!==h)*((l-16/116)/7.787),f*=.950456,p*=1.088754,_[m]=f*g[0]+d*g[1]+p*g[2],_[m+1]=f*g[3]+d*g[4]+p*g[5],_[m+2]=f*g[6]+d*g[7]+p*g[8];return _}var rgb={fromWhiteIsZero:fromWhiteIsZero,fromBlackIsZero:fromBlackIsZero,fromPalette:fromPalette,fromCMYK:fromCMYK,fromYCbCr:fromYCbCr,fromCIELab:fromCIELab};function AbstractDecoder(){}AbstractDecoder.prototype={isAsync:function(){return void 0===this.decodeBlock}};var abstractdecoder=AbstractDecoder;function RawDecoder(){}RawDecoder.prototype=Object.create(abstractdecoder.prototype),RawDecoder.prototype.constructor=RawDecoder,RawDecoder.prototype.decodeBlock=function(e){return e};var raw=RawDecoder,MIN_BITS=9,MAX_BITS$2=12,CLEAR_CODE=256,EOI_CODE=257;function LZW(){this.littleEndian=!1,this.position=0,this._makeEntryLookup=!1,this.dictionary=[]}function LZWDecoder(){this.decompressor=new LZW}LZW.prototype={constructor:LZW,initDictionary:function(){this.dictionary=new Array(258),this.entryLookup={},this.byteLength=MIN_BITS;for(var e=0;e<=257;e++)this.dictionary[e]=[e],this._makeEntryLookup&&(this.entryLookup[e]=e)},decompress:function(e){this._makeEntryLookup=!1,this.initDictionary(),this.position=0,this.result=[],e.buffer||(e=new Uint8Array(e));for(var t,r=new DataView(e.buffer),n=this.getNext(r);n!==EOI_CODE;){if(n===CLEAR_CODE){for(this.initDictionary(),n=this.getNext(r);n===CLEAR_CODE;)n=this.getNext(r);if(n>CLEAR_CODE)throw"corrupted code at scanline "+n;if(n===EOI_CODE)break;var i=this.dictionary[n];this.appendArray(this.result,i),t=n}else if(void 0!==this.dictionary[n]){var a=this.dictionary[n];this.appendArray(this.result,a);var s=this.dictionary[t].concat(this.dictionary[n][0]);this.addToDictionary(s),t=n}else{var o=this.dictionary[t];if(!o)throw"Bogus entry. Not in dictionary, "+t+" / "+this.dictionary.length+", position: "+this.position;var l=o.concat(this.dictionary[t][0]);this.appendArray(this.result,l),this.addToDictionary(l),t=n}this.dictionary.length>=Math.pow(2,this.byteLength)-1&&this.byteLength++,n=this.getNext(r)}return new Uint8Array(this.result)},appendArray:function(e,t){for(var r=0;r<t.length;r++)e.push(t[r]);return e},haveBytesChanged:function(){return this.dictionary.length>=Math.pow(2,this.byteLength)&&(this.byteLength++,!0)},addToDictionary:function(e){return this.dictionary.push(e),this._makeEntryLookup&&(this.entryLookup[e]=this.dictionary.length-1),this.haveBytesChanged(),this.dictionary.length-1},getNext:function(e){var t=this.getByte(e,this.position,this.byteLength);return this.position+=this.byteLength,t},getByte:function(e,t,r){var n=t%8,i=Math.floor(t/8),a=8-n,s=t+r-8*(i+1),o=8*(i+2)-(t+r),l=8*(i+2)-t;if(o=Math.max(0,o),i>=e.byteLength)return console.warn("ran off the end of the buffer before finding EOI_CODE (end on input code)"),EOI_CODE;var u=e.getUint8(i,this.littleEndian)&Math.pow(2,8-n)-1,c=u<<=r-a;if(i+1<e.byteLength){var h=e.getUint8(i+1,this.littleEndian)>>>o;c+=h<<=Math.max(0,r-l)}if(s>8&&i+2<e.byteLength){var f=8*(i+3)-(t+r);c+=e.getUint8(i+2,this.littleEndian)>>>f}return c},compress:function(e){this._makeEntryLookup=!0,this.initDictionary(),this.position=0;var t=[],r=[];t=this.appendArray(t,this.binaryFromByte(CLEAR_CODE,this.byteLength));for(var n=0;n<e.length;n++){var i=[e[n]],a=r.concat(i);if(void 0!==this.entryLookup[a])r=a;else{var s=this.entryLookup[r],o=this.binaryFromByte(s,this.byteLength);t=this.appendArray(t,o),this.addToDictionary(a),r=i,this.dictionary.length>=Math.pow(2,MAX_BITS$2)&&(t=this.appendArray(t,this.binaryFromByte(CLEAR_CODE,this.byteLength)),this.initDictionary())}}var l=this.entryLookup[r],u=this.binaryFromByte(l,this.byteLength);return t=this.appendArray(t,u),t=t=this.appendArray(t,this.binaryFromByte(EOI_CODE,this.byteLength)),this.binary=t,this.result=this.binaryToUint8(t),this.result},byteFromCode:function(e){return this.dictionary[e]},binaryFromByte:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,r=new Uint8Array(t),n=0;n<r.length;n++){var i=(e&Math.pow(2,n))>0;r[r.length-1-n]=i}return r},binaryToNumber:function(e){for(var t=0,r=0;r<e.length;r++)t+=Math.pow(2,e.length-r-1)*e[r];return t},inputToBinary:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,r=new Uint8Array(e.length*t),n=0;n<e.length;n++){var i=this.binaryFromByte(e[n],t);r.set(i,n*t)}return r},binaryToUint8:function(e){for(var t=new Uint8Array(Math.ceil(e.length/8)),r=0,n=0;n<e.length;n+=8){for(var i=0,a=0;a<8&&n+a<e.length;a++)i+=e[n+a]*Math.pow(2,8-a-1);t[r]=i,r++}return t}},LZWDecoder.prototype=Object.create(abstractdecoder.prototype),LZWDecoder.prototype.constructor=LZWDecoder,LZWDecoder.prototype.decodeBlock=function(e){return this.decompressor.decompress(e).buffer};var lzw=LZWDecoder,pakoInflate=inflate_1$1.inflate;function DeflateDecoder(){}DeflateDecoder.prototype=Object.create(abstractdecoder.prototype),DeflateDecoder.prototype.constructor=DeflateDecoder,DeflateDecoder.prototype.decodeBlock=function(e){return pakoInflate(new Uint8Array(e)).buffer};var deflate$2=DeflateDecoder;function PackbitsDecoder(){}PackbitsDecoder.prototype=Object.create(abstractdecoder.prototype),PackbitsDecoder.prototype.constructor=PackbitsDecoder,PackbitsDecoder.prototype.decodeBlock=function(e){var t,r,n=new DataView(e),i=[];for(t=0;t<e.byteLength;++t){var a=n.getInt8(t);if(a<0){var s=n.getUint8(t+1);for(a=-a,r=0;r<=a;++r)i.push(s);t+=1}else{for(r=0;r<=a;++r)i.push(n.getUint8(t+r+1));t+=a+1}}return new Uint8Array(i).buffer};var packbits=PackbitsDecoder,sum=function(e,t,r){for(var n=0,i=t;i<r;++i)n+=e[i];return n},arrayForType=function(e,t,r){switch(e){case 1:switch(t){case 8:return new Uint8Array(r);case 16:return new Uint16Array(r);case 32:return new Uint32Array(r)}break;case 2:switch(t){case 8:return new Int8Array(r);case 16:return new Int16Array(r);case 32:return new Int32Array(r)}break;case 3:switch(t){case 32:return new Float32Array(r);case 64:return new Float64Array(r)}}throw Error("Unsupported data format/bitsPerSample")};function GeoTIFFImage(e,t,r,n,i){this.fileDirectory=e,this.geoKeys=t,this.dataView=r,this.littleEndian=n,this.tiles=i?{}:null,this.isTiled=!e.StripOffsets;var a=e.PlanarConfiguration;if(this.planarConfiguration=void 0===a?1:a,1!==this.planarConfiguration&&2!==this.planarConfiguration)throw new Error("Invalid planar configuration.");switch(this.fileDirectory.Compression){case void 0:case 1:this.decoder=new raw;break;case 5:this.decoder=new lzw;break;case 6:throw new Error("JPEG compression not supported.");case 8:this.decoder=new deflate$2;break;case 32773:this.decoder=new packbits;break;default:throw new Error("Unknown compresseion method identifier: "+this.fileDirectory.Compression)}}GeoTIFFImage.prototype={getFileDirectory:function(){return this.fileDirectory},getGeoKeys:function(){return this.geoKeys},getWidth:function(){return this.fileDirectory.ImageWidth},getHeight:function(){return this.fileDirectory.ImageLength},getSamplesPerPixel:function(){return this.fileDirectory.SamplesPerPixel},getTileWidth:function(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()},getTileHeight:function(){return this.isTiled?this.fileDirectory.TileLength:this.fileDirectory.RowsPerStrip},getBytesPerPixel:function(){for(var e=0,t=0;t<this.fileDirectory.BitsPerSample.length;++t){var r=this.fileDirectory.BitsPerSample[t];if(r%8!=0)throw new Error("Sample bit-width of "+r+" is not supported.");if(r!==this.fileDirectory.BitsPerSample[0])throw new Error("Differing size of samples in a pixel are not supported.");e+=r}return e/8},getSampleByteSize:function(e){if(e>=this.fileDirectory.BitsPerSample.length)throw new RangeError("Sample index "+e+" is out of range.");var t=this.fileDirectory.BitsPerSample[e];if(t%8!=0)throw new Error("Sample bit-width of "+t+" is not supported.");return t/8},getReaderForSample:function(e){var t=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,r=this.fileDirectory.BitsPerSample[e];switch(t){case 1:switch(r){case 8:return DataView.prototype.getUint8;case 16:return DataView.prototype.getUint16;case 32:return DataView.prototype.getUint32}break;case 2:switch(r){case 8:return DataView.prototype.getInt8;case 16:return DataView.prototype.getInt16;case 32:return DataView.prototype.getInt32}break;case 3:switch(r){case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}}},getArrayForSample:function(e,t){var r=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,n=this.fileDirectory.BitsPerSample[e];return arrayForType(r,n,t)},getDecoder:function(){return this.decoder},getTileOrStrip:function(e,t,r,n){var i,a,s,o=Math.ceil(this.getWidth()/this.getTileWidth()),l=Math.ceil(this.getHeight()/this.getTileHeight()),u=this.tiles;if(1===this.planarConfiguration?i=t*o+e:2===this.planarConfiguration&&(i=r*o*l+t*o+e),null!==u&&i in u)return n?n(null,{x:e,y:t,sample:r,data:u[i]}):u[i];this.isTiled?(a=this.fileDirectory.TileOffsets[i],s=this.fileDirectory.TileByteCounts[i]):(a=this.fileDirectory.StripOffsets[i],s=this.fileDirectory.StripByteCounts[i]);var c=this.dataView.buffer.slice(a,a+s);if(n)return this.getDecoder().decodeBlockAsync(c,function(a,s){a||null===u||(u[i]=s),n(a,{x:e,y:t,sample:r,data:s})});var h=this.getDecoder().decodeBlock(c);return null!==u&&(u[i]=h),h},_readRasterAsync:function(e,t,r,n,i,a){for(var s=this.getTileWidth(),o=this.getTileHeight(),l=Math.floor(e[0]/s),u=Math.ceil(e[2]/s),c=Math.floor(e[1]/o),h=Math.ceil(e[3]/o),f=(Math.ceil(this.getWidth()/s),e[2]-e[0]),d=(e[3],e[1],this.getBytesPerPixel()),p=(this.getWidth(),this.fileDirectory.Predictor||1),g=[],_=[],y=0;y<t.length;++y)1===this.planarConfiguration?g.push(sum(this.fileDirectory.BitsPerSample,0,t[y])/8):g.push(0),_.push(this.getReaderForSample(t[y]));var m=!1,v=0,b=this.littleEndian,w=null;function E(){m&&0===v&&(w?a(w):i(r))}function T(i,a){if(i)w=i;else for(var l=new DataView(a.data),u=a.y*o,c=a.x*s,h=(a.y+1)*o,y=(a.x+1)*s,m=a.sample,T=Math.max(0,e[1]-u);T<Math.min(o,o-(h-e[3]));++T)for(var k=Math.max(0,e[0]-c);k<Math.min(s,s-(y-e[2]));++k){var x,S=(T*s+k)*d,I=_[m].call(l,S+g[m],b);n?(1!==p&&k>0&&(x=(T+u-e[1])*f*t.length+(k+c-e[0]-1)*t.length+m,I+=r[x]),x=(T+u-e[1])*f*t.length+(k+c-e[0])*t.length+m,r[x]=I):(1!==p&&k>0&&(x=(T+u-e[1])*f+k-1+c-e[0],I+=r[m][x]),x=(T+u-e[1])*f+k+c-e[0],r[m][x]=I)}v-=1,E()}for(var k=c;k<=h;++k)for(var x=l;x<=u;++x)for(var S=0;S<t.length;++S){var I=t[S];2===this.planarConfiguration&&(d=this.getSampleByteSize(I)),v+=1,this.getTileOrStrip(x,k,I,T)}m=!0,E()},_readRaster:function(e,t,r,n,i,a){try{for(var s=this.getTileWidth(),o=this.getTileHeight(),l=Math.floor(e[0]/s),u=Math.ceil(e[2]/s),c=Math.floor(e[1]/o),h=Math.ceil(e[3]/o),f=(Math.ceil(this.getWidth()/s),e[2]-e[0]),d=(e[3],e[1],this.getBytesPerPixel()),p=(this.getWidth(),this.fileDirectory.Predictor||1),g=[],_=[],y=0;y<t.length;++y)1===this.planarConfiguration?g.push(sum(this.fileDirectory.BitsPerSample,0,t[y])/8):g.push(0),_.push(this.getReaderForSample(t[y]));for(var m=c;m<h;++m)for(var v=l;v<u;++v)for(var b=m*o,w=v*s,E=(m+1)*o,T=(v+1)*s,k=0;k<t.length;++k){var x=t[k];2===this.planarConfiguration&&(d=this.getSampleByteSize(x));var S=new DataView(this.getTileOrStrip(v,m,x)),I=_[k],A=Math.min(o,o-(E-e[3])),M=Math.min(s,s-(T-e[2])),N=(A*s+M)*d,C=new Uint8Array(S.buffer).length;2*C!==N&&this._debugMessages&&console.warn("dimension mismatch",C,N);for(var O=Math.max(0,e[1]-b);O<A;++O)for(var D=Math.max(0,e[0]-w);D<M;++D){var R,B=(O*s+D)*d,F=0;B<C-1&&(F=I.call(S,B+g[k],this.littleEndian)),n?(1!==p&&D>0&&(F+=r[R=(O+b-e[1])*f*t.length+(D+w-e[0]-1)*t.length+k]),r[R=(O+b-e[1])*f*t.length+(D+w-e[0])*t.length+k]=F):(1!==p&&D>0&&(R=(O+b-e[1])*f+D-1+w-e[0],F+=r[k][R]),R=(O+b-e[1])*f+D+w-e[0],r[k][R]=F)}}return i(r),r}catch(e){return a(e)}},readRasters:function(){var e,t,r;switch(arguments.length){case 0:break;case 1:"function"==typeof arguments[0]?t=arguments[0]:e=arguments[0];break;case 2:"function"==typeof arguments[0]?(t=arguments[0],r=arguments[1]):(e=arguments[0],t=arguments[1]);break;case 3:e=arguments[0],t=arguments[1],r=arguments[2];break;default:throw new Error("Invalid number of arguments passed.")}e=e||{},r=r||function(e){console.error(e)};var n=e.window||[0,0,this.getWidth(),this.getHeight()],i=e.samples,a=e.interleave;if(n[0]<0||n[1]<0||n[2]>this.getWidth()||n[3]>this.getHeight())throw new Error("Select window is out of image bounds.");if(n[0]>n[2]||n[1]>n[3])throw new Error("Invalid subsets");var s,o,l=(n[2]-n[0])*(n[3]-n[1]);if(i){for(s=0;s<i.length;++s)if(i[s]>=this.fileDirectory.SamplesPerPixel)throw new RangeError("Invalid sample index '"+i[s]+"'.")}else for(i=[],s=0;s<this.fileDirectory.SamplesPerPixel;++s)i.push(s);if(a){var u=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,c=Math.max.apply(null,this.fileDirectory.BitsPerSample);o=arrayForType(u,c,l*i.length)}else for(o=[],s=0;s<i.length;++s)o.push(this.getArrayForSample(i[s],l));if(this.getDecoder().isAsync()){if(!t)throw new Error("No callback specified for asynchronous raster reading.");return this._readRasterAsync(n,i,o,a,t,r)}return t=t||function(){},this._readRaster(n,i,o,a,t,r)},readRGB:function(){var e=null,t=null,r=null;switch(arguments.length){case 0:break;case 1:"function"==typeof arguments[0]?t=arguments[0]:e=arguments[0];break;case 2:"function"==typeof arguments[0]?(t=arguments[0],r=arguments[1]):(e=arguments[0],t=arguments[1]);break;case 3:e=arguments[0],t=arguments[1],r=arguments[2];break;default:throw new Error("Invalid number of arguments passed.")}e=e||{},r=r||function(e){console.error(e)};var n=e.window||[0,0,this.getWidth(),this.getHeight()];if(n[0]<0||n[1]<0||n[2]>this.getWidth()||n[3]>this.getHeight())throw new Error("Select window is out of image bounds.");if(n[0]>n[2]||n[1]>n[3])throw new Error("Invalid subsets");var i,a=n[2]-n[0],s=n[3]-n[1],o=this.fileDirectory.PhotometricInterpretation,l=this.fileDirectory.BitsPerSample[0],u=Math.pow(2,l);if(o===globals.photometricInterpretations.RGB)return this.readRasters({window:e.window,interleave:!0},t,r);switch(o){case globals.photometricInterpretations.WhiteIsZero:case globals.photometricInterpretations.BlackIsZero:case globals.photometricInterpretations.Palette:i=[0];break;case globals.photometricInterpretations.CMYK:i=[0,1,2,3];break;case globals.photometricInterpretations.YCbCr:case globals.photometricInterpretations.CIELab:i=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}var c={window:e.window,interleave:!0,samples:i},h=this.fileDirectory;return this.readRasters(c,function(e){switch(o){case globals.photometricInterpretations.WhiteIsZero:return t(rgb.fromWhiteIsZero(e,u,a,s));case globals.photometricInterpretations.BlackIsZero:return t(rgb.fromBlackIsZero(e,u,a,s));case globals.photometricInterpretations.Palette:return t(rgb.fromPalette(e,h.ColorMap,a,s));case globals.photometricInterpretations.CMYK:return t(rgb.fromCMYK(e,a,s));case globals.photometricInterpretations.YCbCr:return t(rgb.fromYCbCr(e,a,s));case globals.photometricInterpretations.CIELab:return t(rgb.fromCIELab(e,a,s))}},r)},getTiePoints:function(){if(!this.fileDirectory.ModelTiepoint)return[];for(var e=[],t=0;t<this.fileDirectory.ModelTiepoint.length;t+=6)e.push({i:this.fileDirectory.ModelTiepoint[t],j:this.fileDirectory.ModelTiepoint[t+1],k:this.fileDirectory.ModelTiepoint[t+2],x:this.fileDirectory.ModelTiepoint[t+3],y:this.fileDirectory.ModelTiepoint[t+4],z:this.fileDirectory.ModelTiepoint[t+5]});return e},getGDALMetadata:function(){var e={};if(!this.fileDirectory.GDAL_METADATA)return null;for(var t=this.fileDirectory.GDAL_METADATA,r=globals.parseXml(t.substring(0,t.length-1)),n=r.evaluate("GDALMetadata/Item",r,null,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,null),i=0;i<n.snapshotLength;++i){var a=n.snapshotItem(i);e[a.getAttribute("name")]=a.textContent}return e},getOrigin:function(){var e=this.fileDirectory.ModelTiepoint;if(!e||6!==e.length)throw new Error("The image does not have an affine transformation.");return[e[3],e[4],e[5]]},getResolution:function(){if(!this.fileDirectory.ModelPixelScale)throw new Error("The image does not have an affine transformation.");return[this.fileDirectory.ModelPixelScale[0],this.fileDirectory.ModelPixelScale[1],this.fileDirectory.ModelPixelScale[2]]},pixelIsArea:function(){return 1===this.geoKeys.GTRasterTypeGeoKey},getBoundingBox:function(){var e=this.getOrigin(),t=this.getResolution(),r=e[0],n=e[1],i=r+t[0]*this.getWidth(),a=n+t[1]*this.getHeight();return[Math.min(r,i),Math.min(n,a),Math.max(r,i),Math.max(n,a)]}};var geotiffimage=GeoTIFFImage,_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var DataView64=function(){function e(t){_classCallCheck(this,e),this._dataView=new DataView(t)}return _createClass(e,[{key:"getUint64",value:function(e,t){var r=this.getUint32(e,t),n=this.getUint32(e+4,t);return t?r<<32|n:n<<32|r}},{key:"getInt64",value:function(e,t){var r;return t?(r=this.getInt32(e,t))<<32|this.getUint32(e+4,t):(r=this.getUint32(e,t),this.getInt32(e+4,t)<<32|r)}},{key:"getUint8",value:function(e,t){return this._dataView.getUint8(e,t)}},{key:"getInt8",value:function(e,t){return this._dataView.getInt8(e,t)}},{key:"getUint16",value:function(e,t){return this._dataView.getUint16(e,t)}},{key:"getInt16",value:function(e,t){return this._dataView.getInt16(e,t)}},{key:"getUint32",value:function(e,t){return this._dataView.getUint32(e,t)}},{key:"getInt32",value:function(e,t){return this._dataView.getInt32(e,t)}},{key:"getFloat32",value:function(e,t){return this._dataView.getFloat32(e,t)}},{key:"getFloat64",value:function(e,t){return this._dataView.getFloat64(e,t)}},{key:"buffer",get:function(){return this._dataView.buffer}}]),e}(),dataview64=DataView64,fieldTypes$1=globals.fieldTypes,fieldTagNames$1=globals.fieldTagNames,arrayFields$1=globals.arrayFields,geoKeyNames$1=globals.geoKeyNames;function GeoTIFF(e,t){this.dataView=new dataview64(e),t=t||{},this.cache=t.cache||!1;var r=this.dataView.getUint16(0,0);if(18761===r)this.littleEndian=!0;else{if(19789!==r)throw new TypeError("Invalid byte order value.");this.littleEndian=!1}var n=this.dataView.getUint16(2,this.littleEndian);if(42===this.dataView.getUint16(2,this.littleEndian))this.bigTiff=!1;else{if(43!==n)throw new TypeError("Invalid magic number.");if(this.bigTiff=!0,8!==this.dataView.getUint16(4,this.littleEndian))throw new Error("Unsupported offset byte-size.")}this.fileDirectories=this.parseFileDirectories(this.getOffset(this.bigTiff?8:4))}GeoTIFF.prototype={getOffset:function(e){return this.bigTiff?this.dataView.getUint64(e,this.littleEndian):this.dataView.getUint32(e,this.littleEndian)},getFieldTypeLength:function(e){switch(e){case fieldTypes$1.BYTE:case fieldTypes$1.ASCII:case fieldTypes$1.SBYTE:case fieldTypes$1.UNDEFINED:return 1;case fieldTypes$1.SHORT:case fieldTypes$1.SSHORT:return 2;case fieldTypes$1.LONG:case fieldTypes$1.SLONG:case fieldTypes$1.FLOAT:return 4;case fieldTypes$1.RATIONAL:case fieldTypes$1.SRATIONAL:case fieldTypes$1.DOUBLE:case fieldTypes$1.LONG8:case fieldTypes$1.SLONG8:case fieldTypes$1.IFD8:return 8;default:throw new RangeError("Invalid field type: "+e)}},getValues:function(e,t,r){var n,i=null,a=null,s=this.getFieldTypeLength(e);switch(e){case fieldTypes$1.BYTE:case fieldTypes$1.ASCII:case fieldTypes$1.UNDEFINED:i=new Uint8Array(t),a=this.dataView.getUint8;break;case fieldTypes$1.SBYTE:i=new Int8Array(t),a=this.dataView.getInt8;break;case fieldTypes$1.SHORT:i=new Uint16Array(t),a=this.dataView.getUint16;break;case fieldTypes$1.SSHORT:i=new Int16Array(t),a=this.dataView.getInt16;break;case fieldTypes$1.LONG:i=new Uint32Array(t),a=this.dataView.getUint32;break;case fieldTypes$1.SLONG:i=new Int32Array(t),a=this.dataView.getInt32;break;case fieldTypes$1.LONG8:case fieldTypes$1.IFD8:i=new Array(t),a=this.dataView.getUint64;break;case fieldTypes$1.SLONG8:i=new Array(t),a=this.dataView.getInt64;break;case fieldTypes$1.RATIONAL:i=new Uint32Array(2*t),a=this.dataView.getUint32;break;case fieldTypes$1.SRATIONAL:i=new Int32Array(2*t),a=this.dataView.getInt32;break;case fieldTypes$1.FLOAT:i=new Float32Array(t),a=this.dataView.getFloat32;break;case fieldTypes$1.DOUBLE:i=new Float64Array(t),a=this.dataView.getFloat64;break;default:throw new RangeError("Invalid field type: "+e)}if(e!==fieldTypes$1.RATIONAL&&e!==fieldTypes$1.SRATIONAL)for(n=0;n<t;++n)i[n]=a.call(this.dataView,r+n*s,this.littleEndian);else for(n=0;n<t;n+=2)i[n]=a.call(this.dataView,r+n*s,this.littleEndian),i[n+1]=a.call(this.dataView,r+(n*s+4),this.littleEndian);return e===fieldTypes$1.ASCII?String.fromCharCode.apply(null,i):i},getFieldValues:function(e,t,r,n){var i;if(this.getFieldTypeLength(t)*r<=(this.bigTiff?8:4))i=this.getValues(t,r,n);else{var a=this.getOffset(n);i=this.getValues(t,r,a)}return 1===r&&-1===arrayFields$1.indexOf(e)&&t!==fieldTypes$1.RATIONAL&&t!==fieldTypes$1.SRATIONAL?i[0]:i},parseGeoKeyDirectory:function(e){var t=e.GeoKeyDirectory;if(!t)return null;for(var r={},n=4;n<4*t[3];n+=4){var i=geoKeyNames$1[t[n]],a=t[n+1]?fieldTagNames$1[t[n+1]]:null,s=t[n+2],o=t[n+3],l=null;if(a){if(void 0===(l=e[a])||null===l)throw new Error("Could not get value of geoKey '"+i+"'.");"string"==typeof l?l=l.substring(o,o+s-1):l.subarray&&(l=l.subarray(o,o+s-1))}else l=o;r[i]=l}return r},parseFileDirectories:function(e){for(var t=e,r=[];0!==t;){for(var n=this.bigTiff?this.dataView.getUint64(t,this.littleEndian):this.dataView.getUint16(t,this.littleEndian),i={},a=t+(this.bigTiff?8:2),s=0;s<n;a+=this.bigTiff?20:12,++s){var o=this.dataView.getUint16(a,this.littleEndian),l=this.dataView.getUint16(a+2,this.littleEndian),u=this.bigTiff?this.dataView.getUint64(a+4,this.littleEndian):this.dataView.getUint32(a+4,this.littleEndian);i[fieldTagNames$1[o]]=this.getFieldValues(o,l,u,a+(this.bigTiff?12:8))}r.push([i,this.parseGeoKeyDirectory(i)]),t=this.getOffset(a)}return r},getImage:function(e){e=e||0;var t=this.fileDirectories[e];if(!t)throw new RangeError("Invalid image index");return new geotiffimage(t[0],t[1],this.dataView,this.littleEndian,this.cache)},getImageCount:function(){return this.fileDirectories.length}};var geotiff=GeoTIFF,main=createCommonjsModule(function(e){var t=function(e,t){var r,n,i,a;if("string"==typeof e||e instanceof String)for(r=new ArrayBuffer(2*e.length),a=new Uint16Array(r),n=0,i=e.length;n<i;++n)a[n]=e.charCodeAt(n);else{if(!(e instanceof ArrayBuffer))throw new Error("Invalid input data given.");r=e}return new geotiff(r,t)};e.exports.parse=t,"undefined"!=typeof window&&(window.GeoTIFF={parse:t})}),main_1=main.parse,TiffDecoder=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setMetadata("targetType",Image2D.name),e.addInputValidator(0,ArrayBuffer),e}return inherits(t,Decoder),createClass(t,[{key:"_run",value:function(){var e=this._getInput(0);if(e){var t=!1;try{var r=main.parse(e).getImage(),n=r.readRasters({interleave:!0}),i=r.getWidth(),a=r.getHeight(),s=r.getSamplesPerPixel();if(s==n.length/(i*a)&&(t=!0),t)this._addOutput(Image2D).setData(n,i,a,s);else console.warn("Tiff support is experimental and this file is not compatible.")}catch(e){console.warn("This buffer is not from a TIFF file.")}}else console.warn('TiffDecoder requires an ArrayBuffer as input "0". Unable to continue.')}}]),t}(),qeegmodfile_umd=createCommonjsModule(function(e,t){!function(e){var t=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),n=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},i=function(){function e(){t(this,e),this._rawData=null}return r(e,[{key:"setRawData",value:function(e){this._rawData=e}},{key:"parse",value:function(){var e=null;try{e=this._parseNoException()}catch(e){console.warn("This file is not compatible.")}return e}},{key:"_parseNoException",value:function(){if(!this._rawData)return console.warn("The input buffer is null. Nothing to be parsed here."),null;var e=this._rawData,t=new DataView(e),r={};r.protectionMask=t.getUint16(0,!0);var i=t.getUint8(2),a=new Uint8Array(e,3,i);r.comment=String.fromCharCode.apply(String,a),r.measureSize=t.getUint16(83,!0),r.durationSize=t.getUint16(85,!0),r.firstSpaceSize=t.getUint16(87,!0),r.secondSpaceSize=t.getUint16(89,!0),r.reservedBytes=t.getUint16(91,!0),r.dataSize=t.getUint16(93,!0);for(var s=r.measureSize*r.durationSize*r.firstSpaceSize*r.secondSpaceSize,o=s*r.dataSize,l=new Float32Array(s),u=0;u<s;u++)l[u]=t.getFloat32(95+u*r.dataSize,!0);for(var c=95+o,h=c+r.reservedBytes,f=t.getUint8(h),d=new Uint8Array(e,h+1,f),p=(String.fromCharCode.apply(String,d),h+9),g=new Array(8),u=0;u<8;u++){var _={total:t.getUint16(p+6*u+4,!0),labels:null};g[u]=_}g[0].description="list of labels for measure dimension",g[1].description="list of labels for duration dimension",g[2].description="list of labels for first space dimension",g[3].description="list of labels for second space dimension",g[4].description="list of scales",g[5].description="list of units",g[6].description="list of transformations",g[7].description="list of contexts";for(var y=p+48,m=y,u=0;u<g.length-2;u++){var v=g[u].total;g[u].labels=v?new Array(v).fill(""):0;for(var b=0;b<v;b++){var w=t.getUint8(m);if(w){var E=new Uint8Array(e,m+1,w),T=String.fromCharCode.apply(String,n(E));g[u].labels[b]=T.replace("æ","µ").replace("ý","²")}m+=w+1}}var k=t.getUint8(m);g[6].labels=k,m+=g[6].total*(k+1);var x=g[g.length-1];x.contextsByteLength=new Array(x.total),x.types=new Array(x.total),x.values=new Array(x.total);var S=/[a-zA-Z ]*\:{1}([a-zA-Z]*)[\[]?\d*[\]]?/;x.labels=new Array(x.total).fill("");for(var I=0;I<x.total;I++){var w=t.getUint8(m),E=new Uint8Array(e,m+1,w),T=String.fromCharCode.apply(String,E);x.labels[I]=T.split(":")[0],x.contextsByteLength[I]=t.getUint16(m+w+1,!0);var A=S.exec(T);x.types[I]=A?A[1].toLowerCase():null,m+=w+3}for(var I=0;I<x.total;I++){var M=null;if("single"===x.types[I])M=t.getFloat32(m,!0);else if("boolean"===x.types[I]){M=new Array(x.contextsByteLength[I]);for(var N=0;N<M.length;N++)M[N]=!!t.getUint8(m+N)}else if("string"===x.types[I]){var w=t.getUint8(m),E=new Uint8Array(e,m+1,w);M=String.fromCharCode.apply(String,E)}m+=x.contextsByteLength[I],x.values[I]=M}for(var u=0;u<g.length;u++)delete g[u].total;delete g[7].contextsByteLength,delete g[7].types;var C={metadata:{comment:r.comment,sizes:{measure:r.measureSize,duration:r.durationSize,firstSpace:r.firstSpaceSize,secondSpace:r.secondSpaceSize},informationList:g},data:l};return C}}]),e}(),a=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t(this,e),this._qeegModObj=null,this._typeCode=null,this._typeCodeMap={"Z Electrical Tomography for Cortex and Basal Ganglia":"ZETCBG","Z Electrical Tomography for Cortex":"ZETC","Z Cross Spectrum":"ZCROSS","Z Broad Band":"ZBBSP",Phase:"PHA","Electrical Tomography for Cortex and Basal Ganglia":"ETCBG","Electrical Tomography for Cortex":"ETC","Cross Spectrum":"CROSS",Correlation:"COR",Coherence:"COH","Broad Band":"BBSP"},this.setQeegModObj(r)}return r(e,[{key:"_defineTypeCode",value:function(){var e=this.getType();e in this._typeCodeMap&&(this._typeCode=this._typeCodeMap[e])}},{key:"setQeegModObj",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&(this._qeegModObj=e,this._defineTypeCode())}},{key:"getType",value:function(){return this._qeegModObj.metadata.comment}},{key:"getTypeCode",value:function(){return this._typeCode}},{key:"getMeasureNames",value:function(){return this._qeegModObj.metadata.informationList[0].labels}},{key:"getDurationsLabels",value:function(){return this._qeegModObj.metadata.informationList[1].labels}},{key:"getFirstSpaceNames",value:function(){return this._qeegModObj.metadata.informationList[2].labels}},{key:"getSecondSpaceNames",value:function(){return this._qeegModObj.metadata.informationList[3].labels}},{key:"getUnitsLabels",value:function(){return this._qeegModObj.metadata.informationList[5].labels}},{key:"getMeasureSize",value:function(){return this._qeegModObj.metadata.sizes.measure}},{key:"getDurationSize",value:function(){return this._qeegModObj.metadata.sizes.duration}},{key:"getFirstSpaceSize",value:function(){return this._qeegModObj.metadata.sizes.firstSpace}},{key:"getSecondSpaceSize",value:function(){return this._qeegModObj.metadata.sizes.secondSpace}},{key:"getDimensionSizes",value:function(){return[this._qeegModObj.metadata.sizes.measure,this._qeegModObj.metadata.sizes.duration,this._qeegModObj.metadata.sizes.firstSpace,this._qeegModObj.metadata.sizes.secondSpace]}},{key:"getNumberOfDimensionsUsed",value:function(){for(var e=this.getDimensionSizes(),t=e.length-1;t>=0;t--)if(e[t]>1)return t+1;return 0}},{key:"getTranformation",value:function(){return this._qeegModObj.metadata.informationList[6].labels}},{key:"getContext",value:function(e){return e<0||e>=this._qeegModObj.metadata.informationList[7].labels.length?(console.warn("The context index is out of range"),null):{label:this._qeegModObj.metadata.informationList[7].labels[e],value:this._qeegModObj.metadata.informationList[7].values[e]}}},{key:"getAllContexts",value:function(){var e=this._qeegModObj.metadata.informationList[7];if(e.labels.length!=e.values.length)return console.warn("The contexts is corrupted. Inequal amount of values/labels."),null;for(var t=[],r=0;r<e.labels.length;r++)t.push({label:e.labels[r],value:e.values[r]});return t}},{key:"getStartFrequency",value:function(){return"COR"===this._typeCode?-1:this._qeegModObj.metadata.informationList[7].values[0]}},{key:"getFrequencyResolution",value:function(){return"COR"===this._typeCode?-1:this._qeegModObj.metadata.informationList[7].values[1]}},{key:"getScaleFactor",value:function(){var e=2;return"COR"===this._typeCode&&(e-=2),this._qeegModObj.metadata.informationList[7].values[e]}},{key:"getScaleIfScaleMeasures",value:function(){var e=3;return"COR"===this._typeCode&&(e-=2),this._qeegModObj.metadata.informationList[7].values[e]}},{key:"getMeasureName",value:function(){var e=4;return"COR"===this._typeCode&&(e-=2),this._qeegModObj.metadata.informationList[7].values[e]}},{key:"getDurationName",value:function(){var e=5;return"COR"===this._typeCode&&(e-=2),this._qeegModObj.metadata.informationList[7].values[e]}},{key:"getFirstSpaceName",value:function(){var e=6;return"COR"===this._typeCode&&(e-=2),this._qeegModObj.metadata.informationList[7].values[e]}},{key:"getSecondSpaceName",value:function(){var e=7;return"COR"===this._typeCode&&(e-=2),this._qeegModObj.metadata.informationList[7].values[e]}},{key:"getAllDimensionsNames",value:function(){return[this.getMeasureName(),this.getDurationName(),this.getFirstSpaceName(),this.getSecondSpaceName()]}},{key:"getValue",value:function(e,t,r,n){var i=this._qeegModObj.metadata.sizes;if(e<0||e>=i.measure)return console.warn("measureIndex is out of range."),null;if(t<0||t>=i.duration)return console.warn("durationIndex is out of range."),null;if(r<0||r>=i.firstSpace)return console.warn("firstSpaceIndex is out of range."),null;if(n<0||n>=i.secondSpace)return console.warn("secondSpaceIndex is out of range."),null;var a=this._getOffset(e,t,r,n);return this._qeegModObj.data[a]}},{key:"getSpectrum",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,n=this._qeegModObj.metadata.sizes,i=this._qeegModObj.data;if(-1==e&&-1==t&&-1==r)return i.slice();if(e>=0&&e<n.measure&&-1==t&&-1==r){var a=this._getOffset(e,0,0,0),s=this._getOffset(e+1,0,0,0);return i.slice(a,s)}if(e>=0&&e<n.measure&&t>=0&&t<n.duration&&-1==r){var a=this._getOffset(e,t,0,0),s=this._getOffset(e,t+1,0,0);return i.slice(a,s)}if(e>=0&&e<n.measure&&t>=0&&t<n.duration&&r>=0&&r<n.firstSpace){var a=this._getOffset(e,t,r,0),s=this._getOffset(e,t,r+1,0);return i.slice(a,s)}return null}},{key:"getSpectrumByLabels",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=this._qeegModObj.metadata.informationList,i=n[0].labels.indexOf(e),a=n[1].labels.indexOf(t),s=n[2].labels.indexOf(r);return e&&-1==i?(console.warn("The measure label "+e+" could not be found."),null):t&&-1==a?(console.warn("The duration label "+t+" could not be found."),null):r&&-1==s?(console.warn("The first-space label "+r+" could not be found."),null):this.getSpectrum(i,a,s)}},{key:"getSpectrumLabelsByLabels",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=this._qeegModObj.metadata.informationList,i=n[0].labels.indexOf(e),a=n[1].labels.indexOf(t),s=n[2].labels.indexOf(r);return e&&-1==i?(console.warn("The measure label "+e+" could not be found."),null):t&&-1==a?(console.warn("The duration label "+t+" could not be found."),null):r&&-1==s?(console.warn("The first-space label "+r+" could not be found."),null):this.getSpectrumLabels(i,a,s)}},{key:"getSpectrumLabels",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,n=this._qeegModObj.metadata.sizes,i=this._qeegModObj.metadata.informationList,a=[];return-1==e&&-1==t&&-1==r?(i[0].labels&&a.push(i[0].labels.slice()),i[1].labels&&a.push(i[1].labels.slice()),i[2].labels&&a.push(i[2].labels.slice()),i[3].labels&&a.push(i[3].labels.slice()),a):e>=0&&e<n.measure&&-1==t&&-1==r?(this._getOffset(e,0,0,0),this._getOffset(e+1,0,0,0),i[0].labels&&i[0].labels.length>e&&a.push(i[0].labels[e]),i[1].labels&&a.push(i[1].labels.slice()),i[2].labels&&a.push(i[2].labels.slice()),i[3].labels&&a.push(i[3].labels.slice()),a):e>=0&&e<n.measure&&t>=0&&t<n.duration&&-1==r?(this._getOffset(e,t,0,0),this._getOffset(e,t+1,0,0),i[0].labels&&i[0].labels.length>e&&a.push(i[0].labels[e]),i[1].labels&&i[1].labels.length>t&&a.push(i[1].labels[t]),i[2].labels&&a.push(i[2].labels.slice()),i[3].labels&&a.push(i[3].labels.slice()),a):e>=0&&e<n.measure&&t>=0&&t<n.duration&&r>=0&&r<n.firstSpace?(this._getOffset(e,t,r,0),this._getOffset(e,t,r+1,0),i[0].labels&&i[0].labels.length>e&&a.push(i[0].labels[e]),i[1].labels&&i[1].labels.length>t&&a.push(i[1].labels[t]),i[2].labels&&i[2].labels.length>r&&a.push(i[2].labels[r]),i[3].labels&&a.push(i[3].labels.slice()),a):null}},{key:"_getOffset",value:function(e,t,r,n){var i=this._qeegModObj.metadata.sizes;return(e*i.duration*i.firstSpace+t*i.firstSpace+r)*i.secondSpace+n}}]),e}();e.QeegModFileParser=i,e.QeegModFileInterpreter=a,Object.defineProperty(e,"__esModule",{value:!0})}(t)}),qeegmodfile=unwrapExports(qeegmodfile_umd),EegModDecoder=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.addInputValidator(0,ArrayBuffer),e.setMetadata("debug",!1),e._view=null,e}return inherits(t,Decoder),createClass(t,[{key:"_run",value:function(){var e=this._getInput(0);if(e){var t=new qeegmodfile.QeegModFileParser;t.setRawData(e);var r=t.parse();r&&(this._output[0]=r)}else console.warn('EegModDecoder requires an ArrayBuffer as input "0". Unable to continue.')}}]),t}(),PixBinEncoder=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setMetadata("compress",!0),e.setMetadata("description","no description"),e.setMetadata("madeWith","Pixpipejs"),e.setMetadata("userObject",null),e}return inherits(t,Filter),createClass(t,[{key:"_run",value:function(){var e=new pixbincodec.PixBinEncoder;e.enableDataCompression(this.getMetadata("compress")),e.setOption("userObject",this.getMetadata("userObject")),e.setOption("description",this.getMetadata("description")),e.setOption("madeWith",this.getMetadata("madeWith")),this._forEachInput(function(t,r){e.addInput(r)}),e.run(),this._output[0]=e.getOutput()}}],[{key:"MAGIC_NUMBER",value:function(){return"PIXPIPE_PIXBIN"}}]),t}(),btoa=btoa||function(e){return new Buffer(e).toString("base64")};function JPEGEncoder(e){var t,r,n,i,a,s=Math.floor,o=new Array(64),l=new Array(64),u=new Array(64),c=new Array(64),h=new Array(65535),f=new Array(65535),d=new Array(64),p=new Array(64),g=[],_=0,y=7,m=new Array(64),v=new Array(64),b=new Array(64),w=new Array(256),E=new Array(2048),T=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],k=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],x=[0,1,2,3,4,5,6,7,8,9,10,11],S=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],I=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],A=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],M=[0,1,2,3,4,5,6,7,8,9,10,11],N=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],C=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function O(e,t){for(var r=0,n=0,i=new Array,a=1;a<=16;a++){for(var s=1;s<=e[a];s++)i[t[n]]=[],i[t[n]][0]=r,i[t[n]][1]=a,n++,r++;r*=2}return i}function D(e){for(var t=e[0],r=e[1]-1;r>=0;)t&1<<r&&(_|=1<<y),r--,--y<0&&(255==_?(R(255),R(0)):R(_),y=7,_=0)}function R(e){g.push(e)}function B(e){R(e>>8&255),R(255&e)}function F(e,t,r,n,i){for(var a,s=i[0],o=i[240],l=function(e,t){var r,n,i,a,s,o,l,u,c,h,f=0;for(c=0;c<8;++c){r=e[f],n=e[f+1],i=e[f+2],a=e[f+3],s=e[f+4],o=e[f+5],l=e[f+6];var p=r+(u=e[f+7]),g=r-u,_=n+l,y=n-l,m=i+o,v=i-o,b=a+s,w=a-s,E=p+b,T=p-b,k=_+m,x=_-m;e[f]=E+k,e[f+4]=E-k;var S=.707106781*(x+T);e[f+2]=T+S,e[f+6]=T-S;var I=.382683433*((E=w+v)-(x=y+g)),A=.5411961*E+I,M=1.306562965*x+I,N=.707106781*(k=v+y),C=g+N,O=g-N;e[f+5]=O+A,e[f+3]=O-A,e[f+1]=C+M,e[f+7]=C-M,f+=8}for(f=0,c=0;c<8;++c){r=e[f],n=e[f+8],i=e[f+16],a=e[f+24],s=e[f+32],o=e[f+40],l=e[f+48];var D=r+(u=e[f+56]),R=r-u,B=n+l,F=n-l,U=i+o,L=i-o,P=a+s,j=a-s,z=D+P,H=D-P,V=B+U,$=B-U;e[f]=z+V,e[f+32]=z-V;var Z=.707106781*($+H);e[f+16]=H+Z,e[f+48]=H-Z;var q=.382683433*((z=j+L)-($=F+R)),Y=.5411961*z+q,G=1.306562965*$+q,X=.707106781*(V=L+F),K=R+X,W=R-X;e[f+40]=W+Y,e[f+24]=W-Y,e[f+8]=K+G,e[f+56]=K-G,f++}for(c=0;c<64;++c)h=e[c]*t[c],d[c]=h>0?h+.5|0:h-.5|0;return d}(e,t),u=0;u<64;++u)p[T[u]]=l[u];var c=p[0]-r;r=p[0],0==c?D(n[0]):(D(n[f[a=32767+c]]),D(h[a]));for(var g=63;g>0&&0==p[g];g--);if(0==g)return D(s),r;for(var _,y=1;y<=g;){for(var m=y;0==p[y]&&y<=g;++y);var v=y-m;if(v>=16){_=v>>4;for(var b=1;b<=_;++b)D(o);v&=15}a=32767+p[y],D(i[(v<<4)+f[a]]),D(h[a]),y++}return 63!=g&&D(s),r}function U(e){if(e<=0&&(e=1),e>100&&(e=100),a!=e){(function(e){for(var t=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],r=0;r<64;r++){var n=s((t[r]*e+50)/100);n<1?n=1:n>255&&(n=255),o[T[r]]=n}for(var i=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],a=0;a<64;a++){var h=s((i[a]*e+50)/100);h<1?h=1:h>255&&(h=255),l[T[a]]=h}for(var f=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],d=0,p=0;p<8;p++)for(var g=0;g<8;g++)u[d]=1/(o[T[d]]*f[p]*f[g]*8),c[d]=1/(l[T[d]]*f[p]*f[g]*8),d++})(e<50?Math.floor(5e3/e):Math.floor(200-2*e)),a=e}}this.encode=function(e,a){(new Date).getTime();a&&U(a),g=new Array,_=0,y=7,B(65496),B(65504),B(16),R(74),R(70),R(73),R(70),R(0),R(1),R(1),R(0),B(1),B(1),R(0),R(0),function(){B(65499),B(132),R(0);for(var e=0;e<64;e++)R(o[e]);R(1);for(var t=0;t<64;t++)R(l[t])}(),function(e,t){B(65472),B(17),R(8),B(t),B(e),R(3),R(1),R(17),R(0),R(2),R(17),R(1),R(3),R(17),R(1)}(e.width,e.height),function(){B(65476),B(418),R(0);for(var e=0;e<16;e++)R(k[e+1]);for(var t=0;t<=11;t++)R(x[t]);R(16);for(var r=0;r<16;r++)R(S[r+1]);for(var n=0;n<=161;n++)R(I[n]);R(1);for(var i=0;i<16;i++)R(A[i+1]);for(var a=0;a<=11;a++)R(M[a]);R(17);for(var s=0;s<16;s++)R(N[s+1]);for(var o=0;o<=161;o++)R(C[o])}(),B(65498),B(12),R(3),R(1),R(0),R(2),R(17),R(3),R(17),R(0),R(63),R(0);var s=0,h=0,f=0;_=0,y=7,this.encode.displayName="_encode_";for(var d,p,w,T,O,L,P,j,z,H=e.data,V=e.width,$=e.height,Z=4*V,q=0;q<$;){for(d=0;d<Z;){for(L=O=Z*q+d,P=-1,j=0,z=0;z<64;z++)L=O+(j=z>>3)*Z+(P=4*(7&z)),q+j>=$&&(L-=Z*(q+1+j-$)),d+P>=Z&&(L-=d+P-Z+4),p=H[L++],w=H[L++],T=H[L++],m[z]=(E[p]+E[w+256>>0]+E[T+512>>0]>>16)-128,v[z]=(E[p+768>>0]+E[w+1024>>0]+E[T+1280>>0]>>16)-128,b[z]=(E[p+1280>>0]+E[w+1536>>0]+E[T+1792>>0]>>16)-128;s=F(m,u,s,t,n),h=F(v,c,h,r,i),f=F(b,c,f,r,i),d+=32}q+=8}if(y>=0){var Y=[];Y[1]=y+1,Y[0]=(1<<y+1)-1,D(Y)}return B(65497),new Buffer(g)},function(){(new Date).getTime();e||(e=50),function(){for(var e=String.fromCharCode,t=0;t<256;t++)w[t]=e(t)}(),t=O(k,x),r=O(A,M),n=O(S,I),i=O(N,C),function(){for(var e=1,t=2,r=1;r<=15;r++){for(var n=e;n<t;n++)f[32767+n]=r,h[32767+n]=[],h[32767+n][1]=r,h[32767+n][0]=n;for(var i=-(t-1);i<=-e;i++)f[32767+i]=r,h[32767+i]=[],h[32767+i][1]=r,h[32767+i][0]=t-1+i;e<<=1,t<<=1}}(),function(){for(var e=0;e<256;e++)E[e]=19595*e,E[e+256>>0]=38470*e,E[e+512>>0]=7471*e+32768,E[e+768>>0]=-11059*e,E[e+1024>>0]=-21709*e,E[e+1280>>0]=32768*e+8421375,E[e+1536>>0]=-27439*e,E[e+1792>>0]=-5329*e}(),U(e),(new Date).getTime()}()}var encoder=encode;function encode(e,t){return void 0===t&&(t=50),{data:new JPEGEncoder(t).encode(e,t),width:e.width,height:e.height}}var JpegImage=function(){var e=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),t=4017,r=799,n=3406,i=2276,a=1567,s=3784,o=5793,l=2896;function u(){}function c(e,t){for(var r,n,i=0,a=[],s=16;s>0&&!e[s-1];)s--;a.push({children:[],index:0});var o,l=a[0];for(r=0;r<s;r++){for(n=0;n<e[r];n++){for((l=a.pop()).children[l.index]=t[i];l.index>0;)l=a.pop();for(l.index++,a.push(l);a.length<=r;)a.push(o={children:[],index:0}),l.children[l.index]=o.children,l=o;i++}r+1<s&&(a.push(o={children:[],index:0}),l.children[l.index]=o.children,l=o)}return a[0].children}function h(t,r,n,i,a,s,o,l,u){n.precision,n.samplesPerLine,n.scanLines;var c=n.mcusPerLine,h=n.progressive,f=(n.maxH,n.maxV,r),d=0,p=0;function g(){if(p>0)return d>>--p&1;if(255==(d=t[r++])){var e=t[r++];if(e)throw new Error("unexpected marker: "+(d<<8|e).toString(16))}return p=7,d>>>7}function _(e){for(var t,r=e;null!==(t=g());){if("number"==typeof(r=r[t]))return r;if("object"!==(void 0===r?"undefined":_typeof(r)))throw new Error("invalid huffman sequence")}return null}function y(e){for(var t=0;e>0;){var r=g();if(null===r)return;t=t<<1|r,e--}return t}function m(e){var t=y(e);return t>=1<<e-1?t:t+(-1<<e)+1}var v=0;var b,w=0;function E(e,t,r,n,i){var a=r%c,s=(r/c|0)*e.v+n,o=a*e.h+i;t(e,e.blocks[s][o])}function T(e,t,r){var n=r/e.blocksPerLine|0,i=r%e.blocksPerLine;t(e,e.blocks[n][i])}var k,x,S,I,A,M,N=i.length;M=h?0===s?0===l?function(e,t){var r=_(e.huffmanTableDC),n=0===r?0:m(r)<<u;t[0]=e.pred+=n}:function(e,t){t[0]|=g()<<u}:0===l?function(t,r){if(v>0)v--;else for(var n=s,i=o;n<=i;){var a=_(t.huffmanTableAC),l=15&a,c=a>>4;if(0!==l)r[e[n+=c]]=m(l)*(1<<u),n++;else{if(c<15){v=y(c)+(1<<c)-1;break}n+=16}}}:function(t,r){for(var n=s,i=o,a=0;n<=i;){var l=e[n],c=r[l]<0?-1:1;switch(w){case 0:var h=_(t.huffmanTableAC),f=15&h;if(a=h>>4,0===f)a<15?(v=y(a)+(1<<a),w=4):(a=16,w=1);else{if(1!==f)throw new Error("invalid ACn encoding");b=m(f),w=a?2:3}continue;case 1:case 2:r[l]?r[l]+=(g()<<u)*c:0==--a&&(w=2==w?3:0);break;case 3:r[l]?r[l]+=(g()<<u)*c:(r[l]=b<<u,w=0);break;case 4:r[l]&&(r[l]+=(g()<<u)*c)}n++}4===w&&0==--v&&(w=0)}:function(t,r){var n=_(t.huffmanTableDC),i=0===n?0:m(n);r[0]=t.pred+=i;for(var a=1;a<64;){var s=_(t.huffmanTableAC),o=15&s,l=s>>4;if(0!==o)r[e[a+=l]]=m(o),a++;else{if(l<15)break;a+=16}}};var C,O,D,R,B=0;for(O=1==N?i[0].blocksPerLine*i[0].blocksPerColumn:c*n.mcusPerColumn,a||(a=O);B<O;){for(x=0;x<N;x++)i[x].pred=0;if(v=0,1==N)for(k=i[0],A=0;A<a;A++)T(k,M,B),B++;else for(A=0;A<a;A++){for(x=0;x<N;x++)for(D=(k=i[x]).h,R=k.v,S=0;S<R;S++)for(I=0;I<D;I++)E(k,M,B,S,I);if(++B===O)break}if(p=0,(C=t[r]<<8|t[r+1])<65280)throw new Error("marker was not found");if(!(C>=65488&&C<=65495))break;r+=2}return r-f}function f(e,u){var c,h,f=[],d=u.blocksPerLine,p=u.blocksPerColumn,g=d<<3,_=new Int32Array(64),y=new Uint8Array(64);function m(e,c,h){var f,d,p,g,_,y,m,v,b,w,E=u.quantizationTable,T=h;for(w=0;w<64;w++)T[w]=e[w]*E[w];for(w=0;w<8;++w){var k=8*w;0!=T[1+k]||0!=T[2+k]||0!=T[3+k]||0!=T[4+k]||0!=T[5+k]||0!=T[6+k]||0!=T[7+k]?(f=o*T[0+k]+128>>8,d=o*T[4+k]+128>>8,p=T[2+k],g=T[6+k],_=l*(T[1+k]-T[7+k])+128>>8,v=l*(T[1+k]+T[7+k])+128>>8,y=T[3+k]<<4,m=T[5+k]<<4,b=f-d+1>>1,f=f+d+1>>1,d=b,b=p*s+g*a+128>>8,p=p*a-g*s+128>>8,g=b,b=_-m+1>>1,_=_+m+1>>1,m=b,b=v+y+1>>1,y=v-y+1>>1,v=b,b=f-g+1>>1,f=f+g+1>>1,g=b,b=d-p+1>>1,d=d+p+1>>1,p=b,b=_*i+v*n+2048>>12,_=_*n-v*i+2048>>12,v=b,b=y*r+m*t+2048>>12,y=y*t-m*r+2048>>12,m=b,T[0+k]=f+v,T[7+k]=f-v,T[1+k]=d+m,T[6+k]=d-m,T[2+k]=p+y,T[5+k]=p-y,T[3+k]=g+_,T[4+k]=g-_):(b=o*T[0+k]+512>>10,T[0+k]=b,T[1+k]=b,T[2+k]=b,T[3+k]=b,T[4+k]=b,T[5+k]=b,T[6+k]=b,T[7+k]=b)}for(w=0;w<8;++w){var x=w;0!=T[8+x]||0!=T[16+x]||0!=T[24+x]||0!=T[32+x]||0!=T[40+x]||0!=T[48+x]||0!=T[56+x]?(f=o*T[0+x]+2048>>12,d=o*T[32+x]+2048>>12,p=T[16+x],g=T[48+x],_=l*(T[8+x]-T[56+x])+2048>>12,v=l*(T[8+x]+T[56+x])+2048>>12,y=T[24+x],m=T[40+x],b=f-d+1>>1,f=f+d+1>>1,d=b,b=p*s+g*a+2048>>12,p=p*a-g*s+2048>>12,g=b,b=_-m+1>>1,_=_+m+1>>1,m=b,b=v+y+1>>1,y=v-y+1>>1,v=b,b=f-g+1>>1,f=f+g+1>>1,g=b,b=d-p+1>>1,d=d+p+1>>1,p=b,b=_*i+v*n+2048>>12,_=_*n-v*i+2048>>12,v=b,b=y*r+m*t+2048>>12,y=y*t-m*r+2048>>12,m=b,T[0+x]=f+v,T[56+x]=f-v,T[8+x]=d+m,T[48+x]=d-m,T[16+x]=p+y,T[40+x]=p-y,T[24+x]=g+_,T[32+x]=g-_):(b=o*h[w+0]+8192>>14,T[0+x]=b,T[8+x]=b,T[16+x]=b,T[24+x]=b,T[32+x]=b,T[40+x]=b,T[48+x]=b,T[56+x]=b)}for(w=0;w<64;++w){var S=128+(T[w]+8>>4);c[w]=S<0?0:S>255?255:S}}for(var v=0;v<p;v++){var b=v<<3;for(c=0;c<8;c++)f.push(new Uint8Array(g));for(var w=0;w<d;w++){m(u.blocks[v][w],y,_);var E=0,T=w<<3;for(h=0;h<8;h++){var k=f[b+h];for(c=0;c<8;c++)k[T+c]=y[E++]}}}return f}function d(e){return e<0?0:e>255?255:e}return u.prototype={load:function(e){var t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="arraybuffer",t.onload=function(){var e=new Uint8Array(t.response||t.mozResponseArrayBuffer);this.parse(e),this.onload&&this.onload()}.bind(this),t.send(null)},parse:function(t){var r=0;t.length;function n(){var e=t[r]<<8|t[r+1];return r+=2,e}function i(){var e=n(),i=t.subarray(r,r+e-2);return r+=i.length,i}function a(e){var t,r,n=0,i=0;for(r in e.components)e.components.hasOwnProperty(r)&&(n<(t=e.components[r]).h&&(n=t.h),i<t.v&&(i=t.v));var a=Math.ceil(e.samplesPerLine/8/n),s=Math.ceil(e.scanLines/8/i);for(r in e.components)if(e.components.hasOwnProperty(r)){t=e.components[r];for(var o=Math.ceil(Math.ceil(e.samplesPerLine/8)*t.h/n),l=Math.ceil(Math.ceil(e.scanLines/8)*t.v/i),u=a*t.h,c=s*t.v,h=[],f=0;f<c;f++){for(var d=[],p=0;p<u;p++)d.push(new Int32Array(64));h.push(d)}t.blocksPerLine=o,t.blocksPerColumn=l,t.blocks=h}e.maxH=n,e.maxV=i,e.mcusPerLine=a,e.mcusPerColumn=s}var s,o,l=null,u=null,d=[],p=[],g=[],_=[],y=n();if(65496!=y)throw new Error("SOI not found");for(y=n();65497!=y;){switch(y){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var m=i();65504===y&&74===m[0]&&70===m[1]&&73===m[2]&&70===m[3]&&0===m[4]&&(l={version:{major:m[5],minor:m[6]},densityUnits:m[7],xDensity:m[8]<<8|m[9],yDensity:m[10]<<8|m[11],thumbWidth:m[12],thumbHeight:m[13],thumbData:m.subarray(14,14+3*m[12]*m[13])}),65518===y&&65===m[0]&&100===m[1]&&111===m[2]&&98===m[3]&&101===m[4]&&0===m[5]&&(u={version:m[6],flags0:m[7]<<8|m[8],flags1:m[9]<<8|m[10],transformCode:m[11]});break;case 65499:for(var v=n()+r-2;r<v;){var b=t[r++],w=new Int32Array(64);if(b>>4==0)for(z=0;z<64;z++){w[e[z]]=t[r++]}else{if(b>>4!=1)throw new Error("DQT: invalid table spec");for(z=0;z<64;z++){w[e[z]]=n()}}d[15&b]=w}break;case 65472:case 65473:case 65474:n(),(s={}).extended=65473===y,s.progressive=65474===y,s.precision=t[r++],s.scanLines=n(),s.samplesPerLine=n(),s.components={},s.componentsOrder=[];var E,T=t[r++];for(P=0;P<T;P++){E=t[r];var k=t[r+1]>>4,x=15&t[r+1],S=t[r+2];s.componentsOrder.push(E),s.components[E]={h:k,v:x,quantizationIdx:S},r+=3}a(s),p.push(s);break;case 65476:var I=n();for(P=2;P<I;){var A=t[r++],M=new Uint8Array(16),N=0;for(z=0;z<16;z++,r++)N+=M[z]=t[r];var C=new Uint8Array(N);for(z=0;z<N;z++,r++)C[z]=t[r];P+=17+N,(A>>4==0?_:g)[15&A]=c(M,C)}break;case 65501:n(),o=n();break;case 65498:n();var O=t[r++],D=[];for(P=0;P<O;P++){H=s.components[t[r++]];var R=t[r++];H.huffmanTableDC=_[R>>4],H.huffmanTableAC=g[15&R],D.push(H)}var B=t[r++],F=t[r++],U=t[r++],L=h(t,r,s,D,o,B,F,U>>4,15&U);r+=L;break;default:if(255==t[r-3]&&t[r-2]>=192&&t[r-2]<=254){r-=3;break}throw new Error("unknown JPEG marker "+y.toString(16))}y=n()}if(1!=p.length)throw new Error("only single frame JPEGs supported");for(var P=0;P<p.length;P++){var j=p[P].components;for(var z in j)j[z].quantizationTable=d[j[z].quantizationIdx],delete j[z].quantizationIdx}this.width=s.samplesPerLine,this.height=s.scanLines,this.jfif=l,this.adobe=u,this.components=[];for(P=0;P<s.componentsOrder.length;P++){var H=s.components[s.componentsOrder[P]];this.components.push({lines:f(0,H),scaleX:H.h/s.maxH,scaleY:H.v/s.maxV})}},getData:function(e,t){var r,n,i,a,s,o,l,u,c,h,f,p,g,_,y,m,v,b,w,E,T,k=this.width/e,x=this.height/t,S=0,I=e*t*this.components.length,A=new Uint8Array(I);switch(this.components.length){case 1:for(r=this.components[0],h=0;h<t;h++)for(s=r.lines[0|h*r.scaleY*x],c=0;c<e;c++)f=s[0|c*r.scaleX*k],A[S++]=f;break;case 2:for(r=this.components[0],n=this.components[1],h=0;h<t;h++)for(s=r.lines[0|h*r.scaleY*x],o=n.lines[0|h*n.scaleY*x],c=0;c<e;c++)f=s[0|c*r.scaleX*k],A[S++]=f,f=o[0|c*n.scaleX*k],A[S++]=f;break;case 3:for(T=!0,this.adobe&&this.adobe.transformCode?T=!0:void 0!==this.colorTransform&&(T=!!this.colorTransform),r=this.components[0],n=this.components[1],i=this.components[2],h=0;h<t;h++)for(s=r.lines[0|h*r.scaleY*x],o=n.lines[0|h*n.scaleY*x],l=i.lines[0|h*i.scaleY*x],c=0;c<e;c++)T?(f=s[0|c*r.scaleX*k],p=o[0|c*n.scaleX*k],b=d(f+1.402*((g=l[0|c*i.scaleX*k])-128)),w=d(f-.3441363*(p-128)-.71413636*(g-128)),E=d(f+1.772*(p-128))):(b=s[0|c*r.scaleX*k],w=o[0|c*n.scaleX*k],E=l[0|c*i.scaleX*k]),A[S++]=b,A[S++]=w,A[S++]=E;break;case 4:if(!this.adobe)throw"Unsupported color mode (4 components)";for(T=!1,this.adobe&&this.adobe.transformCode?T=!0:void 0!==this.colorTransform&&(T=!!this.colorTransform),r=this.components[0],n=this.components[1],i=this.components[2],a=this.components[3],h=0;h<t;h++)for(s=r.lines[0|h*r.scaleY*x],o=n.lines[0|h*n.scaleY*x],l=i.lines[0|h*i.scaleY*x],u=a.lines[0|h*a.scaleY*x],c=0;c<e;c++)T?(f=s[0|c*r.scaleX*k],p=o[0|c*n.scaleX*k],g=l[0|c*i.scaleX*k],_=u[0|c*a.scaleX*k],y=255-d(f+1.402*(g-128)),m=255-d(f-.3441363*(p-128)-.71413636*(g-128)),v=255-d(f+1.772*(p-128))):(y=s[0|c*r.scaleX*k],m=o[0|c*n.scaleX*k],v=l[0|c*i.scaleX*k],_=u[0|c*a.scaleX*k]),A[S++]=255-y,A[S++]=255-m,A[S++]=255-v,A[S++]=255-_;break;default:throw"Unsupported color mode"}return A},copyToImageData:function(e){var t,r,n,i,a,s,o,l,u,c=e.width,h=e.height,f=e.data,p=this.getData(c,h),g=0,_=0;switch(this.components.length){case 1:for(r=0;r<h;r++)for(t=0;t<c;t++)n=p[g++],f[_++]=n,f[_++]=n,f[_++]=n,f[_++]=255;break;case 3:for(r=0;r<h;r++)for(t=0;t<c;t++)o=p[g++],l=p[g++],u=p[g++],f[_++]=o,f[_++]=l,f[_++]=u,f[_++]=255;break;case 4:for(r=0;r<h;r++)for(t=0;t<c;t++)a=p[g++],s=p[g++],n=p[g++],o=255-d(a*(1-(i=p[g++])/255)+i),l=255-d(s*(1-i/255)+i),u=255-d(n*(1-i/255)+i),f[_++]=o,f[_++]=l,f[_++]=u,f[_++]=255;break;default:throw"Unsupported color mode"}}},u}(),decoder=decode;function decode(e,t){var r=new Uint8Array(e),n=new JpegImage;n.parse(r);var i={width:n.width,height:n.height,data:t?new Uint8Array(n.width*n.height*4):new Buffer(n.width*n.height*4)};return n.copyToImageData(i),i}var jpegJs={encode:encoder,decode:decoder},JpegDecoder=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setMetadata("targetType",Image2D.name),e.addInputValidator(0,ArrayBuffer),e}return inherits(t,Decoder),createClass(t,[{key:"_run",value:function(){var e=this._getInput(0);if(e)try{var t=jpegJs.decode(e),r=t.data.length/(t.width*t.height),n=new Image2D,i=new Uint8Array(t.data.buffer);n.setData(i,t.width,t.height,r),this._output[0]=n}catch(e){}else console.warn('JpegDecoder requires an ArrayBuffer as input "0". Unable to continue.')}}]),t}(),UPNG=createCommonjsModule(function(e){!function(){var t={};function r(){void 0!==process&&"development"!=process.env.NODE_ENV||console.log.apply(console,arguments)}e.exports=t,function(e,t){e.toRGBA8=function(t){var n=t.width,i=t.height,a=n*i,s=e.decode._getBPP(t),o=Math.ceil(n*s/8),l=new Uint8Array(4*a),u=new Uint32Array(l.buffer),c=t.data,h=t.ctype,f=t.depth,d=e._bin.readUshort;if(6==h){var p=a<<2;if(8==f)for(var g=0;g<p;g++)l[g]=c[g];if(16==f)for(g=0;g<p;g++)l[g]=c[g<<1]}else if(2==h){var _=t.tabs.tRNS,y=-1,m=-1,v=-1;if(_&&(y=_[0],m=_[1],v=_[2]),8==f)for(g=0;g<a;g++){var b=3*g;l[I=g<<2]=c[b],l[I+1]=c[b+1],l[I+2]=c[b+2],l[I+3]=255,-1!=y&&c[b]==y&&c[b+1]==m&&c[b+2]==v&&(l[I+3]=0)}if(16==f)for(g=0;g<a;g++){b=6*g;l[I=g<<2]=c[b],l[I+1]=c[b+2],l[I+2]=c[b+4],l[I+3]=255,-1!=y&&d(c,b)==y&&d(c,b+2)==m&&d(c,b+4)==v&&(l[I+3]=0)}}else if(3==h){var w=t.tabs.PLTE,E=t.tabs.tRNS,T=E?E.length:0;if(1==f)for(var k=0;k<i;k++){var x=k*o,S=k*n;for(g=0;g<n;g++){var I=S+g<<2,A=3*(M=c[x+(g>>3)]>>7-((7&g)<<0)&1);l[I]=w[A],l[I+1]=w[A+1],l[I+2]=w[A+2],l[I+3]=M<T?E[M]:255}}if(2==f)for(k=0;k<i;k++)for(x=k*o,S=k*n,g=0;g<n;g++){I=S+g<<2,A=3*(M=c[x+(g>>2)]>>6-((3&g)<<1)&3);l[I]=w[A],l[I+1]=w[A+1],l[I+2]=w[A+2],l[I+3]=M<T?E[M]:255}if(4==f)for(k=0;k<i;k++)for(x=k*o,S=k*n,g=0;g<n;g++){I=S+g<<2,A=3*(M=c[x+(g>>1)]>>4-((1&g)<<2)&15);l[I]=w[A],l[I+1]=w[A+1],l[I+2]=w[A+2],l[I+3]=M<T?E[M]:255}if(8==f)for(g=0;g<a;g++){var M;I=g<<2,A=3*(M=c[g]);l[I]=w[A],l[I+1]=w[A+1],l[I+2]=w[A+2],l[I+3]=M<T?E[M]:255}}else if(4==h){if(8==f)for(g=0;g<a;g++){I=g<<2;var N=c[C=g<<1];l[I]=N,l[I+1]=N,l[I+2]=N,l[I+3]=c[C+1]}if(16==f)for(g=0;g<a;g++){var C;I=g<<2,N=c[C=g<<2];l[I]=N,l[I+1]=N,l[I+2]=N,l[I+3]=c[C+2]}}else if(0==h){y=t.tabs.tRNS?t.tabs.tRNS:-1;if(1==f)for(g=0;g<a;g++){var O=(N=255*(c[g>>3]>>7-(7&g)&1))==255*y?0:255;u[g]=O<<24|N<<16|N<<8|N}if(2==f)for(g=0;g<a;g++){O=(N=85*(c[g>>2]>>6-((3&g)<<1)&3))==85*y?0:255;u[g]=O<<24|N<<16|N<<8|N}if(4==f)for(g=0;g<a;g++){O=(N=17*(c[g>>1]>>4-((1&g)<<2)&15))==17*y?0:255;u[g]=O<<24|N<<16|N<<8|N}if(8==f)for(g=0;g<a;g++){O=(N=c[g])==y?0:255;u[g]=O<<24|N<<16|N<<8|N}if(16==f)for(g=0;g<a;g++){N=c[g<<1],O=d(c,g<<1)==y?0:255;u[g]=O<<24|N<<16|N<<8|N}}else r("unsupported color type",h);return l},e.encode=function(t,r,n,i){null==i&&(i=0);for(var a=new Uint8Array(t),s=new Uint8Array(a.length+100),o=[137,80,78,71,13,10,26,10],l=0;l<8;l++)s[l]=o[l];var u=8,c=e._bin,h=e.crc.crc,f=e.encode.compress(a,r,n,i);if(c.writeUint(s,u,13),u+=4,c.writeASCII(s,u,"IHDR"),u+=4,c.writeUint(s,u,r),u+=4,c.writeUint(s,u,n),s[u+=4]=f.depth,s[++u]=f.ctype,s[++u]=0,s[++u]=0,s[++u]=0,u++,c.writeUint(s,u,h(s,u-17,17)),u+=4,c.writeUint(s,u,1),u+=4,c.writeASCII(s,u,"sRGB"),s[u+=4]=1,u++,c.writeUint(s,u,h(s,u-5,5)),u+=4,3==f.ctype){var d=f.plte.length;c.writeUint(s,u,3*d),u+=4,c.writeASCII(s,u,"PLTE"),u+=4;for(l=0;l<d;l++){var p=3*l,g=f.plte[l],_=255&g,y=g>>8&255,m=g>>16&255;s[u+p+0]=_,s[u+p+1]=y,s[u+p+2]=m}if(u+=3*d,c.writeUint(s,u,h(s,u-3*d-4,3*d+4)),u+=4,f.gotAlpha){c.writeUint(s,u,d),u+=4,c.writeASCII(s,u,"tRNS"),u+=4;for(l=0;l<d;l++)s[u+l]=f.plte[l]>>24&255;u+=d,c.writeUint(s,u,h(s,u-d-4,d+4)),u+=4}}d=f.data.length;c.writeUint(s,u,d),u+=4,c.writeASCII(s,u,"IDAT"),u+=4;for(l=0;l<d;l++)s[u+l]=f.data[l];return u+=d,c.writeUint(s,u,h(s,u-d-4,d+4)),u+=4,c.writeUint(s,u,0),u+=4,c.writeASCII(s,u,"IEND"),u+=4,c.writeUint(s,u,h(s,u-4,4)),u+=4,s.buffer.slice(0,u)},e.encode.compress=function(t,r,n,i){0!=i&&(t=e.quantize(t,r,n,i));for(var a=6,s=8,o=[],l=4,u=4*r,c=new Uint32Array(t.buffer),h=!1,f=[],d=0;d<t.length;d+=4){var p=c[d>>2];o.length<600&&null==f[p]&&(f[p]=o.length,o.push(p)),255!=t[d+3]&&(h=!0)}var g=o.length;if(g<=256){s=g<=2?1:g<=4?2:g<=16?4:8,u=Math.ceil(s*r/8),v=new Uint8Array(u*n);for(var _=0;_<n;_++){d=_*u;var y=_*r;if(1==s)for(var m=0;m<r;m++)v[d+(m>>3)]|=f[c[y+m]]<<7-(7&m);if(2==s)for(m=0;m<r;m++)v[d+(m>>2)]|=f[c[y+m]]<<6-2*(3&m);if(4==s)for(m=0;m<r;m++)v[d+(m>>1)]|=f[c[y+m]]<<4-4*(1&m);if(8==s)for(m=0;m<r;m++)v[d+m]=f[c[y+m]]}t=v,a=3,l=1}else if(0==h){var v=new Uint8Array(r*n*3),b=r*n;for(d=0;d<b;d++){var w=3*d,E=4*d;v[w]=t[E],v[w+1]=t[E+1],v[w+2]=t[E+2]}t=v,a=2,l=3,u=3*r}var T=new Uint8Array(r*n*l+n);return{ctype:a,depth:s,plte:o,gotAlpha:h,data:e.encode._filterZero(t,n,l,u,T)}},e.encode._filterZero=function(r,n,i,a,s){for(var o=[],l=0;l<5;l++)if(!(n*a>5e5)||2!=l&&3!=l&&4!=l){for(var u=0;u<n;u++)e.encode._filterLine(s,r,u,a,i,l);if(o.push(t.deflate(s)),1==i)break}for(var c,h=1e9,f=0;f<o.length;f++)o[f].length<h&&(c=f,h=o[f].length);return o[c]},e.encode._filterLine=function(t,r,n,i,a,s){var o=n*i,l=o+n,u=e.decode._paeth;if(t[l]=s,l++,0==s)for(var c=0;c<i;c++)t[l+c]=r[o+c];else if(1==s){for(c=0;c<a;c++)t[l+c]=r[o+c];for(c=a;c<i;c++)t[l+c]=r[o+c]-r[o+c-a]+256&255}else if(0==n){for(c=0;c<a;c++)t[l+c]=r[o+c];if(2==s)for(c=a;c<i;c++)t[l+c]=r[o+c];if(3==s)for(c=a;c<i;c++)t[l+c]=r[o+c]-(r[o+c-a]>>1)+256&255;if(4==s)for(c=a;c<i;c++)t[l+c]=r[o+c]-u(r[o+c-a],0,0)+256&255}else{if(2==s)for(c=0;c<i;c++)t[l+c]=r[o+c]+256-r[o+c-i]&255;if(3==s){for(c=0;c<a;c++)t[l+c]=r[o+c]+256-(r[o+c-i]>>1)&255;for(c=a;c<i;c++)t[l+c]=r[o+c]+256-(r[o+c-i]+r[o+c-a]>>1)&255}if(4==s){for(c=0;c<a;c++)t[l+c]=r[o+c]+256-u(0,r[o+c-i],0)&255;for(c=a;c<i;c++)t[l+c]=r[o+c]+256-u(r[o+c-a],r[o+c-i],r[o+c-a-i])&255}}},e.crc={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var r=t,n=0;n<8;n++)1&r?r=3988292384^r>>>1:r>>>=1;e[t]=r}return e}(),update:function(t,r,n,i){for(var a=0;a<i;a++)t=e.crc.table[255&(t^r[n+a])]^t>>>8;return t},crc:function(t,r,n){return 4294967295^e.crc.update(4294967295,t,r,n)}},e.quantize=function(t,r,n,i){for(var a=new Uint8Array(t.length),s=new Uint16Array(r*n),o=r*n,l=e.quantize.dist,u=0;u<o;u++){var c=t[(T=u<<2)+3]/255;a[T+0]=t[T+0]*c,a[T+1]=t[T+1]*c,a[T+2]=t[T+2]*c,a[T+3]=t[T+3]}for(var h=[],f=[],d=0,p=Math.max(100,10*i);;){f=[],h=[];var g=255-((1<<d)-1),_=1<<d>>1;for(u=0;u<o;u++){var y=((C=a[T=u<<2])&g)+_,m=((O=a[T+1])&g)+_,v=((D=a[T+2])&g)+_,b=((c=a[T+3])&g)+_,w=b<<24|v<<16|m<<8|y;if(f[w])h[f[w]].occ++;else f[w]=h.length,h.push({occ:1,r:y,g:m,b:v,a:b});if(h.length>p)break}if(!(h.length>p))break;d++}if(0==d&&h.length<=i)return t;h.sort(function(e,t){return t.occ-e.occ}),i=Math.min(i,h.length);var E=new Uint8Array(4*i);for(u=0;u<i;u++){var T=u<<2,k=h[u];E[T]=k.r,E[T+1]=k.g,E[T+2]=k.b,E[T+3]=k.a}h=E;for(var x=Math.max(1,Math.min(10,Math.floor(1024/i))),S=0;S<x;S++){var I=new Uint32Array(i),A=new Uint32Array(4*i),M=new Uint32Array(i),N=new Uint32Array(i);for(u=0;u<i;u++){var C=h[T=u<<2],O=h[T+1],D=h[T+2],R=(c=h[T+3],0);F=1e9;for(var B=0;B<i;B++){if(B!=u)(U=l(C,O,D,c,h,B<<2))<F&&(R=B,F=U)}M[u]=F,N[u]=R}for(u=0;u<o;u++){R=0;var F=1e9;if((F=l(C=a[T=u<<2],O=a[T+1],D=a[T+2],c=a[T+3],h,(R=s[u])<<2))<=M[R]>>1);else for(B=0;B<i;B++){if((U=l(C,O,D,c,h,B<<2))<F){if(F=U,U<=M[R=B]>>1)break;var U;if((U=l(C,O,D,c,h,N[B]<<2))<=M[R]>>1){R=N[B];break}}}s[u]=R,I[R]++,A[P=R<<2]+=C,A[P+1]+=O,A[P+2]+=D,A[P+3]+=c}for(u=0;u<i;u++){T=u<<2;var L=1/I[u];h[T]=A[T]*L,h[T+1]=A[T+1]*L,h[T+2]=A[T+2]*L,h[T+3]=A[T+3]*L}}for(u=0;u<o;u++){T=u<<2;var P,j=0==h[(P=(R=s[u])<<2)+3]?0:255/h[P+3];a[T+0]=h[P+0]*j,a[T+1]=h[P+1]*j,a[T+2]=h[P+2]*j,a[T+3]=h[P+3]}return a},e.quantize.dist=function(e,t,r,n,i,a){var s=i[a],o=i[a+1],l=i[a+2],u=i[a+3];return(s-e)*(s-e)+(o-t)*(o-t)+(l-r)*(l-r)+(u-n)*(u-n)},e.quantize.dither=function(t,r,n,i,a,s){for(var o=new Float32Array(r*n*4),l=1/16,u=e.quantize.dist,c=Math.round,h=r<<2,f=0;f<n;f++)for(var d=0;d<r;d++){for(var p=f*r+d,g=p<<2,_=0;_<4;_++)o[g+_]=Math.max(-8,Math.min(8,o[g+_]));var y=c(t[g]+o[g]),m=c(t[g+1]+o[g+1]),v=c(t[g+2]+o[g+2]),b=c(t[g+3]+o[g+3]),w=0,E=1e9;for(_=0;_<s;_++){var T=u(y,m,v,b,a,_<<2);T<E&&(w=_,E=T)}i[p]=w;var k=w<<2,x=y-a[k],S=m-a[k+1],I=v-a[k+2],A=b-a[k+3];o[g+4+0]+=7*x*l,o[g+4+1]+=7*S*l,o[g+4+2]+=7*I*l,o[g+4+3]+=7*A*l,o[g+h-4+0]+=3*x*l,o[g+h-4+1]+=3*S*l,o[g+h-4+2]+=3*I*l,o[g+h-4+3]+=3*A*l,o[g+h+0]+=5*x*l,o[g+h+1]+=5*S*l,o[g+h+2]+=5*I*l,o[g+h+3]+=5*A*l,o[g+h+4+0]+=1*x*l,o[g+h+4+1]+=1*S*l,o[g+h+4+2]+=1*I*l,o[g+h+4+3]+=1*A*l}},e.decode=function(t){for(var n=new Uint8Array(t),i=8,a=e._bin,s=a.readUshort,o={tabs:{}},l=new Uint8Array(n.length),u=0;;){var c=a.readUint(n,i);i+=4;var h=a.readASCII(n,i,4);if(i+=4,"IHDR"==h)e.decode._IHDR(n,i,o);else if("IDAT"==h){for(var f=0;f<c;f++)l[u+f]=n[i+f];u+=c}else if("pHYs"==h)o.tabs[h]=[a.readUint(n,i),a.readUint(n,i+4),n[i+8]];else if("cHRM"==h){o.tabs[h]=[];for(f=0;f<8;f++)o.tabs[h].push(a.readUint(n,i+4*f))}else if("tEXt"==h){null==o.tabs[h]&&(o.tabs[h]={});var d=a.nextZero(n,i),p=a.readASCII(n,i,d-i),g=a.readASCII(n,d+1,i+c-d-1);o.tabs[h][p]=g}else if("iTXt"==h){null==o.tabs[h]&&(o.tabs[h]={});d=0;var _=i;d=a.nextZero(n,_);p=a.readASCII(n,_,d-_);_=d+1,_+=2,d=a.nextZero(n,_);a.readASCII(n,_,d-_);_=d+1,d=a.nextZero(n,_);a.readUTF8(n,_,d-_);_=d+1;g=a.readUTF8(n,_,c-(_-i));o.tabs[h][p]=g}else if("PLTE"==h)o.tabs[h]=a.readBytes(n,i,c);else if("hIST"==h){var y=o.tabs.PLTE.length/3;o.tabs[h]=[];for(f=0;f<y;f++)o.tabs[h].push(s(n,i+2*f))}else if("tRNS"==h)3==o.ctype?o.tabs[h]=a.readBytes(n,i,c):0==o.ctype?o.tabs[h]=s(n,i):2==o.ctype?o.tabs[h]=[s(n,i),s(n,i+2),s(n,i+4)]:r("tRNS for unsupported color type",o.ctype,c);else if("gAMA"==h)o.tabs[h]=a.readUint(n,i)/1e5;else if("sRGB"==h)o.tabs[h]=n[i];else if("bKGD"==h)0==o.ctype||4==o.ctype?o.tabs[h]=[s(n,i)]:2==o.ctype||6==o.ctype?o.tabs[h]=[s(n,i),s(n,i+2),s(n,i+4)]:3==o.ctype&&(o.tabs[h]=n[i]);else{if("IEND"==h){0==o.compress?l=e.decode._inflate(l):r("unsupported compression method:",o.interlace),0!=o.filter&&r("unsupported filter method:",o.filter),0==o.interlace?o.data=e.decode._filterZero(l,o,0,o.width,o.height):1==o.interlace?o.data=e.decode._readInterlace(l,o):r("unsupported interlace method:",o.interlace);break}r("unknown chunk type",h,c)}i+=c;a.readUint(n,i);i+=4}return delete o.compress,delete o.interlace,delete o.filter,o},e.decode._inflate=function(e){return t.inflate(e)},e.decode._readInterlace=function(t,r){for(var n=r.width,i=r.height,a=e.decode._getBPP(r),s=a>>3,o=Math.ceil(n*a/8),l=new Uint8Array(i*o),u=0,c=[0,0,4,0,2,0,1],h=[0,4,0,2,0,1,0],f=[8,8,8,4,4,2,2],d=[8,8,4,4,2,2,1],p=0;p<7;){for(var g=f[p],_=d[p],y=0,m=0,v=c[p];v<i;)v+=g,m++;for(var b=h[p];b<n;)b+=_,y++;var w=Math.ceil(y*a/8);e.decode._filterZero(t,r,u,y,m);for(var E=0,T=c[p];T<i;){for(var k=h[p],x=u+E*w<<3;k<n;){var S;if(1==a)S=(S=t[x>>3])>>7-(7&x)&1,l[T*o+(k>>3)]|=S<<7-((3&k)<<0);if(2==a)S=(S=t[x>>3])>>6-(7&x)&3,l[T*o+(k>>2)]|=S<<6-((3&k)<<1);if(4==a)S=(S=t[x>>3])>>4-(7&x)&15,l[T*o+(k>>1)]|=S<<4-((1&k)<<2);if(a>=8)for(var I=T*o+k*s,A=0;A<s;A++)l[I+A]=t[(x>>3)+A];x+=a,k+=_}E++,T+=g}y*m!=0&&(u+=m*(1+w)),p+=1}return l},e.decode._getBPP=function(e){var t=[1,null,3,1,2,null,4][e.ctype];return null==t&&r("unsupported color type",e.ctype),t*e.depth},e.decode._filterZero=function(t,r,n,i,a){var s=e.decode._getBPP(r),o=Math.ceil(i*s/8),l=e.decode._paeth;s=Math.ceil(s/8);for(var u=0;u<a;u++){var c=n+u*o,h=c+u+1,f=t[h-1];if(0==f)for(var d=0;d<o;d++)t[c+d]=t[h+d];else if(1==f){for(d=0;d<s;d++)t[c+d]=t[h+d];for(d=s;d<o;d++)t[c+d]=t[h+d]+t[c+d-s]&255}else if(0==u){for(d=0;d<s;d++)t[c+d]=t[h+d];if(2==f)for(d=s;d<o;d++)t[c+d]=255&t[h+d];if(3==f)for(d=s;d<o;d++)t[c+d]=t[h+d]+(t[c+d-s]>>1)&255;if(4==f)for(d=s;d<o;d++)t[c+d]=t[h+d]+l(t[c+d-s],0,0)&255}else{if(2==f)for(d=0;d<o;d++)t[c+d]=t[h+d]+t[c+d-o]&255;if(3==f){for(d=0;d<s;d++)t[c+d]=t[h+d]+(t[c+d-o]>>1)&255;for(d=s;d<o;d++)t[c+d]=t[h+d]+(t[c+d-o]+t[c+d-s]>>1)&255}if(4==f){for(d=0;d<s;d++)t[c+d]=t[h+d]+l(0,t[c+d-o],0)&255;for(d=s;d<o;d++)t[c+d]=t[h+d]+l(t[c+d-s],t[c+d-o],t[c+d-s-o])&255}}}return t},e.decode._paeth=function(e,t,r){var n=e+t-r,i=Math.abs(n-e),a=Math.abs(n-t),s=Math.abs(n-r);return i<=a&&i<=s?e:a<=s?t:r},e.decode._IHDR=function(t,r,n){var i=e._bin;n.width=i.readUint(t,r),r+=4,n.height=i.readUint(t,r),r+=4,n.depth=t[r],r++,n.ctype=t[r],r++,n.compress=t[r],r++,n.filter=t[r],r++,n.interlace=t[r],r++},e._bin={nextZero:function(e,t){for(;0!=e[t];)t++;return t},readUshort:function(e,t){return e[t]<<8|e[t+1]},writeUshort:function(e,t,r){e[t]=r>>8&255,e[t+1]=255&r},readUint:function(e,t){return 16777216*e[t]+(e[t+1]<<16|e[t+2]<<8|e[t+3])},writeUint:function(e,t,r){e[t]=r>>24&255,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=255&r},readASCII:function(e,t,r){for(var n="",i=0;i<r;i++)n+=String.fromCharCode(e[t+i]);return n},writeASCII:function(e,t,r){for(var n=0;n<r.length;n++)e[t+n]=r.charCodeAt(n)},readBytes:function(e,t,r){for(var n=[],i=0;i<r;i++)n.push(e[t+i]);return n},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(t,r,n){for(var i,a="",s=0;s<n;s++)a+="%"+e._bin.pad(t[r+s].toString(16));try{i=decodeURIComponent(a)}catch(i){return e._bin.readASCII(t,r,n)}return i}}}(t,"function"==typeof commonjsRequire?pako_1:window.pako)}()}),PngDecoder=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setMetadata("targetType",Image2D.name),e.addInputValidator(0,ArrayBuffer),e}return inherits(t,Decoder),createClass(t,[{key:"_run",value:function(){var e=this._getInput(0);if(e)if(this._isPng(e))try{var t=UPNG.decode(e),r=Math.round(t.data.length/(t.width*t.height)),n=new Image2D,i=new t.data.constructor(t.data.buffer,0,t.width*t.height*r);n.setData(i,t.width,t.height,r),this._output[0]=n}catch(e){console.warn(e)}else console.warn("This is not a PNG file, unable to decode this file.");else console.warn('PngDecoder requires an ArrayBuffer as input "0". Unable to continue.')}},{key:"_isPng",value:function(e){for(var t=new Uint8Array(e,0,8),r=new Uint8Array([137,80,78,71,13,10,26,10]),n=0;n<t.length;n++)if(t[n]!=r[n])return!1;return!0}}]),t}(),Image2DGenericDecoder=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setMetadata("enablePixBin",!0),e._decoders=[TiffDecoder,JpegDecoder,PngDecoder],e}return inherits(t,GenericDecoderInterface),t}(),mniobjparser_umd=createCommonjsModule(function(e,t){!function(e){var t=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),n=function(){function e(){t(this,e),this._stack=null,this._stackIndex=null,this._tempResult=null,this._shapeData=null}return r(e,[{key:"copy",value:function(e){this._stack=e._stack,this._stackIndex=e._stackIndex,this._tempResult=e._tempResult,this._shapeData=e._shapeData}},{key:"parse",value:function(e){try{this._parseRawData(e),this._arrangeData()}catch(e){console.warn("MNI OBJ file is invalid."),console.warn(e)}}},{key:"_parseRawData",value:function(e){this._stack=e.trim().split(/\s+/).reverse(),this._stackIndex=this._stack.length-1,this._tempResult={};var t,r,n,i,a,s,o,l=this._popStack(),u=null;if(this._tempResult.type="P"===l?"polygon":"L"===l?"line":l,"polygon"===this._tempResult.type)this._parseSurfProp(),this._tempResult.numVertices=parseInt(this._popStack(),10),this._parseVertices(),this._parseNormals(),this._tempResult.nitems=parseInt(this._popStack(),10);else{if("line"!==this._tempResult.type)return this._tempResult.error=!0,void(this._tempResult.errorMessage='Invalid MNI Object class: must be "polygon" or "line"');this._parseSurfProp(),this._tempResult.numVertices=parseInt(this._popStack(),10),this._parseVertices(),this._tempResult.nitems=parseInt(this._popStack(),10)}if(this._parseColors(),this._parseEndIndices(),this._parseIndices(),"polygon"===this._tempResult.type);else if("line"===this._tempResult.type){i=this._tempResult.indices,a=this._tempResult.endIndices,n=this._tempResult.nitems,s=o=0;for(var c=0;c<n;c++)t=0===c?0:a[c-1],r=a[c],s+=2*(r-t-1);u=new Uint32Array(s);for(var c=0;c<n;c++){t=0===c?0:a[c-1],u[o++]=i[t],r=a[c];for(var h=t+1;h<r-1;h++)u[o++]=i[h],u[o++]=i[h];u[o++]=i[r-1]}this._tempResult.indices=u}}},{key:"_arrangeData",value:function(){this._shapeData={type:this._tempResult.type,vertices:this._tempResult.vertices,normals:this._tempResult.normals,colors:this._tempResult.colors,surfaceProperties:this._tempResult.surfaceProperties,error:this._tempResult.error,errorMessage:this._tempResult.errorMessage};var e=[this._shapeData.vertices.buffer,this._shapeData.colors.buffer];this._shapeData.normals&&e.push(this._shapeData.normals.buffer),this._shapeData.shapes=this._tempResult.indices,e.push(this._tempResult.indices.buffer),4===this._shapeData.colors.length&&this._unrollColors()}},{key:"_unrollColors",value:function(){var e,t,r,n,i=this._shapeData.vertices.length/3,a=4*i,s=new Uint8Array(a);e=this._shapeData.colors[0],t=this._shapeData.colors[1],r=this._shapeData.colors[2],n=this._shapeData.colors[3];for(var o=0;o<a;o+=4)s[o]=255*e,s[o+1]=255*t,s[o+2]=255*r,s[o+3]=255*n;this._shapeData.colors=s}},{key:"_parseSurfProp",value:function(){"polygon"===this._tempResult.type?this._tempResult.surfaceProperties={ambient:parseFloat(this._popStack()),diffuse:parseFloat(this._popStack()),specularReflectance:parseFloat(this._popStack()),specularScattering:parseFloat(this._popStack()),transparency:parseFloat(this._popStack())}:"line"===this._tempResult.type&&(this._tempResult.surfaceProperties={width:this._popStack()})}},{key:"_parseVertices",value:function(){for(var e=3*this._tempResult.numVertices,t=new Float32Array(e),r=0;r<e;r++)t[r]=parseFloat(this._popStack());this._tempResult.vertices=t}},{key:"_parseNormals",value:function(){for(var e=3*this._tempResult.numVertices,t=new Float32Array(e),r=0;r<e;r++)t[r]=parseFloat(this._popStack());this._tempResult.normals=t}},{key:"_parseColors",value:function(){var e,t,r=parseInt(this._popStack(),10);if(0===r){e=new Float32Array(4);for(var n=0;n<4;n++)e[n]=parseFloat(this._popStack())}else if(1===r){t=4*this._tempResult.num_polygons,e=new Float32Array(t);for(var n=0;n<t;n++)e[n]=parseFloat(this._popStack())}else if(2===r){t=4*this._tempResult.numVertices,e=new Float32Array(t);for(var n=0;n<t;n++)e[n]=parseFloat(this._popStack())}else this._tempResult.error=!0,this._tempResult.errorMessage="Invalid color flag: "+r;this._tempResult.colorFlag=r,this._tempResult.colors=e}},{key:"_parseEndIndices",value:function(){for(var e=this._tempResult.nitems,t=new Uint32Array(e),r=0;r<e;r++)t[r]=parseInt(this._popStack(),10);this._tempResult.endIndices=t}},{key:"_parseIndices",value:function(){for(var e=this._stackIndex+1,t=new Uint32Array(e),r=0;r<e;r++)t[r]=parseInt(this._popStack(),10);this._tempResult.indices=t}},{key:"_popStack",value:function(){return this._stack[this._stackIndex--]}},{key:"isValid",value:function(){return!this._shapeData.error}},{key:"getErrorMessage",value:function(){return this._shapeData.errorMessage}},{key:"getShapeData",value:function(){return this._shapeData}},{key:"getShapeRawIndices",value:function(){return this._shapeData.error?(console.warn("ERROR while parsing: "+this._shapeData.errorMessage),null):this._shapeData.shapes}},{key:"getRawVertices",value:function(){return this._shapeData.error?(console.warn("ERROR while parsing: "+this._shapeData.errorMessage),null):this._shapeData.vertices}},{key:"getRawNormals",value:function(){return this._shapeData.error?(console.warn("ERROR while parsing: "+this._shapeData.errorMessage),null):this._shapeData.normals}},{key:"getRawColors",value:function(){return this._shapeData.error?(console.warn("ERROR while parsing: "+this._shapeData.errorMessage),null):this._shapeData.colors}},{key:"getSurfaceProperties",value:function(){return this._shapeData.error?(console.warn("ERROR while parsing: "+this._shapeData.errorMessage),null):this._shapeData.surfaceProperties}},{key:"getType",value:function(){return this._shapeData.type}},{key:"isPolygon",value:function(){return"polygon"===this._shapeData.type}},{key:"isLine",value:function(){return"line"===this._shapeData.type}}]),e}();e.MniObjParser=n,Object.defineProperty(e,"__esModule",{value:!0})}(t)}),mniobjparser=unwrapExports(mniobjparser_umd),MniObjDecoder=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setMetadata("targetType",Mesh3D.name),e}return inherits(t,Decoder),createClass(t,null,[{key:"isBinary",value:function(){return!1}}]),createClass(t,[{key:"_run",value:function(){var e=this._getInput();if(e){var t=new mniobjparser.MniObjParser;if(t.parse(e),t.isValid())if(t.isPolygon()){var r=t.getRawVertices(),n=t.getShapeRawIndices(),i=t.getRawNormals(),a=t.getRawColors(),s=(t.getSurfaceProperties(),new Mesh3D);s.setVertexPositions(r),s.setPolygonFacesOrder(n),s.setPolygonFacesNormals(i),s.setVertexColors(a),s.setNumberOfVerticesPerShapes(3),s.setNumberOfComponentsPerColor(4),this._output[0]=s}else console.warn("The MNI OBJ file is valid but does not describe a 3D mesh.");else console.warn("Invalid MNI OBJ file.\nERROR: "+t.getErrorMessage())}else console.warn("Invalid input for MniObjDecoder")}}]),t}(),edfdecoder_umd=createCommonjsModule(function(e,t){!function(e){"undefined"!=typeof window?window:void 0!==commonjsGlobal||"undefined"!=typeof self&&self;var t,r,n=(function(e,t){!function(e){var t,r=(function(e){var t=e.exports=function(e){return new r(e)};function r(e){this.value=e}function n(e,t,r){var n=[],s=[],c=!0;return function e(h){var f=r?i(h):h,d={},p=!0,g={node:f,node_:h,path:[].concat(n),parent:s[s.length-1],parents:s,key:n.slice(-1)[0],isRoot:0===n.length,level:n.length,circular:null,update:function(e,t){g.isRoot||(g.parent.node[g.key]=e),g.node=e,t&&(p=!1)},delete:function(e){delete g.parent.node[g.key],e&&(p=!1)},remove:function(e){o(g.parent.node)?g.parent.node.splice(g.key,1):delete g.parent.node[g.key],e&&(p=!1)},keys:null,before:function(e){d.before=e},after:function(e){d.after=e},pre:function(e){d.pre=e},post:function(e){d.post=e},stop:function(){c=!1},block:function(){p=!1}};if(!c)return g;function _(){if("object"===_typeof(g.node)&&null!==g.node){g.keys&&g.node_===g.node||(g.keys=a(g.node)),g.isLeaf=0==g.keys.length;for(var e=0;e<s.length;e++)if(s[e].node_===h){g.circular=s[e];break}}else g.isLeaf=!0,g.keys=null;g.notLeaf=!g.isLeaf,g.notRoot=!g.isRoot}_();var y=t.call(g,g.node);return void 0!==y&&g.update&&g.update(y),d.before&&d.before.call(g,g.node),p?("object"!=_typeof(g.node)||null===g.node||g.circular||(s.push(g),_(),l(g.keys,function(t,i){n.push(t),d.pre&&d.pre.call(g,g.node[t],t);var a=e(g.node[t]);r&&u.call(g.node,t)&&(g.node[t]=a.node),a.isLast=i==g.keys.length-1,a.isFirst=0==i,d.post&&d.post.call(g,a),n.pop()}),s.pop()),d.after&&d.after.call(g,g.node),g):g}(e).node}function i(e){if("object"===(void 0===e?"undefined":_typeof(e))&&null!==e){var t;if(o(e))t=[];else if("[object Date]"===s(e))t=new Date(e.getTime?e.getTime():e);else if(function(e){return"[object RegExp]"===s(e)}(e))t=new RegExp(e);else if(function(e){return"[object Error]"===s(e)}(e))t={message:e.message};else if(function(e){return"[object Boolean]"===s(e)}(e))t=new Boolean(e);else if(function(e){return"[object Number]"===s(e)}(e))t=new Number(e);else if(function(e){return"[object String]"===s(e)}(e))t=new String(e);else if(Object.create&&Object.getPrototypeOf)t=Object.create(Object.getPrototypeOf(e));else if(e.constructor===Object)t={};else{var r=e.constructor&&e.constructor.prototype||e.__proto__||{},n=function(){};n.prototype=r,t=new n}return l(a(e),function(r){t[r]=e[r]}),t}return e}r.prototype.get=function(e){for(var t=this.value,r=0;r<e.length;r++){var n=e[r];if(!t||!u.call(t,n)){t=void 0;break}t=t[n]}return t},r.prototype.has=function(e){for(var t=this.value,r=0;r<e.length;r++){var n=e[r];if(!t||!u.call(t,n))return!1;t=t[n]}return!0},r.prototype.set=function(e,t){for(var r=this.value,n=0;n<e.length-1;n++){var i=e[n];u.call(r,i)||(r[i]={}),r=r[i]}return r[e[n]]=t,t},r.prototype.map=function(e){return n(this.value,e,!0)},r.prototype.forEach=function(e){return this.value=n(this.value,e,!1),this.value},r.prototype.reduce=function(e,t){var r=1===arguments.length,n=r?this.value:t;return this.forEach(function(t){this.isRoot&&r||(n=e.call(this,n,t))}),n},r.prototype.paths=function(){var e=[];return this.forEach(function(t){e.push(this.path)}),e},r.prototype.nodes=function(){var e=[];return this.forEach(function(t){e.push(this.node)}),e},r.prototype.clone=function(){var e=[],t=[];return function r(n){for(var s=0;s<e.length;s++)if(e[s]===n)return t[s];if("object"===(void 0===n?"undefined":_typeof(n))&&null!==n){var o=i(n);return e.push(n),t.push(o),l(a(n),function(e){o[e]=r(n[e])}),e.pop(),t.pop(),o}return n}(this.value)};var a=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};function s(e){return Object.prototype.toString.call(e)}var o=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},l=function(e,t){if(e.forEach)return e.forEach(t);for(var r=0;r<e.length;r++)t(e[r],r,e)};l(a(r.prototype),function(e){t[e]=function(t){var n=[].slice.call(arguments,1),i=new r(t);return i[e].apply(i,n)}});var u=Object.hasOwnProperty||function(e,t){return t in e}}(t={exports:{}}),t.exports),n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function(){function e(){n(this,e)}return i(e,null,[{key:"isPlatformLittleEndian",value:function(){var e=new Uint32Array([305419896]),t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);return 18!=t[0]}},{key:"arrayBufferToUnicode",value:function(e){for(var t=new Uint8Array(e),r=[],n=0,i=0;n<t.length;){var a=t[n++];if(a<128){if(a<32&&10!=a&&13!=a&&9!=a||127==a)return console.warn("Invalid string: non-printable characters"),null;r[i++]=String.fromCharCode(a)}else if(a>191&&a<224){var s=t[n++];r[i++]=String.fromCharCode((31&a)<<6|63&s)}else if(a>239&&a<365){var s=t[n++],o=t[n++],l=t[n++],u=((7&a)<<18|(63&s)<<12|(63&o)<<6|63&l)-65536;r[i++]=String.fromCharCode(55296+(u>>10)),r[i++]=String.fromCharCode(56320+(1023&u))}else{var s=t[n++],o=t[n++],c=(15&a)<<12|(63&s)<<6|63&o;if(65533===c)return console.warn("Invalid string: a REPLACEMENT CHARACTER was spotted"),null;r[i++]=String.fromCharCode(c)}}return r.join("")}},{key:"unicodeToArrayBuffer",value:function(e){for(var t=[],r=0,n=0;n<e.length;n++){var i=e.charCodeAt(n);i<128?t[r++]=i:i<2048?(t[r++]=i>>6|192,t[r++]=63&i|128):55296==(64512&i)&&n+1<e.length&&56320==(64512&e.charCodeAt(n+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++n)),t[r++]=i>>18|240,t[r++]=i>>12&63|128,t[r++]=i>>6&63|128,t[r++]=63&i|128):(t[r++]=i>>12|224,t[r++]=i>>6&63|128,t[r++]=63&i|128)}return new Uint8Array(t).buffer}},{key:"arrayBufferToString8",value:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}},{key:"string8ToArrayBuffer",value:function(e){for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return t}},{key:"setString8InBuffer",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(r<0)console.warn("The byte offset cannot be negative.");else if(t&&t instanceof ArrayBuffer)if(e.length+r>t.byteLength)console.warn("The string is too long to be writen in this buffer.");else for(var n=new Uint8Array(t),i=0;i<e.length;i++)n[i+r]=e.charCodeAt(i);else console.warn("The buffer must be a valid ArrayBuffer.")}},{key:"getString8FromBuffer",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return r<0?(console.warn("The byte offset cannot be negative."),null):e&&e instanceof ArrayBuffer?t+r>e.byteLength?(console.warn("The string is too long to be writen in this buffer."),null):String.fromCharCode.apply(null,new Uint8Array(e,r,t)):(console.warn("The buffer must be a valid ArrayBuffer."),null)}},{key:"objectToArrayBuffer",value:function(t){var r=null,n=e.makeSerializeFriendly(t);try{var i=JSON.stringify(n);r=e.unicodeToArrayBuffer(i)}catch(e){console.warn(e)}return r}},{key:"ArrayBufferToObject",value:function(t){var r=null;try{var n=e.arrayBufferToUnicode(t);r=JSON.parse(n)}catch(e){console.warn(e)}return r}},{key:"isTypedArray",value:function(e){return e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array}},{key:"mergeBuffers",value:function(e){for(var t=0,r=0;r<e.length;r++)t+=e[r].byteLength;for(var n=new Uint8Array(t),i=0,r=0;r<e.length;r++)n.set(new Uint8Array(e[r]),i),i+=e[r].byteLength;return n.buffer}},{key:"getGlobalObject",value:function(){var e=null;try{e=window}catch(t){try{e=GLOBAL}catch(e){return console.warn("You are not in a Javascript environment?? Weird."),null}}return e}},{key:"extractTypedArray",value:function(e,t,r,n){if(!e)return console.warn("Input Buffer is null."),null;if(!(e instanceof ArrayBuffer))return console.warn("Buffer must be of type ArrayBuffer"),null;if(n<=0)return console.warn("The number of elements to fetch must be greater than 0"),null;if(t<0)return console.warn("The byte offset must be possitive or 0"),null;if(t>=e.byteLength)return console.warn("The offset cannot be larger than the size of the buffer."),null;if(r instanceof Function&&!("BYTES_PER_ELEMENT"in r))return console.warn("ArrayType must be a typed array constructor function."),null;if(!(r.BYTES_PER_ELEMENT*n+t>e.byteLength)){var i=e.slice(t,t+n*r.BYTES_PER_ELEMENT);return new r(i)}console.warn("The requested number of elements is too large for this buffer")}},{key:"getTypedArrayInfo",value:function(e){var t=null,r=!1;return e instanceof Int8Array?(t="int",r=!1):e instanceof Uint8Array?(t="int",r=!0):e instanceof Uint8ClampedArray?(t="int",r=!0):e instanceof Int16Array?(t="int",r=!1):e instanceof Uint16Array?(t="int",r=!0):e instanceof Int32Array?(t="int",r=!1):e instanceof Uint32Array?(t="int",r=!0):e instanceof Float32Array?(t="float",r=!1):e instanceof Float64Array&&(t="float",r=!1),{type:t,signed:r,bytesPerElements:e.BYTES_PER_ELEMENT,byteLength:e.byteLength,length:e.length}}},{key:"howManyTypedArrayAttributes",value:function(t){var n=0;return r(t).forEach(function(t){n+=e.isTypedArray(t)}),n}},{key:"hasCircularReference",value:function(e){var t=!1;return r(e).forEach(function(e){this.circular&&(t=!0)}),t}},{key:"removeCircularReference",value:function(e){var t=!1,n=r(e).map(function(e){this.circular&&(this.remove(),t=!0)});return t?n:null}},{key:"replaceTypedArrayAttributesByArrays",value:function(t){var n=!1,i=r(t).map(function(t){if(e.isTypedArray(t)){for(var r=Object.keys(t).length,i=new Array(r),a=0;a<r;a++)i[a]=t[a];this.update(i),n=!0}});return n?i:null}},{key:"makeSerializeFriendly",value:function(t){var r=t,n=e.removeCircularReference(r);n&&(r=n);var i=e.replaceTypedArrayAttributesByArrays(r);return i&&(r=i),r}},{key:"isValidString",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e.length,n=t?r:Math.min(1e3,r),i=0,a=0;a<n;a++){var s=e.charCodeAt(Math.floor(Math.random()*n));(65533===s||s<32&&10!=s&&13!=s&&9!=s||127==s)&&i++}return!(i>0)}}]),e}();e.CodecUtils=a,Object.defineProperty(e,"__esModule",{value:!0})}(t)}(r={exports:{}},r.exports),(t=r.exports)&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t),i=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=function(){function e(t,r,n){i(this,e),this._header=t,this._physicalSignals=n,this._rawSignals=r}return a(e,[{key:"getRecordDuration",value:function(){return this._header.durationDataRecordsSec}},{key:"getRecordingID",value:function(){return this._header.localRecordingId}},{key:"getNumberOfRecords",value:function(){return this._header.nbDataRecords}},{key:"getNumberOfSignals",value:function(){return this._header.nbSignals}},{key:"getPatientID",value:function(){return this._header.patientId}},{key:"getRecordingStartDate",value:function(){return this._header.recordingDate}},{key:"getReservedField",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;return-1===e?this._header.reserved:e>=0&&e<this._header.signalInfo.length?this._header.signalInfo[e].reserved:null}},{key:"getSignalDigitalMax",value:function(e){return e<0||e>=this._header.signalInfo.length?(console.warn("Signal index is out of range"),null):this._header.signalInfo[e].digitalMaximum}},{key:"getSignalDigitalMin",value:function(e){return e<0||e>=this._header.signalInfo.length?(console.warn("Signal index is out of range"),null):this._header.signalInfo[e].digitalMinimum}},{key:"getSignalPhysicalMin",value:function(e){return e<0||e>=this._header.signalInfo.length?(console.warn("Signal index is out of range"),null):this._header.signalInfo[e].physicalMinimum}},{key:"getSignalPhysicalMax",value:function(e){return e<0||e>=this._header.signalInfo.length?(console.warn("Signal index is out of range"),null):this._header.signalInfo[e].physicalMaximum}},{key:"getSignalLabel",value:function(e){return e<0||e>=this._header.signalInfo.length?(console.warn("Signal index is out of range"),null):this._header.signalInfo[e].label}},{key:"getSignalNumberOfSamplesPerRecord",value:function(e){return e<0||e>=this._header.signalInfo.length?(console.warn("Signal index is out of range"),null):this._header.signalInfo[e].nbOfSamples}},{key:"getSignalPhysicalUnit",value:function(e){return e<0||e>=this._header.signalInfo.length?(console.warn("Signal index is out of range"),null):this._header.signalInfo[e].physicalDimension}},{key:"getSignalPrefiltering",value:function(e){return e<0||e>=this._header.signalInfo.length?(console.warn("Signal index is out of range"),null):this._header.signalInfo[e].prefiltering}},{key:"getSignalTransducerType",value:function(e){return e<0||e>=this._header.signalInfo.length?(console.warn("Signal index is out of range"),null):this._header.signalInfo[e].transducerType}},{key:"getSignalSamplingFrequency",value:function(e){return e<0||e>=this._header.signalInfo.length?(console.warn("Signal index is out of range"),null):this._header.signalInfo[e].nbOfSamples/this._header.durationDataRecordsSec}},{key:"getPhysicalSignal",value:function(e,t){return e<0||e>=this._header.signalInfo.length?(console.warn("Signal index is out of range"),null):t<0&&t>=this._physicalSignals[e].length?(console.warn("Record index is out of range"),null):this._physicalSignals[e][t]}},{key:"getRawSignal",value:function(e,t){return e<0||e>=this._header.signalInfo.length?(console.warn("Signal index is out of range"),null):t<0&&t>=this._rawSignals[e].length?(console.warn("Record index is out of range"),null):this._rawSignals[e][t]}},{key:"getPhysicalSignalConcatRecords",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(e<0||e>=this._header.signalInfo.length)return console.warn("Signal index is out of range"),null;if(t<0&&t>=this._physicalSignals[e].length)return console.warn("The index recordStart is out of range"),null;-1===t&&(t=0),-1===r?r=this._physicalSignals[e].length-t:t+r>this._physicalSignals[e].length&&(console.warn("The number of requested records is too large. Forcing only to available records."),r=this._physicalSignals[e].length-t);var n=t+r-1;if(n<0&&n>=this._physicalSignals[e].length)return console.warn("Too many records to concatenate, this goes out of range."),null;for(var i=0,a=t;a<t+r;a++)i+=this._physicalSignals[e][a].length;for(var s=new Float32Array(i),o=0,a=t;a<t+r;a++)s.set(this._physicalSignals[e][a],o),o+=this._physicalSignals[e][a].length;return s}}]),e}(),o=function(){function e(){i(this,e),this._inputBuffer=null,this._output=null}return a(e,[{key:"setInput",value:function(e){this._output=null,this._inputBuffer=e}},{key:"decode",value:function(){try{var e=this._decodeHeader();this._decodeData(e.offset,e.header)}catch(e){console.warn(e)}}},{key:"_decodeHeader",value:function(){if(this._inputBuffer){var e={},t=0;e.dataFormat=n.CodecUtils.getString8FromBuffer(this._inputBuffer,8,t).trim(),t+=8,e.patientId=n.CodecUtils.getString8FromBuffer(this._inputBuffer,80,t).trim(),t+=80,e.localRecordingId=n.CodecUtils.getString8FromBuffer(this._inputBuffer,80,t).trim(),t+=80;var r=n.CodecUtils.getString8FromBuffer(this._inputBuffer,8,t).trim();t+=8;var i=n.CodecUtils.getString8FromBuffer(this._inputBuffer,8,t).trim();t+=8;var a=r.split("."),s=i.split(".");e.recordingDate=new Date(a[2],a[1],a[0],s[0],s[1],s[2],0),e.nbBytesHeaderRecord=parseInt(n.CodecUtils.getString8FromBuffer(this._inputBuffer,8,t).trim()),t+=8,e.reserved=n.CodecUtils.getString8FromBuffer(this._inputBuffer,44,t),t+=44,e.nbDataRecords=parseInt(n.CodecUtils.getString8FromBuffer(this._inputBuffer,8,t).trim()),t+=8,e.durationDataRecordsSec=parseInt(n.CodecUtils.getString8FromBuffer(this._inputBuffer,8,t).trim()),t+=8,e.nbSignals=parseInt(n.CodecUtils.getString8FromBuffer(this._inputBuffer,4,t).trim()),t+=4;var o=this,l={label:h(16),transducerType:h(80),physicalDimension:h(8),physicalMinimum:h(8),physicalMaximum:h(8),digitalMinimum:h(8),digitalMaximum:h(8),prefiltering:h(80),nbOfSamples:h(8),reserved:h(32)},u=[];e.signalInfo=u;for(var c=0;c<e.nbSignals;c++)u.push({label:l.label[c],transducerType:l.transducerType[c],physicalDimension:l.physicalDimension[c],physicalMinimum:parseFloat(l.physicalMinimum[c]),physicalMaximum:parseFloat(l.physicalMaximum[c]),digitalMinimum:parseInt(l.digitalMinimum[c]),digitalMaximum:parseInt(l.digitalMaximum[c]),prefiltering:l.prefiltering[c],nbOfSamples:parseInt(l.nbOfSamples[c]),reserved:l.reserved[c]});return{offset:t,header:e}}function h(r){for(var i=[],a=0;a<e.nbSignals;a++)i.push(n.CodecUtils.getString8FromBuffer(o._inputBuffer,r,t).trim()),t+=r;return i}console.warn("A input buffer must be specified.")}},{key:"_decodeData",value:function(e,t){if(this._inputBuffer)if(t){for(var r=Int16Array,i=new Array(t.nbSignals),a=new Array(t.nbSignals),o=0;o<t.nbSignals;o++)i[o]=new Array(t.nbDataRecords),a[o]=new Array(t.nbDataRecords);for(var l=0;l<t.nbDataRecords;l++)for(var o=0;o<t.nbSignals;o++){var u=t.signalInfo[o].nbOfSamples,c=n.CodecUtils.extractTypedArray(this._inputBuffer,e,r,u);e+=u*r.BYTES_PER_ELEMENT,i[o][l]=c;for(var h=new Float32Array(c.length).fill(0),f=t.signalInfo[o].digitalMaximum-t.signalInfo[o].digitalMinimum,d=t.signalInfo[o].physicalMaximum-t.signalInfo[o].physicalMinimum,p=0;p<u;p++)h[p]=(c[p]-t.signalInfo[o].digitalMinimum)/f*d+t.signalInfo[o].physicalMinimum;a[o][l]=h}this._output=new s(t,i,a)}else console.warn("Invalid header");else console.warn("A input buffer must be specified.")}},{key:"getOutput",value:function(){return this._output}}]),e}();e.EdfDecoder=o,e.Edf=s,Object.defineProperty(e,"__esModule",{value:!0})}(t)}),edfdecoder=unwrapExports(edfdecoder_umd),EdfDecoder=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setMetadata("targetType",Signal1D.name),e.addInputValidator(0,ArrayBuffer),e.setMetadata("debug",!1),e.setMetadata("concatenateRecords",!0),e}return inherits(t,Decoder),createClass(t,[{key:"_run",value:function(){var e=this._getInput(0);if(e){var t=new edfdecoder.EdfDecoder;t.setInput(e),t.decode();var r=t.getOutput();if(r)for(var n=r.getNumberOfSignals(),i=r.getNumberOfRecords(),a=0;a<n;a++){var s=new Signal1D;s.setData(r.getPhysicalSignalConcatRecords(a)),s.setMetadata("numberOfRecords",i),s.setMetadata("patientID",r.getPatientID()),s.setMetadata("recordDuration",r.getRecordDuration()),s.setMetadata("recordingID",r.getRecordingID()),s.setMetadata("recordingStartDate",r.getRecordingStartDate()),s.setMetadata("reservedField",r.getReservedField()),s.setMetadata("signalLabel",r.getSignalLabel(a)),s.setMetadata("numberOfSamplesPerRecord",r.getSignalNumberOfSamplesPerRecord(a)),s.setMetadata("signalPhysicalMax",r.getSignalPhysicalMax(a)),s.setMetadata("signalPhysicalMin",r.getSignalPhysicalMin(a)),s.setMetadata("signalPhysicalUnit",r.getSignalPhysicalUnit(a)),s.setMetadata("signalPrefiltering",r.getSignalPrefiltering(a)),s.setMetadata("signalTransducerType",r.getSignalTransducerType(a)),s.setMetadata("samplingFrequency",r.getSignalSamplingFrequency(a)),this._output[a]=s}else console.warn("Invalid EDF file.")}else console.warn('EdfDecoder requires an ArrayBuffer as input "0". Unable to continue.')}}]),t}(),Mesh3DGenericDecoder=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setMetadata("enablePixBin",!0),e._decoders=[MniObjDecoder],e}return inherits(t,GenericDecoderInterface),t}(),Signal1DGenericDecoder=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setMetadata("enablePixBin",!0),e._decoders=[EdfDecoder],e}return inherits(t,GenericDecoderInterface),t}(),AllFormatsGenericDecoder=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._decoders=[Signal1DGenericDecoder,Image2DGenericDecoder,Image3DGenericDecoderAlt,Mesh3DGenericDecoder],e}return inherits(t,GenericDecoderInterface),t}();function iota(e){for(var t=new Array(e),r=0;r<e;++r)t[r]=r;return t}var iota_1=iota,isBuffer_1=function(e){return null!=e&&(isBuffer$1(e)||isSlowBuffer$1(e)||!!e._isBuffer)};function isBuffer$1(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function isSlowBuffer$1(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&isBuffer$1(e.slice(0,0))}var hasTypedArrays="undefined"!=typeof Float64Array;function compare1st(e,t){return e[0]-t[0]}function order(){var e,t=this.stride,r=new Array(t.length);for(e=0;e<r.length;++e)r[e]=[Math.abs(t[e]),e];r.sort(compare1st);var n=new Array(r.length);for(e=0;e<n.length;++e)n[e]=r[e][1];return n}function compileConstructor(e,t){var r=["View",t,"d",e].join("");t<0&&(r="View_Nil"+e);var n="generic"===e;if(-1===t){var i="function "+r+"(a){this.data=a;};var proto="+r+".prototype;proto.dtype='"+e+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+r+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+r+"(a){return new "+r+"(a);}";return new Function(i)()}if(0===t){i="function "+r+"(a,d) {this.data = a;this.offset = d};var proto="+r+".prototype;proto.dtype='"+e+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+r+"_copy() {return new "+r+"(this.data,this.offset)};proto.pick=function "+r+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+r+"_get(){return "+(n?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+r+"_set(v){return "+(n?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+r+"(a,b,c,d){return new "+r+"(a,d)}";return new Function("TrivialArray",i)(CACHED_CONSTRUCTORS[e][0])}i=["'use strict'"];var a=iota_1(t),s=a.map(function(e){return"i"+e}),o="this.offset+"+a.map(function(e){return"this.stride["+e+"]*i"+e}).join("+"),l=a.map(function(e){return"b"+e}).join(","),u=a.map(function(e){return"c"+e}).join(",");i.push("function "+r+"(a,"+l+","+u+",d){this.data=a","this.shape=["+l+"]","this.stride=["+u+"]","this.offset=d|0}","var proto="+r+".prototype","proto.dtype='"+e+"'","proto.dimension="+t),i.push("Object.defineProperty(proto,'size',{get:function "+r+"_size(){return "+a.map(function(e){return"this.shape["+e+"]"}).join("*"),"}})"),1===t?i.push("proto.order=[0]"):(i.push("Object.defineProperty(proto,'order',{get:"),t<4?(i.push("function "+r+"_order(){"),2===t?i.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===t&&i.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):i.push("ORDER})")),i.push("proto.set=function "+r+"_set("+s.join(",")+",v){"),n?i.push("return this.data.set("+o+",v)}"):i.push("return this.data["+o+"]=v}"),i.push("proto.get=function "+r+"_get("+s.join(",")+"){"),n?i.push("return this.data.get("+o+")}"):i.push("return this.data["+o+"]}"),i.push("proto.index=function "+r+"_index(",s.join(),"){return "+o+"}"),i.push("proto.hi=function "+r+"_hi("+s.join(",")+"){return new "+r+"(this.data,"+a.map(function(e){return["(typeof i",e,"!=='number'||i",e,"<0)?this.shape[",e,"]:i",e,"|0"].join("")}).join(",")+","+a.map(function(e){return"this.stride["+e+"]"}).join(",")+",this.offset)}");var c=a.map(function(e){return"a"+e+"=this.shape["+e+"]"}),h=a.map(function(e){return"c"+e+"=this.stride["+e+"]"});i.push("proto.lo=function "+r+"_lo("+s.join(",")+"){var b=this.offset,d=0,"+c.join(",")+","+h.join(","));for(var f=0;f<t;++f)i.push("if(typeof i"+f+"==='number'&&i"+f+">=0){d=i"+f+"|0;b+=c"+f+"*d;a"+f+"-=d}");i.push("return new "+r+"(this.data,"+a.map(function(e){return"a"+e}).join(",")+","+a.map(function(e){return"c"+e}).join(",")+",b)}"),i.push("proto.step=function "+r+"_step("+s.join(",")+"){var "+a.map(function(e){return"a"+e+"=this.shape["+e+"]"}).join(",")+","+a.map(function(e){return"b"+e+"=this.stride["+e+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(f=0;f<t;++f)i.push("if(typeof i"+f+"==='number'){d=i"+f+"|0;if(d<0){c+=b"+f+"*(a"+f+"-1);a"+f+"=ceil(-a"+f+"/d)}else{a"+f+"=ceil(a"+f+"/d)}b"+f+"*=d}");i.push("return new "+r+"(this.data,"+a.map(function(e){return"a"+e}).join(",")+","+a.map(function(e){return"b"+e}).join(",")+",c)}");var d=new Array(t),p=new Array(t);for(f=0;f<t;++f)d[f]="a[i"+f+"]",p[f]="b[i"+f+"]";i.push("proto.transpose=function "+r+"_transpose("+s+"){"+s.map(function(e,t){return e+"=("+e+"===undefined?"+t+":"+e+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+r+"(this.data,"+d.join(",")+","+p.join(",")+",this.offset)}"),i.push("proto.pick=function "+r+"_pick("+s+"){var a=[],b=[],c=this.offset");for(f=0;f<t;++f)i.push("if(typeof i"+f+"==='number'&&i"+f+">=0){c=(c+this.stride["+f+"]*i"+f+")|0}else{a.push(this.shape["+f+"]);b.push(this.stride["+f+"])}");return i.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),i.push("return function construct_"+r+"(data,shape,stride,offset){return new "+r+"(data,"+a.map(function(e){return"shape["+e+"]"}).join(",")+","+a.map(function(e){return"stride["+e+"]"}).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",i.join("\n"))(CACHED_CONSTRUCTORS[e],order)}function arrayDType(e){if(isBuffer_1(e))return"buffer";if(hasTypedArrays)switch(Object.prototype.toString.call(e)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped"}return Array.isArray(e)?"array":"generic"}var CACHED_CONSTRUCTORS={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],buffer:[],generic:[]};function wrappedNDArrayCtor(e,t,r,n){if(void 0===e)return(0,CACHED_CONSTRUCTORS.array[0])([]);"number"==typeof e&&(e=[e]),void 0===t&&(t=[e.length]);var i=t.length;if(void 0===r){r=new Array(i);for(var a=i-1,s=1;a>=0;--a)r[a]=s,s*=t[a]}if(void 0===n){n=0;for(a=0;a<i;++a)r[a]<0&&(n-=(t[a]-1)*r[a])}for(var o=arrayDType(e),l=CACHED_CONSTRUCTORS[o];l.length<=i+1;)l.push(compileConstructor(o,l.length-1));return(0,l[i+1])(e,t,r,n)}var ndarray=wrappedNDArrayCtor;function dtypeToType(e){switch(e){case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"float":case"float32":return Float32Array;case"double":case"float64":return Float64Array;case"uint8_clamped":return Uint8ClampedArray;case"generic":case"buffer":case"data":case"dataview":return ArrayBuffer;case"array":return Array}}var zeros=function(e,t){t=t||"float64";for(var r=1,n=0;n<e.length;++n)r*=e[n];return ndarray(new(dtypeToType(t))(r),e)},ComponentProjectionImage2DFilter=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.addInputValidator(0,Image2D),e.setMetadata("componentOffset",0),e}return inherits(t,Filter),createClass(t,[{key:"_run",value:function(){if(this.hasValidInput()){for(var e=this._getInput(0),t=e.getMetadata("width"),r=e.getMetadata("height"),n=e.getMetadata("ncpp"),i=this.getMetadata("componentOffset"),a=ndarray(e.getData(),[t,r,n]),s=a.pick(null,null,i),o=zeros([t,r],a.dtype),l=0;l<t;l++)for(var u=0;u<r;u++)o.set(l,u,s.get(l,u));var c=new Image2D;c.setData(o.data,t,r,1),this._output[0]=c}else console.warn("A filter of type ComponentProjectionImage2DFilter requires 1 input of Image2D.")}}]),t}();function validateInputs(e){var t=e.map(function(e){return e.getMetadata("width")});if(!t.reduce(function(e,r){return e&&r===t[0]},!0))return!1;var r=e.map(function(e){return e.getMetadata("height")});if(!r.reduce(function(e,t){return e&&t===r[0]},!0))return!1;var n=e.map(function(e){return e.getData().constructor});return!!n.reduce(function(e,t){return e&&t===n[0]},!0)}var ComponentMergeImage2DFilter=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.addInputValidator("ALL",Image2D),e}return inherits(t,Filter),createClass(t,[{key:"_run",value:function(){var e=this;if(this.getNumberOfInputs()<2)console.warn("A filter of type ComponentMergeImage2DFilter needs 2 or more inputs.");else if(this.hasValidInput()){var t=this.getInputCategories().map(function(t){return e._getInput(t)});if(validateInputs(t)){var r=t[0].getMetadata("width"),n=t[0].getMetadata("height"),i=t.map(function(e){return e.getMetadata("ncpp")}).reduce(function(e,t){return e+t}),a=ndarray(t[0].getData()).dtype,s=zeros([r,n,i],a),o=0;t.forEach(function(e,t){for(var i=e.getMetadata("ncpp"),a=ndarray(e.getData(),[r,n,i]),l=0;l<r;l++)for(var u=0;u<n;u++)for(var c=0;c<i;c++)s.set(l,u,o+c,a.get(l,u,c));o+=i}),this._output[0]=new Image2D,this._output[0].setData(s.data,r,n,i)}else console.warn("A filter of type ComponentMergeImage2DFilter requires inputs to be the same dimensions and array type")}else console.warn("A filter of type ComponentMergeImage2DFilter requires inputs of Image2D.")}}]),t}();function unique_pred(e,t){for(var r=1,n=e.length,i=e[0],a=e[0],s=1;s<n;++s)if(a=i,t(i=e[s],a)){if(s===r){r++;continue}e[r++]=i}return e.length=r,e}function unique_eq(e){for(var t=1,r=e.length,n=e[0],i=e[0],a=1;a<r;++a,i=n)if(i=n,(n=e[a])!==i){if(a===t){t++;continue}e[t++]=n}return e.length=t,e}function unique(e,t,r){return 0===e.length?e:t?(r||e.sort(t),unique_pred(e,t)):(r||e.sort(),unique_eq(e))}var uniq=unique;function innerFill(e,t,r){var n,i,a=e.length,s=t.arrayArgs.length,o=t.indexArgs.length>0,l=[],u=[],c=0,h=0;for(n=0;n<a;++n)u.push(["i",n,"=0"].join(""));for(i=0;i<s;++i)for(n=0;n<a;++n)h=c,c=e[n],0===n?u.push(["d",i,"s",n,"=t",i,"p",c].join("")):u.push(["d",i,"s",n,"=(t",i,"p",c,"-s",h,"*t",i,"p",h,")"].join(""));for(u.length>0&&l.push("var "+u.join(",")),n=a-1;n>=0;--n)c=e[n],l.push(["for(i",n,"=0;i",n,"<s",c,";++i",n,"){"].join(""));for(l.push(r),n=0;n<a;++n){for(h=c,c=e[n],i=0;i<s;++i)l.push(["p",i,"+=d",i,"s",n].join(""));o&&(n>0&&l.push(["index[",h,"]-=s",h].join("")),l.push(["++index[",c,"]"].join(""))),l.push("}")}return l.join("\n")}function outerFill(e,t,r,n){for(var i=t.length,a=r.arrayArgs.length,s=r.blockSize,o=r.indexArgs.length>0,l=[],u=0;u<a;++u)l.push(["var offset",u,"=p",u].join(""));for(u=e;u<i;++u)l.push(["for(var j"+u+"=SS[",t[u],"]|0;j",u,">0;){"].join("")),l.push(["if(j",u,"<",s,"){"].join("")),l.push(["s",t[u],"=j",u].join("")),l.push(["j",u,"=0"].join("")),l.push(["}else{s",t[u],"=",s].join("")),l.push(["j",u,"-=",s,"}"].join("")),o&&l.push(["index[",t[u],"]=j",u].join(""));for(u=0;u<a;++u){for(var c=["offset"+u],h=e;h<i;++h)c.push(["j",h,"*t",u,"p",t[h]].join(""));l.push(["p",u,"=(",c.join("+"),")"].join(""))}l.push(innerFill(t,r,n));for(u=e;u<i;++u)l.push("}");return l.join("\n")}function countMatches(e){for(var t=0,r=e[0].length;t<r;){for(var n=1;n<e.length;++n)if(e[n][t]!==e[0][t])return t;++t}return t}function processBlock(e,t,r){for(var n=e.body,i=[],a=[],s=0;s<e.args.length;++s){var o=e.args[s];if(!(o.count<=0)){var l=new RegExp(o.name,"g"),u="",c=t.arrayArgs.indexOf(s);switch(t.argTypes[s]){case"offset":var h=t.offsetArgIndex.indexOf(s);c=t.offsetArgs[h].array,u="+q"+h;case"array":u="p"+c+u;var f="l"+s,d="a"+c;if(0===t.arrayBlockIndices[c])1===o.count?"generic"===r[c]?o.lvalue?(i.push(["var ",f,"=",d,".get(",u,")"].join("")),n=n.replace(l,f),a.push([d,".set(",u,",",f,")"].join(""))):n=n.replace(l,[d,".get(",u,")"].join("")):n=n.replace(l,[d,"[",u,"]"].join("")):"generic"===r[c]?(i.push(["var ",f,"=",d,".get(",u,")"].join("")),n=n.replace(l,f),o.lvalue&&a.push([d,".set(",u,",",f,")"].join(""))):(i.push(["var ",f,"=",d,"[",u,"]"].join("")),n=n.replace(l,f),o.lvalue&&a.push([d,"[",u,"]=",f].join("")));else{for(var p=[o.name],g=[u],_=0;_<Math.abs(t.arrayBlockIndices[c]);_++)p.push("\\s*\\[([^\\]]+)\\]"),g.push("$"+(_+1)+"*t"+c+"b"+_);if(l=new RegExp(p.join(""),"g"),u=g.join("+"),"generic"===r[c])throw new Error("cwise: Generic arrays not supported in combination with blocks!");n=n.replace(l,[d,"[",u,"]"].join(""))}break;case"scalar":n=n.replace(l,"Y"+t.scalarArgs.indexOf(s));break;case"index":n=n.replace(l,"index");break;case"shape":n=n.replace(l,"shape")}}}return[i.join("\n"),n,a.join("\n")].join("\n").trim()}function typeSummary(e){for(var t=new Array(e.length),r=!0,n=0;n<e.length;++n){var i=e[n],a=i.match(/\d+/);a=a?a[0]:"",0===i.charAt(0)?t[n]="u"+i.charAt(1)+a:t[n]=i.charAt(0)+a,n>0&&(r=r&&t[n]===t[n-1])}return r?t[0]:t.join("")}function generateCWiseOp(e,t){for(var r=t[1].length-Math.abs(e.arrayBlockIndices[0])|0,n=new Array(e.arrayArgs.length),i=new Array(e.arrayArgs.length),a=0;a<e.arrayArgs.length;++a)i[a]=t[2*a],n[a]=t[2*a+1];var s=[],o=[],l=[],u=[],c=[];for(a=0;a<e.arrayArgs.length;++a){e.arrayBlockIndices[a]<0?(l.push(0),u.push(r),s.push(r),o.push(r+e.arrayBlockIndices[a])):(l.push(e.arrayBlockIndices[a]),u.push(e.arrayBlockIndices[a]+r),s.push(0),o.push(e.arrayBlockIndices[a]));for(var h=[],f=0;f<n[a].length;f++)l[a]<=n[a][f]&&n[a][f]<u[a]&&h.push(n[a][f]-l[a]);c.push(h)}var d=["SS"],p=["'use strict'"],g=[];for(f=0;f<r;++f)g.push(["s",f,"=SS[",f,"]"].join(""));for(a=0;a<e.arrayArgs.length;++a){d.push("a"+a),d.push("t"+a),d.push("p"+a);for(f=0;f<r;++f)g.push(["t",a,"p",f,"=t",a,"[",l[a]+f,"]"].join(""));for(f=0;f<Math.abs(e.arrayBlockIndices[a]);++f)g.push(["t",a,"b",f,"=t",a,"[",s[a]+f,"]"].join(""))}for(a=0;a<e.scalarArgs.length;++a)d.push("Y"+a);if(e.shapeArgs.length>0&&g.push("shape=SS.slice(0)"),e.indexArgs.length>0){var _=new Array(r);for(a=0;a<r;++a)_[a]="0";g.push(["index=[",_.join(","),"]"].join(""))}for(a=0;a<e.offsetArgs.length;++a){var y=e.offsetArgs[a],m=[];for(f=0;f<y.offset.length;++f)0!==y.offset[f]&&(1===y.offset[f]?m.push(["t",y.array,"p",f].join("")):m.push([y.offset[f],"*t",y.array,"p",f].join("")));0===m.length?g.push("q"+a+"=0"):g.push(["q",a,"=",m.join("+")].join(""))}var v=uniq([].concat(e.pre.thisVars).concat(e.body.thisVars).concat(e.post.thisVars));(g=g.concat(v)).length>0&&p.push("var "+g.join(","));for(a=0;a<e.arrayArgs.length;++a)p.push("p"+a+"|=0");e.pre.body.length>3&&p.push(processBlock(e.pre,e,i));var b=processBlock(e.body,e,i),w=countMatches(c);w<r?p.push(outerFill(w,c[0],e,b)):p.push(innerFill(c[0],e,b)),e.post.body.length>3&&p.push(processBlock(e.post,e,i)),e.debug&&console.log("-----Generated cwise routine for ",t,":\n"+p.join("\n")+"\n----------");var E=[e.funcName||"unnamed","_cwise_loop_",n[0].join("s"),"m",w,typeSummary(i)].join("");return new Function(["function ",E,"(",d.join(","),"){",p.join("\n"),"} return ",E].join(""))()}var compile=generateCWiseOp;function createThunk(e){var t=["'use strict'","var CACHED={}"],r=[],n=e.funcName+"_cwise_thunk";t.push(["return function ",n,"(",e.shimArgs.join(","),"){"].join(""));for(var i=[],a=[],s=[["array",e.arrayArgs[0],".shape.slice(",Math.max(0,e.arrayBlockIndices[0]),e.arrayBlockIndices[0]<0?","+e.arrayBlockIndices[0]+")":")"].join("")],o=[],l=[],u=0;u<e.arrayArgs.length;++u){var c=e.arrayArgs[u];r.push(["t",c,"=array",c,".dtype,","r",c,"=array",c,".order"].join("")),i.push("t"+c),i.push("r"+c),a.push("t"+c),a.push("r"+c+".join()"),s.push("array"+c+".data"),s.push("array"+c+".stride"),s.push("array"+c+".offset|0"),u>0&&(o.push("array"+e.arrayArgs[0]+".shape.length===array"+c+".shape.length+"+(Math.abs(e.arrayBlockIndices[0])-Math.abs(e.arrayBlockIndices[u]))),l.push("array"+e.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,e.arrayBlockIndices[0])+"]===array"+c+".shape[shapeIndex+"+Math.max(0,e.arrayBlockIndices[u])+"]"))}e.arrayArgs.length>1&&(t.push("if (!("+o.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),t.push("for(var shapeIndex=array"+e.arrayArgs[0]+".shape.length-"+Math.abs(e.arrayBlockIndices[0])+"; shapeIndex--\x3e0;) {"),t.push("if (!("+l.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),t.push("}"));for(u=0;u<e.scalarArgs.length;++u)s.push("scalar"+e.scalarArgs[u]);return r.push(["type=[",a.join(","),"].join()"].join("")),r.push("proc=CACHED[type]"),t.push("var "+r.join(",")),t.push(["if(!proc){","CACHED[type]=proc=compile([",i.join(","),"])}","return proc(",s.join(","),")}"].join("")),e.debug&&console.log("-----Generated thunk:\n"+t.join("\n")+"\n----------"),new Function("compile",t.join("\n"))(compile.bind(void 0,e))}var thunk=createThunk;function Procedure(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}function compileCwise(e){var t=new Procedure;t.pre=e.pre,t.body=e.body,t.post=e.post;var r=e.args.slice(0);t.argTypes=r;for(var n=0;n<r.length;++n){var i=r[n];if("array"===i||"object"===(void 0===i?"undefined":_typeof(i))&&i.blockIndices){if(t.argTypes[n]="array",t.arrayArgs.push(n),t.arrayBlockIndices.push(i.blockIndices?i.blockIndices:0),t.shimArgs.push("array"+n),n<t.pre.args.length&&t.pre.args[n].count>0)throw new Error("cwise: pre() block may not reference array args");if(n<t.post.args.length&&t.post.args[n].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===i)t.scalarArgs.push(n),t.shimArgs.push("scalar"+n);else if("index"===i){if(t.indexArgs.push(n),n<t.pre.args.length&&t.pre.args[n].count>0)throw new Error("cwise: pre() block may not reference array index");if(n<t.body.args.length&&t.body.args[n].lvalue)throw new Error("cwise: body() block may not write to array index");if(n<t.post.args.length&&t.post.args[n].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===i){if(t.shapeArgs.push(n),n<t.pre.args.length&&t.pre.args[n].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(n<t.body.args.length&&t.body.args[n].lvalue)throw new Error("cwise: body() block may not write to array shape");if(n<t.post.args.length&&t.post.args[n].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!==(void 0===i?"undefined":_typeof(i))||!i.offset)throw new Error("cwise: Unknown argument type "+r[n]);t.argTypes[n]="offset",t.offsetArgs.push({array:i.array,offset:i.offset}),t.offsetArgIndex.push(n)}}if(t.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(t.pre.args.length>r.length)throw new Error("cwise: Too many arguments in pre() block");if(t.body.args.length>r.length)throw new Error("cwise: Too many arguments in body() block");if(t.post.args.length>r.length)throw new Error("cwise: Too many arguments in post() block");return t.debug=!!e.printCode||!!e.debug,t.funcName=e.funcName||"cwise",t.blockSize=e.blockSize||64,thunk(t)}var compiler=compileCwise,ndarrayOps=createCommonjsModule(function(e,t){var r={body:"",args:[],thisVars:[],localVars:[]};function n(e){if(!e)return r;for(var t=0;t<e.args.length;++t){var n=e.args[t];e.args[t]=0===t?{name:n,lvalue:!0,rvalue:!!e.rvalue,count:e.count||1}:{name:n,lvalue:!1,rvalue:!0,count:1}}return e.thisVars||(e.thisVars=[]),e.localVars||(e.localVars=[]),e}function i(e){for(var t=[],r=0;r<e.args.length;++r)t.push("a"+r);return new Function("P",["return function ",e.funcName,"_ndarrayops(",t.join(","),") {P(",t.join(","),");return a0}"].join(""))(function(e){return compiler({args:e.args,pre:n(e.pre),body:n(e.body),post:n(e.proc),funcName:e.funcName})}(e))}var a={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};!function(){for(var e in a){var r=a[e];t[e]=i({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+r+"c"},funcName:e}),t[e+"eq"]=i({args:["array","array"],body:{args:["a","b"],body:"a"+r+"=b"},rvalue:!0,funcName:e+"eq"}),t[e+"s"]=i({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+r+"s"},funcName:e+"s"}),t[e+"seq"]=i({args:["array","scalar"],body:{args:["a","s"],body:"a"+r+"=s"},rvalue:!0,funcName:e+"seq"})}}();var s={not:"!",bnot:"~",neg:"-",recip:"1.0/"};!function(){for(var e in s){var r=s[e];t[e]=i({args:["array","array"],body:{args:["a","b"],body:"a="+r+"b"},funcName:e}),t[e+"eq"]=i({args:["array"],body:{args:["a"],body:"a="+r+"a"},rvalue:!0,count:2,funcName:e+"eq"})}}();var o={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};!function(){for(var e in o){var r=o[e];t[e]=i({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+r+"c"},funcName:e}),t[e+"s"]=i({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+r+"s"},funcName:e+"s"}),t[e+"eq"]=i({args:["array","array"],body:{args:["a","b"],body:"a=a"+r+"b"},rvalue:!0,count:2,funcName:e+"eq"}),t[e+"seq"]=i({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+r+"s"},rvalue:!0,count:2,funcName:e+"seq"})}}();var l=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];!function(){for(var e=0;e<l.length;++e){var r=l[e];t[r]=i({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:r}),t[r+"eq"]=i({args:["array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"eq"})}}();var u=["max","min","atan2","pow"];!function(){for(var e=0;e<u.length;++e){var r=u[e];t[r]=i({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:r}),t[r+"s"]=i({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:r+"s"}),t[r+"eq"]=i({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"eq"}),t[r+"seq"]=i({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"seq"})}}();var c=["atan2","pow"];!function(){for(var e=0;e<c.length;++e){var r=c[e];t[r+"op"]=i({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:r+"op"}),t[r+"ops"]=i({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:r+"ops"}),t[r+"opeq"]=i({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"opeq"}),t[r+"opseq"]=i({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"opseq"})}}(),t.any=compiler({args:["array"],pre:r,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),t.all=compiler({args:["array"],pre:r,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),t.sum=compiler({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),t.prod=compiler({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),t.norm2squared=compiler({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),t.norm2=compiler({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),t.norminf=compiler({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),t.norm1=compiler({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),t.sup=compiler({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),t.inf=compiler({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),t.argmin=compiler({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),t.argmax=compiler({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),t.random=i({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),t.assign=i({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),t.assigns=i({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),t.equals=compiler({args:["array","array"],pre:r,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})}),ndarrayOps_1=ndarrayOps.any,ndarrayOps_2=ndarrayOps.all,ndarrayOps_3=ndarrayOps.sum,ndarrayOps_4=ndarrayOps.prod,ndarrayOps_5=ndarrayOps.norm2squared,ndarrayOps_6=ndarrayOps.norm2,ndarrayOps_7=ndarrayOps.norminf,ndarrayOps_8=ndarrayOps.norm1,ndarrayOps_9=ndarrayOps.sup,ndarrayOps_10=ndarrayOps.inf,ndarrayOps_11=ndarrayOps.argmin,ndarrayOps_12=ndarrayOps.argmax,ndarrayOps_13=ndarrayOps.random,ndarrayOps_14=ndarrayOps.assign,ndarrayOps_15=ndarrayOps.assigns,ndarrayOps_16=ndarrayOps.equals,INT_BITS=32,INT_BITS_1=INT_BITS,INT_MAX=2147483647,INT_MIN=-1<<INT_BITS-1,sign=function(e){return(e>0)-(e<0)},abs=function(e){var t=e>>INT_BITS-1;return(e^t)-t},min$3=function(e,t){return t^(e^t)&-(e<t)},max$3=function(e,t){return e^(e^t)&-(e<t)},isPow2=function(e){return!(e&e-1||!e)},log2=function(e){var t,r;return t=(e>65535)<<4,t|=r=((e>>>=t)>255)<<3,t|=r=((e>>>=r)>15)<<2,(t|=r=((e>>>=r)>3)<<1)|(e>>>=r)>>1},log10=function(e){return e>=1e9?9:e>=1e8?8:e>=1e7?7:e>=1e6?6:e>=1e5?5:e>=1e4?4:e>=1e3?3:e>=100?2:e>=10?1:0},popCount=function(e){return 16843009*((e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)>>>24};function countTrailingZeros(e){var t=32;return(e&=-e)&&t--,65535&e&&(t-=16),16711935&e&&(t-=8),252645135&e&&(t-=4),858993459&e&&(t-=2),1431655765&e&&(t-=1),t}var countTrailingZeros_1=countTrailingZeros,nextPow2=function(e){return e+=0===e,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)+1},prevPow2=function(e){return e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)-(e>>>1)},parity=function(e){return e^=e>>>16,e^=e>>>8,e^=e>>>4,27030>>>(e&=15)&1},REVERSE_TABLE=new Array(256);!function(e){for(var t=0;t<256;++t){var r=t,n=t,i=7;for(r>>>=1;r;r>>>=1)n<<=1,n|=1&r,--i;e[t]=n<<i&255}}(REVERSE_TABLE);var reverse=function(e){return REVERSE_TABLE[255&e]<<24|REVERSE_TABLE[e>>>8&255]<<16|REVERSE_TABLE[e>>>16&255]<<8|REVERSE_TABLE[e>>>24&255]},interleave2=function(e,t){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))<<1},deinterleave2=function(e,t){return(e=65535&((e=16711935&((e=252645135&((e=858993459&((e=e>>>t&1431655765)|e>>>1))|e>>>2))|e>>>4))|e>>>16))<<16>>16},interleave3=function(e,t,r){return e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2),(e|=(t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2))<<1)|(r=1227133513&((r=3272356035&((r=251719695&((r=4278190335&((r&=1023)|r<<16))|r<<8))|r<<4))|r<<2))<<2},deinterleave3=function(e,t){return(e=1023&((e=4278190335&((e=251719695&((e=3272356035&((e=e>>>t&1227133513)|e>>>2))|e>>>4))|e>>>8))|e>>>16))<<22>>22},nextCombination=function(e){var t=e|e-1;return t+1|(~t&-~t)-1>>>countTrailingZeros(e)+1},twiddle={INT_BITS:INT_BITS_1,INT_MAX:INT_MAX,INT_MIN:INT_MIN,sign:sign,abs:abs,min:min$3,max:max$3,isPow2:isPow2,log2:log2,log10:log10,popCount:popCount,countTrailingZeros:countTrailingZeros_1,nextPow2:nextPow2,prevPow2:prevPow2,parity:parity,reverse:reverse,interleave2:interleave2,deinterleave2:deinterleave2,interleave3:interleave3,deinterleave3:deinterleave3,nextCombination:nextCombination};function dupe_array(e,t,r){var n=0|e[r];if(n<=0)return[];var i,a=new Array(n);if(r===e.length-1)for(i=0;i<n;++i)a[i]=t;else for(i=0;i<n;++i)a[i]=dupe_array(e,t,r+1);return a}function dupe_number(e,t){var r,n;for(r=new Array(e),n=0;n<e;++n)r[n]=t;return r}function dupe(e,t){switch(void 0===t&&(t=0),void 0===e?"undefined":_typeof(e)){case"number":if(e>0)return dupe_number(0|e,t);break;case"object":if("number"==typeof e.length)return dupe_array(e,t,0)}return[]}var dup=dupe,pool=createCommonjsModule(function(e,t){commonjsGlobal.__TYPEDARRAY_POOL||(commonjsGlobal.__TYPEDARRAY_POOL={UINT8:dup([32,0]),UINT16:dup([32,0]),UINT32:dup([32,0]),INT8:dup([32,0]),INT16:dup([32,0]),INT32:dup([32,0]),FLOAT:dup([32,0]),DOUBLE:dup([32,0]),DATA:dup([32,0]),UINT8C:dup([32,0]),BUFFER:dup([32,0])});var r="undefined"!=typeof Uint8ClampedArray,n=commonjsGlobal.__TYPEDARRAY_POOL;n.UINT8C||(n.UINT8C=dup([32,0])),n.BUFFER||(n.BUFFER=dup([32,0]));var i=n.DATA,a=n.BUFFER;function s(e){if(e){var t=e.length||e.byteLength,r=twiddle.log2(t);i[r].push(e)}}function o(e){e=twiddle.nextPow2(e);var t=twiddle.log2(e),r=i[t];return r.length>0?r.pop():new ArrayBuffer(e)}function l(e){return new Uint8Array(o(e),0,e)}function u(e){return new Uint16Array(o(2*e),0,e)}function c(e){return new Uint32Array(o(4*e),0,e)}function h(e){return new Int8Array(o(e),0,e)}function f(e){return new Int16Array(o(2*e),0,e)}function d(e){return new Int32Array(o(4*e),0,e)}function p(e){return new Float32Array(o(4*e),0,e)}function g(e){return new Float64Array(o(8*e),0,e)}function _(e){return r?new Uint8ClampedArray(o(e),0,e):l(e)}function y(e){return new DataView(o(e),0,e)}function m(e){e=twiddle.nextPow2(e);var t=twiddle.log2(e),r=a[t];return r.length>0?r.pop():new Buffer(e)}t.free=function(e){if(isBuffer(e))a[twiddle.log2(e.length)].push(e);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(e)&&(e=e.buffer),!e)return;var t=e.length||e.byteLength,r=0|twiddle.log2(t);i[r].push(e)}},t.freeUint8=t.freeUint16=t.freeUint32=t.freeInt8=t.freeInt16=t.freeInt32=t.freeFloat32=t.freeFloat=t.freeFloat64=t.freeDouble=t.freeUint8Clamped=t.freeDataView=function(e){s(e.buffer)},t.freeArrayBuffer=s,t.freeBuffer=function(e){a[twiddle.log2(e.length)].push(e)},t.malloc=function(e,t){if(void 0===t||"arraybuffer"===t)return o(e);switch(t){case"uint8":return l(e);case"uint16":return u(e);case"uint32":return c(e);case"int8":return h(e);case"int16":return f(e);case"int32":return d(e);case"float":case"float32":return p(e);case"double":case"float64":return g(e);case"uint8_clamped":return _(e);case"buffer":return m(e);case"data":case"dataview":return y(e);default:return null}return null},t.mallocArrayBuffer=o,t.mallocUint8=l,t.mallocUint16=u,t.mallocUint32=c,t.mallocInt8=h,t.mallocInt16=f,t.mallocInt32=d,t.mallocFloat32=t.mallocFloat=p,t.mallocFloat64=t.mallocDouble=g,t.mallocUint8Clamped=_,t.mallocDataView=y,t.mallocBuffer=m,t.clearCache=function(){for(var e=0;e<32;++e)n.UINT8[e].length=0,n.UINT16[e].length=0,n.UINT32[e].length=0,n.INT8[e].length=0,n.INT16[e].length=0,n.INT32[e].length=0,n.FLOAT[e].length=0,n.DOUBLE[e].length=0,n.UINT8C[e].length=0,i[e].length=0,a[e].length=0}}),pool_1=pool.free,pool_2=pool.freeUint8,pool_3=pool.freeUint16,pool_4=pool.freeUint32,pool_5=pool.freeInt8,pool_6=pool.freeInt16,pool_7=pool.freeInt32,pool_8=pool.freeFloat32,pool_9=pool.freeFloat,pool_10=pool.freeFloat64,pool_11=pool.freeDouble,pool_12=pool.freeUint8Clamped,pool_13=pool.freeDataView,pool_14=pool.freeArrayBuffer,pool_15=pool.freeBuffer,pool_16=pool.malloc,pool_17=pool.mallocArrayBuffer,pool_18=pool.mallocUint8,pool_19=pool.mallocUint16,pool_20=pool.mallocUint32,pool_21=pool.mallocInt8,pool_22=pool.mallocInt16,pool_23=pool.mallocInt32,pool_24=pool.mallocFloat32,pool_25=pool.mallocFloat,pool_26=pool.mallocFloat64,pool_27=pool.mallocDouble,pool_28=pool.mallocUint8Clamped,pool_29=pool.mallocDataView,pool_30=pool.mallocBuffer,pool_31=pool.clearCache;function fft(e,t,r,n,i,a,s){e|=0,t|=0,r|=0,i|=0,a|=0,twiddle.isPow2(r)?fftRadix2(e,t,r,n,i,a):fftBluestein(e,t,r,n,i,a,s)}var fftMatrix=fft;function scratchMemory(e){return twiddle.isPow2(e)?0:2*e+4*twiddle.nextPow2(2*e+1)}var scratchMemory_1=scratchMemory;function fftRadix2(e,t,r,n,i,a){var s,o,l,u,c,h,f,d,p,g,_,y,m,v,b,w,E,T,k,x,S,I,A,M;for(e|=0,t|=0,i|=0,a|=0,s=r|=0,o=twiddle.log2(s),T=0;T<t;++T){for(f=s>>1,c=0,l=0;l<s-1;l++){for(l<c&&(m=n[i+l],n[i+l]=n[i+c],n[i+c]=m,m=n[a+l],n[a+l]=n[a+c],n[a+c]=m),h=f;h<=c;)c-=h,h>>=1;c+=h}for(_=-1,y=0,g=1,d=0;d<o;d++){for(p=g,g<<=1,w=1,E=0,c=0;c<p;c++){for(l=c;l<s;l+=g)k=n[i+(u=l+p)],x=n[a+u],S=n[i+l],I=n[a+l],v=(A=w*(k+x))-x*(w+E),b=A+(M=k*(E-w)),n[i+u]=S-v,n[a+u]=I-b,n[i+l]+=v,n[a+l]+=b;M=w*(y-_),w=(A=_*(w+E))-E*(_+y),E=A+M}y=Math.sqrt((1-_)/2),e<0&&(y=-y),_=Math.sqrt((1+_)/2)}if(e<0){var N=1/s;for(l=0;l<s;l++)n[i+l]*=N,n[a+l]*=N}i+=r,a+=r}}function fftBluestein(e,t,r,n,i,a,s){e|=0,t|=0,r|=0,i|=0,a|=0,s|=0;var o,l,u,c,h,f,d,p,g,_=twiddle.nextPow2(2*r+1),y=s,m=y+r,v=m+r,b=v+_,w=b+_,E=w+_,T=-e*Math.PI/r;for(g=0;g<r;++g)l=T*(g*g%(2*r)),c=Math.cos(l),h=Math.sin(l),n[w+(_-g)]=n[w+g]=n[y+g]=c,n[E+(_-g)]=n[E+g]=n[m+g]=h;for(g=r;g<=_-r;++g)n[w+g]=0;for(g=r;g<=_-r;++g)n[E+g]=0;for(fftRadix2(1,1,_,n,w,E),T=e<0?1/r:1,o=0;o<t;++o){for(g=0;g<r;++g)l=n[i+g],u=n[a+g],f=(c=n[y+g])*(l+u),d=l*((h=-n[m+g])-c),p=u*(c+h),n[v+g]=f-p,n[b+g]=f+d;for(g=r;g<_;++g)n[v+g]=0;for(g=r;g<_;++g)n[b+g]=0;for(fftRadix2(1,1,_,n,v,b),g=0;g<_;++g)l=n[v+g],u=n[b+g],f=(c=n[w+g])*(l+u),d=l*((h=n[E+g])-c),p=u*(c+h),n[v+g]=f-p,n[b+g]=f+d;for(fftRadix2(-1,1,_,n,v,b),g=0;g<r;++g)l=n[v+g],u=n[b+g],f=(c=n[y+g])*(l+u),d=l*((h=-n[m+g])-c),p=u*(c+h),n[i+g]=T*(f-p),n[a+g]=T*(f+d);i+=r,a+=r}}function ndfft(e,t,r){var n,i,a=t.shape,s=a.length,o=1,l=new Array(s),u=0;for(n=s-1;n>=0;--n)if(l[n]=o,o*=a[n],u=Math.max(u,fftMatrix.scratchMemory(a[n])),t.shape[n]!==r.shape[n])throw new Error("Shape mismatch, real and imaginary arrays must have same size");var c,h=4*o+u;c="array"===t.dtype||"float64"===t.dtype||"custom"===t.dtype?pool.mallocDouble(h):pool.mallocFloat(h);var f,d,p,g,_=ndarray(c,a.slice(0),l,0),y=ndarray(c,a.slice(0),l.slice(0),o),m=ndarray(c,a.slice(0),l.slice(0),2*o),v=ndarray(c,a.slice(0),l.slice(0),3*o),b=4*o;for(ndarrayOps.assign(_,t),ndarrayOps.assign(y,r),n=s-1;n>=0&&(fftMatrix(e,o/a[n],a[n],c,_.offset,y.offset,b),0!==n);--n){for(d=1,p=m.stride,g=v.stride,i=n-1;i<s;++i)g[i]=p[i]=d,d*=a[i];for(i=n-2;i>=0;--i)g[i]=p[i]=d,d*=a[i];ndarrayOps.assign(m,_),ndarrayOps.assign(v,y),f=_,_=m,m=f,f=y,y=v,v=f}ndarrayOps.assign(t,_),ndarrayOps.assign(r,y),pool.free(c)}fftMatrix.scratchMemory=scratchMemory_1;var fft$1=ndfft,DIRECTIONS={FORWARD:1,INVERSE:-1},BaseFourierSignalFilter=function(e){function t(e){classCallCheck(this,t);var r=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(r.direction=e,r.setMetadata("direction",r.direction),void 0===DIRECTIONS[r.direction])throw new Error(r.direction+" is not a valid fourier transform direction. Please try one of: "+Object.keys(DIRECTIONS));return r.addInputValidator(0,Signal1D),r.addInputValidator(1,Signal1D),r}return inherits(t,Filter),createClass(t,[{key:"_run",value:function(){if(this.hasValidInput()){var e=this._getInput(0),t=this._getInput(1),r=e.getMetadata("length");r!==t.getMetadata("length")&&console.warn("The imaginary and real components of the signal need to be of equal length.");var n=ndarray(e.clone().getData(),[r]),i=ndarray(t.clone().getData(),[r]);fft$1(DIRECTIONS[this.direction],n,i),this._output[0]=new Signal1D,this._output[0].setData(n.data),this._output[1]=new Signal1D,this._output[1].setData(i.data),this._output[0].setMetadata("samplingFrequency",e.getMetadata("samplingFrequency")),this._output[1].setMetadata("samplingFrequency",e.getMetadata("samplingFrequency"))}else console.warn("A filter of type BaseFourierSignalFilter requires 2 inputs of Signal1D.")}}]),t}(),ForwardFourierSignalFilter=function(e){function t(){return classCallCheck(this,t),possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"FORWARD"))}return inherits(t,BaseFourierSignalFilter),t}(),InverseFourierSignalFilter=function(e){function t(){return classCallCheck(this,t),possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"INVERSE"))}return inherits(t,BaseFourierSignalFilter),t}(),DIRECTIONS$1={FORWARD:1,INVERSE:-1},BaseFourierImageFilter=function(e){function t(e){classCallCheck(this,t);var r=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(r.direction=e,void 0===DIRECTIONS$1[r.direction])throw new Error(r.direction+" is not a valid fourier transform direction. Please try one of: "+Object.keys(DIRECTIONS$1));return r.addInputValidator(0,Image2D),r.addInputValidator(1,Image2D),r}return inherits(t,Filter),createClass(t,[{key:"_run",value:function(){if(this.hasValidInput()){var e=this._getInput(0),t=this._getInput(1);if(e.getMetadata("ncpp")>1)console.warn("Please make sure the input images are made of exactly 1 channel.");else{var r=e.getMetadata("width"),n=e.getMetadata("height");r===t.getMetadata("width")&&n===t.getMetadata("height")||console.warn("Please make sure the real and imaginary input images are the same dimensions");var i=ndarray(e.getDataAsFloat32Array(),[r,n]),a=ndarray(t.getDataAsFloat32Array(),[r,n]);this.setMetadata("direction",this.direction),fft$1(DIRECTIONS$1[this.direction],i,a),this._output[0]=new Image2D,this._output[0].setData(i.data,r,n,1),this._output[0].setMetadata("ncpp",1),this._output[1]=new Image2D,this._output[1].setData(a.data,r,n,1),this._output[1].setMetadata("ncpp",1)}}else console.warn("A filter of type BaseFourierSignalFilter requires 2 inputs of Signal1D.")}}]),t}(),ForwardFourierImageFilter=function(e){function t(){return classCallCheck(this,t),possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"FORWARD"))}return inherits(t,BaseFourierImageFilter),t}(),InverseFourierImageFilter=function(e){function t(){return classCallCheck(this,t),possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"INVERSE"))}return inherits(t,BaseFourierImageFilter),t}(),ForEachPixelImageFilter=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.addInputValidator(0,Image2D),e}return inherits(t,ImageToImageFilter),createClass(t,[{key:"_run",value:function(){if(this.hasValidInput()){var e=this._getInput(),t=e.getWidth()*e.getHeight(),r=e.getDataCopy();this._forEachPixelOfSuch(r,0,t,1),this._addOutput(Image2D).setData(r,e.getWidth(),e.getHeight(),e.getComponentsPerPixel())}}},{key:"_forEachPixelOfSuch",value:function(e,t,r,n){if(this.hasEvent("pixel"))for(var i=this._getInput(),a=i.getData(),s=i.getComponentsPerPixel(),o=null,l=t;l<r;l+=n){var u=l*s,c=i.get2dPositionFrom1dIndex(l);o=a.slice(u,u+s);var h=this.triggerEvent("pixel",c,o);if(h&&h.length==s)for(var f=0;f<s;f++)e[u+f]=h[f]}else console.warn("No function to apply per pixel was specified.")}}]),t}(),SpectralScaleImageFilter=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.addInputValidator(0,Image2D),e.addInputValidator(1,Image2D),e}return inherits(t,ImageToImageFilter),createClass(t,[{key:"_run",value:function(){if(this.hasValidInput()&&this.hasSameSizeInput()&&this.hasValidInput()){var e=this._getInput(0),t=this._getInput(1);if(1==t.getComponentsPerPixel()){for(var r=e.getWidth()*e.getHeight(),n=e.getComponentsPerPixel(),i=e.getDataCopy(),a=t.getData(),s=0;s<r;s++)for(var o=0;o<n;o++)i[s*n+o]*=a[s];this._addOutput(Image2D).setData(i,e.getWidth(),e.getHeight())}else console.warn("The scaling image must have one single band.")}}}]),t}(),bundle=createCommonjsModule(function(e,t){e.exports=function(){function e(e,t){for(var r=0;r<e.length;r++)if(e[r]===t)return r;return-1}var t="INUMBER",r="IOP1",n="IOP2",i="IOP3",a="IVAR",s="IFUNCALL",o="IEXPR",l="IMEMBER";function u(e,t){this.type=e,this.value=void 0!==t&&null!==t?t:0}function c(e,t){this.tokens=e,this.parser=t,this.unaryOps=t.unaryOps,this.binaryOps=t.binaryOps,this.ternaryOps=t.ternaryOps,this.functions=t.functions}function h(e,u){for(var c,f,d,p,g=[],_=0,y=e.length;_<y;_++){var m=e[_],v=m.type;if(v===t)"number"==typeof m.value&&m.value<0?g.push("("+m.value+")"):g.push("string"==typeof(E=m.value)?JSON.stringify(E).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029"):E);else if(v===n)f=g.pop(),c=g.pop(),p=m.value,u?"^"===p?g.push("Math.pow("+c+", "+f+")"):"and"===p?g.push("(!!"+c+" && !!"+f+")"):"or"===p?g.push("(!!"+c+" || !!"+f+")"):"||"===p?g.push("(String("+c+") + String("+f+"))"):"=="===p?g.push("("+c+" === "+f+")"):"!="===p?g.push("("+c+" !== "+f+")"):g.push("("+c+" "+p+" "+f+")"):g.push("("+c+" "+p+" "+f+")");else if(v===i){if(d=g.pop(),f=g.pop(),c=g.pop(),"?"!==(p=m.value))throw new Error("invalid Expression");g.push("("+c+" ? "+f+" : "+d+")")}else if(v===a)g.push(m.value);else if(v===r)c=g.pop(),"-"===(p=m.value)||"+"===p?g.push("("+p+c+")"):u?"not"===p?g.push("(!"+c+")"):"!"===p?g.push("fac("+c+")"):g.push(p+"("+c+")"):"!"===p?g.push("("+c+"!)"):g.push("("+p+" "+c+")");else if(v===s){for(var b=m.value,w=[];b-- >0;)w.unshift(g.pop());p=g.pop(),g.push(p+"("+w.join(", ")+")")}else if(v===l)c=g.pop(),g.push(c+"."+m.value);else{if(v!==o)throw new Error("invalid Expression");g.push("("+h(m.value,u)+")")}}var E;if(g.length>1)throw new Error("invalid Expression (parity)");return g[0]}function f(t,r){for(var n=0,i=t.length;n<i;n++){var s=t[n];s.type===a&&-1===e(r,s.value)?r.push(s.value):s.type===o&&f(s.value,r)}}function d(e,t){return Number(e)+Number(t)}function p(e,t){return e-t}function g(e,t){return e*t}function _(e,t){return e/t}function y(e,t){return e%t}function m(e,t){return""+e+t}function v(e,t){return e===t}function b(e,t){return e!==t}function w(e,t){return e>t}function E(e,t){return e<t}function T(e,t){return e>=t}function k(e,t){return e<=t}function x(e,t){return Boolean(e&&t)}function S(e,t){return Boolean(e||t)}function I(e){return(Math.exp(e)-Math.exp(-e))/2}function A(e){return(Math.exp(e)+Math.exp(-e))/2}function M(e){return e===1/0?1:e===-1/0?-1:(Math.exp(e)-Math.exp(-e))/(Math.exp(e)+Math.exp(-e))}function N(e){return e===-1/0?e:Math.log(e+Math.sqrt(e*e+1))}function C(e){return Math.log(e+Math.sqrt(e*e-1))}function O(e){return Math.log((1+e)/(1-e))/2}function D(e){return Math.log(e)*Math.LOG10E}function R(e){return-e}function B(e){return!e}function F(e){return e<0?Math.ceil(e):Math.floor(e)}function U(e){return Math.random()*(e||1)}function L(e){return $(e+1)}function P(e){return String(e).length}function j(){for(var e=0,t=0,r=0,n=arguments.length;r<n;r++){var i,a=Math.abs(arguments[r]);t<a?(e=e*(i=t/a)*i+1,t=a):e+=a>0?(i=a/t)*i:a}return t===1/0?1/0:t*Math.sqrt(e)}function z(e,t,r){return e?t:r}u.prototype.toString=function(){switch(this.type){case t:case r:case n:case i:case a:return this.value;case s:return"CALL "+this.value;case l:return"."+this.value;default:return"Invalid Instruction"}},c.prototype.simplify=function(e){return e=e||{},new c(function e(s,c,h,f,d){for(var p,g,_,y,m=[],v=[],b=0,w=s.length;b<w;b++){var E=s[b],T=E.type;if(T===t)m.push(E);else if(T===a&&d.hasOwnProperty(E.value))E=new u(t,d[E.value]),m.push(E);else if(T===n&&m.length>1)g=m.pop(),p=m.pop(),y=h[E.value],E=new u(t,y(p.value,g.value)),m.push(E);else if(T===i&&m.length>2)_=m.pop(),g=m.pop(),p=m.pop(),"?"===E.value?m.push(p.value?g.value:_.value):(y=f[E.value],E=new u(t,y(p.value,g.value,_.value)),m.push(E));else if(T===r&&m.length>0)p=m.pop(),y=c[E.value],E=new u(t,y(p.value)),m.push(E);else if(T===o){for(;m.length>0;)v.push(m.shift());v.push(new u(o,e(E.value,c,h,f,d)))}else if(T===l&&m.length>0)p=m.pop(),m.push(new u(t,p.value[E.value]));else{for(;m.length>0;)v.push(m.shift());v.push(E)}}for(;m.length>0;)v.push(m.shift());return v}(this.tokens,this.unaryOps,this.binaryOps,this.ternaryOps,e),this.parser)},c.prototype.substitute=function(e,t){return t instanceof c||(t=this.parser.parse(String(t))),new c(function e(t,s,l){for(var c=[],h=0,f=t.length;h<f;h++){var d=t[h],p=d.type;if(p===a&&d.value===s)for(var g=0;g<l.tokens.length;g++){var _,y=l.tokens[g];_=y.type===r?K(y.value):y.type===n?J(y.value):y.type===i?ee(y.value):new u(y.type,y.value),c.push(_)}else p===o?c.push(new u(o,e(d.value,s,l))):c.push(d)}return c}(this.tokens,e,t),this.parser)},c.prototype.evaluate=function(e){return e=e||{},function e(u,c,h){for(var f,d,p,g,_=[],y=0,m=u.length;y<m;y++){var v=u[y],b=v.type;if(b===t)_.push(v.value);else if(b===n)d=_.pop(),f=_.pop(),g=c.binaryOps[v.value],_.push(g(f,d));else if(b===i)p=_.pop(),d=_.pop(),f=_.pop(),"?"===v.value?_.push(e(f?d:p,c,h)):(g=c.ternaryOps[v.value],_.push(g(f,d,p)));else if(b===a)if(v.value in c.functions)_.push(c.functions[v.value]);else{var w=h[v.value];if(void 0===w)throw new Error("undefined variable: "+v.value);_.push(w)}else if(b===r)f=_.pop(),g=c.unaryOps[v.value],_.push(g(f));else if(b===s){for(var E=v.value,T=[];E-- >0;)T.unshift(_.pop());if(!(g=_.pop()).apply||!g.call)throw new Error(g+" is not a function");_.push(g.apply(void 0,T))}else if(b===o)_.push(v.value);else{if(b!==l)throw new Error("invalid Expression");f=_.pop(),_.push(f[v.value])}}if(_.length>1)throw new Error("invalid Expression (parity)");return _[0]}(this.tokens,this,e)},c.prototype.toString=function(){return h(this.tokens,!1)},c.prototype.symbols=function(){var e=[];return f(this.tokens,e),e},c.prototype.variables=function(){var e=[];f(this.tokens,e);var t=this.functions;return e.filter(function(e){return!(e in t)})},c.prototype.toJSFunction=function(e,t){var r=this,n=new Function(e,"with(this.functions) with (this.ternaryOps) with (this.binaryOps) with (this.unaryOps) { return "+h(this.simplify(t).tokens,!0)+"; }");return function(){return n.apply(r,arguments)}};var H=4.7421875,V=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22];function $(e){var t,r;if(function(e){return isFinite(e)&&e===Math.round(e)}(e)){if(e<=0)return isFinite(e)?1/0:NaN;if(e>171)return 1/0;for(var n=e-2,i=e-1;n>1;)i*=n,n--;return 0===i&&(i=1),i}if(e<.5)return Math.PI/(Math.sin(Math.PI*e)*$(1-e));if(e>=171.35)return 1/0;if(e>85){var a=e*e,s=a*e,o=s*e,l=o*e;return Math.sqrt(2*Math.PI/e)*Math.pow(e/Math.E,e)*(1+1/(12*e)+1/(288*a)-139/(51840*s)-571/(2488320*o)+163879/(209018880*l)+5246819/(75246796800*l*e))}--e,r=V[0];for(var u=1;u<V.length;++u)r+=V[u]/(e+u);return t=e+H+.5,Math.sqrt(2*Math.PI)*Math.pow(t,e+.5)*Math.exp(-t)*r}var Z="TOP";function q(e,t,r,n){this.type=e,this.value=t,this.line=r,this.column=n}function Y(e,t,r,n,i){this.pos=0,this.line=0,this.column=0,this.current=null,this.unaryOps=t,this.binaryOps=r,this.ternaryOps=n,this.consts=i,this.expression=e,this.savedPosition=0,this.savedCurrent=null,this.savedLine=0,this.savedColumn=0}q.prototype.toString=function(){return this.type+": "+this.value},Y.prototype.newToken=function(e,t,r,n){return new q(e,t,null!=r?r:this.line,null!=n?n:this.column)},Y.prototype.save=function(){this.savedPosition=this.pos,this.savedCurrent=this.current,this.savedLine=this.line,this.savedColumn=this.column},Y.prototype.restore=function(){this.pos=this.savedPosition,this.current=this.savedCurrent,this.line=this.savedLine,this.column=this.savedColumn},Y.prototype.next=function(){return this.pos>=this.expression.length?this.newToken("TEOF","EOF"):this.isWhitespace()||this.isComment()?this.next():this.isNumber()||this.isOperator()||this.isString()||this.isParen()||this.isComma()||this.isNamedOp()||this.isConst()||this.isName()?this.current:void this.parseError('Unknown character "'+this.expression.charAt(this.pos)+'"')},Y.prototype.isString=function(){var e=!1,t=this.line,r=this.column,n=this.pos,i=this.expression.charAt(n);if("'"===i||'"'===i){this.pos++,this.column++;for(var a=this.expression.indexOf(i,n+1);a>=0&&this.pos<this.expression.length;){if(this.pos=a+1,"\\"!==this.expression.charAt(a-1)){var s=this.expression.substring(n+1,a);this.current=this.newToken("TSTRING",this.unescape(s),t,r);for(var o=s.indexOf("\n"),l=-1;o>=0;)this.line++,this.column=0,l=o,o=s.indexOf("\n",o+1);this.column+=s.length-l,e=!0;break}a=this.expression.indexOf(i,a+1)}}return e},Y.prototype.isParen=function(){var e=this.expression.charAt(this.pos);return("("===e||")"===e)&&(this.current=this.newToken("TPAREN",e),this.pos++,this.column++,!0)},Y.prototype.isComma=function(){var e=this.expression.charAt(this.pos);return","===e&&(this.current=this.newToken("TCOMMA",","),this.pos++,this.column++,!0)},Y.prototype.isConst=function(){for(var e=this.pos,t=e;t<this.expression.length;t++){var r=this.expression.charAt(t);if(r.toUpperCase()===r.toLowerCase()&&(t===this.pos||"_"!==r&&"."!==r&&(r<"0"||r>"9")))break}if(t>e){var n=this.expression.substring(e,t);if(n in this.consts)return this.current=this.newToken("TNUMBER",this.consts[n]),this.pos+=n.length,this.column+=n.length,!0}return!1},Y.prototype.isNamedOp=function(){for(var e=this.pos,t=e;t<this.expression.length;t++){var r=this.expression.charAt(t);if(r.toUpperCase()===r.toLowerCase()&&(t===this.pos||"_"!==r&&(r<"0"||r>"9")))break}if(t>e){var n=this.expression.substring(e,t);if(n in this.binaryOps||n in this.unaryOps||n in this.ternaryOps)return this.current=this.newToken(Z,n),this.pos+=n.length,this.column+=n.length,!0}return!1},Y.prototype.isName=function(){for(var e=this.pos,t=e;t<this.expression.length;t++){var r=this.expression.charAt(t);if(r.toUpperCase()===r.toLowerCase()&&(t===this.pos||"_"!==r&&(r<"0"||r>"9")))break}if(t>e){var n=this.expression.substring(e,t);return this.current=this.newToken("TNAME",n),this.pos+=n.length,this.column+=n.length,!0}return!1},Y.prototype.isWhitespace=function(){for(var e=!1,t=this.expression.charAt(this.pos);!(" "!==t&&"\t"!==t&&"\n"!==t&&"\r"!==t||(e=!0,this.pos++,this.column++,"\n"===t&&(this.line++,this.column=0),this.pos>=this.expression.length));)t=this.expression.charAt(this.pos);return e};var G=/^[0-9a-f]{4}$/i;Y.prototype.unescape=function(e){var t=e.indexOf("\\");if(t<0)return e;for(var r=e.substring(0,t);t>=0;){var n=e.charAt(++t);switch(n){case"'":r+="'";break;case'"':r+='"';break;case"\\":r+="\\";break;case"/":r+="/";break;case"b":r+="\b";break;case"f":r+="\f";break;case"n":r+="\n";break;case"r":r+="\r";break;case"t":r+="\t";break;case"u":var i=e.substring(t+1,t+5);G.test(i)||this.parseError("Illegal escape sequence: \\u"+i),r+=String.fromCharCode(parseInt(i,16)),t+=4;break;default:throw this.parseError('Illegal escape sequence: "\\'+n+'"')}++t;var a=e.indexOf("\\",t);r+=e.substring(t,a<0?e.length:a),t=a}return r},Y.prototype.isComment=function(){var e=this.expression.charAt(this.pos);if("/"===e&&"*"===this.expression.charAt(this.pos+1)){var t=this.pos;this.pos=this.expression.indexOf("*/",this.pos)+2,1===this.pos&&(this.pos=this.expression.length);for(var r=this.expression.substring(t,this.pos),n=r.indexOf("\n");n>=0;)this.line++,this.column=r.length-n,n=r.indexOf("\n",n+1);return!0}return!1},Y.prototype.isNumber=function(){for(var e,t=!1,r=this.pos,n=r,i=r,a=this.column,s=a,o=!1,l=!1;r<this.expression.length&&((e=this.expression.charAt(r))>="0"&&e<="9"||!o&&"."===e);)"."===e?o=!0:l=!0,r++,a++,t=l;if(t&&(i=r,s=a),"e"===e||"E"===e){r++,a++;for(var u=!0,c=!1;r<this.expression.length;){if(e=this.expression.charAt(r),!u||"+"!==e&&"-"!==e){if(!(e>="0"&&e<="9"))break;c=!0,u=!1}else u=!1;r++,a++}c||(r=i,a=s)}return t?(this.current=this.newToken("TNUMBER",parseFloat(this.expression.substring(n,r))),this.pos=r,this.column=a):(this.pos=i,this.column=s),t},Y.prototype.isOperator=function(){var e=this.expression.charAt(this.pos);if("+"===e||"-"===e||"*"===e||"/"===e||"%"===e||"^"===e||"?"===e||":"===e||"."===e)this.current=this.newToken(Z,e);else if("∙"===e||"•"===e)this.current=this.newToken(Z,"*");else if(">"===e)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(Z,">="),this.pos++,this.column++):this.current=this.newToken(Z,">");else if("<"===e)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(Z,"<="),this.pos++,this.column++):this.current=this.newToken(Z,"<");else if("|"===e){if("|"!==this.expression.charAt(this.pos+1))return!1;this.current=this.newToken(Z,"||"),this.pos++,this.column++}else if("="===e){if("="!==this.expression.charAt(this.pos+1))return!1;this.current=this.newToken(Z,"=="),this.pos++,this.column++}else{if("!"!==e)return!1;"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(Z,"!="),this.pos++,this.column++):this.current=this.newToken(Z,e)}return this.pos++,this.column++,!0},Y.prototype.parseError=function(e){throw new Error("parse error ["+(this.line+1)+":"+(this.column+1)+"]: "+e)};var X={};function K(e){var t=X[e];return t||(t=X[e]=new u(r,e)),t}var W={};function J(e){var t=W[e];return t||(t=W[e]=new u(n,e)),t}var Q={};function ee(e){var t=Q[e];return t||(t=Q[e]=new u(i,e)),t}function te(e,t){this.parser=e,this.tokens=t,this.current=null,this.nextToken=null,this.next(),this.savedCurrent=null,this.savedNextToken=null}function re(){this.unaryOps={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:Math.sinh||I,cosh:Math.cosh||A,tanh:Math.tanh||M,asinh:Math.asinh||N,acosh:Math.acosh||C,atanh:Math.atanh||O,sqrt:Math.sqrt,log:Math.log,ln:Math.log,lg:Math.log10||D,log10:Math.log10||D,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:Math.trunc||F,"-":R,"+":Number,exp:Math.exp,not:B,length:P,"!":L},this.binaryOps={"+":d,"-":p,"*":g,"/":_,"%":y,"^":Math.pow,"||":m,"==":v,"!=":b,">":w,"<":E,">=":T,"<=":k,and:x,or:S},this.ternaryOps={"?":z},this.functions={random:U,fac:L,min:Math.min,max:Math.max,hypot:Math.hypot||j,pyt:Math.hypot||j,pow:Math.pow,atan2:Math.atan2,if:z,gamma:$},this.consts={E:Math.E,PI:Math.PI,true:!0,false:!1}}return te.prototype.next=function(){return this.current=this.nextToken,this.nextToken=this.tokens.next()},te.prototype.tokenMatches=function(t,r){return void 0===r||(Array.isArray(r)?e(r,t.value)>=0:"function"==typeof r?r(t):t.value===r)},te.prototype.save=function(){this.savedCurrent=this.current,this.savedNextToken=this.nextToken,this.tokens.save()},te.prototype.restore=function(){this.tokens.restore(),this.current=this.savedCurrent,this.nextToken=this.savedNextToken},te.prototype.accept=function(e,t){return!(this.nextToken.type!==e||!this.tokenMatches(this.nextToken,t)||(this.next(),0))},te.prototype.expect=function(e,t){if(!this.accept(e,t))throw new Error("parse error ["+this.tokens.line+":"+this.tokens.column+"]: Expected "+(t||e))},te.prototype.parseAtom=function(e){if(this.accept("TNAME"))e.push(new u(a,this.current.value));else if(this.accept("TNUMBER"))e.push(new u(t,this.current.value));else if(this.accept("TSTRING"))e.push(new u(t,this.current.value));else{if(!this.accept("TPAREN","("))throw new Error("unexpected "+this.nextToken);this.parseExpression(e),this.expect("TPAREN",")")}},te.prototype.parseExpression=function(e){this.parseConditionalExpression(e)},te.prototype.parseConditionalExpression=function(e){for(this.parseOrExpression(e);this.accept(Z,"?");){var t=[],r=[];this.parseConditionalExpression(t),this.expect(Z,":"),this.parseConditionalExpression(r),e.push(new u(o,t)),e.push(new u(o,r)),e.push(ee("?"))}},te.prototype.parseOrExpression=function(e){for(this.parseAndExpression(e);this.accept(Z,"or");)this.parseAndExpression(e),e.push(J("or"))},te.prototype.parseAndExpression=function(e){for(this.parseComparison(e);this.accept(Z,"and");)this.parseComparison(e),e.push(J("and"))},te.prototype.parseComparison=function(e){for(this.parseAddSub(e);this.accept(Z,["==","!=","<","<=",">=",">"]);){var t=this.current;this.parseAddSub(e),e.push(J(t.value))}},te.prototype.parseAddSub=function(e){for(this.parseTerm(e);this.accept(Z,["+","-","||"]);){var t=this.current;this.parseTerm(e),e.push(J(t.value))}},te.prototype.parseTerm=function(e){for(this.parseFactor(e);this.accept(Z,["*","/","%"]);){var t=this.current;this.parseFactor(e),e.push(J(t.value))}},te.prototype.parseFactor=function(e){var t=this.tokens.unaryOps;if(this.save(),this.accept(Z,function(e){return e.value in t}))if("-"!==this.current.value&&"+"!==this.current.value&&"TPAREN"===this.nextToken.type&&"("===this.nextToken.value)this.restore(),this.parseExponential(e);else{var r=this.current;this.parseFactor(e),e.push(K(r.value))}else this.parseExponential(e)},te.prototype.parseExponential=function(e){for(this.parsePostfixExpression(e);this.accept(Z,"^");)this.parseFactor(e),e.push(J("^"))},te.prototype.parsePostfixExpression=function(e){for(this.parseFunctionCall(e);this.accept(Z,"!");)e.push(K("!"))},te.prototype.parseFunctionCall=function(e){var t=this.tokens.unaryOps;if(this.accept(Z,function(e){return e.value in t})){var r=this.current;this.parseAtom(e),e.push(K(r.value))}else for(this.parseMemberExpression(e);this.accept("TPAREN","(");)if(this.accept("TPAREN",")"))e.push(new u(s,0));else{var n=this.parseArgumentList(e);e.push(new u(s,n))}},te.prototype.parseArgumentList=function(e){for(var t=0;!this.accept("TPAREN",")");)for(this.parseExpression(e),++t;this.accept("TCOMMA");)this.parseExpression(e),++t;return t},te.prototype.parseMemberExpression=function(e){for(this.parseAtom(e);this.accept(Z,".");)this.expect("TNAME"),e.push(new u(l,this.current.value))},re.parse=function(e){return(new re).parse(e)},re.evaluate=function(e,t){return re.parse(e).evaluate(t)},re.prototype={parse:function(e){var t=[],r=new te(this,new Y(e,this.unaryOps,this.binaryOps,this.ternaryOps,this.consts));return r.parseExpression(t),r.expect("TEOF","EOF"),new c(t,this)},evaluate:function(e,t){return this.parse(e).evaluate(t)}},{Parser:re,Expression:c}}()}),ImageBlendExpressionFilter=function(e){function t(){return classCallCheck(this,t),possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return inherits(t,ImageToImageFilter),createClass(t,[{key:"_run",value:function(){if(this.hasMetadata("expression")){if(this.hasSameNcppInput()&&this.hasSameSizeInput())if(this.getNumberOfInputs()){for(var e=this.getInputCategories(),t=this._getInput(e[0]),r=t.getDataCopy(),n=(new bundle.Parser).parse(this.getMetadata("expression")),i=0;i<r.length;i++){for(var a={},s=0;s<e.length;s++)a[e[s]]=this._getInput(e[s]).getData()[i];r[i]=n.evaluate(a)}this._addOutput(Image2D).setData(r,t.getWidth(),t.getHeight())}else console.warn("A filter of type ImageBlendExpressionFilter requires at least one input.")}else console.warn('A filter of type ImageBlendExpressionFilter requires a blending expression.\nUse \'setMetadata("expression", "...")\' to set it.')}}]),t}(),SpatialConvolutionFilter=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.addInputValidator(0,Image2D),e.setMetadata("filter",null),e}return inherits(t,ImageToImageFilter),createClass(t,[{key:"_run",value:function(){if(this.hasValidInput()){var e=this.getMetadata("filter");if(e){for(var t=this._getInput(0),r=(t.getData(),t.getNcpp()),n=t.getWidth(),i=t.getHeight(),a=new Image2D({width:n,height:i,color:new Array(r).fill(0)}),s=a.getData(),o=(e.length,e.length),l=e[0].length,u=Math.floor(l/2),c=Math.floor(o/2),h=c,f=n-u,d=i-c,p=u;p<f;p++)for(var g=h;g<d;g++)for(var _=(g*n+p)*r,y=0;y<l;y++)for(var m=0;m<o;m++)for(var v=p+y-u,b=g+m-c,w=t.getPixel({x:v,y:b}),E=e[m][y],T=0;T<r;T++)s[_+T]+=w[T]*E;this._output[0]=a}else console.warn("A filter must be specified using .setMetadata('filter', [[]])")}else console.warn("A filter of type SpatialConvolutionFilter requires 1 input of category '0' and one input of category '1'.")}}]),t}(),MultiplyImageFilter=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.addInputValidator(0,Image2D),e.addInputValidator(1,Image2D),e}return inherits(t,ImageToImageFilter),createClass(t,[{key:"_run",value:function(){if(this.hasValidInput()){if(this.hasSameNcppInput()&&this.hasSameSizeInput()){for(var e=this._getInput(0),t=this._getInput(1).getData(),r=e.getDataCopy(),n=0;n<r.length;n++)r[n]*=t[n];this._addOutput(Image2D).setData(r,e.getWidth(),e.getHeight())}}else console.warn("A filter of type MultiplyImageFilter requires 1 input of category '0' and one input of category '1'.")}}]),t}(),SimpleThresholdFilter=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.addInputValidator(0,Image2D),e.setMetadata("threshold",128),e.setMetadata("lowValue",0),e.setMetadata("highValue",255),e.setMetadata("preserveAlpha",!0),e}return inherits(t,ImageToImageFilter),createClass(t,[{key:"_run",value:function(){if(this.hasValidInput()){var e=this._getInput(0),t=e.clone(),r=e.getComponentsPerPixel(),n=this.getMetadata("threshold"),i=this.getMetadata("lowValue"),a=this.getMetadata("highValue"),s=t.getData();if(1!=r&&3!=r&&4!=r)return s=null,void console.warn("The input data must have 1, 3 or 4 components per pixel.");if(this.getMetadata("preserveAlpha")&&4==r)for(var o=0;o<s.length;o++)o%4!=3&&(s[o]=s[o]<n?i:a);else for(o=0;o<s.length;o++)s[o]=s[o]<n?i:a;this._output[0]=t}}}]),t}(),ImageDerivativeFilter=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e.addInputValidator(0,Image2D);return e.setMetadata("dxFilter",[[1,-1]]),e.setMetadata("dyFilter",[[1],[-1]]),e}return inherits(t,ImageToImageFilter),createClass(t,[{key:"_run",value:function(){if(this.hasValidInput()){var e=this._getInput(0),t=this.getMetadata("dxFilter"),r=this.getMetadata("dyFilter"),n=new pixpipe.SpatialConvolutionFilter;n.addInput(e),n.setMetadata("filter",t),n.update(),this._output.dx=n.getOutput(),n.setMetadata("filter",r),n.update(),this._output.dy=n.getOutput()}else console.warn("A filter of type ImageDerivativeFilter requires 1 input of category '0' and one input of category '1'.")}}]),t}(),GradientImageFilter=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.addInputValidator("dx",Image2D),e.addInputValidator("dy",Image2D),e}return inherits(t,ImageToImageFilter),createClass(t,[{key:"_run",value:function(){if(this.hasValidInput()){if(this.hasSameSizeInput()&&this.hasSameNcppInput()){for(var e=this._getInput("dx"),t=e.getData(),r=this._getInput("dy").getData(),n=e.hollowClone(),i=n.getData(),a=e.hollowClone(),s=a.getData(),o={min:1/0,max:-1/0},l={min:1/0,max:-1/0},u=0;u<t.length;u++)i[u]=Math.sqrt(t[u]*t[u]+r[u]*r[u]),isNaN(i[u])||(o.min=Math.min(o.min,i[u]),o.max=Math.max(o.max,i[u])),s[u]=Math.atan(r[u]/t[u]),isNaN(s[u])||(l.min=Math.min(l.min,s[u]),l.max=Math.max(l.max,s[u]));n.setMetadata("min",o.min),n.setMetadata("max",o.max),a.setMetadata("min",l.min),a.setMetadata("max",l.max),this._output.direction=a,this._output.magnitude=n}}else console.warn("A filter of type GradientImageFilter requires 1 input of category 'dx' and 1 input of category 'dy'.")}}]),t}(),NormalizeImageFilter=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.addInputValidator(0,Image2D),e.setMetadata("max",NaN),e}return inherits(t,ImageToImageFilter),createClass(t,[{key:"_run",value:function(){if(this.hasValidInput()){var e=this._input[0],t=e.getData(),r=e.hollowClone(),n=r.getData(),i=this.getMetadata("max");isNaN(i)&&(i=e.getMax());for(var a=0;a<t.length;a++)n[a]=t[a]/i;this._output[0]=r}else console.warn("A filter of type */ requires 1 input of category '0'.")}}]),t}(),ContourImage2DFilter=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.addInputValidator(0,Image2D),e.setMetadata("connexity",8),e.setMetadata("seed",[0,0]),e._directionListConnexity4=[[0,-1],[-1,0],[0,1],[1,0]],e._directionListConnexity8=[[0,-1],[-1,-1],[-1,0],[-1,1],[0,1],[1,1],[1,0],[1,-1]],e}return inherits(t,Filter),createClass(t,[{key:"_run",value:function(){if(this.hasValidInput()){var e=this._getInput(0),t=(e.getNcpp(),e.getWidth()),r=e.getHeight(),n=null;n=8==this.getMetadata("connexity")?this._directionListConnexity8:this._directionListConnexity4;var i=this._metadata.seed.slice(),a=n.length/4,s=a;if(i[0]<0||i[1]<0||i[0]>=t||i[1]>=r)console.warn("The seed is out of image range.");else{for(var o=e.getPixel({x:i[0],y:i[1]}),l=o,u=i.slice(),c=!1,h=0;h<this._directionListConnexity4.length;h++){if(!m(e.getPixel({x:i[0]+this._directionListConnexity4[h][0],y:i[1]+this._directionListConnexity4[h][1]}),o)){c=!0,s=h,8==this.getMetadata("connexity")&&(s*=2),s+=a;break}}for(;!c;){if(u[0]+=n[0][0],u[1]+=n[0][1],u[0]<0){i[0]=0,i[1]=u[1];break}if(!(l=e.getPixel({x:u[0],y:u[1]}))||!m(l,o))break;i[0]=u[0],i[1]=u[1]}var f=i.slice(),d=[0,0],p=[];p.push(i[0]),p.push(i[1]);e:for(;;){(s-=a)<0&&(s=n.length-a);var g=v();if(0==g)break e;if(1!=g){var _=0;t:for(h=0;h<n.length-1;h++){if(s++,s%=n.length,0==(g=v()))break e;if(1==g)break t;_++}if(_==n.length-1)break}}var y=new LineString;y.setData(p),y.setMetadata("closed",!0),this._output[0]=y}}else console.warn("A filter of type AngleToHueWheelHelper requires 1 input of category '0'.");function m(e,t){if(e.length!=t.length)return!1;for(var r=0;r<e.length;r++)if(e[r]!=t[r])return!1;return!0}function v(){return d[0]=f[0]+n[s][0],d[1]=f[1]+n[s][1],d[0]<0||d[1]<0||d[0]>=t||d[1]>=r?2:m(e.getPixel({x:d[0],y:d[1]}),o)?d[0]==p[0]&&d[1]==p[1]?0:(f[0]=d[0],f[1]=d[1],p.push(f[0]),p.push(f[1]),1):2}}}]),t}(),FloodFillImageFilter=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.addInputValidator(0,Image2D),e.setMetadata("tolerance",1),e.setMetadata("connexity",4),e.setMetadata("color",null),e.setMetadata("onlyHits",!1),e._directionListConnexity4=[[0,-1],[-1,0],[0,1],[1,0]],e._directionListConnexity8=[[0,-1],[-1,-1],[-1,0],[-1,1],[0,1],[1,1],[1,0],[1,-1]],e}return inherits(t,ImageToImageFilter),createClass(t,[{key:"_run",value:function(){if(this.hasValidInput()){var e=this._getInput(0),t=e.getNcpp(),r=e.getWidth(),n=e.getHeight(),i=null;i=8==this.getMetadata("connexity")?this._directionListConnexity8:this._directionListConnexity4;var a=new Array(t);a[0]=255;var s=this.getMetadata("color")||a;if(s.length==t||3==s.length&&4==t){var o=new Image2D({width:r,height:n,color:[0]}),l=this.getMetadata("seed"),u=e.getPixel({x:l[0],y:l[1]}),c=this.getMetadata("tolerance"),h=this.getMetadata("onlyHits"),f=null;h||(f=e.clone());var d=[],p=[];for(p.push(l);p.length>0;){var g=p.pop(),_=g[0],y=g[1];if(!(_<0||_>=r||y<0||y>=n)&&0==o.getPixel({x:_,y:y})[0]){o.setPixel({x:_,y:y},[1]),h||f.setPixel({x:_,y:y},s);for(var m=[0,0],v=!1,b=0;b<i.length;b++)if(m[0]=_+i[b][0],m[1]=y+i[b][1],!(m[0]<0||m[0]>=r||m[1]<0||m[1]>=n)){for(var w=e.getPixel({x:m[0],y:m[1]}),E=!0,T=0;T<u.length;T++)if(Math.abs(w[T]-u[T])>c){E=!1,v=!0;break}if(E){var k=[m[0],m[1]];p.push(k)}}v&&0!=_&&_!=r-1&&0!=y&&y!=n-1&&d.push(g)}}h||(this._output[0]=f),this._output.edgePoints=d}else console.warn("The color to fill must have the same number of components as the input image. (RGB color for RGBA image is accepted)")}else console.warn("A filter of type FloodFillImageFilter requires 1 input of category '0'.")}}]),t}(),ContourHolesImage2DFilter=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.addInputValidator(0,Image2D),e.setMetadata("connexity",4),e.setMetadata("seed",[0,0]),e}return inherits(t,Filter),createClass(t,[{key:"_run",value:function(){if(this.hasValidInput()){var e=this._getInput(0),t=(e.getNcpp(),e.getWidth(),e.getHeight(),[]),r=this.getMetadata("connexity"),n=this.getMetadata("seed"),i=new ContourImage2DFilter;i.addInput(e),i.setMetadata("connexity",r),i.setMetadata("seed",n),i.update(),t.push(i.getOutput());var a=new FloodFillImageFilter;a.addInput(e),a.setMetadata("onlyHits",!1),a.setMetadata("connexity",4),a.setMetadata("tolerance",0),a.setMetadata("seed",n),a.update();var s=a.getOutput("edgePoints"),o=new ContourImage2DFilter;o.setMetadata("time",!1);for(var l=0;l<s.length;l++){for(var u=s[l],c=!1,h=0;h<t.length;h++)if(t[h].hasPoint(u)){c=!0;break}c||(o.addInput(e),o.setMetadata("connexity",r),o.setMetadata("seed",u),o.update(),t.push(o.getOutput()))}for(l=0;l<t.length;l++)this._output[l]=t[l]}else console.warn("A filter of type ContourHolesImage2DFilter requires 1 input of category '0'.")}}]),t}(),ForEachPixelReadOnlyFilter=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.addInputValidator(0,Image2D),e}return inherits(t,Filter),createClass(t,[{key:"_run",value:function(){if(this.hasValidInput())if(this.hasEvent("pixel"))for(var e=this._getInput(0),t=(e.getNcpp(),e.getWidth()),r=e.getHeight(),n=0;n<r;n++)for(var i=0;i<t;i++){var a={x:i,y:n},s=e.getPixel(a);this.triggerEvent("pixel",a,s)}else console.warn("No function to apply per pixel was specified.");else console.warn("A filter of type ForEachPixelReadOnlyFilter requires 1 input of category '0'.")}}]),t}(),TerrainRgbToElevationImageFilter=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.addInputValidator(0,Image2D),e}return inherits(t,ImageToImageFilter),createClass(t,[{key:"_run",value:function(){if(this.hasValidInput()){var e=this._getInput(0),t=e.getNcpp(),r=e.getWidth(),n=e.getHeight();if(t<3)console.warn("A filter of type TerrainRgbToElevationImageFilter requires an input with at least 3 components per pixel.");else{var i=new pixpipe.Image2D({width:r,height:n,color:[0]}),a=new pixpipe.ForEachPixelReadOnlyFilter;a.addInput(e),a.on("pixel",function(e,t){var r=.1*(256*t[0]*256+256*t[1]+t[2])-1e4;i.setPixel(e,[r])}),a.update(),this._output[0]=i}}else console.warn("A filter of type TerrainRgbToElevationImageFilter requires 1 input of category '0'.")}}]),t}(),NearestNeighborSparseInterpolationImageFilter=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setMetadata("outputSize",{width:0,height:0}),e}return inherits(t,Filter),createClass(t,[{key:"_run",value:function(){var e=null;if("0"in this._input){e=this._input[0];var t=this.getMetadata("outputSize");if(0!=t.width&&0!=t.height){for(var r=new pixpipe.Image2D({width:t.width,height:t.height,color:[0]}),n=0;n<t.width;n++)for(var i=0;i<t.height;i++){for(var a=0,s=1/0,o=0;o<e.length;o++){var l=Math.sqrt(Math.pow(e[o].x-n,2)+Math.pow(e[o].y-i,2));l<s&&(s=l,a=o)}r.setPixel({x:n,y:i},[e[a].value])}this._output[0]=r}else console.warn("The output size cannot be 0.")}else console.warn("No input point set were given.")}}]),t}(),IDWSparseInterpolationImageFilter=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setMetadata("strength",2),e.setMetadata("k",5),e.setMetadata("forceBuildMap",!1),e.setMetadata("outputSize",{width:256,height:256}),e._map=null,e}return inherits(t,Filter),createClass(t,[{key:"_run",value:function(){var e=null;if("0"in this._input){e=this._input[0];var t=this.getMetadata("outputSize");if(0!=t.width&&0!=t.height){!this.getMetadata("forceBuildMap")&&this._map||this._buildMap();var r=new pixpipe.Image2D({width:t.width,height:t.height,color:[0]}),n=this.getMetadata("strength"),i=Math.min(this.getMetadata("k"),e.length);console.time("make");for(var a=0;a<t.width;a++)for(var s=0;s<t.height;s++){for(var o=0,l=0,u=null,c=!1,h=a+s*t.width,f=this._map[h],d=0;d<i;d++){var p=f[d].distance,g=f[d].index;if(0==p){c=!0,u=e[g].value;break}var _=1/Math.pow(p,n);o+=e[g].value*_,l+=_}var y=c?u:o/l;r.setPixel({x:a,y:s},[y])}this._output[0]=r}else console.warn("The output size cannot be 0.")}else console.warn("No input point set were given.")}},{key:"_buildMap",value:function(){var e=this.getMetadata("outputSize"),t=this._input[0],r=Math.min(this.getMetadata("k"),t.length);this._map=new Array(e.width*e.height);for(var n=0;n<e.width;n++)for(var i=0;i<e.height;i++){for(var a=n+i*e.width,s=new Array(o),o=0;o<t.length;o++){var l=Math.sqrt(Math.pow(t[o].x-n,2)+Math.pow(t[o].y-i,2));s[o]={index:o,distance:l}}s.sort(function(e,t){return e.distance<t.distance?-1:1}),s=s.slice(0,r),this._map[a]=s}}}]),t}(),delaunay=createCommonjsModule(function(e){var t;!function(){var r=1/1048576;function n(e,t,n,i){var a,s,o,l,u,c,h,f,d,p,g=e[t][0],_=e[t][1],y=e[n][0],m=e[n][1],v=e[i][0],b=e[i][1],w=Math.abs(_-m),E=Math.abs(m-b);if(w<r&&E<r)throw new Error("Eek! Coincident points!");return w<r?s=(l=-(v-y)/(b-m))*((a=(y+g)/2)-(c=(y+v)/2))+(f=(m+b)/2):E<r?s=(o=-(y-g)/(m-_))*((a=(v+y)/2)-(u=(g+y)/2))+(h=(_+m)/2):(a=((o=-(y-g)/(m-_))*(u=(g+y)/2)-(l=-(v-y)/(b-m))*(c=(y+v)/2)+(f=(m+b)/2)-(h=(_+m)/2))/(o-l),s=w>E?o*(a-u)+h:l*(a-c)+f),{i:t,j:n,k:i,x:a,y:s,r:(d=y-a)*d+(p=m-s)*p}}function i(e){var t,r,n,i,a,s;for(r=e.length;r;)for(i=e[--r],n=e[--r],t=r;t;)if(s=e[--t],n===(a=e[--t])&&i===s||n===s&&i===a){e.splice(r,2),e.splice(t,2);break}}t={triangulate:function(e,t){var a,s,o,l,u,c,h,f,d,p,g,_,y=e.length;if(y<3)return[];if(e=e.slice(0),t)for(a=y;a--;)e[a]=e[a][t];for(o=new Array(y),a=y;a--;)o[a]=a;for(o.sort(function(t,r){return e[r][0]-e[t][0]}),l=function(e){var t,r,n,i,a,s,o=Number.POSITIVE_INFINITY,l=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY;for(t=e.length;t--;)e[t][0]<o&&(o=e[t][0]),e[t][0]>u&&(u=e[t][0]),e[t][1]<l&&(l=e[t][1]),e[t][1]>c&&(c=e[t][1]);return n=c-l,[[(a=o+.5*(r=u-o))-20*(i=Math.max(r,n)),(s=l+.5*n)-i],[a,s+20*i],[a+20*i,s-i]]}(e),e.push(l[0],l[1],l[2]),u=[n(e,y+0,y+1,y+2)],c=[],h=[],a=o.length;a--;h.length=0){for(_=o[a],s=u.length;s--;)(f=e[_][0]-u[s].x)>0&&f*f>u[s].r?(c.push(u[s]),u.splice(s,1)):f*f+(d=e[_][1]-u[s].y)*d-u[s].r>r||(h.push(u[s].i,u[s].j,u[s].j,u[s].k,u[s].k,u[s].i),u.splice(s,1));for(i(h),s=h.length;s;)g=h[--s],p=h[--s],u.push(n(e,p,g,_))}for(a=u.length;a--;)c.push(u[a]);for(u.length=0,a=c.length;a--;)c[a].i<y&&c[a].j<y&&c[a].k<y&&u.push(c[a].i,c[a].j,c[a].k);return u},contains:function(e,t){if(t[0]<e[0][0]&&t[0]<e[1][0]&&t[0]<e[2][0]||t[0]>e[0][0]&&t[0]>e[1][0]&&t[0]>e[2][0]||t[1]<e[0][1]&&t[1]<e[1][1]&&t[1]<e[2][1]||t[1]>e[0][1]&&t[1]>e[1][1]&&t[1]>e[2][1])return null;var r=e[1][0]-e[0][0],n=e[2][0]-e[0][0],i=e[1][1]-e[0][1],a=e[2][1]-e[0][1],s=r*a-n*i;if(0===s)return null;var o=(a*(t[0]-e[0][0])-n*(t[1]-e[0][1]))/s,l=(r*(t[1]-e[0][1])-i*(t[0]-e[0][0]))/s;return o<0||l<0||o+l>1?null:[o,l]}},e.exports=t}()}),TriangulationSparseInterpolationImageFilter=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setMetadata("outputSize",{width:0,height:0}),e}return inherits(t,Filter),createClass(t,[{key:"_run",value:function(){var e=null;if("0"in this._input){e=this._input[0];var t=this.getMetadata("outputSize");if(0!=t.width&&0!=t.height){for(var r=e.map(function(e){return[e.x,e.y]}),n=delaunay.triangulate(r),i=[],a=0;a<=n.length-3;a+=3)i.push([n[a],n[a+1],n[a+2]]);console.log(r),console.log(i);var s=new pixpipe.Image2D({width:Math.round(t.width),height:Math.round(t.height),color:[0]});for(a=0;a<t.width;a++)for(var o=0;o<t.height;o++){for(var l=0,u=!1,c=0,h=0;h<i.length;h++){if(delaunay.contains([r[i[h][0]],r[i[h][1]],r[i[h][2]]],[a,o])){u=!0,c=i[h];break}}if(u){var f=r[c[0]],d=r[c[1]],p=r[c[2]],g=[a,o],_=b(f,d,p),y=b(f,d,g),m=b(d,p,g),v=b(p,f,g);l=y/_*e[c[2]].value+m/_*e[c[0]].value+v/_*e[c[1]].value}s.setPixel({x:a,y:o},[l])}this._output[0]=s}else console.warn("The output size cannot be 0.")}else console.warn("No input point set were given.");function b(e,t,r){var n=[e[0]-t[0],e[1]-t[1]],i=[t[0]-r[0],t[1]-r[1]],a=[r[0]-e[0],r[1]-e[1]],s=Math.sqrt(i[0]*i[0]+i[1]*i[1]),o=Math.sqrt(a[0]*a[0]+a[1]*a[1]),l=Math.sqrt(n[0]*n[0]+n[1]*n[1]),u=(s+o+l)/2;return Math.sqrt(u*(u-s)*(u-o)*(u-l))}}}]),t}(),CropImageFilter=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.addInputValidator(0,Image2D),e.setMetadata("x",0),e.setMetadata("y",0),e.setMetadata("w",0),e.setMetadata("h",0),e}return inherits(t,ImageToImageFilter),createClass(t,[{key:"_run",value:function(){if(this.hasValidInput()){var e=Math.round(this.getMetadata("x")),t=Math.round(this.getMetadata("y")),r=Math.round(this.getMetadata("w")),n=Math.round(this.getMetadata("h")),i=e+r,a=t+n,s=this._getInput(0),o=s.getWidth(),l=s.getHeight(),u=s.getNcpp();if(e<0||t<0||e>=o||t>=l||i<0||a<0||i>=o||a>=l)console.warn("The query area is out of bound");else{for(var c=s.getData(),h=new Image2D({width:r,height:n,color:new c.constructor(u)}),f=0;f<r;f++)for(var d=0;d<n;d++){var p=s.getPixel({x:f+e,y:d+t});h.setPixel({x:f,y:d},p)}this._output[0]=h}}else console.warn("A filter of type CropImageFilter requires 1 input of category '0' (Image2D)")}}]),t}(),simplify=createCommonjsModule(function(e){!function(){function t(e,t,r){var n=t.x,i=t.y,a=r.x-n,s=r.y-i;if(0!==a||0!==s){var o=((e.x-n)*a+(e.y-i)*s)/(a*a+s*s);o>1?(n=r.x,i=r.y):o>0&&(n+=a*o,i+=s*o)}return(a=e.x-n)*a+(s=e.y-i)*s}function r(e,r,n){var i=void 0!==r?r*r:1;return e=function(e,r){var n,i,a,s,o=e.length,l=new("undefined"!=typeof Uint8Array?Uint8Array:Array)(o),u=0,c=o-1,h=[],f=[];for(l[u]=l[c]=1;c;){for(i=0,n=u+1;n<c;n++)(a=t(e[n],e[u],e[c]))>i&&(s=n,i=a);i>r&&(l[s]=1,h.push(u,s,s,c)),c=h.pop(),u=h.pop()}for(n=0;n<o;n++)l[n]&&f.push(e[n]);return f}(e=n?e:function(e,t){for(var r,n,i,a,s,o=e[0],l=[o],u=1,c=e.length;u<c;u++)r=e[u],i=o,a=(n=r).x-i.x,s=n.y-i.y,a*a+s*s>t&&(l.push(r),o=r);return o!==r&&l.push(r),l}(e,i),i)}e.exports=r}()}),SimplifyLineStringFilter=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.addInputValidator(0,LineString),e.setMetadata("tolerance",.1),e}return inherits(t,Filter),createClass(t,[{key:"_run",value:function(){if(this.hasValidInput()){var e=this._getInput(0),t=e.getNod(),r=e.getData(),n=this.getMetadata("tolerance");if(2==t){for(var i=new Array(r.length/2),a=0;a<i.length;a++)i[a]={x:r[2*a],y:r[2*a+1]};var s=simplify(i,n,!0),o=new Array(2*s.length);for(a=0;a<s.length-1;a++)o[2*a]=s[a].x,o[2*a+1]=s[a+1].y;var l=new LineString;l.setData(o,t),l.copyMetadataFrom(e),this._output[0]=l}else console.warn("SimplifyLineStringFilter is only for 2D LineStrings.")}else console.warn("A filter of type SimplifyLineStringFilter requires 1 input of category '0' (LineString)")}}]),t}(),PatchImageFilter=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.addInputValidator(0,Image2D),e.setMetadata("outputSize",{w:0,h:0}),e.setMetadata("outputColor",[0,0,0,255]),e.setMetadata("patchPosition",{x:0,y:0}),e.setMetadata("resetOutput",!0),e._patchedOutput=null,e}return inherits(t,ImageToImageFilter),createClass(t,[{key:"_run",value:function(){if(this.hasValidInput()){var e=this._getInput(0),t=e.getNcpp(),r=e.getWidth(),n=e.getHeight(),i=this.getMetadata("outputSize");if(0!=i.w&&0!=i.h){var a=this.getMetadata("outputColor");if(Array.isArray(a)){var s=a.length;if(t==s){this.getMetadata("resetOutput")&&(this._patchedOutput=new pixpipe.Image2D({width:i.w,height:i.h,color:a})),this._output[0]=this._patchedOutput;var o=this.getMetadata("patchPosition");o.x=Math.round(o.x),o.y=Math.round(o.y),(o.x+r>i.w||o.y+n>i.h||o.x<0||o.y<0)&&console.warn("The patch is partly or totaly out of bound.");for(var l=0;l<r;l++)for(var u=0;u<n;u++){var c=e.getPixel({x:l,y:u});this._patchedOutput.setPixel({x:l+o.x,y:u+o.y},c)}this.setMetadata("resetOutput",!1)}else console.warn("The Image2D specified in input has "+t+" ncpp while the output is configured with "+s+" ncpp. Unable to continue patching.")}else console.warn("The filter metadata 'outputColor' must be an Array of non null size.")}else console.warn("The output image cannot have a size of (0, 0). Use .setMetadata( 'outputSize', {w: Number, h:Number} ) to specify a size.")}else console.warn("A filter of type PatchImageFilter requires 1 input of category '0' (Image2D)")}}]),t}(),differenceequationsignal1d_umd=createCommonjsModule(function(e,t){!function(e){var t=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),n=function(){function e(){t(this,e),this._inputSignal=null,this._outputSignal=null,this._aCoefficients=null,this._bCoefficients=null,this._enableBackwardSecondPass=!1}return r(e,[{key:"setInput",value:function(e){this._outputSignal=null,this._inputSignal=e}},{key:"setACoefficients",value:function(e){this._aCoefficients=e}},{key:"setBCoefficients",value:function(e){this._bCoefficients=e}},{key:"getOutput",value:function(){return this._outputSignal}},{key:"enableBackwardSecondPass",value:function(){this._enableBackwardSecondPass=!0}},{key:"disableBackwardSecondPass",value:function(){this._enableBackwardSecondPass=!1}},{key:"run",value:function(){var e=new Float32Array(this._inputSignal.length).fill(0),t=this._inputSignal,r=e,n=this._bCoefficients,i=this._aCoefficients,a=n.length-1,s=i.length-1;function o(e){for(var o=0,l=0;l<=a;l++){var u=l>e?0:t[e-l];o+=n[l]*u}for(var c=0,h=1;h<=s;h++){var u=h>e?0:r[e-h];c+=i[h]*u}var f=o-c;return f}for(var l=0;l<e.length;l++)e[l]=o(l);if(this._enableBackwardSecondPass){e.reverse(),t=e,e=new Float32Array(this._inputSignal.length).fill(0),r=e;for(var l=0;l<e.length;l++)e[l]=o(l);e.reverse()}this._outputSignal=e}}]),e}();e.DifferenceEquationSignal1D=n,Object.defineProperty(e,"__esModule",{value:!0})}(t)}),differenceequationsignal1d=unwrapExports(differenceequationsignal1d_umd),DifferenceEquationSignal1D=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.addInputValidator(0,Signal1D),e.setMetadata("coefficientsB",null),e.setMetadata("coefficientsA",null),e.setMetadata("enableBackwardSecondPass",!0),e}return inherits(t,Filter),createClass(t,[{key:"_run",value:function(){if(this.hasValidInput()){var e=this._getInput(0),t=this.getMetadata("coefficientsB"),r=this.getMetadata("coefficientsA"),n=this.getMetadata("enableBackwardSecondPass");if(r&&t)if(r.length==t.length){var i=new differenceequationsignal1d.DifferenceEquationSignal1D;n&&i.enableBackwardSecondPass(),i.setInput(e.getData()),i.setACoefficients(r),i.setBCoefficients(t),i.run();var a=i.getOutput();if(a){var s=new Signal1D;s.copyMetadataFrom(e),s.setData(a),this._output[0]=s}}else console.warn("The 'coefficientsB' and 'coefficientsA' metadata must be arrays of the same size.");else console.warn("Both 'coefficientsB' and 'coefficientsA' metadata must be set to arrays of numbers.")}}}]),t}(),FunctionGenerator=function(){function e(){classCallCheck(this,e)}return createClass(e,null,[{key:"gaussianFrequencyResponse",value:function(t,r,n){for(var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=[],o=!1,l=1/0,u=-1/0,c=r;c<=n;c+=i){var h=e.gaussianFrequencyResponseSingle(t,c);if(h>a)o||(l=c,o=!0),s.push(h),u=c;else if(o)break}return{data:new Float32Array(s),actualBegin:l,actualEnd:u}}},{key:"gaussianFrequencyResponseSingle",value:function(e,t){return Math.exp(-t*t/(2*e*e))}}]),e}(),F_TYPES=["gaussian","rectangular"],LowPassFreqSignal1D=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.addInputValidator("real",Signal1D),e.addInputValidator("imaginary",Signal1D),e.setMetadata("cutoffFrequency",0),e.setMetadata("filterType","gaussian"),e.setMetadata("gaussianTolerance",.01),e}return inherits(t,Filter),createClass(t,[{key:"_run",value:function(){if(this.hasValidInput()){var e=this._getInput("real"),t=this._getInput("imaginary"),r=this.getMetadata("cutoffFrequency"),n=this.getMetadata("filterType");if(0!=r)if(-1!=F_TYPES.indexOf(n)){var i=e.clone(),a=t.clone();this["_"+n](i,a,r)&&(this._output.real=i,this._output.imaginary=a)}else console.warn("The filter type must be one of: "+F_TYPES.join(", "));else console.warn("The cutoff frequency cannot be 0.")}else console.warn("A filter of type LowPassFreqSignal1D requires 2 input of type Signal1D and of category: 'real' and 'imaginary'.")}},{key:"_getDataIndexFromFrequency",value:function(e,t){return Math.round(t*e.getData().length/e.getMetadata("samplingFrequency"))}},{key:"_rectangular",value:function(e,t,r){e.getMetadata("samplingFrequency");for(var n=this._getDataIndexFromFrequency(e,r),i=e.getData(),a=t.getData(),s=n;s<i.length-n;s++)i[s]=0,a[s]=0;return!0}},{key:"_gaussian",value:function(e,t,r){e.getMetadata("samplingFrequency");for(var n=this._getDataIndexFromFrequency(e,r),i=e.getData(),a=t.getData(),s=i.length,o=Math.floor(s/2),l=this.getMetadata("gaussianTolerance"),u=FunctionGenerator.gaussianFrequencyResponse(r,0,Math.floor(a.length/2),r/n,l).data,c=0;c<u.length&&!(c>=o);c++)i[c]*=u[c],a[c]*=u[c],i[s-1-c]*=u[c],a[s-1-c]*=u[c];try{var h=new Float32Array(i.length-2*u.length);i.set(h,u.length),a.set(h,u.length)}catch(e){}return!0}}]),t}(),LowPassSignal1D=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.addInputValidator(0,Signal1D),e.setMetadata("cutoffFrequency",0),e.setMetadata("filterType","gaussian"),e.setMetadata("gaussianTolerance",.01),e}return inherits(t,Filter),createClass(t,[{key:"_run",value:function(){if(this.hasValidInput()){var e=this._getInput(),t=e.getMetadata("samplingFrequency"),r=this.getMetadata("cutoffFrequency"),n=this.getMetadata("filterType"),i=this.getMetadata("gaussianTolerance");if(r>t/2)console.warn("The cutoff frequency cannot be greater than half of the sampling frequency (cf. Nyquist).");else{var a=e.hollowClone(),s=new ForwardFourierSignalFilter;s.addInput(e,0),s.addInput(a,1),s.update();var o={real:s.getOutput(0),imag:s.getOutput(1)},l=new LowPassFreqSignal1D;l.addInput(o.real,"real"),l.addInput(o.imag,"imaginary"),l.setMetadata("filterType",n),l.setMetadata("cutoffFrequency",r),l.setMetadata("gaussianTolerance",i),l.update();var u={real:l.getOutput("real"),imag:l.getOutput("imaginary")},c=new pixpipe.InverseFourierSignalFilter;c.addInput(u.real,0),c.addInput(u.imag,1),c.update();var h=c.getOutput();h&&(this._output[0]=h)}}else console.warn("A filter of type LowPassSignal1D requires 1 input of type Signal1D and of category 0")}}]),t}(),HighPassSignal1D=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.addInputValidator(0,Signal1D),e.setMetadata("cutoffFrequency",0),e.setMetadata("filterType","gaussian"),e.setMetadata("gaussianTolerance",.01),e}return inherits(t,Filter),createClass(t,[{key:"_run",value:function(){if(this.hasValidInput()){var e=this._getInput(),t=e.getMetadata("samplingFrequency"),r=this.getMetadata("cutoffFrequency"),n=this.getMetadata("filterType"),i=this.getMetadata("gaussianTolerance");if(r>t/2)console.warn("The cutoff frequency cannot be greater than half of the sampling frequency (cf. Nyquist).");else{var a=new LowPassSignal1D;a.setMetadata("cutoffFrequency",r),a.setMetadata("filterType",n),a.setMetadata("gaussianTolerance",i),a.addInput(e),a.update();var s=a.getOutput();if(s){for(var o=e.clone(),l=o.getData(),u=s.getData(),c=0;c<l.length;c++)l[c]-=u[c];this._output[0]=o}else console.warn("couldnt compute the low pass filter.")}}else console.warn("A filter of type HighPassSignal1D requires 1 input of type Signal1D and of category 0")}}]),t}(),BandPassSignal1D=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.addInputValidator(0,Signal1D),e.setMetadata("hiCutoffFrequency",0),e.setMetadata("loCutoffFrequency",0),e.setMetadata("filterType","gaussian"),e.setMetadata("gaussianTolerance",.01),e}return inherits(t,Filter),createClass(t,[{key:"_run",value:function(){if(this.hasValidInput()){var e=this._getInput(),t=e.getMetadata("samplingFrequency"),r=this.getMetadata("hiCutoffFrequency"),n=this.getMetadata("loCutoffFrequency"),i=this.getMetadata("filterType"),a=this.getMetadata("gaussianTolerance");if(0!==r||0!==n)if(r>t/2||n>t/2)console.warn("The cutoff frequency cannot be greater than half of the sampling frequency (cf. Nyquist).");else if(n>0&&r>0&&r>n)console.warn("Band pass filter: the hiCutoffFrequency cannot be greater than the loCutoffFrequency.");else{var s=null;if(n>0){var o=new pixpipe.LowPassSignal1D;o.addInput(e),o.setMetadata("cutoffFrequency",n),o.setMetadata("filterType",i),o.setMetadata("gaussianTolerance",a),o.update(),s=o.getOutput()}if(r>0){var l=new pixpipe.HighPassSignal1D;l.addInput(s||e),l.setMetadata("cutoffFrequency",r),l.setMetadata("filterType",i),l.setMetadata("gaussianTolerance",a),l.update(),s=l.getOutput()}this._output[0]=s}else console.warn("At least one of the following metadata must be greater than zero: hiCutoffFrequency loCutoffFrequency")}else console.warn("A filter of type BandPassSignal1D requires 1 input of type Signal1D and of category 0")}}]),t}(),Mesh3DToVolumetricHullFilter=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.addInputValidator("mesh",Mesh3D),e.setMetadata("voidValue",0),e.setMetadata("hullValue",254),e.setMetadata("resolutionStep",1),e.setMetadata("margin",1),e}return inherits(t,Filter),createClass(t,[{key:"_run",value:function(){if(this.hasValidInput()){for(var e=this._getInput("mesh"),t=e.getBox(),r=this.getMetadata("resolutionStep"),n=1/r,i=this.getMetadata("margin"),a={min:[Math.floor(t.min[0]-i),Math.floor(t.min[1]-i),Math.floor(t.min[2]-i)],max:[Math.ceil(t.max[0]+i),Math.ceil(t.max[1]+i),Math.ceil(t.max[2]+i)]},s=a.max[0]-a.min[0],o=a.max[1]-a.min[1],l=a.max[2]-a.min[2],u=[],c=[0,0,1],h=a.min[0];h<a.max[0];h+=r)for(var f=a.min[1];f<a.max[1];f+=r)for(var d=[h,f,0],p=e.intersectRay(d,c),g=0;g<p.length;g++)u.push(p[g].intersectionPoint);c=[1,0,0];for(f=a.min[1];f<a.max[1];f+=r)for(var _=a.min[2];_<a.max[2];_+=r)for(d=[0,f,_],p=e.intersectRay(d,c),g=0;g<p.length;g++)u.push(p[g].intersectionPoint);c=[0,1,0];for(h=a.min[0];h<a.max[0];h+=r)for(_=a.min[2];_<a.max[2];_+=r)for(d=[h,0,_],p=e.intersectRay(d,c),g=0;g<p.length;g++)u.push(p[g].intersectionPoint);var y=new Image3DAlt({xSize:s*n,ySize:o*n,zSize:l*n,tSize:1,ncpp:1}),m=this.getMetadata("voidValue"),v=this.getMetadata("hullValue");y.resetData(m);var b=[r,0,0,0,0,r,0,0,0,0,r,0,a.min[0],a.min[1],a.min[2],1],w=[n,0,0,0,0,n,0,0,0,0,n,0,-a.min[0]*n,-a.min[1]*n,-a.min[2]*n,1];y.addTransformation(b,"v2w"),y.addTransformation(w,"w2v");var E=y.getMetadata("dimensions");E[0].step=E[0].worldStep=E[0].worldUnitSize=r,E[1].step=E[1].worldStep=E[1].worldUnitSize=r,E[2].step=E[2].worldStep=E[2].worldUnitSize=r;for(g=0;g<u.length;g++){var T=u[g],k={x:(T.x-a.min[0])*n,y:(T.y-a.min[1])*n,z:(T.z-a.min[2])*n};y.setVoxel({i:Math.round(k.z),j:Math.round(k.y),k:Math.round(k.x)},v)}this._output[0]=y}else console.warn("A filter of type Mesh3DToVolumetricHullFilter requires 1 input of category 'mesh' of type Mesh3D")}}]),t}(),natninter_umd=createCommonjsModule(function(e,t){!function(e){var t,r=(function(e){function t(){this.vertices=null,this.edges=null,this.cells=null,this.toRecycle=null,this.beachsectionJunkyard=[],this.circleEventJunkyard=[],this.vertexJunkyard=[],this.edgeJunkyard=[],this.cellJunkyard=[]}t.prototype.reset=function(){if(this.beachline||(this.beachline=new this.RBTree),this.beachline.root)for(var e=this.beachline.getFirst(this.beachline.root);e;)this.beachsectionJunkyard.push(e),e=e.rbNext;this.beachline.root=null,this.circleEvents||(this.circleEvents=new this.RBTree),this.circleEvents.root=this.firstCircleEvent=null,this.vertices=[],this.edges=[],this.cells=[]},t.prototype.sqrt=Math.sqrt,t.prototype.abs=Math.abs,t.prototype.ε=t.ε=1e-9,t.prototype.invε=t.invε=1/t.ε,t.prototype.equalWithEpsilon=function(e,t){return this.abs(e-t)<1e-9},t.prototype.greaterThanWithEpsilon=function(e,t){return e-t>1e-9},t.prototype.greaterThanOrEqualWithEpsilon=function(e,t){return t-e<1e-9},t.prototype.lessThanWithEpsilon=function(e,t){return t-e>1e-9},t.prototype.lessThanOrEqualWithEpsilon=function(e,t){return e-t<1e-9},t.prototype.RBTree=function(){this.root=null},t.prototype.RBTree.prototype.rbInsertSuccessor=function(e,t){var r,n,i;if(e){if(t.rbPrevious=e,t.rbNext=e.rbNext,e.rbNext&&(e.rbNext.rbPrevious=t),e.rbNext=t,e.rbRight){for(e=e.rbRight;e.rbLeft;)e=e.rbLeft;e.rbLeft=t}else e.rbRight=t;r=e}else this.root?(e=this.getFirst(this.root),t.rbPrevious=null,t.rbNext=e,e.rbPrevious=t,e.rbLeft=t,r=e):(t.rbPrevious=t.rbNext=null,this.root=t,r=null);for(t.rbLeft=t.rbRight=null,t.rbParent=r,t.rbRed=!0,e=t;r&&r.rbRed;)n=r.rbParent,r===n.rbLeft?(i=n.rbRight)&&i.rbRed?(r.rbRed=i.rbRed=!1,n.rbRed=!0,e=n):(e===r.rbRight&&(this.rbRotateLeft(r),r=(e=r).rbParent),r.rbRed=!1,n.rbRed=!0,this.rbRotateRight(n)):(i=n.rbLeft)&&i.rbRed?(r.rbRed=i.rbRed=!1,n.rbRed=!0,e=n):(e===r.rbLeft&&(this.rbRotateRight(r),r=(e=r).rbParent),r.rbRed=!1,n.rbRed=!0,this.rbRotateLeft(n)),r=e.rbParent;this.root.rbRed=!1},t.prototype.RBTree.prototype.rbRemoveNode=function(e){e.rbNext&&(e.rbNext.rbPrevious=e.rbPrevious),e.rbPrevious&&(e.rbPrevious.rbNext=e.rbNext),e.rbNext=e.rbPrevious=null;var t,r,n=e.rbParent,i=e.rbLeft,a=e.rbRight;if(t=i?a?this.getFirst(a):i:a,n?n.rbLeft===e?n.rbLeft=t:n.rbRight=t:this.root=t,i&&a?(r=t.rbRed,t.rbRed=e.rbRed,t.rbLeft=i,i.rbParent=t,t!==a?(n=t.rbParent,t.rbParent=e.rbParent,e=t.rbRight,n.rbLeft=e,t.rbRight=a,a.rbParent=t):(t.rbParent=n,n=t,e=t.rbRight)):(r=e.rbRed,e=t),e&&(e.rbParent=n),!r)if(e&&e.rbRed)e.rbRed=!1;else{var s;do{if(e===this.root)break;if(e===n.rbLeft){if((s=n.rbRight).rbRed&&(s.rbRed=!1,n.rbRed=!0,this.rbRotateLeft(n),s=n.rbRight),s.rbLeft&&s.rbLeft.rbRed||s.rbRight&&s.rbRight.rbRed){s.rbRight&&s.rbRight.rbRed||(s.rbLeft.rbRed=!1,s.rbRed=!0,this.rbRotateRight(s),s=n.rbRight),s.rbRed=n.rbRed,n.rbRed=s.rbRight.rbRed=!1,this.rbRotateLeft(n),e=this.root;break}}else if((s=n.rbLeft).rbRed&&(s.rbRed=!1,n.rbRed=!0,this.rbRotateRight(n),s=n.rbLeft),s.rbLeft&&s.rbLeft.rbRed||s.rbRight&&s.rbRight.rbRed){s.rbLeft&&s.rbLeft.rbRed||(s.rbRight.rbRed=!1,s.rbRed=!0,this.rbRotateLeft(s),s=n.rbLeft),s.rbRed=n.rbRed,n.rbRed=s.rbLeft.rbRed=!1,this.rbRotateRight(n),e=this.root;break}s.rbRed=!0,e=n,n=n.rbParent}while(!e.rbRed);e&&(e.rbRed=!1)}},t.prototype.RBTree.prototype.rbRotateLeft=function(e){var t=e,r=e.rbRight,n=t.rbParent;n?n.rbLeft===t?n.rbLeft=r:n.rbRight=r:this.root=r,r.rbParent=n,t.rbParent=r,t.rbRight=r.rbLeft,t.rbRight&&(t.rbRight.rbParent=t),r.rbLeft=t},t.prototype.RBTree.prototype.rbRotateRight=function(e){var t=e,r=e.rbLeft,n=t.rbParent;n?n.rbLeft===t?n.rbLeft=r:n.rbRight=r:this.root=r,r.rbParent=n,t.rbParent=r,t.rbLeft=r.rbRight,t.rbLeft&&(t.rbLeft.rbParent=t),r.rbRight=t},t.prototype.RBTree.prototype.getFirst=function(e){for(;e.rbLeft;)e=e.rbLeft;return e},t.prototype.RBTree.prototype.getLast=function(e){for(;e.rbRight;)e=e.rbRight;return e},t.prototype.Diagram=function(e){this.site=e},t.prototype.Cell=function(e){this.site=e,this.halfedges=[],this.closeMe=!1},t.prototype.Cell.prototype.init=function(e){return this.site=e,this.halfedges=[],this.closeMe=!1,this},t.prototype.createCell=function(e){var t=this.cellJunkyard.pop();return t?t.init(e):new this.Cell(e)},t.prototype.Cell.prototype.prepareHalfedges=function(){for(var e,t=this.halfedges,r=t.length;r--;)(e=t[r].edge).vb&&e.va||t.splice(r,1);return t.sort(function(e,t){return t.angle-e.angle}),t.length},t.prototype.Cell.prototype.getNeighborIds=function(){for(var e,t=[],r=this.halfedges.length;r--;)null!==(e=this.halfedges[r].edge).lSite&&e.lSite.voronoiId!=this.site.voronoiId?t.push(e.lSite.voronoiId):null!==e.rSite&&e.rSite.voronoiId!=this.site.voronoiId&&t.push(e.rSite.voronoiId);return t},t.prototype.Cell.prototype.getBbox=function(){for(var e,t,r,n=this.halfedges,i=n.length,a=1/0,s=1/0,o=-1/0,l=-1/0;i--;)e=n[i].getStartpoint(),t=e.x,r=e.y,t<a&&(a=t),r<s&&(s=r),t>o&&(o=t),r>l&&(l=r);return{x:a,y:s,width:o-a,height:l-s}},t.prototype.Cell.prototype.pointIntersection=function(e,t){for(var r,n,i,a,s=this.halfedges,o=s.length;o--;){if(r=s[o],n=r.getStartpoint(),i=r.getEndpoint(),!(a=(t-n.y)*(i.x-n.x)-(e-n.x)*(i.y-n.y)))return 0;if(a>0)return-1}return 1},t.prototype.Vertex=function(e,t){this.x=e,this.y=t},t.prototype.Edge=function(e,t){this.lSite=e,this.rSite=t,this.va=this.vb=null},t.prototype.Halfedge=function(e,t,r){if(this.site=t,this.edge=e,r)this.angle=Math.atan2(r.y-t.y,r.x-t.x);else{var n=e.va,i=e.vb;this.angle=e.lSite===t?Math.atan2(i.x-n.x,n.y-i.y):Math.atan2(n.x-i.x,i.y-n.y)}},t.prototype.createHalfedge=function(e,t,r){return new this.Halfedge(e,t,r)},t.prototype.Halfedge.prototype.getStartpoint=function(){return this.edge.lSite===this.site?this.edge.va:this.edge.vb},t.prototype.Halfedge.prototype.getEndpoint=function(){return this.edge.lSite===this.site?this.edge.vb:this.edge.va},t.prototype.createVertex=function(e,t){var r=this.vertexJunkyard.pop();return r?(r.x=e,r.y=t):r=new this.Vertex(e,t),this.vertices.push(r),r},t.prototype.createEdge=function(e,t,r,n){var i=this.edgeJunkyard.pop();return i?(i.lSite=e,i.rSite=t,i.va=i.vb=null):i=new this.Edge(e,t),this.edges.push(i),r&&this.setEdgeStartpoint(i,e,t,r),n&&this.setEdgeEndpoint(i,e,t,n),this.cells[e.voronoiId].halfedges.push(this.createHalfedge(i,e,t)),this.cells[t.voronoiId].halfedges.push(this.createHalfedge(i,t,e)),i},t.prototype.createBorderEdge=function(e,t,r){var n=this.edgeJunkyard.pop();return n?(n.lSite=e,n.rSite=null):n=new this.Edge(e,null),n.va=t,n.vb=r,this.edges.push(n),n},t.prototype.setEdgeStartpoint=function(e,t,r,n){e.va||e.vb?e.lSite===r?e.vb=n:e.va=n:(e.va=n,e.lSite=t,e.rSite=r)},t.prototype.setEdgeEndpoint=function(e,t,r,n){this.setEdgeStartpoint(e,r,t,n)},t.prototype.Beachsection=function(){},t.prototype.createBeachsection=function(e){var t=this.beachsectionJunkyard.pop();return t||(t=new this.Beachsection),t.site=e,t},t.prototype.leftBreakPoint=function(e,t){var r=e.site,n=r.x,i=r.y,a=i-t;if(!a)return n;var s=e.rbPrevious;if(!s)return-1/0;var o=(r=s.site).x,l=r.y,u=l-t;if(!u)return o;var c=o-n,h=1/a-1/u,f=c/u;return h?(-f+this.sqrt(f*f-2*h*(c*c/(-2*u)-l+u/2+i-a/2)))/h+n:(n+o)/2},t.prototype.rightBreakPoint=function(e,t){var r=e.rbNext;if(r)return this.leftBreakPoint(r,t);var n=e.site;return n.y===t?n.x:1/0},t.prototype.detachBeachsection=function(e){this.detachCircleEvent(e),this.beachline.rbRemoveNode(e),this.beachsectionJunkyard.push(e)},t.prototype.removeBeachsection=function(e){var t=e.circleEvent,r=t.x,n=t.ycenter,i=this.createVertex(r,n),a=e.rbPrevious,s=e.rbNext,o=[e],l=Math.abs;this.detachBeachsection(e);for(var u=a;u.circleEvent&&l(r-u.circleEvent.x)<1e-9&&l(n-u.circleEvent.ycenter)<1e-9;)a=u.rbPrevious,o.unshift(u),this.detachBeachsection(u),u=a;o.unshift(u),this.detachCircleEvent(u);for(var c=s;c.circleEvent&&l(r-c.circleEvent.x)<1e-9&&l(n-c.circleEvent.ycenter)<1e-9;)s=c.rbNext,o.push(c),this.detachBeachsection(c),c=s;o.push(c),this.detachCircleEvent(c);var h,f=o.length;for(h=1;h<f;h++)c=o[h],u=o[h-1],this.setEdgeStartpoint(c.edge,u.site,c.site,i);u=o[0],(c=o[f-1]).edge=this.createEdge(u.site,c.site,void 0,i),this.attachCircleEvent(u),this.attachCircleEvent(c)},t.prototype.addBeachsection=function(e){for(var t,r,n,i,a=e.x,s=e.y,o=this.beachline.root;o;)if((n=this.leftBreakPoint(o,s)-a)>1e-9)o=o.rbLeft;else{if(!((i=a-this.rightBreakPoint(o,s))>1e-9)){n>-1e-9?(t=o.rbPrevious,r=o):i>-1e-9?(t=o,r=o.rbNext):t=r=o;break}if(!o.rbRight){t=o;break}o=o.rbRight}var l=this.createBeachsection(e);if(this.beachline.rbInsertSuccessor(t,l),t||r){if(t===r)return this.detachCircleEvent(t),r=this.createBeachsection(t.site),this.beachline.rbInsertSuccessor(l,r),l.edge=r.edge=this.createEdge(t.site,l.site),this.attachCircleEvent(t),void this.attachCircleEvent(r);if(!t||r){if(t!==r){this.detachCircleEvent(t),this.detachCircleEvent(r);var u=t.site,c=u.x,h=u.y,f=e.x-c,d=e.y-h,p=r.site,g=p.x-c,_=p.y-h,y=2*(f*_-d*g),m=f*f+d*d,v=g*g+_*_,b=this.createVertex((_*m-d*v)/y+c,(f*v-g*m)/y+h);return this.setEdgeStartpoint(r.edge,u,p,b),l.edge=this.createEdge(u,e,void 0,b),r.edge=this.createEdge(e,p,void 0,b),this.attachCircleEvent(t),void this.attachCircleEvent(r)}}else l.edge=this.createEdge(t.site,l.site)}},t.prototype.CircleEvent=function(){this.arc=null,this.rbLeft=null,this.rbNext=null,this.rbParent=null,this.rbPrevious=null,this.rbRed=!1,this.rbRight=null,this.site=null,this.x=this.y=this.ycenter=0},t.prototype.attachCircleEvent=function(e){var t=e.rbPrevious,r=e.rbNext;if(t&&r){var n=t.site,i=e.site,a=r.site;if(n!==a){var s=i.x,o=i.y,l=n.x-s,u=n.y-o,c=a.x-s,h=a.y-o,f=2*(l*h-u*c);if(!(f>=-2e-12)){var d=l*l+u*u,p=c*c+h*h,g=(h*d-u*p)/f,_=(l*p-c*d)/f,y=_+o,m=this.circleEventJunkyard.pop();m||(m=new this.CircleEvent),m.arc=e,m.site=i,m.x=g+s,m.y=y+this.sqrt(g*g+_*_),m.ycenter=y,e.circleEvent=m;for(var v=null,b=this.circleEvents.root;b;)if(m.y<b.y||m.y===b.y&&m.x<=b.x){if(!b.rbLeft){v=b.rbPrevious;break}b=b.rbLeft}else{if(!b.rbRight){v=b;break}b=b.rbRight}this.circleEvents.rbInsertSuccessor(v,m),v||(this.firstCircleEvent=m)}}}},t.prototype.detachCircleEvent=function(e){var t=e.circleEvent;t&&(t.rbPrevious||(this.firstCircleEvent=t.rbNext),this.circleEvents.rbRemoveNode(t),this.circleEventJunkyard.push(t),e.circleEvent=null)},t.prototype.connectEdge=function(e,t){var r=e.vb;if(r)return!0;var n,i,a=e.va,s=t.xl,o=t.xr,l=t.yt,u=t.yb,c=e.lSite,h=e.rSite,f=c.x,d=c.y,p=h.x,g=h.y,_=(f+p)/2,y=(d+g)/2;if(this.cells[c.voronoiId].closeMe=!0,this.cells[h.voronoiId].closeMe=!0,g!==d&&(i=y-(n=(f-p)/(g-d))*_),void 0===n){if(_<s||_>=o)return!1;if(f>p){if(!a||a.y<l)a=this.createVertex(_,l);else if(a.y>=u)return!1;r=this.createVertex(_,u)}else{if(!a||a.y>u)a=this.createVertex(_,u);else if(a.y<l)return!1;r=this.createVertex(_,l)}}else if(n<-1||n>1)if(f>p){if(!a||a.y<l)a=this.createVertex((l-i)/n,l);else if(a.y>=u)return!1;r=this.createVertex((u-i)/n,u)}else{if(!a||a.y>u)a=this.createVertex((u-i)/n,u);else if(a.y<l)return!1;r=this.createVertex((l-i)/n,l)}else if(d<g){if(!a||a.x<s)a=this.createVertex(s,n*s+i);else if(a.x>=o)return!1;r=this.createVertex(o,n*o+i)}else{if(!a||a.x>o)a=this.createVertex(o,n*o+i);else if(a.x<s)return!1;r=this.createVertex(s,n*s+i)}return e.va=a,e.vb=r,!0},t.prototype.clipEdge=function(e,t){var r=e.va.x,n=e.va.y,i=e.vb.x,a=e.vb.y,s=0,o=1,l=i-r,u=a-n,c=r-t.xl;if(0===l&&c<0)return!1;var h=-c/l;if(l<0){if(h<s)return!1;h<o&&(o=h)}else if(l>0){if(h>o)return!1;h>s&&(s=h)}if(c=t.xr-r,0===l&&c<0)return!1;if(h=c/l,l<0){if(h>o)return!1;h>s&&(s=h)}else if(l>0){if(h<s)return!1;h<o&&(o=h)}if(c=n-t.yt,0===u&&c<0)return!1;if(h=-c/u,u<0){if(h<s)return!1;h<o&&(o=h)}else if(u>0){if(h>o)return!1;h>s&&(s=h)}if(c=t.yb-n,0===u&&c<0)return!1;if(h=c/u,u<0){if(h>o)return!1;h>s&&(s=h)}else if(u>0){if(h<s)return!1;h<o&&(o=h)}return s>0&&(e.va=this.createVertex(r+s*l,n+s*u)),o<1&&(e.vb=this.createVertex(r+o*l,n+o*u)),(s>0||o<1)&&(this.cells[e.lSite.voronoiId].closeMe=!0,this.cells[e.rSite.voronoiId].closeMe=!0),!0},t.prototype.clipEdges=function(e){for(var t,r=this.edges,n=r.length,i=Math.abs;n--;)t=r[n],(!this.connectEdge(t,e)||!this.clipEdge(t,e)||i(t.va.x-t.vb.x)<1e-9&&i(t.va.y-t.vb.y)<1e-9)&&(t.va=t.vb=null,r.splice(n,1))},t.prototype.closeCells=function(e){for(var t,r,n,i,a,s,o,l,u,c=e.xl,h=e.xr,f=e.yt,d=e.yb,p=this.cells,g=p.length,_=Math.abs;g--;)if((t=p[g]).prepareHalfedges()&&t.closeMe){for(n=t.halfedges,i=n.length,r=0;r<i;){if(s=n[r].getEndpoint(),l=n[(r+1)%i].getStartpoint(),_(s.x-l.x)>=1e-9||_(s.y-l.y)>=1e-9)switch(!0){case this.equalWithEpsilon(s.x,c)&&this.lessThanWithEpsilon(s.y,d):if(u=this.equalWithEpsilon(l.x,c),o=this.createVertex(c,u?l.y:d),a=this.createBorderEdge(t.site,s,o),r++,n.splice(r,0,this.createHalfedge(a,t.site,null)),i++,u)break;s=o;case this.equalWithEpsilon(s.y,d)&&this.lessThanWithEpsilon(s.x,h):if(u=this.equalWithEpsilon(l.y,d),o=this.createVertex(u?l.x:h,d),a=this.createBorderEdge(t.site,s,o),r++,n.splice(r,0,this.createHalfedge(a,t.site,null)),i++,u)break;s=o;case this.equalWithEpsilon(s.x,h)&&this.greaterThanWithEpsilon(s.y,f):if(u=this.equalWithEpsilon(l.x,h),o=this.createVertex(h,u?l.y:f),a=this.createBorderEdge(t.site,s,o),r++,n.splice(r,0,this.createHalfedge(a,t.site,null)),i++,u)break;s=o;case this.equalWithEpsilon(s.y,f)&&this.greaterThanWithEpsilon(s.x,c):if(u=this.equalWithEpsilon(l.y,f),o=this.createVertex(u?l.x:c,f),a=this.createBorderEdge(t.site,s,o),r++,n.splice(r,0,this.createHalfedge(a,t.site,null)),i++,u)break;if(s=o,u=this.equalWithEpsilon(l.x,c),o=this.createVertex(c,u?l.y:d),a=this.createBorderEdge(t.site,s,o),r++,n.splice(r,0,this.createHalfedge(a,t.site,null)),i++,u)break;if(s=o,u=this.equalWithEpsilon(l.y,d),o=this.createVertex(u?l.x:h,d),a=this.createBorderEdge(t.site,s,o),r++,n.splice(r,0,this.createHalfedge(a,t.site,null)),i++,u)break;if(s=o,u=this.equalWithEpsilon(l.x,h),o=this.createVertex(h,u?l.y:f),a=this.createBorderEdge(t.site,s,o),r++,n.splice(r,0,this.createHalfedge(a,t.site,null)),i++,u)break;default:throw"Voronoi.closeCells() > this makes no sense!"}r++}t.closeMe=!1}},t.prototype.quantizeSites=function(e){for(var t,r=this.ε,n=e.length;n--;)(t=e[n]).x=Math.floor(t.x/r)*r,t.y=Math.floor(t.y/r)*r},t.prototype.recycle=function(e){if(e){if(!(e instanceof this.Diagram))throw"Voronoi.recycleDiagram() > Need a Diagram object.";this.toRecycle=e}},t.prototype.compute=function(e,t){var r=new Date;this.reset(),this.toRecycle&&(this.vertexJunkyard=this.vertexJunkyard.concat(this.toRecycle.vertices),this.edgeJunkyard=this.edgeJunkyard.concat(this.toRecycle.edges),this.cellJunkyard=this.cellJunkyard.concat(this.toRecycle.cells),this.toRecycle=null);var n=e.slice(0);n.sort(function(e,t){var r=t.y-e.y;return r||t.x-e.x});for(var i,a,s,o=n.pop(),l=0,u=this.cells;;)if(s=this.firstCircleEvent,o&&(!s||o.y<s.y||o.y===s.y&&o.x<s.x))o.x===i&&o.y===a||(u[l]=this.createCell(o),o.voronoiId=l++,this.addBeachsection(o),a=o.y,i=o.x),o=n.pop();else{if(!s)break;this.removeBeachsection(s.arc)}this.clipEdges(t),this.closeCells(t);var c=new Date,h=new this.Diagram;return h.cells=this.cells,h.edges=this.edges,h.vertices=this.vertices,h.execTime=c.getTime()-r.getTime(),this.reset(),h},e.exports=t}(t={exports:{}},t.exports),t.exports);function n(e){return Array.isArray(e)?{x:e[0],y:e[1]}:e}var i=function(e,t){for(var r=e[0],n=e[1],i=!1,a=0,s=t.length-1;a<t.length;s=a++){var o=t[a][0],l=t[a][1],u=t[s][0],c=t[s][1],h=l>n!=c>n&&r<(u-o)*(n-l)/(c-l)+o;h&&(i=!i)}return i},a=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(){function e(){a(this,e)}return s(e,null,[{key:"crossProduct",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=[t[1]*r[2]-t[2]*r[1],-1*(t[0]*r[2]-t[2]*r[0]),t[0]*r[1]-t[1]*r[0]];return n&&(i=e.normalize(i)),i}},{key:"dotProduct",value:function(e,t){if(e.length!=t.length)return console.log("ERROR: v1 and v2 must be the same size to compute a dot product"),null;for(var r=0,n=0;n<e.length;n++)r+=e[n]*t[n];return r}},{key:"normalize",value:function(t){var r=e.getNorm(t),n=[t[0]/r,t[1]/r,t[2]/r];return n}},{key:"getNorm",value:function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}},{key:"rotate",value:function(e,t){var r=[e[0]*t[0][0]+e[1]*t[0][1]+e[2]*t[0][2],e[0]*t[1][0]+e[1]*t[1][1]+e[2]*t[1][2],e[0]*t[2][0]+e[1]*t[2][1]+e[2]*t[2][2]];return r}},{key:"getAnglePoints",value:function(t,r,n){var i=[t[0]-r[0],t[1]-r[1],t[2]-r[2]],a=[n[0]-r[0],n[1]-r[1],n[2]-r[2]];i=e.normalize(i),a=e.normalize(a);var s=e.dotProduct(i,a),o=Math.acos(s);return o}},{key:"vector2DCrossing",value:function(e,t,r,n){var i=null,a=t[0]-e[0],s=t[1]-e[1],o=n[0]-r[0],l=n[1]-r[1],u=(-s*(e[0]-r[0])+a*(e[1]-r[1]))/(-o*s+a*l),c=(o*(e[1]-r[1])-l*(e[0]-r[0]))/(-o*s+a*l);return u>=0&&u<=1&&c>=0&&c<=1&&(i=[e[0]+c*a,e[1]+c*s]),i}},{key:"pointToSegmentDistance",value:function(e,t,r){var n,i,a=e[0]-t[0],s=e[1]-t[1],o=r[0]-t[0],l=r[1]-t[1],u=a*o+s*l,c=o*o+l*l,h=-1;0!=c&&(h=u/c),h<0?(n=t[0],i=t[1]):h>1?(n=r[0],i=r[1]):(n=t[0]+h*o,i=t[1]+h*l);var f=e[0]-n,d=e[1]-i;return Math.sqrt(f*f+d*d)}}]),e}(),l=function(){function e(t){if(a(this,e),this._isValid=!1,this._hull=null,this._area=null,Array.isArray(t)&&t.length>2){var r=null;"x"in t[0]&&"y"in t[0]?r=t.map(function(e){return[e.x,e.y]}):Array.isArray(t[0])&&(r=t.map(function(e){return[e[0],e[1]]})),r&&(r=e.removeDuplicateVertices(r),this._hull=e.orderPolygonPoints(r)),this._isValid=!!this._hull}}return s(e,[{key:"isValid",value:function(){return this._isValid}},{key:"getArea",value:function(){return this._area||(this._area=function(e,t){var r=e.length,i=0,a=t||!1;(e=e.map(n))[0]!=e[e.length-1]&&(e=e.concat(e[0]));for(var s=0;s<r;s++)i+=e[s].x*e[s+1].y-e[s].y*e[s+1].x;return a?i/2:Math.abs(i)/2}(this._hull)),this._area}},{key:"getCellReplacementIntersection",value:function(t){for(var r=this.getHull(),n=t.getHull(),a=[],s=r.length,l=n.length,u=0;u<s;u++){var c=r[u],h=r[(u+1)%s],f=i(r[u],n);f&&a.push(r[u]);for(var d=0;d<l;d++){if(0===u){var f=i(n[d],r);f&&a.push(n[d])}var p=n[d],g=n[(d+1)%l],_=o.vector2DCrossing(c,h,p,g);_&&a.push(_);var y=o.pointToSegmentDistance(p,c,h);y<1e-4&&a.push(p);var m=o.pointToSegmentDistance(c,p,g);m<1e-4&&a.push(c)}}var v=new e(a);return v}},{key:"getHull",value:function(){return this._hull}},{key:"isSame",value:function(e){var t=e.getHull();if(this._hull.length!==t.length)return!1;for(var r=0;r<t.length;r++)if(Math.abs(t[r][0]-this._hull[r][0])>1e-4||Math.abs(t[r][1]-this._hull[r][1])>1e-4)return!1;return!0}}],[{key:"removeDuplicateVertices",value:function(e){for(var t=[e[0]],r=1;r<e.length;r++){for(var n=!1,i=0;i<t.length;i++){var a=Math.abs(e[r][0]-t[i][0]),s=Math.abs(e[r][1]-t[i][1]);if(a<1e-4&&s<1e-4){n=!0;break}}n||t.push(e[r])}return t}},{key:"getPolygonCenter",value:function(e){for(var t=e.length,r=0,n=0,i=0,a=0;a<t;a++)r+=e[a][0],n+=e[a][1],i+=e[a][2];var s=[r/=t,n/=t,i/=t];return s}},{key:"orderPolygonPoints",value:function(t){for(var r=t.length,n=e.getPolygonCenter(t),i=new Array(r),a=[0,1,0],s=0;s<r;s++){var l=[n[0]-t[s][0],n[1]-t[s][1],0],u=o.normalize(l),c=o.dotProduct(a,u),h=Math.acos(c),f=o.crossProduct(a,u),d=o.dotProduct(f,[0,0,1])>0?1:-1;(h*=d)<0&&(h=Math.PI+(Math.PI+h)),i[s]={vertex:t[s],angle:h}}i.sort(function(e,t){return e.angle-t.angle});for(var p=[],s=0;s<r;s++)p.push(i[s].vertex);return p}}]),e}(),u=function(){function e(t,r){a(this,e),this._hash=e.genarateHash(r.x,r.y),this._polygon=new l(t),this._seed=r,this._isValid=this._polygon.isValid()&&!!this._hash}return s(e,[{key:"isValid",value:function(){return this._isValid}},{key:"getHash",value:function(){return this._hash}},{key:"getSeed",value:function(){return this._seed}},{key:"getPolygon",value:function(){return this._polygon}},{key:"getArea",value:function(){return this._polygon.getArea()}},{key:"intersectWithCell",value:function(e){return this._polygon.getCellReplacementIntersection(e.getPolygon())}},{key:"hasSamePolygon",value:function(e){return this._polygon.isSame(e.getPolygon())}}],[{key:"genarateHash",value:function(e,t){var r=e.toString()+"_"+t.toString();return r}}]),e}(),c=function(){function e(){a(this,e),this._cells={},this._cellArray=[],this._addedSeedHash=null}return s(e,[{key:"buildFromVoronoiDiagram",value:function(e){for(var t=e.cells,r=0;r<t.length;r++){for(var n=t[r].halfedges,i=[],a=0;a<n.length;a++)i.push(n[a].edge.va),i.push(n[a].edge.vb);var s=new u(i,t[r].site);s.isValid()&&(this._cells[s.getHash()]=s,this._cellArray.push(s))}}},{key:"getCellHashes",value:function(){return Object.keys(this._cells)}},{key:"getCell",value:function(e){return e in this._cells?this._cells[e]:null}},{key:"referenceSeed",value:function(e,t){this._addedSeedHash=u.genarateHash(e,t)}},{key:"getReferencedSeedCell",value:function(){return this._cells[this._addedSeedHash]}},{key:"getStolenAreaInfo",value:function(e){var t=e.getReferencedSeedCell(),r=(t.getArea(),[]);for(var n in this._cells)if(n!==t.getHash()){var i=this._cells[n],a=e.getCell(n),s=i.hasSamePolygon(a);if(!s){var o=0,l=t.intersectWithCell(i);if(l.isValid()){var u=l.getArea();o=u/t.getArea()}o=Math.round(1e4*o)/1e4,r.push({seedIndex:i.getSeed().seedIndex,weight:o})}}return r}}]),e}(),h=function(){function e(){a(this,e),this._seeds=[],this._output={width:256,height:256},this._samplingMap=[],this._recomputeMap=!0,this._seedCellCollection=null,this._onProgressCallback=null}return s(e,[{key:"onProgress",value:function(e){e&&"function"==typeof e&&(this._onProgressCallback=e)}},{key:"cleanSeeds",value:function(){this._seeds=[],this._recomputeMap=!0}},{key:"addSeed",value:function(e){"x"in e&&"y"in e&&"value"in e&&(this._seeds.push(e),this._recomputeMap=!0)}},{key:"addSeeds",value:function(e){for(var t=0;t<e.length;t++)this.addSeed(e[t])}},{key:"getNumberOfSeeds",value:function(){return this._seeds.length}},{key:"setOutputSize",value:function(e,t){e>0&&t>0&&(this._output.width=e,this._output.height=t)}},{key:"hasAllSeedsInside",value:function(){var e=this._output;return this._seeds.every(function(t){return t.x>=0&&t.y>=0&&t.x<e.width&&t.y<e.width})}},{key:"generateMap",value:function(){if(!this.hasAllSeedsInside())return console.log("ERR: some seeds are outside of the image. Use .setOutputSize() to change the output size or modify the seed."),!1;this._generateSeedCells();var e=this._output.width,t=this._output.height;this._samplingMap=new Array(e*t);for(var r=0;r<e;r++){this._onProgressCallback&&this._onProgressCallback(Math.round((r+1)/e*100),"sampling map");for(var n=0;n<t;n++){var i=this.isAtSeedPosition(r,n),a=r+n*e;if(-1===i){var s=this._generatePixelCells(r,n),o=this._seedCellCollection.getStolenAreaInfo(s);this._samplingMap[a]=o}else this._samplingMap[a]=[{seedIndex:i,weight:1}]}}return!0}},{key:"getMap",value:function(e){return this._samplingMap}},{key:"setMap",value:function(e){return e.length===this._output.width*this._output.height?(this._samplingMap=e,!0):(console.log("The sampling map must be an 1D array of size output.x*output.y"),!1)}},{key:"isAtSeedPosition",value:function(e,t){return this._seeds.findIndex(function(r){return r.x==e&&r.y==t})}},{key:"_generateSeedCells",value:function(){var e={xl:0,xr:this._output.width,yt:0,yb:this._output.height},t=this._seeds.map(function(e,t){return{x:e.x,y:e.y,seedIndex:t}}),n=new r,i=n.compute(t,e);this._seedCellCollection=new c,this._seedCellCollection.buildFromVoronoiDiagram(i)}},{key:"_generatePixelCells",value:function(e,t){var n=new r,i={xl:0,xr:this._output.width,yt:0,yb:this._output.height},a=this._seeds.map(function(e,t){return{x:e.x,y:e.y,seedIndex:t}});a.push({x:e,y:t,seedIndex:-1});var s=n.compute(a,i),o=new c;return o.buildFromVoronoiDiagram(s),o.referenceSeed(e,t),o}},{key:"generateImage",value:function(){for(var e=this._output.width*this._output.height,t=new Float32Array(e),r=this._seeds,n=this._samplingMap,i=0;i<e;i++){this._onProgressCallback&&this._onProgressCallback(Math.round((i+1)/e*100),"output image");for(var a=n[i],s=0,o=0;o<a.length;o++)s+=a[o].weight*r[a[o].seedIndex].value;t[i]=s}return{_metadata:{width:this._output.width,height:this._output.height},_data:t}}}]),e}();e.Interpolator=h,Object.defineProperty(e,"__esModule",{value:!0})}(t)}),natninter=unwrapExports(natninter_umd),NaturalNeighborSparseInterpolationImageFilter=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setMetadata("outputSize",{width:0,height:0}),e.setMetadata("samplingMapOnly",!1),console.log(natninter),e}return inherits(t,Filter),createClass(t,[{key:"_run",value:function(){var e=this._getInput("seeds"),t=this._getInput("samplingMap"),r=this.getMetadata("outputSize"),n=this.getMetadata("samplingMapOnly");if(e)if(r&&r.width>0&&r.height>0){var i=new natninter.Interpolator;if(i.setOutputSize(r.width,r.height),i.addSeeds(e),0!==i.getNumberOfSeeds()){if(t){if(!i.setMap(t))return void console.log("The provided sampling map is of the wrong size.")}else{if(!i.generateMap())return void console.log("The sampling map generation went wrong.");this._output.samplingMap=i.getMap()}if(!n){var a=i.generateImage(),s=new Image2D;s.setData(a._data,r.width,r.height,1);for(var o=1/0,l=-1/0,u=0;u<e.length;u++)o=Math.min(o,e[u].value),l=Math.max(l,e[u].value);s.setMetadata("min",o),s.setMetadata("max",l),this._output[0]=s}}else console.log("Seeds are probably of the wrong format, check documentation.")}else console.log("The output size must be of form {width: Number, height: Number}, both being positive.");else console.log("The sparse nn interpolation needs seeds to process.")}}]),t}(),ColorScales={jet:[{index:0,rgb:[0,0,131]},{index:.125,rgb:[0,60,170]},{index:.375,rgb:[5,255,255]},{index:.625,rgb:[255,255,0]},{index:.875,rgb:[250,0,0]},{index:1,rgb:[128,0,0]}],hsv:[{index:0,rgb:[255,0,0]},{index:.169,rgb:[253,255,2]},{index:.173,rgb:[247,255,2]},{index:.337,rgb:[0,252,4]},{index:.341,rgb:[0,252,10]},{index:.506,rgb:[1,249,255]},{index:.671,rgb:[2,0,253]},{index:.675,rgb:[8,0,253]},{index:.839,rgb:[255,0,251]},{index:.843,rgb:[255,0,245]},{index:1,rgb:[255,0,6]}],hot:[{index:0,rgb:[0,0,0]},{index:.3,rgb:[230,0,0]},{index:.6,rgb:[255,210,0]},{index:1,rgb:[255,255,255]}],cool:[{index:0,rgb:[0,255,255]},{index:1,rgb:[255,0,255]}],spring:[{index:0,rgb:[255,0,255]},{index:1,rgb:[255,255,0]}],summer:[{index:0,rgb:[0,128,102]},{index:1,rgb:[255,255,102]}],autumn:[{index:0,rgb:[255,0,0]},{index:1,rgb:[255,255,0]}],winter:[{index:0,rgb:[0,0,255]},{index:1,rgb:[0,255,128]}],bone:[{index:0,rgb:[0,0,0]},{index:.376,rgb:[84,84,116]},{index:.753,rgb:[169,200,200]},{index:1,rgb:[255,255,255]}],copper:[{index:0,rgb:[0,0,0]},{index:.804,rgb:[255,160,102]},{index:1,rgb:[255,199,127]}],greys:[{index:0,rgb:[0,0,0]},{index:1,rgb:[255,255,255]}],yignbu:[{index:0,rgb:[8,29,88]},{index:.125,rgb:[37,52,148]},{index:.25,rgb:[34,94,168]},{index:.375,rgb:[29,145,192]},{index:.5,rgb:[65,182,196]},{index:.625,rgb:[127,205,187]},{index:.75,rgb:[199,233,180]},{index:.875,rgb:[237,248,217]},{index:1,rgb:[255,255,217]}],greens:[{index:0,rgb:[0,68,27]},{index:.125,rgb:[0,109,44]},{index:.25,rgb:[35,139,69]},{index:.375,rgb:[65,171,93]},{index:.5,rgb:[116,196,118]},{index:.625,rgb:[161,217,155]},{index:.75,rgb:[199,233,192]},{index:.875,rgb:[229,245,224]},{index:1,rgb:[247,252,245]}],yiorrd:[{index:0,rgb:[128,0,38]},{index:.125,rgb:[189,0,38]},{index:.25,rgb:[227,26,28]},{index:.375,rgb:[252,78,42]},{index:.5,rgb:[253,141,60]},{index:.625,rgb:[254,178,76]},{index:.75,rgb:[254,217,118]},{index:.875,rgb:[255,237,160]},{index:1,rgb:[255,255,204]}],bluered:[{index:0,rgb:[0,0,255]},{index:1,rgb:[255,0,0]}],rdbu:[{index:0,rgb:[5,10,172]},{index:.35,rgb:[106,137,247]},{index:.5,rgb:[190,190,190]},{index:.6,rgb:[220,170,132]},{index:.7,rgb:[230,145,90]},{index:1,rgb:[178,10,28]}],picnic:[{index:0,rgb:[0,0,255]},{index:.1,rgb:[51,153,255]},{index:.2,rgb:[102,204,255]},{index:.3,rgb:[153,204,255]},{index:.4,rgb:[204,204,255]},{index:.5,rgb:[255,255,255]},{index:.6,rgb:[255,204,255]},{index:.7,rgb:[255,153,255]},{index:.8,rgb:[255,102,204]},{index:.9,rgb:[255,102,102]},{index:1,rgb:[255,0,0]}],rainbow:[{index:0,rgb:[150,0,90]},{index:.125,rgb:[0,0,200]},{index:.25,rgb:[0,25,255]},{index:.375,rgb:[0,152,255]},{index:.5,rgb:[44,255,150]},{index:.625,rgb:[151,255,0]},{index:.75,rgb:[255,234,0]},{index:.875,rgb:[255,111,0]},{index:1,rgb:[255,0,0]}],portland:[{index:0,rgb:[12,51,131]},{index:.25,rgb:[10,136,186]},{index:.5,rgb:[242,211,56]},{index:.75,rgb:[242,143,56]},{index:1,rgb:[217,30,30]}],blackbody:[{index:0,rgb:[0,0,0]},{index:.2,rgb:[230,0,0]},{index:.4,rgb:[230,210,0]},{index:.7,rgb:[255,255,255]},{index:1,rgb:[160,200,255]}],earth:[{index:0,rgb:[0,0,130]},{index:.1,rgb:[0,180,180]},{index:.2,rgb:[40,210,40]},{index:.4,rgb:[230,230,50]},{index:.6,rgb:[120,70,20]},{index:1,rgb:[255,255,255]}],electric:[{index:0,rgb:[0,0,0]},{index:.15,rgb:[30,0,100]},{index:.4,rgb:[120,0,100]},{index:.6,rgb:[160,90,0]},{index:.8,rgb:[230,200,0]},{index:1,rgb:[255,250,220]}],viridis:[{index:0,rgb:[68,1,84]},{index:.13,rgb:[71,44,122]},{index:.25,rgb:[59,81,139]},{index:.38,rgb:[44,113,142]},{index:.5,rgb:[33,144,141]},{index:.63,rgb:[39,173,129]},{index:.75,rgb:[92,200,99]},{index:.88,rgb:[170,220,50]},{index:1,rgb:[253,231,37]}],inferno:[{index:0,rgb:[0,0,4]},{index:.13,rgb:[31,12,72]},{index:.25,rgb:[85,15,109]},{index:.38,rgb:[136,34,106]},{index:.5,rgb:[186,54,85]},{index:.63,rgb:[227,89,51]},{index:.75,rgb:[249,140,10]},{index:.88,rgb:[249,201,50]},{index:1,rgb:[252,255,164]}],magma:[{index:0,rgb:[0,0,4]},{index:.13,rgb:[28,16,68]},{index:.25,rgb:[79,18,123]},{index:.38,rgb:[129,37,129]},{index:.5,rgb:[181,54,122]},{index:.63,rgb:[229,80,100]},{index:.75,rgb:[251,135,97]},{index:.88,rgb:[254,194,135]},{index:1,rgb:[252,253,191]}],plasma:[{index:0,rgb:[13,8,135]},{index:.13,rgb:[75,3,161]},{index:.25,rgb:[125,3,168]},{index:.38,rgb:[168,34,150]},{index:.5,rgb:[203,70,121]},{index:.63,rgb:[229,107,93]},{index:.75,rgb:[248,148,65]},{index:.88,rgb:[253,195,40]},{index:1,rgb:[240,249,33]}],warm:[{index:0,rgb:[125,0,179]},{index:.13,rgb:[172,0,187]},{index:.25,rgb:[219,0,170]},{index:.38,rgb:[255,0,130]},{index:.5,rgb:[255,63,74]},{index:.63,rgb:[255,123,0]},{index:.75,rgb:[234,176,0]},{index:.88,rgb:[190,228,0]},{index:1,rgb:[147,255,0]}],cool2:[{index:0,rgb:[125,0,179]},{index:.13,rgb:[116,0,218]},{index:.25,rgb:[98,74,237]},{index:.38,rgb:[68,146,231]},{index:.5,rgb:[0,204,197]},{index:.63,rgb:[0,247,146]},{index:.75,rgb:[0,255,88]},{index:.88,rgb:[40,255,8]},{index:1,rgb:[147,255,0]}],"rainbow-soft":[{index:0,rgb:[125,0,179]},{index:.1,rgb:[199,0,180]},{index:.2,rgb:[255,0,121]},{index:.3,rgb:[255,108,0]},{index:.4,rgb:[222,194,0]},{index:.5,rgb:[150,255,0]},{index:.6,rgb:[0,255,55]},{index:.7,rgb:[0,246,150]},{index:.8,rgb:[50,167,222]},{index:.9,rgb:[103,51,235]},{index:1,rgb:[124,0,186]}],bathymetry:[{index:0,rgb:[40,26,44]},{index:.13,rgb:[59,49,90]},{index:.25,rgb:[64,76,139]},{index:.38,rgb:[63,110,151]},{index:.5,rgb:[72,142,158]},{index:.63,rgb:[85,174,163]},{index:.75,rgb:[120,206,163]},{index:.88,rgb:[187,230,172]},{index:1,rgb:[253,254,204]}],cdom:[{index:0,rgb:[47,15,62]},{index:.13,rgb:[87,23,86]},{index:.25,rgb:[130,28,99]},{index:.38,rgb:[171,41,96]},{index:.5,rgb:[206,67,86]},{index:.63,rgb:[230,106,84]},{index:.75,rgb:[242,149,103]},{index:.88,rgb:[249,193,135]},{index:1,rgb:[254,237,176]}],chlorophyll:[{index:0,rgb:[18,36,20]},{index:.13,rgb:[25,63,41]},{index:.25,rgb:[24,91,59]},{index:.38,rgb:[13,119,72]},{index:.5,rgb:[18,148,80]},{index:.63,rgb:[80,173,89]},{index:.75,rgb:[132,196,122]},{index:.88,rgb:[175,221,162]},{index:1,rgb:[215,249,208]}],density:[{index:0,rgb:[54,14,36]},{index:.13,rgb:[89,23,80]},{index:.25,rgb:[110,45,132]},{index:.38,rgb:[120,77,178]},{index:.5,rgb:[120,113,213]},{index:.63,rgb:[115,151,228]},{index:.75,rgb:[134,185,227]},{index:.88,rgb:[177,214,227]},{index:1,rgb:[230,241,241]}],"freesurface-blue":[{index:0,rgb:[30,4,110]},{index:.13,rgb:[47,14,176]},{index:.25,rgb:[41,45,236]},{index:.38,rgb:[25,99,212]},{index:.5,rgb:[68,131,200]},{index:.63,rgb:[114,156,197]},{index:.75,rgb:[157,181,203]},{index:.88,rgb:[200,208,216]},{index:1,rgb:[241,237,236]}],"freesurface-red":[{index:0,rgb:[60,9,18]},{index:.13,rgb:[100,17,27]},{index:.25,rgb:[142,20,29]},{index:.38,rgb:[177,43,27]},{index:.5,rgb:[192,87,63]},{index:.63,rgb:[205,125,105]},{index:.75,rgb:[216,162,148]},{index:.88,rgb:[227,199,193]},{index:1,rgb:[241,237,236]}],oxygen:[{index:0,rgb:[64,5,5]},{index:.13,rgb:[106,6,15]},{index:.25,rgb:[144,26,7]},{index:.38,rgb:[168,64,3]},{index:.5,rgb:[188,100,4]},{index:.63,rgb:[206,136,11]},{index:.75,rgb:[220,174,25]},{index:.88,rgb:[231,215,44]},{index:1,rgb:[248,254,105]}],par:[{index:0,rgb:[51,20,24]},{index:.13,rgb:[90,32,35]},{index:.25,rgb:[129,44,34]},{index:.38,rgb:[159,68,25]},{index:.5,rgb:[182,99,19]},{index:.63,rgb:[199,134,22]},{index:.75,rgb:[212,171,35]},{index:.88,rgb:[221,210,54]},{index:1,rgb:[225,253,75]}],phase:[{index:0,rgb:[145,105,18]},{index:.13,rgb:[184,71,38]},{index:.25,rgb:[186,58,115]},{index:.38,rgb:[160,71,185]},{index:.5,rgb:[110,97,218]},{index:.63,rgb:[50,123,164]},{index:.75,rgb:[31,131,110]},{index:.88,rgb:[77,129,34]},{index:1,rgb:[145,105,18]}],salinity:[{index:0,rgb:[42,24,108]},{index:.13,rgb:[33,50,162]},{index:.25,rgb:[15,90,145]},{index:.38,rgb:[40,118,137]},{index:.5,rgb:[59,146,135]},{index:.63,rgb:[79,175,126]},{index:.75,rgb:[120,203,104]},{index:.88,rgb:[193,221,100]},{index:1,rgb:[253,239,154]}],temperature:[{index:0,rgb:[4,35,51]},{index:.13,rgb:[23,51,122]},{index:.25,rgb:[85,59,157]},{index:.38,rgb:[129,79,143]},{index:.5,rgb:[175,95,130]},{index:.63,rgb:[222,112,101]},{index:.75,rgb:[249,146,66]},{index:.88,rgb:[249,196,65]},{index:1,rgb:[232,250,91]}],turbidity:[{index:0,rgb:[34,31,27]},{index:.13,rgb:[65,50,41]},{index:.25,rgb:[98,69,52]},{index:.38,rgb:[131,89,57]},{index:.5,rgb:[161,112,59]},{index:.63,rgb:[185,140,66]},{index:.75,rgb:[202,174,88]},{index:.88,rgb:[216,209,126]},{index:1,rgb:[233,246,171]}],"velocity-blue":[{index:0,rgb:[17,32,64]},{index:.13,rgb:[35,52,116]},{index:.25,rgb:[29,81,156]},{index:.38,rgb:[31,113,162]},{index:.5,rgb:[50,144,169]},{index:.63,rgb:[87,173,176]},{index:.75,rgb:[149,196,189]},{index:.88,rgb:[203,221,211]},{index:1,rgb:[254,251,230]}],"velocity-green":[{index:0,rgb:[23,35,19]},{index:.13,rgb:[24,64,38]},{index:.25,rgb:[11,95,45]},{index:.38,rgb:[39,123,35]},{index:.5,rgb:[95,146,12]},{index:.63,rgb:[152,165,18]},{index:.75,rgb:[201,186,69]},{index:.88,rgb:[233,216,137]},{index:1,rgb:[255,253,205]}],cubehelix:[{index:0,rgb:[0,0,0]},{index:.07,rgb:[22,5,59]},{index:.13,rgb:[60,4,105]},{index:.2,rgb:[109,1,135]},{index:.27,rgb:[161,0,147]},{index:.33,rgb:[210,2,142]},{index:.4,rgb:[251,11,123]},{index:.47,rgb:[255,29,97]},{index:.53,rgb:[255,54,69]},{index:.6,rgb:[255,85,46]},{index:.67,rgb:[255,120,34]},{index:.73,rgb:[255,157,37]},{index:.8,rgb:[241,191,57]},{index:.87,rgb:[224,220,93]},{index:.93,rgb:[218,241,142]},{index:1,rgb:[227,253,198]}]},Colormap=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};classCallCheck(this,t);var r=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));r._type=t.TYPE(),r._colormapDescription=null,r._LUT=[],r.setMetadata("flip",!1);var n=r._getOption(e,"style",null);if(n)r.setStyle(n);else{var i=r._getOption(e,"description",null);r.setDescription(i)}if(r._colormapDescription){var a=r._getOption(e,"lutSize",null);a&&r.buildLut(a)}return r}return inherits(t,PixpipeObject),createClass(t,[{key:"setStyle",value:function(e){e in ColorScales?this._validateDescription(ColorScales[e])&&(this._colormapDescription=JSON.parse(JSON.stringify(ColorScales[e]))):console.warn("The given colormap style des not exist.")}},{key:"setDescription",value:function(e){var t="string"==typeof e?JSON.parse(e):e;t&&this._validateDescription(t)&&(this._colormapDescription=t)}},{key:"_validateDescription",value:function(e){if(!Array.isArray(e))return console.warn("The colormap description has to be an Array"),!1;for(var t=0;t<e.length;t++){if(null===e[t]||"object"!==_typeof(e[t]))return console.warn("Each colormap segment must be a non-null object"),!1;if(!("index"in e[t]&&"rgb"in e[t]))return console.warn("Each colormap segment must have a 'index' property and a 'rgb' property."),!1;if("number"!=typeof e[t].index)return console.warn("Each colormap segment 'index' property should be a number."),!1;if(e[t].index<0||e[t].index>1)return console.warn("Each colormap segment 'index' property should be in [0, 1]"),!1;if(Array.isArray(e[t].rgb)){if(3!=e[t].rgb.length)return console.warn("Each colormap segment 'rgb' should contain 3 values"),!1;for(var r=0;r<e[t].rgb.length;r++)if(e[t].rgb[r]<0||e[t].rgb[r]>255)return console.warn("The colormap must have only values in [0, 255]"),!1}}return!0}},{key:"getValueAt",value:function(e){if(!this._colormapDescription)return console.warn("The colormap description is not defined."),null;if(this._metadata.flip&&(e=1-e),e<=this._colormapDescription[0].index)return this._colormapDescription[0].rgb.slice();if(e>=this._colormapDescription[this._colormapDescription.length-1].index)return this._colormapDescription[this._colormapDescription.length-1].rgb.slice();for(var t=0;t<this._colormapDescription.length-1;t++)if(e>=this._colormapDescription[t].index&&e<this._colormapDescription[t+1].index){var r=(e-this._colormapDescription[t].index)/(this._colormapDescription[t+1].index-this._colormapDescription[t].index),n=1-r;return[Math.round(this._colormapDescription[t].rgb[0]*n+this._colormapDescription[t+1].rgb[0]*r),Math.round(this._colormapDescription[t].rgb[1]*n+this._colormapDescription[t+1].rgb[1]*r),Math.round(this._colormapDescription[t].rgb[2]*n+this._colormapDescription[t+1].rgb[2]*r)]}}},{key:"getValueAtWithClusters",value:function(e,t){var r=(Math.floor(e*t)+.5)/t;return this.getValueAt(r)}},{key:"buildLut",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.pow(2,16);if(!this._colormapDescription)return console.warn("The colormap description is not defined, the LUT cannot be created"),null;if(e<0)console.warn("Size of the colormap can not be negative.");else{this._LUT=new Array(e);for(var t=0;t<e;t++)this._LUT[t]=this.getValueAt(t/e+.5/e)}}},{key:"getLutAt",value:function(e){return e<0||e>this._LUT.length?null:this._LUT[e]}},{key:"getLutAtNormalized",value:function(e){var t=-1;return t=e<0?0:e<this._LUT.length?Math.floor(e*(this._LUT.length-1)):this._LUT.length-1,this._LUT[t]}},{key:"createHorizontalLutImage",value:function(){if(this._LUT){for(var e=this._LUT.length,t=new Image2D({width:e,height:1,color:[0,0,0]}),r=0;r<e;r++)t.setPixel({x:r,y:0},this._LUT[r]);return t}console.warn("The LUT must be built before creating a LUT image.")}},{key:"createVerticalLutImage",value:function(){if(this._LUT){for(var e=this._LUT.length,t=new Image2D({width:1,height:e,color:[0,0,0]}),r=0;r<e;r++)t.setPixel({x:0,y:r},this._LUT[r]);return t}console.warn("The LUT must be built before creating a LUT image.")}},{key:"addColor",value:function(e,t){if(this._colormapDescription||(this._colormapDescription=[]),e<0||e>1)return console.warn("The color cannot be added because its index is out of range [0, 1]"),!1;if(this._colormapDescription.find(function(t){return t.index==e}))return console.warn("A color is already present at index "+e),!1;if(!t||!Array.isArray(t)||3!=t.length)return console.warn("The color cannot be added because its rgb array is the wrong size."),!1;for(var r=0;r<t.length;r++)if("number"!=typeof t[r]||t[r]<0||t[r]>255)return console.warn("The rgb colors must be in [0, 255]"),!1;return this._colormapDescription.push({index:e,rgb:t.slice()}),this._colormapDescription.sort(function(e,t){return e.index-t.index}),!0}},{key:"removeColor",value:function(e){if(!this._colormapDescription)return console.warn("The colormap description is empty."),!1;var t=this._colormapDescription.findIndex(function(t){return t.index==e});return-1==t?(console.warn("Such index does not exist."),!1):(this._colormapDescription.splice(t,1),!0)}},{key:"toJson",value:function(){return JSON.stringify(this._colormapDescription)}}],[{key:"TYPE",value:function(){return"COLORMAP"}},{key:"getAvailableStyles",value:function(){return Object.keys(ColorScales)}}]),t}(),ApplyColormapFilter=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.addInputValidator(0,Image2D),e.setMetadata("style","jet"),e.setMetadata("flip",!1),e.setMetadata("min",void 0),e.setMetadata("max",void 0),e.setMetadata("clusters",null),e.setMetadata("component",0),e}return inherits(t,ImageToImageFilter),createClass(t,[{key:"_run",value:function(){if(this.hasValidInput()){var e=this._getInput(0),t=e.getWidth(),r=e.getHeight(),n=e.getNcpp(),i=this.getMetadata("component");if(i>=n)console.warn("The chosen component must be lower than the input ncpp");else{var a=this.getMetadata("min")||e.getMin(),s=this.getMetadata("max")||e.getMax(),o=this.getMetadata("clusters");if(Math.abs(a-s)<1e-6)console.warn("Min and max values are similar, no interpolation is possible.");else{var l=new Colormap;l.setMetadata("flip",this.getMetadata("flip")),l.setStyle(this.getMetadata("style"));var u=l.getValueAt.bind(l);o&&(u=l.getValueAtWithClusters.bind(l));e.getData();var c=new Image2D({width:t,height:r,color:new Uint8Array([0,0,0])});l.buildLut();for(var h=0;h<t;h++)for(var f=0;f<r;f++){var d=u((e.getPixel({x:h,y:f})[i]-a)/(s-a),o);c.setPixel({x:h,y:f},d)}this._output[0]=c}}}else console.warn("A filter of type CropImageFilter requires 1 input of category '0' (Image2D)")}}]),t}(),AngleToHueWheelHelper=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.addInputValidator(0,Image2D),e.setMetadata("component",0),e.setMetadata("minAngle",0),e.setMetadata("maxAngle",Math.PI/2),e}return inherits(t,ImageToImageFilter),createClass(t,[{key:"_run",value:function(){if(this.hasValidInput()){var e=this,t=this._getInput(0).getNcpp(),r=this.getMetadata("component");if(r<0&&r>=t)console.warn("The component to filter must be valid.");else{var n=this._getInput(),i=n.getWidth(),a=n.getHeight(),s=(t=n.getNcpp(),this.getMetadata("minAngle")),o=this.getMetadata("maxAngle");"auto"!==s&&"auto"!==o||(s=n.getMin(),o=n.getMax());var l=new Image2D({width:i,height:a,color:[0,0,0,255]}),u=new pixpipe.ForEachPixelImageFilter;u.addInput(l),u.on("pixel",function(t,i){var a=(n.getPixel(t)[r]-s)/(o-s)*360;return e._hsl2Rgba(a,100,50)}),u.update(),0!=u.getNumberOfOutputs()?this._output[0]=u.getOutput():console.warn("No output of ForEachPixelImageFilter.")}}else console.warn("A filter of type AngleToHueWheelHelper requires 1 input of category '0'.")}},{key:"_hsl2Rgba",value:function(e){var t,r,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;if(e=360===e?1:e%360/360,i=100===i?1:i%100/100,a=100===a?1:a%100/100,0===i)t=r=n=a;else{var s=function(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e},o=a<.5?a*(1+i):a+i-a*i,l=2*a-o;t=s(l,o,e+1/3),r=s(l,o,e),n=s(l,o,e-1/3)}return[Math.round(255*t),Math.round(255*r),Math.round(255*n),255]}}]),t}(),LineStringPrinterOnImage2DHelper=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.addInputValidator(0,Image2D),e.setMetadata("lineStrings",[]),e.setMetadata("lineStringsColors",[]),e}return inherits(t,ImageToImageFilter),createClass(t,[{key:"addLineString",value:function(e,t){this._metadata.lineStrings.push(e),this._metadata.lineStringsColors.push(t)}},{key:"_run",value:function(){if(this.hasValidInput()){for(var e=this._getInput(),t=e.clone(),r=(e.getWidth(),e.getHeight(),e.getNcpp()),n=!1,i=this._metadata.lineStrings,a=this._metadata.lineStringsColors,s=0;s<i.length;s++)if(2==i[s].getMetadata("nod")){if(r==a[s].length||4==r&&3==a[s].length){for(var o=i[s].getData(),l=0;l<o.length-1;l+=2)t.setPixel({x:o[l],y:o[l+1]},a[s]);n=!0}}else console.warn("Linstring must be 2D to be printed on images.");n&&(this._output[0]=t)}else console.warn("A filter of type LineStringPrinterOnImage2DHelper requires 1 input of category '0'.")}}]),t}(),Image3DToMosaicFilter=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.addInputValidator(0,Image3D),e.setMetadata("maxWidth",4096),e.setMetadata("maxHeight",4096),e.setMetadata("axis","xspace"),e.setMetadata("time",0),e}return inherits(t,Filter),createClass(t,[{key:"_run",value:function(){if(this.hasValidInput()){var e=this._getInput(0),t=e.getMetadata(this.getMetadata("axis"));if(t){var r=t.space_length,n=t.width,i=t.height,a=0,s=1;if(e.hasMetadata("time")){var o=e.getMetadata("time").space_length;-1==this._metadata.time?(a=0,s=o):this._metadata.time<o&&(s=(a=this._metadata.time)+1)}var l=r*(s-a),u=Math.floor(this.getMetadata("maxWidth")/n),c=Math.floor(this.getMetadata("maxHeight")/i),h=u*n,f=c*i,d=u*c;1==Math.ceil(l/d)&&(f=Math.ceil(l/u)*i),this.setMetadata("gridWidth",h/n),this.setMetadata("gridHeight",f/i);var p=0,g=0,_=0,y=null,m=null;if("xspace"===this._metadata.axis?m=function(t,r,n,i){return e.getIntensity_xyzOrientation(n,t,r,i)}:"yspace"===this._metadata.axis?m=function(t,r,n,i){return e.getIntensity_xyzOrientation(t,n,r,i)}:"zspace"===this._metadata.axis&&(m=function(t,r,n,i){return e.getIntensity_xyzOrientation(t,r,n,i)}),m)for(var v=new Array(e.getMetadata("ncpp")).fill(0),b=a;b<s;b++)for(var w=0;w<r;w++){g%d==0&&(y=new Image2D({width:h,height:f,color:v}),this._output[p]=y,_=0,p++);var E=_%u,T=Math.floor(_/u);_++;for(var k=E*n,x=T*i,S=0;S<i;S++)for(var I=0;I<n;I++){var A=[m(I,S,w,b)];y.setPixel({x:k+I,y:x+(i-S-1)},A)}g++}else console.warn("The axis to sample along for the mosaic was not properly set.")}else console.warn("Sampling axis for mosaicing was not poperly set. Has to be 'xspace', 'yspace' or 'zspace'.")}}}]),t}(),Image3DToMosaicFilterAlt=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.addInputValidator(0,Image3DAlt),e.setMetadata("maxWidth",4096),e.setMetadata("maxHeight",4096),e.setMetadata("axis","x"),e.setMetadata("time",0),e}return inherits(t,Filter),createClass(t,[{key:"_run",value:function(){if(this.hasValidInput()){var e=this._getInput(0),t=this.getMetadata("axis"),r=e.getSliceSize(t),n=e.getNumberOfSlices(t),i=e.getTimeLength(),a=0,s=1;if(-1==this._metadata.time)a=0,s=i;else{if(!(this._metadata.time>=0&&this._metadata.time<i))return void console.warn("The required time sample is out of bound. Must be 0 <= t < "+i);s=(a=this._metadata.time)+1}var o=n*(s-a),l=Math.floor(this.getMetadata("maxWidth")/r.w),u=Math.floor(this.getMetadata("maxHeight")/r.h),c=l*r.w,h=u*r.h,f=l*u;1==Math.ceil(o/f)&&(h=Math.ceil(o/l)*r.h),this.setMetadata("gridWidth",c/r.w),this.setMetadata("gridHeight",h/r.h);var d=new Array(e.getMetadata("ncpp")).fill(0),p=new PatchImageFilter;p.setMetadata("time",!1),p.setMetadata("outputSize",{w:c,h:h}),p.setMetadata("outputColor",d);for(var g=0,_=0,y=0,m=a;m<s;m++)for(var v=0;v<n;v++){_%f==0&&(p.setMetadata("resetOutput",!0),y=0);var b=y%l,w=Math.floor(y/l),E=b*r.w,T=w*r.h,k=e.getSlice(t,v,m);p.addInput(k),p.setMetadata("patchPosition",{x:E,y:T}),p.update(),_%f==0&&(this._output[g]=p.getOutput(),g++),y++,_++}}else console.warn("A filter of type Image3DToMosaicFilterAlt requires 1 input of category '0' (Image3DAlt)")}}]),t}();setMatrixArrayType(Array),exports.CoreTypes=CoreTypes,exports.PixpipeObject=PixpipeObject,exports.Filter=Filter,exports.Signal1D=Signal1D,exports.Image2D=Image2D,exports.Image3D=Image3D,exports.ImageToImageFilter=ImageToImageFilter,exports.MniVolume=MniVolume,exports.LineString=LineString,exports.Image3DAlt=Image3DAlt,exports.Mesh3D=Mesh3D,exports.Decoder=Decoder,exports.CanvasImageWriter=CanvasImageWriter,exports.UrlImageReader=UrlImageReader,exports.FileImageReader=FileImageReader,exports.FileToArrayBufferReader=FileToArrayBufferReader,exports.UrlToArrayBufferReader=UrlToArrayBufferReader,exports.BrowserDownloadBuffer=BrowserDownloadBuffer,exports.GenericDecoderInterface=GenericDecoderInterface,exports.Minc2Decoder=Minc2Decoder,exports.NiftiDecoder=NiftiDecoder,exports.NiftiDecoderAlt=NiftiDecoderAlt,exports.PixpEncoder=PixpEncoder,exports.PixpDecoder=PixpDecoder,exports.Image3DGenericDecoder=Image3DGenericDecoder,exports.Image3DGenericDecoderAlt=Image3DGenericDecoderAlt,exports.TiffDecoder=TiffDecoder,exports.MghDecoder=MghDecoder,exports.MghDecoderAlt=MghDecoderAlt,exports.EegModDecoder=EegModDecoder,exports.PixBinEncoder=PixBinEncoder,exports.PixBinDecoder=PixBinDecoder,exports.JpegDecoder=JpegDecoder,exports.PngDecoder=PngDecoder,exports.Image2DGenericDecoder=Image2DGenericDecoder,exports.Minc2DecoderAlt=Minc2DecoderAlt,exports.MniObjDecoder=MniObjDecoder,exports.EdfDecoder=EdfDecoder,exports.Mesh3DGenericDecoder=Mesh3DGenericDecoder,exports.AllFormatsGenericDecoder=AllFormatsGenericDecoder,exports.Signal1DGenericDecoder=Signal1DGenericDecoder,exports.ComponentProjectionImage2DFilter=ComponentProjectionImage2DFilter,exports.ComponentMergeImage2DFilter=ComponentMergeImage2DFilter,exports.ForwardFourierSignalFilter=ForwardFourierSignalFilter,exports.InverseFourierSignalFilter=InverseFourierSignalFilter,exports.ForwardFourierImageFilter=ForwardFourierImageFilter,exports.InverseFourierImageFilter=InverseFourierImageFilter,exports.ForEachPixelImageFilter=ForEachPixelImageFilter,exports.SpectralScaleImageFilter=SpectralScaleImageFilter,exports.ImageBlendExpressionFilter=ImageBlendExpressionFilter,exports.SpatialConvolutionFilter=SpatialConvolutionFilter,exports.MultiplyImageFilter=MultiplyImageFilter,exports.SimpleThresholdFilter=SimpleThresholdFilter,exports.ImageDerivativeFilter=ImageDerivativeFilter,exports.GradientImageFilter=GradientImageFilter,exports.NormalizeImageFilter=NormalizeImageFilter,exports.ContourImage2DFilter=ContourImage2DFilter,exports.FloodFillImageFilter=FloodFillImageFilter,exports.ContourHolesImage2DFilter=ContourHolesImage2DFilter,exports.ForEachPixelReadOnlyFilter=ForEachPixelReadOnlyFilter,exports.TerrainRgbToElevationImageFilter=TerrainRgbToElevationImageFilter,exports.NearestNeighborSparseInterpolationImageFilter=NearestNeighborSparseInterpolationImageFilter,exports.IDWSparseInterpolationImageFilter=IDWSparseInterpolationImageFilter,exports.TriangulationSparseInterpolationImageFilter=TriangulationSparseInterpolationImageFilter,exports.CropImageFilter=CropImageFilter,exports.SimplifyLineStringFilter=SimplifyLineStringFilter,exports.PatchImageFilter=PatchImageFilter,exports.DifferenceEquationSignal1D=DifferenceEquationSignal1D,exports.LowPassFreqSignal1D=LowPassFreqSignal1D,exports.LowPassSignal1D=LowPassSignal1D,exports.HighPassSignal1D=HighPassSignal1D,exports.BandPassSignal1D=BandPassSignal1D,exports.Mesh3DToVolumetricHullFilter=Mesh3DToVolumetricHullFilter,exports.NaturalNeighborSparseInterpolationImageFilter=NaturalNeighborSparseInterpolationImageFilter,exports.ApplyColormapFilter=ApplyColormapFilter,exports.AngleToHueWheelHelper=AngleToHueWheelHelper,exports.LineStringPrinterOnImage2DHelper=LineStringPrinterOnImage2DHelper,exports.Colormap=Colormap,exports.Image3DToMosaicFilter=Image3DToMosaicFilter,exports.Image3DToMosaicFilterAlt=Image3DToMosaicFilterAlt,exports.Image3DMetadataConverter=Image3DMetadataConverter,exports.MatrixTricks=MatrixTricks,exports.FunctionGenerator=FunctionGenerator,Object.defineProperty(exports,"__esModule",{value:!0})});
//# sourceMappingURL=pixpipe.js.map
